import{$ as ElButton,$t as _plugin_vue_export_helper_default,A as ElSelect,Bn as resolveComponent,J as ElTag,Jn as watchEffect,Lr as toDisplayString,Mn as onMounted,On as mergeModels,P as ElLink,Pn as openBlock,Pr as normalizeStyle,Rn as renderList,Sn as defineComponent,Ur as __toESM,V as ElDialog,Wn as useModel,Xn as withDirectives,Yn as withCtx,Zt as ElIcon,bn as createVNode,fn as computed,gn as createElementBlock,ir as ref,k as ElOption,ln as Fragment,mn as createBlock,nr as reactive,on as vShow,pn as createBaseVNode,rt as ElBadge,st as ElInput,yn as createTextVNode,zr as __commonJSMin}from"./index-DzasR-yf.js";/* empty css            *//* empty css            */import"./css-pkVQ7h14.js";/* empty css            *//* empty css            *//* empty css            *//* empty css            *//* empty css            *//* empty css            *//* empty css            */var import_dist=__commonJSMin(((e,g)=>{(function(_,v){typeof e==`object`&&typeof g==`object`?g.exports=v():typeof define==`function`&&define.amd?define([],v):typeof e==`object`?e.Poplar=v():_.Poplar=v()})(window,function(){return _={},e.m=g=[function(e,g,_){Object.defineProperty(g,`__esModule`,{value:!0}),g.SVGNS=`http://www.w3.org/2000/svg`},function(e,g,_){var v,y=this&&this.__extends||(v=function(e,g){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var _ in g)g.hasOwnProperty(_)&&(e[_]=g[_])})(e,g)},function(e,g){function _(){this.constructor=e}v(e,g),e.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)}),b=this&&this.__values||function(e){var g=typeof Symbol==`function`&&Symbol.iterator,_=g&&e[g],v=0;if(_)return _.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&v>=e.length&&(e=void 0),{value:e&&e[v++],done:!e}}};throw TypeError(g?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(g,`__esModule`,{value:!0});var x,S,C,w=_(4),T=_(3);function E(){var e=S!==null&&S.apply(this,arguments)||this;return e.entities=new Map,e.nextId=0,e}x=g.Base||={},S=T.EventEmitter,y(E,S),Object.defineProperty(E.prototype,`json`,{get:function(){var e,g,_=[];try{for(var v=b(this.values()),y=v.next();!y.done;y=v.next()){var x=y.value;`json`in x?_.push(x.json):_.push(JSON.parse(JSON.stringify(x)))}}catch(g){e={error:g}}finally{try{y&&!y.done&&(g=v.return)&&g.call(v)}finally{if(e)throw e.error}}return _},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,`length`,{get:function(){return this.entities.size},enumerable:!0,configurable:!0}),E.prototype.get=function(e){return w.assert(this.has(e),`There's no Entity which id=`+e+` in repo!`),this.entities.get(e)},E.prototype.has=function(e){return this.entities.has(e)},E.prototype.set=function(e,g){var _=this.has(e);return this.entities.set(e,g),_?this.emit(`updated`,g):(this.nextId<e+1&&(this.nextId=e+1),this.emit(`created`,g)),this},E.prototype.add=function(e){if(`id`in e){var g=e.id;return w.assert(!this.has(g),`reAdd `+g+`!`),g===null?(e.id=this.nextId,this.add(e)):(this.set(g,e),g)}var _=this.nextId;return this.set(_,e),_},E.prototype[Symbol.iterator]=function(){return this.entities[Symbol.iterator]()},E.prototype.delete=function(e){if(typeof e==`number`&&this.has(e)){var g=this.get(e);return this.entities.delete(e),this.emit(`removed`,g),!0}return typeof e!=`number`&&`id`in e&&this.delete(e.id)},E.prototype.values=function(){return this.entities.values()},C=E,x.Repository=C},function(e,g,_){Object.defineProperty(g,`__esModule`,{value:!0});var v=(Object.defineProperty(y.prototype,`isSome`,{get:function(){return this.value!==null},enumerable:!0,configurable:!0}),y.prototype.map=function(e){return this.value===null?new y(null):new y(e(this.value))},y.prototype.flatMap=function(e){return this.value===null?new y(null):x(e(this.value).toNullable())},y.prototype.orElse=function(e){return this.value===null?e:this.value},y.prototype.toNullable=function(){return this.value},y.prototype.match=function(e,g){return this.isSome?e:g},y);function y(e){this.value=e}function b(e){return new v(e)}function x(e){return e==null?g.none:b(e)}g.Option=v,g.none=new v(null),g.some=b,g.fromNullable=x,g.fromTry=function(e){try{return b(e())}catch{return g.none}}},function(e,g,_){var v,y=typeof Reflect==`object`?Reflect:null,b=y&&typeof y.apply==`function`?y.apply:function(e,g,_){return Function.prototype.apply.call(e,g,_)};v=y&&typeof y.ownKeys==`function`?y.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var x=Number.isNaN||function(e){return e!=e};function S(){S.init.call(this)}((e.exports=S).EventEmitter=S).prototype._events=void 0,S.prototype._eventsCount=0,S.prototype._maxListeners=void 0;var C=10;function w(e){return e._maxListeners===void 0?S.defaultMaxListeners:e._maxListeners}function T(e,g,_,v){var y,b,x;if(typeof _!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof _);if((b=e._events)===void 0?(b=e._events=Object.create(null),e._eventsCount=0):(b.newListener!==void 0&&(e.emit(`newListener`,g,_.listener?_.listener:_),b=e._events),x=b[g]),x===void 0)x=b[g]=_,++e._eventsCount;else if(typeof x==`function`?x=b[g]=v?[_,x]:[x,_]:v?x.unshift(_):x.push(_),0<(y=w(e))&&x.length>y&&!x.warned){x.warned=!0;var S=Error(`Possible EventEmitter memory leak detected. `+x.length+` `+String(g)+` listeners added. Use emitter.setMaxListeners() to increase limit`);S.name=`MaxListenersExceededWarning`,S.emitter=e,S.type=g,S.count=x.length,function(e){console&&console.warn}(S)}return e}function E(e,g,_){var v={fired:!1,wrapFn:void 0,target:e,type:g,listener:_},y=function(){for(var e=[],g=0;g<arguments.length;g++)e.push(arguments[g]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,b(this.listener,this.target,e))}.bind(v);return y.listener=_,v.wrapFn=y}function D(e,g,_){var v=e._events;if(v===void 0)return[];var y=v[g];return y===void 0?[]:typeof y==`function`?_?[y.listener||y]:[y]:_?function(e){for(var g=Array(e.length),_=0;_<g.length;++_)g[_]=e[_].listener||e[_];return g}(y):k(y,y.length)}function O(e){var g=this._events;if(g!==void 0){var _=g[e];if(typeof _==`function`)return 1;if(_!==void 0)return _.length}return 0}function k(e,g){for(var _=Array(g),v=0;v<g;++v)_[v]=e[v];return _}Object.defineProperty(S,`defaultMaxListeners`,{enumerable:!0,get:function(){return C},set:function(e){if(typeof e!=`number`||e<0||x(e))throw RangeError(`The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received `+e+`.`);C=e}}),S.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},S.prototype.setMaxListeners=function(e){if(typeof e!=`number`||e<0||x(e))throw RangeError(`The value of "n" is out of range. It must be a non-negative number. Received `+e+`.`);return this._maxListeners=e,this},S.prototype.getMaxListeners=function(){return w(this)},S.prototype.emit=function(e){for(var g=[],_=1;_<arguments.length;_++)g.push(arguments[_]);var v=e===`error`,y=this._events;if(y!==void 0)v&&=y.error===void 0;else if(!v)return!1;if(v){var x;if(0<g.length&&(x=g[0]),x instanceof Error)throw x;var S=Error(`Unhandled error.`+(x?` (`+x.message+`)`:``));throw S.context=x,S}var C=y[e];if(C===void 0)return!1;if(typeof C==`function`)b(C,this,g);else{var w=C.length,T=k(C,w);for(_=0;_<w;++_)b(T[_],this,g)}return!0},S.prototype.on=S.prototype.addListener=function(e,g){return T(this,e,g,!1)},S.prototype.prependListener=function(e,g){return T(this,e,g,!0)},S.prototype.once=function(e,g){if(typeof g!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof g);return this.on(e,E(this,e,g)),this},S.prototype.prependOnceListener=function(e,g){if(typeof g!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof g);return this.prependListener(e,E(this,e,g)),this},S.prototype.off=S.prototype.removeListener=function(e,g){var _,v,y,b,x;if(typeof g!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof g);if((v=this._events)===void 0||(_=v[e])===void 0)return this;if(_===g||_.listener===g)--this._eventsCount==0?this._events=Object.create(null):(delete v[e],v.removeListener&&this.emit(`removeListener`,e,_.listener||g));else if(typeof _!=`function`){for(y=-1,b=_.length-1;0<=b;b--)if(_[b]===g||_[b].listener===g){x=_[b].listener,y=b;break}if(y<0)return this;y===0?_.shift():function(e,g){for(;g+1<e.length;g++)e[g]=e[g+1];e.pop()}(_,y),_.length===1&&(v[e]=_[0]),v.removeListener!==void 0&&this.emit(`removeListener`,e,x||g)}return this},S.prototype.removeAllListeners=function(e){var g,_,v;if((_=this._events)===void 0)return this;if(_.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):_[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete _[e]),this;if(arguments.length===0){var y,b=Object.keys(_);for(v=0;v<b.length;++v)(y=b[v])!==`removeListener`&&this.removeAllListeners(y);return this.removeAllListeners(`removeListener`),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(g=_[e])==`function`)this.removeListener(e,g);else if(g!==void 0)for(v=g.length-1;0<=v;v--)this.removeListener(e,g[v]);return this},S.prototype.listeners=function(e){return D(this,e,!0)},S.prototype.rawListeners=function(e){return D(this,e,!1)},S.listenerCount=function(e,g){return typeof e.listenerCount==`function`?e.listenerCount(g):O.call(e,g)},S.prototype.listenerCount=O,S.prototype.eventNames=function(){return 0<this._eventsCount?v(this._events):[]}},function(e,g,_){Object.defineProperty(g,`__esModule`,{value:!0}),g.assert=function(e,g){}},function(e,g,_){Object.defineProperty(g,`__esModule`,{value:!0}),g.shadeColor=function(e,g){var _=parseInt(e.slice(1),16),v=Math.min((_>>16)+(_>>16)*g/100,255),y=Math.min((_>>8&255)+(_>>8&255)*g/100,255);return`#`+(Math.min((255&_)+(255&_)*g/100,255)|y<<8|v<<16).toString(16)},g.addAlpha=function(e,g){var _=parseInt(e.slice(1),16);return`rgba(`+(_>>16)+`,`+(_>>8&255)+`,`+(255&_)+`,`+g+`%)`}},function(e,g,_){Object.defineProperty(g,`__esModule`,{value:!0});function v(){this.layer=0}g.TopContextUser=v,g.overLaps=function e(g,_){return g.layer===_.layer&&(g.left>_.left?e(_,g):!(g.left+g.width<_.left))}},function(e,g,_){var v,y=this&&this.__extends||(v=function(e,g){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var _ in g)g.hasOwnProperty(_)&&(e[_]=g[_])})(e,g)},function(e,g){function _(){this.constructor=e}v(e,g),e.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)}),b=this&&this.__read||function(e,g){var _=typeof Symbol==`function`&&e[Symbol.iterator];if(!_)return e;var v,y,b=_.call(e),x=[];try{for(;(g===void 0||0<g--)&&!(v=b.next()).done;)x.push(v.value)}catch(e){y={error:e}}finally{try{v&&!v.done&&(_=b.return)&&_.call(b)}finally{if(y)throw y.error}}return x},x=this&&this.__spread||function(){for(var e=[],g=0;g<arguments.length;g++)e=e.concat(b(arguments[g]));return e};Object.defineProperty(g,`__esModule`,{value:!0});var S=_(6),C=_(0),w=_(1),T=_(5);(function(e){var g,_=(g=S.TopContextUser,y(v,g),Object.defineProperty(v.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`lineIn`,{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`view`,{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`highLightWidth`,{get:function(){return this.view.contentWidth(this.store.startIndex,this.store.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`highLightLeft`,{get:function(){return this.view.contentWidth(this.lineIn.startIndex,this.store.startIndex)+this.lineIn.view.paddingLeft},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`middle`,{get:function(){return this.highLightLeft+this.highLightWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`labelLeft`,{get:function(){return this.middle-this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`labelRight`,{get:function(){return this.middle+this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`labelWidth`,{get:function(){return this.view.labelFont.widthOf(this.store.category.text)+this.config.labelPadding+2},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`left`,{get:function(){return this.config.labelWidthCalcMethod===`max`?this.labelWidth>this.highLightWidth?this.labelLeft:this.highLightLeft:this.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`width`,{get:function(){return this.config.labelWidthCalcMethod===`max`?this.labelWidth>this.highLightWidth-1?this.labelWidth:this.highLightWidth-1:this.labelWidth},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`annotationY`,{get:function(){return-this.view.topContextLayerHeight*(this.layer-1)-(this.view.labelFont.lineHeight+2+2*this.config.labelPadding+this.config.bracketWidth)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`globalY`,{get:function(){return this.lineIn.y+this.annotationY},enumerable:!0,configurable:!0}),v.prototype.render=function(){var e;this.svgElement=document.createElementNS(C.SVGNS,`g`),(e=this.svgElement.classList).add.apply(e,x(this.config.labelClasses));var g=this.createHighLightElement(),_=this.createAnnotationElement(),v=this.view.topContextLayerHeight*(this.layer-1),y=this.createBracketElement(this.highLightWidth,-v,0,-v,this.config.bracketWidth);return this.svgElement.appendChild(g),this.svgElement.appendChild(_),this.svgElement.appendChild(y),this.svgElement},v.prototype.update=function(){this.svgElement.style.transform=`translate(`+this.highLightLeft+`px,`+this.lineIn.y+`px)`},v.prototype.remove=function(){this.svgElement.remove()},v.prototype.createHighLightElement=function(){var e=document.createElementNS(C.SVGNS,`rect`),g=this.store.category.color;return e.setAttribute(`height`,this.lineIn.view.contentFont.lineHeight.toString()),e.setAttribute(`width`,this.highLightWidth.toString()),e.setAttribute(`fill`,/^#/g.test(g)?T.addAlpha(g,70):g),e},v.prototype.createBracketElement=function(e,g,_,v,y,b){b===void 0&&(b=.6);var x=e-_,S=g-v,w=Math.sqrt(x*x+S*S),T=e+b*y*(S/=w),E=g-b*y*(x/=w),D=e-.25*w*x+(1-b)*y*S,O=g-.25*w*S-(1-b)*y*x,k=e-.5*w*x+y*S,A=g-.5*w*S-y*x,j=_+b*y*S,M=v-b*y*x,N=e-.75*w*x+(1-b)*y*S,P=g-.75*w*S-(1-b)*y*x,F=document.createElementNS(C.SVGNS,`path`);return F.setAttribute(`d`,`M`+e+`,`+g+`Q`+T+`,`+E+`,`+D+`,`+O+`T`+k+`,`+A+`M`+_+`,`+v+`Q`+j+`,`+M+`,`+N+`,`+P+`T`+k+`,`+A),F.setAttribute(`fill`,`none`),F.setAttribute(`stroke`,this.store.category.borderColor),F},v.prototype.createAnnotationElement=function(){var e=this,g=this.view.labelCategoryElementFactoryRepository.get(this.store.category.id).create();return g.style.transform=`translate(`+(this.highLightWidth-this.labelWidth)/2+`px,`+this.annotationY+`px)`,g.onclick=function(g){e.view.root.emit(`labelClicked`,e.id,g)},g.ondblclick=function(g){e.view.root.emit(`labelDoubleClicked`,e.id,g)},g.oncontextmenu=function(g){e.view.root.emit(`labelRightClicked`,e.id,g),g.preventDefault()},g.onmouseenter=function(){e.svgElement.classList.add(`hover`),Array.from(e.store.connectionsFrom).map(function(g){return e.view.connectionViewRepository.get(g.id)}).map(function(e){return e.addHover(`from`)}),Array.from(e.store.connectionsTo).map(function(g){return e.view.connectionViewRepository.get(g.id)}).map(function(e){return e.addHover(`to`)})},g.onmouseleave=function(){e.svgElement.classList.remove(`hover`),Array.from(e.store.connectionsFrom).map(function(g){return e.view.connectionViewRepository.get(g.id)}).map(function(e){return e.removeHover(`from`)}),Array.from(e.store.connectionsTo).map(function(g){return e.view.connectionViewRepository.get(g.id)}).map(function(e){return e.removeHover(`to`)})},g},v);function v(e,_,v){var y=g.call(this)||this;return y.store=e,y.contextIn=_,y.config=v,y.layer=0,y.svgElement=null,y}e.Entity=_;var b,E=(b=w.Base.Repository,y(D,b),D.prototype.get=function(e){return this.entities.get(e)},D);function D(){return b!==null&&b.apply(this,arguments)||this}e.Repository=E})(g.LabelView||={})},function(e,g,_){var v,y=this&&this.__extends||(v=function(e,g){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var _ in g)g.hasOwnProperty(_)&&(e[_]=g[_])})(e,g)},function(e,g){function _(){this.constructor=e}v(e,g),e.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)}),b=this&&this.__values||function(e){var g=typeof Symbol==`function`&&Symbol.iterator,_=g&&e[g],v=0;if(_)return _.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&v>=e.length&&(e=void 0),{value:e&&e[v++],done:!e}}};throw TypeError(g?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(g,`__esModule`,{value:!0});var x=_(1);(function(e){var g=(Object.defineProperty(_.prototype,`startIndex`,{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`endIndex`,{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),_.prototype.move=function(e){this._startIndex+=e,this._endIndex+=e},Object.defineProperty(_.prototype,`category`,{get:function(){return this.root.labelCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`json`,{get:function(){return{id:this.id,categoryId:this.categoryId,startIndex:this.startIndex,endIndex:this.endIndex}},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`sameLineConnections`,{get:function(){var e,g,_=[];try{for(var v=b(this.root.connectionRepo.values()),y=v.next();!y.done;y=v.next()){var x=y.value;x.priorLabel===this&&_.push(x)}}catch(g){e={error:g}}finally{try{y&&!y.done&&(g=v.return)&&g.call(v)}finally{if(e)throw e.error}}return _},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`connectionsFrom`,{get:function(){var e,g,_=new Set;try{for(var v=b(this.root.connectionRepo.values()),y=v.next();!y.done;y=v.next()){var x=y.value;x.from===this&&_.add(x)}}catch(g){e={error:g}}finally{try{y&&!y.done&&(g=v.return)&&g.call(v)}finally{if(e)throw e.error}}return _},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`connectionsTo`,{get:function(){var e,g,_=new Set;try{for(var v=b(this.root.connectionRepo.values()),y=v.next();!y.done;y=v.next()){var x=y.value;x.to===this&&_.add(x)}}catch(g){e={error:g}}finally{try{y&&!y.done&&(g=v.return)&&g.call(v)}finally{if(e)throw e.error}}return _},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`allConnections`,{get:function(){return new Set(Array.prototype.concat(Array.from(this.connectionsFrom),Array.from(this.connectionsTo)))},enumerable:!0,configurable:!0}),_);function _(e,g,_,v,y){this.id=e,this.categoryId=g,this._startIndex=_,this._endIndex=v,this.root=y}e.Entity=g;var v,S,C=(v=x.Base.Repository,y(w,v),w.prototype.set=function(e,g){return this.againstMultipleLabelWith(g)||v.prototype.set.call(this,e,g),this},w.prototype.add=function(e){return this.againstMultipleLabelWith(e)?-1:v.prototype.add.call(this,e)},w.prototype.againstMultipleLabelWith=function(e){function g(e,g){return e.startIndex===g.startIndex&&e.endIndex===g.endIndex}var _=this.config.allowMultipleLabel===`notAllowed`?g:function(e,_){return g(e,_)&&e.categoryId==_.categoryId};return Array.from(this.values()).some(function(g){return _(g,e)})},w.prototype.getEntitiesInRange=function(e,g){return Array.from(this.entities.values()).filter(function(_){return e<=_.startIndex&&_.endIndex<=g})},w.prototype.getEntitiesCross=function(e){return Array.from(this.entities.values()).filter(function(g){return g.startIndex<=e&&e<g.endIndex})},w);function w(e){var g=v.call(this)||this;return g.config=e,g}function T(e,_){return new g(e.id,e.categoryId,e.startIndex,e.endIndex,_)}e.Repository=C,(S=e.Factory||={}).create=T,S.createAll=function(e,g){return e.map(function(e){return T(e,g)})}})(g.Label||={})},function(e,g,_){var v,y=this&&this.__extends||(v=function(e,g){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var _ in g)g.hasOwnProperty(_)&&(e[_]=g[_])})(e,g)},function(e,g){function _(){this.constructor=e}v(e,g),e.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)});Object.defineProperty(g,`__esModule`,{value:!0});var b=_(1);(function(e){var g=(Object.defineProperty(_.prototype,`category`,{get:function(){return this.root.connectionCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`from`,{get:function(){return this.root.labelRepo.get(this.fromId)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`to`,{get:function(){return this.root.labelRepo.get(this.toId)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`priorLabel`,{get:function(){return this.from.startIndex<this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`posteriorLabel`,{get:function(){return this.from.startIndex>=this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`json`,{get:function(){return{id:this.id,categoryId:this.categoryId,fromId:this.fromId,toId:this.toId}},enumerable:!0,configurable:!0}),_);function _(e,g,_,v,y){this.id=e,this.categoryId=g,this.fromId=_,this.toId=v,this.root=y}e.Entity=g;var v,x,S=(v=b.Base.Repository,y(C,v),C.prototype.set=function(e,g){return this.againstMultipleConnectionRuleWith(g)||v.prototype.set.call(this,e,g),this},C.prototype.add=function(e){return this.againstMultipleConnectionRuleWith(e)?-1:v.prototype.add.call(this,e)},C.prototype.againstMultipleConnectionRuleWith=function(e){function g(e,g){return e.from===g.from&&e.to===g.to}var _=this.config.allowMultipleConnection===`notAllowed`?g:function(e,_){return g(e,_)&&e.categoryId==_.categoryId};return Array.from(this.values()).some(function(g){return _(g,e)})},C);function C(e){var g=v.call(this)||this;return g.config=e,g}function w(e,_){return new g(e.id,e.categoryId,e.fromId,e.toId,_)}e.Repository=S,(x=e.Factory||={}).create=w,x.createAll=function(e,g){return e.map(function(e){return w(e,g)})}})(g.Connection||={})},function(e,g,_){var v,y=this&&this.__extends||(v=function(e,g){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var _ in g)g.hasOwnProperty(_)&&(e[_]=g[_])})(e,g)},function(e,g){function _(){this.constructor=e}v(e,g),e.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)}),b=this&&this.__read||function(e,g){var _=typeof Symbol==`function`&&e[Symbol.iterator];if(!_)return e;var v,y,b=_.call(e),x=[];try{for(;(g===void 0||0<g--)&&!(v=b.next()).done;)x.push(v.value)}catch(e){y={error:e}}finally{try{v&&!v.done&&(_=b.return)&&_.call(b)}finally{if(y)throw y.error}}return x},x=this&&this.__spread||function(){for(var e=[],g=0;g<arguments.length;g++)e=e.concat(b(arguments[g]));return e};Object.defineProperty(g,`__esModule`,{value:!0});var S=_(1),C=_(0),w=_(6);(function(e){var g,_=(g=w.TopContextUser,y(v,g),Object.defineProperty(v.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`lineIn`,{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`view`,{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`sameLineLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.priorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`mayNotSameLineLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.posteriorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`fromLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.from.id)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`toLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.to.id)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`leftLabelView`,{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`rightLabelView`,{get:function(){return this.fromLabelView.labelLeft>=this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`middle`,{get:function(){return(this.leftLabelView.labelLeft+this.rightLabelView.labelRight)/2},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`textWidth`,{get:function(){return this.view.connectionFont.widthOf(this.store.category.text)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`textLeft`,{get:function(){return this.middle-this.textWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`lineIncludedWidth`,{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.toLabelView.labelRight-this.fromLabelView.labelLeft:this.fromLabelView.labelRight-this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`lineIncludedLeft`,{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView.labelLeft:this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`width`,{get:function(){return this.config.connectionWidthCalcMethod===`text`?this.textWidth:this.lineIncludedWidth},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`left`,{get:function(){return this.config.connectionWidthCalcMethod===`text`?this.textLeft:this.lineIncludedLeft},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,`globalY`,{get:function(){return this.lineIn.y-this.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),v.prototype.render=function(){var e=this;this.svgElement=document.createElementNS(C.SVGNS,`g`);var g=this.view.connectionCategoryElementFactoryRepository.get(this.store.category.id).create();return this.svgElement.appendChild(g),this.svgElement.style.cursor=`pointer`,this.svgElement.onclick=function(g){e.view.root.emit(`connectionClicked`,e.id,g)},this.svgElement.ondblclick=function(g){e.view.root.emit(`connectionDoubleClicked`,e.id,g)},this.svgElement.oncontextmenu=function(g){e.view.root.emit(`connectionRightClicked`,e.id,g),g.preventDefault()},this.svgElement.onmouseenter=function(){e.svgElement.classList.add(`hover`),e.lineElement.classList.add(`hover`)},this.svgElement.onmouseleave=function(){e.svgElement.classList.remove(`hover`),e.lineElement.classList.remove(`hover`)},this.renderLine(),this.svgElement},v.prototype.update=function(){this.svgElement.style.transform=`translate(`+this.textLeft+`px,`+this.globalY+`px)`,this.updateLine()},v.prototype.addHover=function(e){this.svgElement.classList.add(`hover-`+e),this.lineElement.classList.add(`hover-`+e)},v.prototype.removeHover=function(e){this.svgElement.classList.remove(`hover-`+e),this.lineElement.classList.remove(`hover-`+e)},v.prototype.remove=function(){this.svgElement.remove(),this.lineElement.remove()},v.prototype.updateLine=function(){var e=this.globalY+this.view.topContextLayerHeight/2-this.view.labelFont.fontSize+2;this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.lineElement.setAttribute(`d`,`
                    M `+(this.fromLabelView.labelLeft+1)+`   `+(this.fromLabelView.globalY+1)+`
                    C `+(this.fromLabelView.labelLeft-8)+`  `+e+`,
                      `+(this.fromLabelView.labelLeft-8)+`  `+e+`,
                      `+(this.fromLabelView.labelLeft+1)+`   `+e+`
                    L `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+` `+e+`
                    C `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+`  `+e+`,
                      `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+`  `+e+`,
                      `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+`   `+(this.toLabelView.globalY-1)+`
                `):this.lineElement.setAttribute(`d`,`
                    M `+(this.fromLabelView.labelRight-1)+`   `+(this.fromLabelView.globalY+1)+`
                    C `+(this.fromLabelView.labelRight+8)+`  `+e+`,
                      `+(this.fromLabelView.labelRight+8)+`  `+e+`,
                      `+(this.fromLabelView.labelRight-1)+`   `+e+`
                    L `+this.toLabelView.labelLeft+`          `+e+`
                    C `+(this.toLabelView.labelLeft-8)+`  `+e+`,
                      `+(this.toLabelView.labelLeft-8)+`  `+e+`,
                      `+this.toLabelView.labelLeft+`   `+(this.toLabelView.globalY-1)+`
                `)},v.prototype.renderLine=function(){var e;this.lineElement=document.createElementNS(C.SVGNS,`path`),(e=this.lineElement.classList).add.apply(e,x(this.config.connectionClasses.map(function(e){return e+`-line`}))),this.lineElement.setAttribute(`fill`,`none`),this.lineElement.style.markerEnd=`url(#marker-arrow)`,this.updateLine(),this.contextIn.backgroundElement.appendChild(this.lineElement)},v);function v(e,_,v){var y=g.call(this)||this;return y.store=e,y.contextIn=_,y.config=v,y.svgElement=null,y.lineElement=null,y}e.Entity=_;var b,T=(b=S.Base.Repository,y(E,b),E);function E(){return b!==null&&b.apply(this,arguments)||this}e.Repository=T})(g.ConnectionView||={})},function(e,g,_){var v=this&&this.__read||function(e,g){var _=typeof Symbol==`function`&&e[Symbol.iterator];if(!_)return e;var v,y,b=_.call(e),x=[];try{for(;(g===void 0||0<g--)&&!(v=b.next()).done;)x.push(v.value)}catch(e){y={error:e}}finally{try{v&&!v.done&&(_=b.return)&&_.call(b)}finally{if(y)throw y.error}}return x},y=this&&this.__spread||function(){for(var e=[],g=0;g<arguments.length;g++)e=e.concat(v(arguments[g]));return e};Object.defineProperty(g,`__esModule`,{value:!0});var b,x,S=_(0);function C(e,g,_,v,y,b){this.fontFamily=e,this.fontSize=g,this.fontWeight=_,this.lineHeight=v,this.topToBaseLine=y,this.width=b}b=g.Font||={},C.prototype.widthOf=function(e){var g=this;return typeof e==`string`?this.widthOf(Array.from(e)):e.map(function(e){return g.width.get(e)}).reduce(function(e,g){return e+g},0)},x=C,b.ValueObject=x,function(e){function g(e,g,_){var v=new Map,y=new Set(e);y.delete(`
`);var b=Array.from(y);g.textContent=b.join(``),g.parentNode.parentNode.insertBefore(_,g.parentNode),b.forEach(function(e,_){v.set(e,g.getExtentOfChar(_).width)});var S=_.getBoundingClientRect().top-g.getBoundingClientRect().top,C=parseFloat(window.getComputedStyle(g).fontSize),w=window.getComputedStyle(g).fontFamily,T=window.getComputedStyle(g).fontWeight,E=g.getBoundingClientRect().height;return new x(w,C,T,E,S,v)}e.create=g;var _=(v.prototype.thanCreate=function(e,_){var v,b;(v=this.measuringElement.classList).add.apply(v,y(e));var x=g(_,this.measuringElement,this.baseLineReferenceElement);return(b=this.measuringElement.classList).remove.apply(b,y(e)),this.result.push(x),this},v.prototype.endBatch=function(){return this.baseLineReferenceElement.remove(),this.measuringElement.remove(),this.result},v);function v(e,g){this.svgElement=e,this.textElement=g,this.baseLineReferenceElement=document.createElementNS(S.SVGNS,`rect`),this.baseLineReferenceElement.setAttribute(`width`,`1px`),this.baseLineReferenceElement.setAttribute(`height`,`1px`),this.svgElement.appendChild(this.baseLineReferenceElement),this.measuringElement=document.createElementNS(S.SVGNS,`tspan`),this.textElement.appendChild(this.measuringElement),this.result=[]}e.startBatch=function(e,g){return new _(e,g)}}(b.Factory||={}),(b.Service||={}).measureMore=function(e,g,_,v){var b,x=new Set(g);x.delete(`
`);var C=Array.from(x).filter(function(g){return!e.width.has(g)});if(0<C.length){var w=document.createElementNS(S.SVGNS,`tspan`);(b=w.classList).add.apply(b,y(_)),w.textContent=C.join(``),v.appendChild(w),C.forEach(function(g,_){e.width.set(g,w.getExtentOfChar(_).width)}),w.remove()}return e}},function(e,g,_){Object.defineProperty(g,`__esModule`,{value:!0}),g.Annotator=_(13).Annotator;var v=_(27),y=_(28),b=_(29);g.Action={Connection:v.Connection,Label:y.Label,Content:b.Content}},function(e,g,_){var v,y=this&&this.__extends||(v=function(e,g){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var _ in g)g.hasOwnProperty(_)&&(e[_]=g[_])})(e,g)},function(e,g){function _(){this.constructor=e}v(e,g),e.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)});Object.defineProperty(g,`__esModule`,{value:!0});var b,x=_(3),S=_(14),C=_(17),w=_(0),T=_(24),E=_(25),D=_(26),O=(b=x.EventEmitter,y(k,b),k.prototype.applyAction=function(e){e.apply(this.store)},k.prototype.export=function(){this.view.contentEditor.hide();var e=this.view.svgElement.outerHTML.replace(/&nbsp;/,` `);return this.view.contentEditor.show(),e},k.prototype.remove=function(){this.view.svgElement.remove(),this.store.config.contentEditable&&this.view.contentEditor.remove()},k);function k(e,g,_){var v=b.call(this)||this;v.containerElement=g,v.configInput=_;var y=T.parseInput(_||{});v.store=new S.Store(y),v.store.json=typeof e==`string`?JSON.parse(e):e;var x=document.createElementNS(w.SVGNS,`svg`);return x.setAttribute(`xmlns`,w.SVGNS),g.appendChild(x),v.view=new C.View(v,x,y),v.textSelectionHandler=new E.TextSelectionHandler(v,y),v.twoLabelsClickedHandler=new D.TwoLabelsClickedHandler(v,y),v}g.Annotator=O},function(e,g,_){var v,y=this&&this.__extends||(v=function(e,g){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var _ in g)g.hasOwnProperty(_)&&(e[_]=g[_])})(e,g)},function(e,g){function _(){this.constructor=e}v(e,g),e.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)});Object.defineProperty(g,`__esModule`,{value:!0});var b,x=_(15),S=_(8),C=_(16),w=_(9),T=(b=_(3).EventEmitter,y(E,b),Object.defineProperty(E.prototype,`content`,{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,`json`,{get:function(){return{content:this._content,labelCategories:this.labelCategoryRepo.json,labels:this.labelRepo.json,connectionCategories:this.connectionCategoryRepo.json,connections:this.connectionRepo.json}},set:function(e){var g=this;this._content=e.content.endsWith(`
`)?e.content:e.content+`
`,x.LabelCategory.Factory.createAll(e.labelCategories,this.config).map(function(e){return g.labelCategoryRepo.add(e)}),S.Label.Factory.createAll(e.labels,this).map(function(e){return g.labelRepo.add(e)}),e.connectionCategories.map(function(e){return g.connectionCategoryRepo.add(e)}),w.Connection.Factory.createAll(e.connections,this).map(function(e){return g.connectionRepo.add(e)})},enumerable:!0,configurable:!0}),E.prototype.contentSlice=function(e,g){return this.content.slice(e,g)},E.prototype.moveLabels=function(e,g){Array.from(this.labelRepo.values()).filter(function(g){return g.startIndex>=e}).map(function(e){return e.move(g)})},E.prototype.spliceContent=function(e,g){var _=[...arguments].slice(2),v=e+g;if(g===0||Array.from(this.labelRepo.values()).find(function(g){return g.startIndex<=e&&e<g.endIndex||g.startIndex<v&&v<g.endIndex})===void 0){var y=this.content.slice(0,e),b=this.content.slice(e,e+g),x=_.join(``),S=this.content.slice(e+g);this._content=y+x+S,this.moveLabels(e+g,x.length-b.length),this.emit(`contentSpliced`,e,b,x)}},E);function E(e){var g=b.call(this)||this;return g._content=``,g.config=e,g.labelCategoryRepo=new x.LabelCategory.Repository,g.labelRepo=new S.Label.Repository(e),g.connectionCategoryRepo=new C.ConnectionCategory.Repository,g.connectionRepo=new w.Connection.Repository(e),g}g.Store=T},function(e,g,_){var v,y=this&&this.__extends||(v=function(e,g){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var _ in g)g.hasOwnProperty(_)&&(e[_]=g[_])})(e,g)},function(e,g){function _(){this.constructor=e}v(e,g),e.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)});Object.defineProperty(g,`__esModule`,{value:!0});var b,x,S,C,w=_(1),T=_(5);function E(){return x!==null&&x.apply(this,arguments)||this}function D(e,g){var _=e.borderColor,v=e.color;return!e.borderColor&&e[`border-color`]&&(_=e[`border-color`]),e.color||(v=g),e.borderColor||(_=T.shadeColor(v,-30)),{id:e.id,text:e.text,color:v,borderColor:_}}b=g.LabelCategory||={},x=w.Base.Repository,y(E,x),C=E,b.Repository=C,(S=b.Factory||={}).create=D,S.createAll=function(e,g){return e.map(function(e){return D(e,g.defaultLabelColor)})}},function(e,g,_){var v,y=this&&this.__extends||(v=function(e,g){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var _ in g)g.hasOwnProperty(_)&&(e[_]=g[_])})(e,g)},function(e,g){function _(){this.constructor=e}v(e,g),e.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)});Object.defineProperty(g,`__esModule`,{value:!0});var b,x,S,C=_(1);function w(){return x!==null&&x.apply(this,arguments)||this}b=g.ConnectionCategory||={},x=C.Base.Repository,y(w,x),S=w,b.Repository=S},function(e,g,_){var v=this&&this.__read||function(e,g){var _=typeof Symbol==`function`&&e[Symbol.iterator];if(!_)return e;var v,y,b=_.call(e),x=[];try{for(;(g===void 0||0<g--)&&!(v=b.next()).done;)x.push(v.value)}catch(e){y={error:e}}finally{try{v&&!v.done&&(_=b.return)&&_.call(b)}finally{if(y)throw y.error}}return x},y=this&&this.__spread||function(){for(var e=[],g=0;g<arguments.length;g++)e=e.concat(v(arguments[g]));return e},b=this&&this.__values||function(e){var g=typeof Symbol==`function`&&Symbol.iterator,_=g&&e[g],v=0;if(_)return _.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&v>=e.length&&(e=void 0),{value:e&&e[v++],done:!e}}};throw TypeError(g?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(g,`__esModule`,{value:!0});var x=_(0),S=_(18),C=_(11),w=_(21),T=_(7),E=_(10),D=_(22),O=_(23),k=_(2),A=(j.layoutTopContextsAfter=function(e){for(;e.next.isSome;)e.topContext.update(),e=e.next.toNullable();e.topContext.update()},j.prototype.constructLabelViewsForLine=function(e){var g=this,_=this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map(function(_){return new T.LabelView.Entity(_,e.topContext,g.config)});return _.map(function(e){return g.labelViewRepository.add(e)}),_.map(function(g){return e.topContext.addChild(g)}),_},j.prototype.constructConnectionsForLine=function(e){var g=this;return this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map(function(_){var v=_.sameLineConnections.filter(function(e){return!g.connectionViewRepository.has(e.id)}).map(function(_){return new E.ConnectionView.Entity(_,e.topContext,g.config)});return v.map(function(e){return g.connectionViewRepository.add(e)}),v.map(function(g){return e.topContext.addChild(g)}),v}).reduce(function(e,g){return e.concat(g)},[])},Object.defineProperty(j.prototype,`height`,{get:function(){var e=this;return this.lines.reduce(function(g,_){return g+_.height+e.contentFont.fontSize*(e.config.lineHeight-1)},20)},enumerable:!0,configurable:!0}),j.createMarkerElement=function(){var e=document.createElementNS(x.SVGNS,`path`);e.setAttribute(`d`,`M0,4 L0,8 L6,6 L0,4 L0,8`),e.setAttribute(`stroke`,`#000000`),e.setAttribute(`fill`,`#000000`);var g=document.createElementNS(x.SVGNS,`marker`);return g.setAttribute(`id`,`marker-arrow`),g.setAttribute(`markerWidth`,`8`),g.setAttribute(`markerHeight`,`10`),g.setAttribute(`orient`,`auto`),g.setAttribute(`refX`,`5`),g.setAttribute(`refY`,`6`),g.appendChild(e),g},j.prototype.contentWidth=function(e,g){return this.contentFont.widthOf(this.store.contentSlice(e,g))},j.prototype.removeLine=function(e){var g=this;e.remove(),e.topContext.children.forEach(function(e){e instanceof T.LabelView.Entity?g.labelViewRepository.delete(e):e instanceof E.ConnectionView.Entity&&g.connectionViewRepository.delete(e)})},j.prototype.registerEventHandlers=function(){var e=this;this.textElement.onmouseup=function(g){window.getSelection().type===`Range`?e.root.textSelectionHandler.textSelected():e.config.contentEditable&&e.contentEditor.caretChanged(g.clientY)},this.store.labelRepo.on(`created`,this.onLabelCreated.bind(this)),this.store.labelRepo.on(`removed`,function(g){var _=e.labelViewRepository.get(g.id);_.lineIn.topContext.removeChild(_),_.remove(),e.labelViewRepository.delete(_),_.lineIn.topContext.update(),_.lineIn.update(),j.layoutTopContextsAfter(_.lineIn),e.config.contentEditable&&e.contentEditor.update()}),this.store.connectionRepo.on(`created`,this.onConnectionCreated.bind(this)),this.store.connectionRepo.on(`removed`,function(g){var _=e.connectionViewRepository.get(g.id);_.lineIn.topContext.removeChild(_),_.remove(),e.connectionViewRepository.delete(_),_.lineIn.topContext.update(),_.lineIn.update(),j.layoutTopContextsAfter(_.lineIn),e.config.contentEditable&&e.contentEditor.update()}),this.config.contentEditable&&this.store.on(`contentSpliced`,this.onContentSpliced.bind(this))},j.prototype.rerenderLines=function(e,g){for(var _,v,x,C,w,T,E,D=this.lines[0].svgElement.parentElement,O=e;O<=g;++O)this.removeLine(this.lines[O]);var A=this.lines[e],j=this.lines[g],M=S.Line.Service.divide(this,A.startIndex,j.endIndex);for(M.length!==0&&(M[0].last=A.last,A.last.map(function(e){return e.next=k.some(M[0])}),M[M.length-1].next=j.next,j.next.map(function(e){return e.last=k.some(M[M.length-1])}),(_=this.lines).splice.apply(_,y([e,g-e+1],M)),e===0?j.next.isSome?M[0].insertBefore(j.next):M[0].insertInto(D):M[0].insertAfter(A.last)),O=1;O<M.length;++O)M[O].insertAfter(k.some(M[O-1]));function N(e){P.constructLabelViewsForLine(e).map(function(g){return e.topContext.renderChild(g)})}var P=this;try{for(var F=b(M),I=F.next();!I.done;I=F.next())N(U=I.value)}catch(e){v={error:e}}finally{try{I&&!I.done&&(x=F.return)&&x.call(F)}finally{if(v)throw v.error}}function L(e){R.constructConnectionsForLine(e).map(function(g){return e.topContext.renderChild(g)})}var R=this;try{for(var z=b(M),B=z.next();!B.done;B=z.next())L(U=B.value)}catch(e){C={error:e}}finally{try{B&&!B.done&&(w=z.return)&&w.call(z)}finally{if(C)throw C.error}}try{for(var V=b(M),H=V.next();!H.done;H=V.next()){var U;(U=H.value).update(),U.topContext.update()}}catch(e){T={error:e}}finally{try{H&&!H.done&&(E=V.return)&&E.call(V)}finally{if(T)throw T.error}}},j.prototype.onLabelCreated=function(e){var g=v(this.findRangeInLines(e.startIndex,e.endIndex),2),_=g[0];if(g[1]===_+1){var y=this.lines[_],b=new T.LabelView.Entity(e,y.topContext,this.config);this.labelViewRepository.add(b),y.topContext.addChild(b),y.topContext.renderChild(b),y.topContext.update(),y.update()}else{var x=this.findHardLineEndsInIndex(_);this.rerenderLines(_,x)}j.layoutTopContextsAfter(this.lines[_]),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},j.prototype.findRangeInLines=function(e,g){var _=0,v=0;return this.lines.forEach(function(y,b){y.startIndex<=e&&e<y.endIndex&&(_=b),y.startIndex<=g-1&&g-1<y.endIndex&&(v=b+1)}),[_,v]},j.prototype.onConnectionCreated=function(e){var g=this.labelViewRepository.get(e.priorLabel.id),_=g.lineIn.topContext,v=new E.ConnectionView.Entity(e,_,this.config);this.connectionViewRepository.add(v),_.addChild(v),_.renderChild(v),_.update(),g.lineIn.update(),j.layoutTopContextsAfter(g.lineIn),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},j.prototype.onContentSpliced=function(e,g,_){g!==``&&this.onRemoved(e,g),_!==``&&this.onInserted(e,_)},j.prototype.onRemoved=function(e,g){var _=v(this.findRangeInLines(e,e+1),2),y=_[0];_[1],this.lines[y].startIndex===e-g.length?this.lines[y].move(-g.length):this.lines[y].inserted(-g.length);for(var b=y+1;b<this.lines.length;)this.lines[b].move(-g.length),++b;var x=this.findHardLineEndsInIndex(y);if(g===`
`&&this.lines[y].isBlank){var S=this.lines[y].last,C=this.lines[y].next;this.lines[y].remove(),this.lines.splice(y,1),S.map(function(e){return e.next=C}),C.map(function(e){return e.last=S})}else this.rerenderLines(y,x);j.layoutTopContextsAfter(this.lines[x-1]);var w=Array.from(g).filter(function(e){return e===`
`}).length;w===0?(this.contentEditor.characterIndex-=g.length,this.contentEditor.avoidInLabel(`forward`)):0<=this.contentEditor.lineIndex-w&&(this.contentEditor.lineIndex-=w,this.contentEditor.characterIndex=this.contentEditor.line.content.length,this.contentEditor.avoidInLabel(`forward`)),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},j.prototype.onInserted=function(e,g){var _=v(this.findRangeInLines(e,e+1),2),y=_[0];_[1],this.lines[y].startIndex===e+g.length?this.lines[y].move(g.length):this.lines[y].inserted(g.length);for(var b=y+1;b<this.lines.length;)this.lines[b].move(g.length),++b;var x=this.findHardLineEndsInIndex(y);this.rerenderLines(y,x),j.layoutTopContextsAfter(this.lines[x]);var S=Array.from(g),C=S.filter(function(e){return e===`
`}).length,w=S.lastIndexOf(`
`),T=g.length-w;C===0?this.contentEditor.characterIndex+=g.length:(this.contentEditor.lineIndex+=C,this.contentEditor.characterIndex=T-1),this.contentEditor.avoidInLabel(`forward`),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},j.prototype.findHardLineEndsInIndex=function(e){var g;for(g=e;g<this.lines.length-1&&!this.lines[g].endWithHardLineBreak;++g);return g},j.prototype.collectStyle=function(){var e=document.createElementNS(x.SVGNS,`style`),g=`
        `+this.config.contentClasses.map(function(e){return`.`+e}).join(`,`)+` {
            font-family: `+this.contentFont.fontFamily+`;
            font-weight: `+this.contentFont.fontWeight+`;
            font-size: `+this.contentFont.fontSize+`px;
            line-height: `+this.contentFont.lineHeight+`px;
        }
        `,_=`
        `+this.config.labelClasses.map(function(e){return`.`+e}).join(`,`)+` {
            font-family: `+this.labelFont.fontFamily+`;
            font-weight: `+this.labelFont.fontWeight+`;
            font-size: `+this.labelFont.fontSize+`px;
        }
        `,v=this.config.connectionClasses.map(function(e){return`.`+e}).join(`,`),y=this.config.connectionClasses.map(function(e){return`.`+e+`-line`}).join(`,`),b=`
        `+v+` {
            font-family: `+this.connectionFont.fontFamily+`;
            font-weight: `+this.connectionFont.fontWeight+`;
            font-size: `+this.connectionFont.fontSize+`px;
        }
        `+y+` {
            stroke: #000;
        }
        `;return e.innerHTML=g+_+b,e},Object.defineProperty(j.prototype,`paddingLeft`,{get:function(){var e=this;return Math.max.apply(Math,y(Array.from(this.store.labelCategoryRepo.values()).map(function(g){return e.labelFont.widthOf(g.text)})))/2+1},enumerable:!0,configurable:!0}),j);function j(e,g,_){var b,k,A;this.root=e,this.svgElement=g,this.config=_,this.contentEditor=null,this.store=e.store,this.labelViewRepository=new T.LabelView.Repository,this.connectionViewRepository=new E.ConnectionView.Repository,this.markerElement=j.createMarkerElement(),this.svgElement.appendChild(this.markerElement),this.textElement=document.createElementNS(x.SVGNS,`text`),this.textElement.style.whiteSpace=`pre`,this.textElement.style.wordWrap=`normal`,this.svgElement.appendChild(this.textElement);var M=Array.from(this.store.labelCategoryRepo.values()).map(function(e){return e.text}).join(``),N=Array.from(this.store.connectionCategoryRepo.values()).map(function(e){return e.text}).join(``);b=v(C.Font.Factory.startBatch(g,this.textElement).thanCreate(_.contentClasses,this.store.content).thanCreate(_.labelClasses,M).thanCreate(_.connectionClasses,N).endBatch(),3),this.contentFont=b[0],this.labelFont=b[1],this.connectionFont=b[2];var P=this.labelFont.lineHeight+2+2*_.labelPadding+_.bracketWidth;this.topContextLayerHeight=2*_.topContextMargin+Math.max(P,this.connectionFont.lineHeight),(k=this.textElement.classList).add.apply(k,y(_.contentClasses)),this.labelCategoryElementFactoryRepository=new w.LabelCategoryElement.FactoryRepository(this,_),this.connectionCategoryElementFactoryRepository=new D.ConnectionCategoryElement.FactoryRepository(this,_),this.lineMaxWidth=g.width.baseVal.value-2*this.paddingLeft,this.lines=S.Line.Service.divide(this,0,this.store.content.length),this.lines.map(this.constructLabelViewsForLine.bind(this)),this.lines.map(this.constructConnectionsForLine.bind(this));var F=this.lines.map(function(e){return e.render()});if((A=this.textElement).append.apply(A,y(F)),this.svgElement.style.height=this.height.toString()+`px`,this.registerEventHandlers(),this.config.contentEditable){this.contentEditor=new O.ContentEditor(this);var I=v(this.contentEditor.render(),2),L=I[0],R=I[1];this.svgElement.appendChild(L),this.svgElement.parentNode.insertBefore(R,this.svgElement)}this.svgElement.appendChild(this.collectStyle())}g.View=A},function(e,g,_){var v=this&&this.__read||function(e,g){var _=typeof Symbol==`function`&&e[Symbol.iterator];if(!_)return e;var v,y,b=_.call(e),x=[];try{for(;(g===void 0||0<g--)&&!(v=b.next()).done;)x.push(v.value)}catch(e){y={error:e}}finally{try{v&&!v.done&&(_=b.return)&&_.call(b)}finally{if(y)throw y.error}}return x},y=this&&this.__values||function(e){var g=typeof Symbol==`function`&&Symbol.iterator,_=g&&e[g],v=0;if(_)return _.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&v>=e.length&&(e=void 0),{value:e&&e[v++],done:!e}}};throw TypeError(g?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(g,`__esModule`,{value:!0});var b=_(2),x=_(0),S=_(19),C=_(20);(function(e){var g=(Object.defineProperty(_.prototype,`startIndex`,{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`endIndex`,{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),_.prototype.move=function(e){this._startIndex+=e,this._endIndex+=e},_.prototype.inserted=function(e){this._endIndex+=e},Object.defineProperty(_.prototype,`dy`,{get:function(){return this.last.match(this.view.contentFont.fontSize*this.config.lineHeight,this.view.contentFont.topToBaseLine)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`height`,{get:function(){return this.topContext.layer*this.view.topContextLayerHeight+this.view.contentFont.fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`y`,{get:function(){var e=this;return C.takeWhile(this.view.lines,function(g){return g!==e}).reduce(function(g,_){return g+_.height+e.view.contentFont.fontSize*(e.config.lineHeight-1)},0)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`isBlank`,{get:function(){return this.view.store.content.slice(this.startIndex,this.endIndex-1)===``},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`content`,{get:function(){return this.endWithHardLineBreak?this.isBlank?``:this.view.store.content.slice(this.startIndex,this.endIndex-1):this.view.store.content.slice(this.startIndex,this.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`endWithHardLineBreak`,{get:function(){return this.view.store.content[this.endIndex-1]===`
`},enumerable:!0,configurable:!0}),_.prototype.update=function(){this.svgElement.innerHTML=this.content.replace(/ /g,`&nbsp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`),this.isBlank&&(this.svgElement.style.fontSize=this.view.contentFont.fontSize/4+`px`),this.svgElement.setAttribute(`x`,this.view.paddingLeft.toString()),this.svgElement.setAttribute(`dy`,this.dy.toString()+`px`)},_.prototype.render=function(){this.svgElement=document.createElementNS(x.SVGNS,`tspan`);var e=v(this.topContext.render(),2),g=e[0],_=e[1];return this.view.svgElement.insertBefore(g,this.view.textElement),this.view.markerElement.insertAdjacentElement(`afterend`,_),Object.assign(this.svgElement,{annotatorElement:this}),this.update(),this.svgElement},_.prototype.remove=function(){this.topContext.remove(),this.svgElement.remove()},_.prototype.insertBefore=function(e){var g=this;this.render(),e.map(function(e){e.svgElement.parentNode.insertBefore(g.svgElement,e.svgElement),e.topContext.svgElement.parentNode.insertBefore(g.topContext.svgElement,e.topContext.svgElement),e.topContext.backgroundElement.parentNode.insertBefore(g.topContext.backgroundElement,e.topContext.backgroundElement)})},_.prototype.insertAfter=function(e){var g=this;this.render(),e.map(function(e){e.svgElement.insertAdjacentElement(`afterend`,g.svgElement),e.topContext.svgElement.insertAdjacentElement(`afterend`,g.topContext.svgElement),e.topContext.backgroundElement.insertAdjacentElement(`afterend`,g.topContext.backgroundElement)})},_.prototype.insertInto=function(e){this.render(),e.appendChild(this.svgElement)},_);function _(e,g,_,v,y){this.last=_,this.next=v,this.view=y,this.svgElement=null,this._startIndex=e,this._endIndex=g,this.topContext=new S.TopContext(this),this.config=y.config}e.ValueObject=g;var w=(Object.defineProperty(T.prototype,`store`,{get:function(){return this.view.store},enumerable:!0,configurable:!0}),T.prototype.divide=function(e,g){var _,v;this.init();var x=e,S=e+1;do{var C=this.mergeLabel(S),w=this.mergeWord(C),T=C===S&&C===w;this.store.content[S-1]===`
`?(this.tokenQueue.length===0?this.reduce(S-1,S):this.reduce(this.tokenQueue[0].startIndex,S),x=S):T&&(this.shiftWithAutoReduce({startIndex:x,endIndex:S}),x=S),++S}while(x<g);function E(e){D.map(function(g){return g.next=b.some(e)}),e.last=D,D=b.some(e)}this.tokenQueue.length!==0&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex);var D=b.none;try{for(var O=y(this.result),k=O.next();!k.done;k=O.next())E(k.value)}catch(e){_={error:e}}finally{try{k&&!k.done&&(v=O.return)&&v.call(O)}finally{if(_)throw _.error}}return this.result},T.prototype.init=function(){this.result=[],this.tokenQueue=[]},T.prototype.mergeLabel=function(e){return this.store.labelRepo.getEntitiesCross(e-1).some(function(g){return g.endIndex>e})?this.store.labelRepo.getEntitiesCross(e-1).filter(function(g){return g.endIndex>e}).sort(function(e,g){return g.endIndex-e.endIndex})[0].endIndex:e},T.prototype.mergeWord=function(e){T.wordReg.lastIndex=0;var g=T.wordReg.exec(this.store.contentSlice(e-1,e+1));return g===null?e:g[0].length===2?e+1:e},T.prototype.reduce=function(g,_){var v=new e.ValueObject(g,_,b.none,b.none,this.view);this.result.push(v),this.tokenQueue=[]},T.prototype.shiftWithAutoReduce=function(e){var g=this.tokenQueue.length===0?0:this.view.contentWidth(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),_=this.view.contentWidth(e.startIndex,e.endIndex);this.tokenQueue.length!==0&&g+_>this.view.lineMaxWidth&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),_>this.view.lineMaxWidth?this.reduce(e.startIndex,e.endIndex):this.tokenQueue.push(e)},T.wordReg=/([a-zA-z][a-zA-Z0-9']*[-|.]?)|([+\-]?[0-9.][0-9.%]*)/g,T);function T(e){this.view=e,this.result=[],this.tokenQueue=[]}(e.Service||={}).divide=function(e,g,_){return new w(e).divide(g,_)}})(g.Line||={})},function(e,g,_){var v=this&&this.__read||function(e,g){var _=typeof Symbol==`function`&&e[Symbol.iterator];if(!_)return e;var v,y,b=_.call(e),x=[];try{for(;(g===void 0||0<g--)&&!(v=b.next()).done;)x.push(v.value)}catch(e){y={error:e}}finally{try{v&&!v.done&&(_=b.return)&&_.call(b)}finally{if(y)throw y.error}}return x},y=this&&this.__spread||function(){for(var e=[],g=0;g<arguments.length;g++)e=e.concat(v(arguments[g]));return e},b=this&&this.__values||function(e){var g=typeof Symbol==`function`&&Symbol.iterator,_=g&&e[g],v=0;if(_)return _.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&v>=e.length&&(e=void 0),{value:e&&e[v++],done:!e}}};throw TypeError(g?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(g,`__esModule`,{value:!0});var x=_(0),S=_(6),C=_(10),w=_(4),T=_(7),E=(Object.defineProperty(D.prototype,`layer`,{get:function(){return this.children.size===0?0:Math.max.apply(Math,y(Array.from(this.children).map(function(e){return e.layer})))},enumerable:!0,configurable:!0}),D.prototype.update=function(){var e=this;this.children.forEach(function(e){return e.update()}),Array.from(this.children).filter(function(e){return e instanceof T.LabelView.Entity}).map(function(g){g.store.allConnections.forEach(function(_){if(e.belongTo.view.connectionViewRepository.has(_.id)){var v=e.belongTo.view.connectionViewRepository.get(_.id);v.mayNotSameLineLabelView===g&&v.update()}})})},D.prototype.render=function(){var e=this;return this.svgElement=document.createElementNS(x.SVGNS,`g`),this.backgroundElement=document.createElementNS(x.SVGNS,`g`),this.children.forEach(function(g){e.renderChild(g)}),this.update(),[this.svgElement,this.backgroundElement]},D.prototype.addChild=function(e){var g,_,v=this.layer,y=!1;e instanceof C.ConnectionView.Entity&&(e.layer=e.sameLineLabelView.layer);do{++e.layer,y=!1;try{for(var x=(g=void 0,b(this.children)),w=x.next();!w.done;w=x.next()){var T=w.value;if(S.overLaps(e,T)){y=!0;break}}}catch(e){g={error:e}}finally{try{w&&!w.done&&(_=x.return)&&_.call(x)}finally{if(g)throw g.error}}}while(y);return this.children.add(e),this.layer-v},D.prototype.renderChild=function(e){w.assert(this.children.has(e));var g=e.render();this.svgElement.appendChild(g)},D.prototype.removeChild=function(e){w.assert(this.children.has(e)),this.children.delete(e)},D.prototype.remove=function(){this.svgElement.remove(),this.backgroundElement.remove()},D);function D(e){this.backgroundElement=null,this.svgElement=null,this.children=new Set,this.belongTo=e}g.TopContext=E},function(e,g,_){Object.defineProperty(g,`__esModule`,{value:!0});var v=_(2);g.lookup=function(e,g){return e.length<=g?v.none:v.some(e[g])},g.takeWhile=function(e,g){var _;for(_=0;_<e.length&&g(e[_]);++_);return e.slice(0,_)}},function(e,g,_){var v,y=this&&this.__extends||(v=function(e,g){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var _ in g)g.hasOwnProperty(_)&&(e[_]=g[_])})(e,g)},function(e,g){function _(){this.constructor=e}v(e,g),e.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)}),b=this&&this.__values||function(e){var g=typeof Symbol==`function`&&Symbol.iterator,_=g&&e[g],v=0;if(_)return _.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&v>=e.length&&(e=void 0),{value:e&&e[v++],done:!e}}};throw TypeError(g?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(g,`__esModule`,{value:!0});var x,S,C,w,T=_(1),E=_(0),D=_(5);function O(e,g,_,v){this.store=e,this.font=g,this.padding=_,this.svgElement=document.createElementNS(E.SVGNS,`g`);var y=document.createElementNS(E.SVGNS,`rect`);y.setAttribute(`fill`,/^#/g.test(e.color)?D.addAlpha(e.color,v):e.color),y.setAttribute(`stroke`,e.borderColor),y.setAttribute(`width`,this.width.toString()),y.setAttribute(`height`,(g.lineHeight+2*_).toString()),y.setAttribute(`rx`,(2*_).toString()),y.style.cursor=`pointer`;var b=document.createElementNS(E.SVGNS,`text`);b.style.userSelect=`none`,b.style.cursor=`pointer`,b.textContent=e.text,b.setAttribute(`dx`,_.toString()),b.setAttribute(`dy`,g.topToBaseLine+_+`px`),this.svgElement.appendChild(y),this.svgElement.appendChild(b)}function k(e,g){var _,v,y=C.call(this)||this;try{for(var x=b(e.store.labelCategoryRepo.values()),w=x.next();!w.done;w=x.next()){var T=w.value;y.add(new S(T,e.labelFont,g.labelPadding,g.labelOpacity))}}catch(e){_={error:e}}finally{try{w&&!w.done&&(v=x.return)&&v.call(x)}finally{if(_)throw _.error}}return y}x=g.LabelCategoryElement||={},Object.defineProperty(O.prototype,`width`,{get:function(){return this.font.widthOf(this.store.text)+2*this.padding},enumerable:!0,configurable:!0}),O.prototype.create=function(){return this.svgElement.cloneNode(!0)},Object.defineProperty(O.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),S=O,C=T.Base.Repository,y(k,C),w=k,x.FactoryRepository=w},function(e,g,_){var v,y=this&&this.__extends||(v=function(e,g){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,g){e.__proto__=g}||function(e,g){for(var _ in g)g.hasOwnProperty(_)&&(e[_]=g[_])})(e,g)},function(e,g){function _(){this.constructor=e}v(e,g),e.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)}),b=this&&this.__read||function(e,g){var _=typeof Symbol==`function`&&e[Symbol.iterator];if(!_)return e;var v,y,b=_.call(e),x=[];try{for(;(g===void 0||0<g--)&&!(v=b.next()).done;)x.push(v.value)}catch(e){y={error:e}}finally{try{v&&!v.done&&(_=b.return)&&_.call(b)}finally{if(y)throw y.error}}return x},x=this&&this.__spread||function(){for(var e=[],g=0;g<arguments.length;g++)e=e.concat(b(arguments[g]));return e},S=this&&this.__values||function(e){var g=typeof Symbol==`function`&&Symbol.iterator,_=g&&e[g],v=0;if(_)return _.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&v>=e.length&&(e=void 0),{value:e&&e[v++],done:!e}}};throw TypeError(g?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(g,`__esModule`,{value:!0});var C,w,T,E,D=_(1),O=_(0);function k(e,g,_){var v;this.store=e,this.svgElement=document.createElementNS(O.SVGNS,`g`);var y=document.createElementNS(O.SVGNS,`rect`);y.setAttribute(`fill`,`#ffffff`),y.setAttribute(`width`,g.widthOf(e.text).toString()),y.setAttribute(`height`,g.lineHeight.toString());var b=document.createElementNS(O.SVGNS,`text`);(v=b.classList).add.apply(v,x(_)),b.textContent=e.text,b.setAttribute(`dy`,g.topToBaseLine+`px`),this.svgElement.appendChild(y),this.svgElement.appendChild(b)}function A(e,g){var _,v,y=T.call(this)||this;y.config=g;try{for(var b=S(e.store.connectionCategoryRepo.values()),x=b.next();!x.done;x=b.next()){var C=x.value;T.prototype.add.call(y,new w(C,e.connectionFont,g.connectionClasses))}}catch(e){_={error:e}}finally{try{x&&!x.done&&(v=b.return)&&v.call(b)}finally{if(_)throw _.error}}return y}C=g.ConnectionCategoryElement||={},Object.defineProperty(k.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),k.prototype.create=function(){return this.svgElement.cloneNode(!0)},w=k,T=D.Base.Repository,y(A,T),E=A,C.FactoryRepository=E},function(e,g,_){var v=this&&this.__read||function(e,g){var _=typeof Symbol==`function`&&e[Symbol.iterator];if(!_)return e;var v,y,b=_.call(e),x=[];try{for(;(g===void 0||0<g--)&&!(v=b.next()).done;)x.push(v.value)}catch(e){y={error:e}}finally{try{v&&!v.done&&(_=b.return)&&_.call(b)}finally{if(y)throw y.error}}return x},y=this&&this.__spread||function(){for(var e=[],g=0;g<arguments.length;g++)e=e.concat(v(arguments[g]));return e};Object.defineProperty(g,`__esModule`,{value:!0});var b=_(0),x=_(11),S=_(7),C=(Object.defineProperty(w.prototype,`characterIndex`,{get:function(){return this._characterIndex},set:function(e){this.view.lines[this._lineIndex].isBlank?this._characterIndex=0:this._characterIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,`lineIndex`,{get:function(){return this._lineIndex},set:function(e){this._lineIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,`line`,{get:function(){return this.view.lines[this.lineIndex]},enumerable:!0,configurable:!0}),w.prototype.render=function(){var e=this;return this.constructCaretElement(),this.constructHiddenTextAreaElement(),this.parentSVGYOffset=this.view.svgElement.getBoundingClientRect().top-document.getElementsByTagName(`html`)[0].getBoundingClientRect().top,this.hiddenTextAreaElement.onkeyup=function(g){if(!e.inComposition){switch(g.key){case`ArrowLeft`:e.characterIndex===0?e.line.last.isSome&&(--e.lineIndex,e.characterIndex=e.line.content.length):(--e.characterIndex,e.avoidInLabel(`backward`));break;case`ArrowRight`:e.characterIndex>=e.line.content.length||e.line.isBlank?e.line.next.isSome&&(++e.lineIndex,e.characterIndex=0):(++e.characterIndex,e.avoidInLabel(`forward`));break;case`ArrowUp`:e.line.last.isSome&&--e.lineIndex,e.characterIndex=Math.min(e.characterIndex,e.line.content.length),e.avoidInLabel(`forward`);break;case`ArrowDown`:e.line.next.isSome&&++e.lineIndex,e.characterIndex=Math.min(e.characterIndex,e.line.content.length),e.avoidInLabel(`forward`);break;case`Backspace`:var _=e.line.startIndex+e.characterIndex-1;e.view.root.emit(`contentDelete`,_,1);break;default:if(e.hiddenTextAreaElement.value!==``){x.Font.Service.measureMore(e.view.contentFont,e.hiddenTextAreaElement.value,e.view.config.contentClasses,e.view.textElement);var v=e.view.lines[e._lineIndex].startIndex+e.characterIndex;e.view.root.emit(`contentInput`,v,e.hiddenTextAreaElement.value),e.hiddenTextAreaElement.value=``}}e.update()}},this.hiddenTextAreaElement.addEventListener(`compositionstart`,function(){e.inComposition=!0}),this.hiddenTextAreaElement.addEventListener(`compositionend`,function(){e.inComposition=!1}),this.update(),this.hiddenTextAreaElement.style.opacity=`0`,[this.cursorElement,this.hiddenTextAreaElement]},w.prototype.avoidInLabel=function(e){for(var g=this.line.startIndex+this.characterIndex,_=Array.from(this.line.topContext.children).filter(function(e){return e instanceof S.LabelView.Entity}),v=_.find(function(e){return e.store.startIndex<=g-1&&g<e.store.endIndex});v!==void 0;)e===`forward`?++this.characterIndex:--this.characterIndex,g=this.line.startIndex+this.characterIndex,v=_.find(function(e){return e.store.startIndex<=g-1&&g<e.store.endIndex})},w.prototype.update=function(){var e=this.view.paddingLeft+this.view.contentFont.widthOf(this.line.content.slice(0,this.characterIndex));this.cursorElement.setAttribute(`d`,`
            M`+e+`,`+this.line.y+`
            L`+e+`,`+(this.line.y+this.view.contentFont.lineHeight)+`
        `),this.hiddenTextAreaElement.style.top=this.parentSVGYOffset+this.line.y+`px`,this.hiddenTextAreaElement.style.left=this.cursorElement.getBoundingClientRect().left+`px`},w.prototype.caretChanged=function(e){var g=window.getSelection();if(g.type===`Caret`){var _=document.querySelector(`svg`).getClientRects()[0];if(g.anchorNode.parentNode!==null){var v=g.anchorNode.parentNode.getExtentOfChar(0);if(_.top+v.y+this.view.contentFont.lineHeight<=e){var y=g.anchorNode.parentNode.nextSibling.annotatorElement;this._lineIndex=this.view.lines.indexOf(y),this.characterIndex=0,this.avoidInLabel(`forward`)}else y=g.anchorNode.parentNode.annotatorElement,this._lineIndex=this.view.lines.indexOf(y),this.characterIndex=g.anchorOffset,this.avoidInLabel(`forward`);this.update(),this.hiddenTextAreaElement.focus({preventScroll:!0})}}},w.prototype.constructHiddenTextAreaElement=function(){var e;this.hiddenTextAreaElement=document.createElement(`textarea`),this.hiddenTextAreaElement.setAttribute(`autocorrect`,`off`),this.hiddenTextAreaElement.setAttribute(`autocapitalize`,`off`),this.hiddenTextAreaElement.setAttribute(`spellcheck`,`false`),(e=this.hiddenTextAreaElement.classList).add.apply(e,y(this.view.config.contentClasses)),this.hiddenTextAreaElement.style.position=`absolute`,this.hiddenTextAreaElement.style.padding=`0`,this.hiddenTextAreaElement.style.width=`100vw`,this.hiddenTextAreaElement.style.height=`1em`,this.hiddenTextAreaElement.style.outline=`none`,this.hiddenTextAreaElement.style.zIndex=`-1`,this.hiddenTextAreaElement.style.borderStyle=`none`,this.hiddenTextAreaElement.style.fontFamily=this.view.contentFont.fontFamily,this.hiddenTextAreaElement.style.fontSize=this.view.contentFont.fontSize+`px`,this.hiddenTextAreaElement.style.fontWeight=this.view.contentFont.fontWeight,this.hiddenTextAreaElement.style.opacity=`0`},w.prototype.constructCaretElement=function(){this.cursorElement=document.createElementNS(b.SVGNS,`path`),this.cursorElement.setAttribute(`stroke`,`#000000`),this.cursorElement.setAttribute(`stroke-width`,`1.5`),this.cursorElement.style.animationName=`cursor`,this.cursorElement.style.animationDuration=`0.75s`,this.cursorElement.style.animationTimingFunction=`ease-out`,this.cursorElement.style.animationDirection=`alternate`,this.cursorElement.style.animationIterationCount=`infinite`},w.prototype.hide=function(){this.cursorElement.style.display=`none`},w.prototype.show=function(){this.cursorElement.style.display=`inline`},w.prototype.remove=function(){this.hiddenTextAreaElement.remove()},w);function w(e){this.view=e,this.cursorElement=null,this.hiddenTextAreaElement=null,this.parentSVGYOffset=null;var g=document.getElementsByTagName(`head`)[0],_=document.createElement(`style`);_.innerHTML=`@keyframes cursor { from { opacity: 0; } to { opacity: 1; }  }`,g.appendChild(_),this._lineIndex=0,this._characterIndex=0,this.inComposition=!1}g.ContentEditor=C},function(e,g,_){Object.defineProperty(g,`__esModule`,{value:!0});var v={contentClasses:[`poplar-annotation-content`],labelClasses:[`poplar-annotation-label`],connectionClasses:[`poplar-annotation-connection`],labelPadding:2,lineHeight:1.5,topContextMargin:3,bracketWidth:8,allowMultipleLabel:`differentCategory`,allowMultipleConnection:`differentCategory`,labelWidthCalcMethod:`max`,connectionWidthCalcMethod:`line`,labelOpacity:90,defaultLabelColor:`#ff9d61`,selectingAreaStrip:/[\n ]/,unconnectedLineStyle:`curve`,contentEditable:!0};g.parseInput=function(e){var g={};for(var _ in v)g[_]=e[_]===void 0?v[_]:e[_];return g}},function(e,g,_){var v=this&&this.__read||function(e,g){var _=typeof Symbol==`function`&&e[Symbol.iterator];if(!_)return e;var v,y,b=_.call(e),x=[];try{for(;(g===void 0||0<g--)&&!(v=b.next()).done;)x.push(v.value)}catch(e){y={error:e}}finally{try{v&&!v.done&&(_=b.return)&&_.call(b)}finally{if(y)throw y.error}}return x};Object.defineProperty(g,`__esModule`,{value:!0});var y=_(2),b=_(4),x=(S.prototype.getSelectionInfo=function(){var e,g=this,_=window.getSelection();b.assert(_.type===`Range`);var x,S,C,w,T=null,E=null;try{T=_.anchorNode.parentNode,E=_.focusNode.parentNode}catch{return null}try{if(x=T.annotatorElement,S=E.annotatorElement,x.view!==this.root.view||S.view!==this.root.view)return null;C=x.startIndex+_.anchorOffset,w=S.startIndex+_.focusOffset}catch{return null}return w<C&&(e=v([w,C],2),C=e[0],w=e[1]),y.fromNullable(this.config.selectingAreaStrip).map(function(e){for(;e.test(g.root.store.content[C]);)++C;for(;e.test(g.root.store.content[w-1]);)--w}),w<=C?null:{startIndex:C,endIndex:w}},S.prototype.textSelected=function(){var e,g=this.getSelectionInfo();g&&this.root.emit(`textSelected`,g.startIndex,g.endIndex),(e=window.getSelection())==null||e.removeAllRanges()},S);function S(e,g){this.root=e,this.config=g}g.TextSelectionHandler=x},function(e,g,_){var v=this&&this.__read||function(e,g){var _=typeof Symbol==`function`&&e[Symbol.iterator];if(!_)return e;var v,y,b=_.call(e),x=[];try{for(;(g===void 0||0<g--)&&!(v=b.next()).done;)x.push(v.value)}catch(e){y={error:e}}finally{try{v&&!v.done&&(_=b.return)&&_.call(b)}finally{if(y)throw y.error}}return x},y=this&&this.__spread||function(){for(var e=[],g=0;g<arguments.length;g++)e=e.concat(v(arguments[g]));return e};Object.defineProperty(g,`__esModule`,{value:!0});function b(e,g){var _,v=this;this.root=e,this.config=g,this.lastSelection=S.none,this.svgElement=document.createElementNS(x.SVGNS,`path`),(_=this.svgElement.classList).add.apply(_,y(e.view.config.connectionClasses.map(function(e){return e+`-line`}))),this.svgElement.setAttribute(`fill`,`none`),this.svgElement.style.markerEnd=`url(#marker-arrow)`,this.root.on(`labelClicked`,function(e){v.lastSelection.isSome?(v.root.emit(`twoLabelsClicked`,v.lastSelection.toNullable().id,e),v.svgElement.remove(),v.svgElement.setAttribute(`d`,``),v.lastSelection=S.none):(v.lastSelection=S.some(v.root.view.labelViewRepository.get(e)),v.root.view.svgElement.insertBefore(v.svgElement,v.root.view.svgElement.firstChild))}),this.root.view.svgElement.onmousemove=function(e){v.lastSelection.map(function(_){var y=_.labelLeft+1,b=_.labelRight-1,x=_.globalY+1,S=e.clientX-v.root.view.svgElement.getBoundingClientRect().left,C=e.clientY-v.root.view.svgElement.getBoundingClientRect().top,w=(y+b)/2<S?y:b;if(g.unconnectedLineStyle===`straight`)v.svgElement.setAttribute(`d`,`
                    M`+w+`,`+x+`
                    L`+S+`,`+C+`
                `);else if(g.unconnectedLineStyle===`curve`){var T=(y-S)/4,E=Math.min(x,C)-20;v.svgElement.setAttribute(`d`,`
                        M`+w+`,`+x+`
                        C`+(w-T)+`,`+E+`,`+(S+T)+`,`+E+`,`+S+`,`+C+`
                    `)}})},this.root.view.svgElement.oncontextmenu=function(e){v.lastSelection.map(function(){v.svgElement.remove(),v.svgElement.setAttribute(`d`,``),v.lastSelection=S.none,e.preventDefault()})}}var x=_(0),S=_(2);g.TwoLabelsClickedHandler=b},function(e,g,_){Object.defineProperty(g,`__esModule`,{value:!0});var v=_(9);(function(e){var g=(_.prototype.apply=function(e){e.connectionRepo.add(new v.Connection.Entity(null,this.categoryId,this.fromId,this.toId,e))},_);function _(e,g,_){this.categoryId=e,this.fromId=g,this.toId=_}e.CreateConnectionAction=g,e.Create=function(e,_,v){return new g(e,_,v)};var y=(b.prototype.apply=function(e){e.connectionRepo.delete(this.id)},b);function b(e){this.id=e}function x(e){return new y(e)}e.DeleteConnectionAction=y,e.Delete=x;var S=(C.prototype.apply=function(e){var g=e.connectionRepo.get(this.connectionId);x(this.connectionId).apply(e),e.connectionRepo.add(new v.Connection.Entity(this.connectionId,this.categoryId,g.fromId,g.toId,e))},C);function C(e,g){this.connectionId=e,this.categoryId=g}e.UpdateConnectionAction=S,e.Update=function(e,g){return new S(e,g)}})(g.Connection||={})},function(e,g,_){var v=this&&this.__values||function(e){var g=typeof Symbol==`function`&&Symbol.iterator,_=g&&e[g],v=0;if(_)return _.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&v>=e.length&&(e=void 0),{value:e&&e[v++],done:!e}}};throw TypeError(g?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(g,`__esModule`,{value:!0});var y=_(8);(function(e){var g=(_.prototype.apply=function(e){if(e.content.slice(this.startIndex,this.endIndex).includes(`
`))throw Error(`Insert label across hard line is not supported now! Please remove the \\n in content first!`);e.labelRepo.add(new y.Label.Entity(null,this.categoryId,this.startIndex,this.endIndex,e))},_);function _(e,g,_){this.categoryId=e,this.startIndex=g,this.endIndex=_}e.CreateLabelAction=g,e.Create=function(e,_,v){return new g(e,_,v)};var b=(x.prototype.apply=function(e){var g,_;try{for(var y=v(e.labelRepo.get(this.id).allConnections),b=y.next();!b.done;b=y.next()){var x=b.value;e.connectionRepo.delete(x)}}catch(e){g={error:e}}finally{try{b&&!b.done&&(_=y.return)&&_.call(y)}finally{if(g)throw g.error}}e.labelRepo.delete(this.id)},x);function x(e){this.id=e}function S(e){return new b(e)}e.DeleteLabelAction=b,e.Delete=S;var C=(w.prototype.apply=function(e){var g=e.labelRepo.get(this.labelId),_=g.allConnections;S(this.labelId).apply(e),e.labelRepo.add(new y.Label.Entity(this.labelId,this.categoryId,g.startIndex,g.endIndex,e)),_.forEach(function(g){return e.connectionRepo.add(g)})},w);function w(e,g){this.labelId=e,this.categoryId=g}e.UpdateLabelAction=C,e.Update=function(e,g){return new C(e,g)}})(g.Label||={})},function(e,g,_){var v,y;function b(e,g,_){this.startIndex=e,this.removeLength=g,this.insert=_}Object.defineProperty(g,`__esModule`,{value:!0}),v=g.Content||={},b.prototype.apply=function(e){if(!e.config.contentEditable)throw Error(`Content edition is not on!`);e.spliceContent(this.startIndex,this.removeLength,this.insert)},y=b,v.SpliceAction=y,v.Splice=function(e,g,_){return new y(e,g,_)}}],e.c=_,e.d=function(g,_,v){e.o(g,_)||Object.defineProperty(g,_,{enumerable:!0,get:v})},e.r=function(e){typeof Symbol<`u`&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:`Module`}),Object.defineProperty(e,`__esModule`,{value:!0})},e.t=function(g,_){if(1&_&&(g=e(g)),8&_||4&_&&typeof g==`object`&&g&&g.__esModule)return g;var v=Object.create(null);if(e.r(v),Object.defineProperty(v,`default`,{enumerable:!0,value:g}),2&_&&typeof g!=`string`)for(var y in g)e.d(v,y,function(e){return g[e]}.bind(null,y));return v},e.n=function(g){var _=g&&g.__esModule?function(){return g.default}:function(){return g};return e.d(_,`a`,_),_},e.o=function(e,g){return Object.prototype.hasOwnProperty.call(e,g)},e.p=``,e(e.s=12);function e(v){if(_[v])return _[v].exports;var y=_[v]={i:v,l:!1,exports:{}};return g[v].call(y.exports,y,y.exports,e),y.l=!0,y.exports}var g,_})}))(),labelCategoryDialog_default=_plugin_vue_export_helper_default(defineComponent({__name:`index`,props:mergeModels({LabelCategorys:{}},{visible:{default:!1},visibleModifiers:{}}),emits:mergeModels([`updateLable`],[`update:visible`]),setup(e,{emit:g}){let v=g,y=useModel(e,`visible`),S=ref(),C=()=>{S.value!==null&&v(`updateLable`,S.value),S.value=void 0};return watchEffect(()=>{}),(e,g)=>{let v=ElOption,b=ElSelect,w=ElDialog;return openBlock(),createElementBlock(`div`,null,[createVNode(w,{title:``,modelValue:y.value,"onUpdate:modelValue":g[1]||=e=>y.value=e,width:`240`},{default:withCtx(()=>[createVNode(b,{modelValue:S.value,"onUpdate:modelValue":g[0]||=e=>S.value=e,placeholder:``,onChange:C},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.LabelCategorys,e=>(openBlock(),createBlock(v,{key:e.id,label:e.text,value:e.id},{default:withCtx(()=>[createBaseVNode(`span`,{class:`w-3 h-3 mr-1 inline-block`,style:normalizeStyle({backgroundColor:e.color})},null,4),createBaseVNode(`span`,null,toDisplayString(e.text),1)]),_:2},1032,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1},8,[`modelValue`])])}}}),[[`__scopeId`,`data-v-291685b6`]]),connectionCategoryDialog_default=_plugin_vue_export_helper_default(defineComponent({__name:`index`,props:{visible:{type:Boolean,default:()=>!1},connectionCategories:{}},emits:[`update:visible`,`updateConnection`],setup(e,{emit:g}){let y=e,b=g,S=computed({get(){return y.visible},set(e){b(`update:visible`,e)}}),C=ref(),w=()=>{C.value!==null&&b(`updateConnection`,C.value),C.value=void 0};return(e,g)=>{let y=resolveComponent(`Link`),b=ElIcon,E=ElOption,O=ElSelect,k=ElDialog;return openBlock(),createElementBlock(`div`,null,[createVNode(k,{title:``,modelValue:S.value,"onUpdate:modelValue":g[1]||=e=>S.value=e,width:`300`},{default:withCtx(()=>[createVNode(O,{modelValue:C.value,"onUpdate:modelValue":g[0]||=e=>C.value=e,placeholder:``,onChange:w},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.connectionCategories,e=>(openBlock(),createBlock(E,{key:e.id,label:e.text,value:e.id},{default:withCtx(()=>[createVNode(b,{color:`#fb9776`,size:`16`,class:`mr-1 translate-y-[2px]`},{default:withCtx(()=>[createVNode(y)]),_:1}),createBaseVNode(`span`,null,toDisplayString(e.text),1)]),_:2},1032,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1},8,[`modelValue`])])}}}),[[`__scopeId`,`data-v-c44b241c`]]),_hoisted_1={class:`h-full`},_hoisted_2={class:`p-5`},_hoisted_3={class:`flex`},_hoisted_4={class:`editor w-1/2`},_hoisted_5={class:`ml-5 w-1/2`},_hoisted_6={class:`dark:border-dark-border mb-3 rounded border border-[#dedede] px-2 py-3`},_hoisted_7={class:`mt-4 flex items-center`},CategorySelectModes=function(e){return e[e.CREATE=0]=`CREATE`,e[e.UPDATE=1]=`UPDATE`,e}(CategorySelectModes||{}),text_annotation_default=_plugin_vue_export_helper_default(defineComponent({__name:`index`,setup(g){let _=ref(null),v=ref(``),b=ref(CategorySelectModes.CREATE),C=ref(!1),E=ref(!1),O=reactive({startIndex:-1,endIndex:-1,selectedId:-1,sourceId:-1,targetId:-1}),k={topContextMargin:0,connectionWidthCalcMethod:`line`,unconnectedLineStyle:`curve`,labelWidthCalcMethod:`label`},A=()=>{let e={content:v.value,labelCategories:[{id:0,text:``,color:`#fae88e`,borderColor:`#dfc33a`},{id:1,text:``,color:`#cdec90`,borderColor:`#98d918`},{id:2,text:``,color:`#7da1ed`,borderColor:`#265ac9`}],labels:[{id:0,categoryId:0,startIndex:0,endIndex:2},{id:1,categoryId:1,startIndex:8,endIndex:9},{id:2,categoryId:2,startIndex:23,endIndex:24}],connectionCategories:[{id:0,text:`1`},{id:1,text:`2`}],connections:[{id:0,categoryId:0,fromId:0,toId:1},{id:1,categoryId:1,fromId:1,toId:2}]},g=document.getElementById(`example`);_.value&&_.value.remove(),_.value=new import_dist.Annotator(e,g,k),_.value.on(`textSelected`,(e,g)=>{O.startIndex=e,O.endIndex=g,C.value=!0,b.value=CategorySelectModes.CREATE}),_.value.on(`labelRightClicked`,e=>{_.value.applyAction(import_dist.Action.Label.Delete(e))}),_.value.on(`labelDoubleClicked`,e=>{b.value=CategorySelectModes.UPDATE,O.selectedId=e,C.value=!0}),_.value.on(`twoLabelsClicked`,(e,g)=>{e!==g&&(O.sourceId=e,O.targetId=g,b.value=CategorySelectModes.CREATE,E.value=!0)}),_.value.on(`connectionDoubleClicked`,e=>{O.selectedId=e,b.value=CategorySelectModes.UPDATE,E.value=!0}),_.value.on(`connectionRightClicked`,e=>{_.value.applyAction(import_dist.Action.Connection.Delete(e))})},j=e=>{b.value===CategorySelectModes.CREATE?_.value.applyAction(import_dist.Action.Label.Create(e,O.startIndex,O.endIndex)):_.value.applyAction(import_dist.Action.Label.Update(O.selectedId,e)),C.value=!1},P=e=>{b.value===CategorySelectModes.CREATE?_.value.applyAction(import_dist.Action.Connection.Create(e,O.sourceId,O.targetId)):_.value.applyAction(import_dist.Action.Connection.Update(O.selectedId,e)),E.value=!1},z=()=>{let e=document.createElement(`a`);e.download=`data.json`,e.style.display=`none`;let g=new Blob([JSON.stringify(_.value.store.json,null,4)]);e.href=URL.createObjectURL(g),document.body.appendChild(e),e.click(),document.body.removeChild(e)},W=()=>{let e=document.createElement(`a`);e.download=`data.svg`,e.style.display=`none`;let g=new Blob([_.value.export()]);e.href=URL.createObjectURL(g),document.body.appendChild(e),e.click(),document.body.removeChild(e)},G=computed(()=>{if(_.value===null)return[];let e=[];for(let[g,v]of _.value.store.labelCategoryRepo)e.push(v);return e}),K=computed(()=>{if(_.value===null)return[];let e=[];for(let[g,v]of _.value.store.connectionCategoryRepo)e.push(v);return e}),q=computed(()=>{if(_.value===null)return[];let e=[],g=[];for(let[e,v]of _.value.store.labelCategoryRepo)g.push(v);for(let[g,v]of _.value.store.labelRepo)e.push(v.json);let v=e.reduce((e,g)=>(e.set(g.categoryId,(e.get(g.categoryId)||0)+1),e),new Map);return g.forEach(e=>{let g=e.id;v.has(g)&&(e.num=v.get(g))}),g});return onMounted(()=>{v.value=` `}),(g,b)=>{let S=ElLink,O=ElInput,k=ElButton,I=ElTag,R=ElBadge;return openBlock(),createElementBlock(`div`,_hoisted_1,[b[10]||=createBaseVNode(`h2`,{class:`title w-full`},``,-1),createBaseVNode(`div`,_hoisted_2,[createVNode(S,{href:`https://github.com/synyi/poplar/blob/master/doc/zh.md`,target:`_blank`},{default:withCtx(()=>b[3]||=[createTextVNode(`Poplar-annotator`)]),_:1}),createBaseVNode(`div`,_hoisted_3,[createBaseVNode(`div`,_hoisted_4,[b[5]||=createBaseVNode(`h4`,{class:`my-1`},``,-1),createVNode(O,{modelValue:v.value,"onUpdate:modelValue":b[0]||=e=>v.value=e,type:`textarea`,resize:`none`,rows:10,placeholder:``},null,8,[`modelValue`]),createVNode(k,{class:`mt-[10px]`,type:`primary`,onClick:A},{default:withCtx(()=>b[4]||=[createTextVNode(``)]),_:1})]),createBaseVNode(`div`,_hoisted_5,[b[8]||=createBaseVNode(`h4`,{class:`my-1`},``,-1),createBaseVNode(`div`,_hoisted_6,[(openBlock(!0),createElementBlock(Fragment,null,renderList(q.value,e=>(openBlock(),createBlock(R,{key:e.id,value:e.num,class:`item mr-4`,type:`warning`},{default:withCtx(()=>[createVNode(I,{hit:!0,color:e.color},{default:withCtx(()=>[createTextVNode(toDisplayString(e.text),1)]),_:2},1032,[`color`])]),_:2},1032,[`value`]))),128))]),b[9]||=createBaseVNode(`div`,{id:`example`,class:`dark:border-dark-border h-[300px] overflow-hidden rounded border border-[#dedede]`},null,-1),createBaseVNode(`div`,_hoisted_7,[withDirectives(createVNode(k,{type:`primary`,onClick:z},{default:withCtx(()=>b[6]||=[createTextVNode(`JSON`)]),_:1},512),[[vShow,_.value]]),withDirectives(createVNode(k,{type:`primary`,onClick:W},{default:withCtx(()=>b[7]||=[createTextVNode(`SVG`)]),_:1},512),[[vShow,_.value]])])])])]),createVNode(labelCategoryDialog_default,{visible:C.value,"onUpdate:visible":b[1]||=e=>C.value=e,LabelCategorys:G.value,onUpdateLable:j},null,8,[`visible`,`LabelCategorys`]),createVNode(connectionCategoryDialog_default,{visible:E.value,"onUpdate:visible":b[2]||=e=>E.value=e,connectionCategories:K.value,onUpdateConnection:P},null,8,[`visible`,`connectionCategories`])])}}}),[[`__scopeId`,`data-v-a33f485d`]]);export{text_annotation_default as default};