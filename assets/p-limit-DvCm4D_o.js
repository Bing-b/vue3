import{$ as ElButton,Hr as __toESM,Ir as toDisplayString,J as ElTag,Jn as withCtx,Ln as renderList,Nn as openBlock,Pt as position_default,Q as require_dayjs_min,Qt as _plugin_vue_export_helper_default,_n as createStaticVNode,cn as Fragment,fn as createBaseVNode,hn as createElementBlock,jr as normalizeClass,kn as nextTick,mn as createCommentVNode,rr as ref,ur as unref,vn as createTextVNode,xn as defineComponent,yn as createVNode}from"./index-CidyMYlX.js";/* empty css            *//* empty css            *//* empty css            */var Node=class{value;next;constructor(r){this.value=r}},Queue=class{#e;#t;#n;constructor(){this.clear()}enqueue(r){let x=new Node(r);this.#e?(this.#t.next=x,this.#t=x):(this.#e=x,this.#t=x),this.#n++}dequeue(){let r=this.#e;if(r)return this.#e=this.#e.next,this.#n--,r.value}peek(){if(this.#e)return this.#e.value}clear(){this.#e=void 0,this.#t=void 0,this.#n=0}get size(){return this.#n}*[Symbol.iterator](){let r=this.#e;for(;r;)yield r.value,r=r.next}};function pLimit(r){validateConcurrency(r);let x=new Queue,S=0,C=()=>{S<r&&x.size>0&&(x.dequeue()(),S++)},w=()=>{S--,C()},T=async(r,x,S)=>{let C=(async()=>r(...S))();x(C);try{await C}catch{}w()},E=(w,E,D)=>{new Promise(r=>{x.enqueue(r)}).then(T.bind(void 0,w,E,D)),(async()=>{await Promise.resolve(),S<r&&C()})()},D=(r,...x)=>new Promise(S=>{E(r,S,x)});return Object.defineProperties(D,{activeCount:{get:()=>S},pendingCount:{get:()=>x.size},clearQueue:{value(){x.clear()}},concurrency:{get:()=>r,set(w){validateConcurrency(w),r=w,queueMicrotask(()=>{for(;S<r&&x.size>0;)C()})}}}),D}function validateConcurrency(r){if(!((Number.isInteger(r)||r===1/0)&&r>0))throw TypeError("Expected `concurrency` to be a number from 1 and up")}var import_dayjs_min=__toESM(require_dayjs_min()),_hoisted_1={class:`demo-card`},_hoisted_2={class:`demo-content`},_hoisted_3={class:`control-panel`},_hoisted_4={class:`config-item`},_hoisted_5={class:`console-wrapper`},_hoisted_6={class:`time`},_hoisted_7={key:0,class:`empty-msg`},p_limit_default=_plugin_vue_export_helper_default(defineComponent({__name:`p-limit`,setup(x){let O=ref([]),k=ref(null),M=(r,x=`info`)=>{O.value.push({time:(0,import_dayjs_min.default)().format(`HH:mm:ss.SSS`),text:r,type:x}),nextTick(()=>{k.value&&(k.value.scrollTop=k.value.scrollHeight)})},N=r=>new Promise(x=>{M(`Task [${r}] - 开始执行 (等待 2s)`),setTimeout(()=>{M(`Task [${r}] - 执行完毕`,`success`),x(r)},2e3)}),P=async()=>{O.value=[],M(`初始化最大并发限额: 1`);let r=pLimit(1),x=[r(()=>N(`Task-X`)),r(()=>N(`Task-Y`)),r(()=>N(`Task-Z`))];await Promise.all(x),M(`所有请求已完成`,`success`)};return(x,A)=>{let j=ElTag,M=ElButton;return openBlock(),createElementBlock(`div`,_hoisted_1,[A[4]||=createBaseVNode(`div`,{class:`demo-info`},[createBaseVNode(`h4`,{class:`title`},`并发控制 (P-Limit)`),createBaseVNode(`p`,{class:`desc`},`模拟受限并发环境下的异步请求执行，确保系统稳定性`)],-1),createBaseVNode(`div`,_hoisted_2,[createBaseVNode(`div`,_hoisted_3,[createBaseVNode(`div`,_hoisted_4,[A[1]||=createBaseVNode(`span`,{class:`label`},`最大并发数`,-1),createVNode(j,{type:`warning`,effect:`dark`},{default:withCtx(()=>A[0]||=[createTextVNode(`1`)]),_:1})]),createVNode(M,{type:`primary`,onClick:P,icon:unref(position_default),large:``},{default:withCtx(()=>A[2]||=[createTextVNode(` 开始模拟并发请求 `)]),_:1},8,[`icon`])]),createBaseVNode(`div`,_hoisted_5,[A[3]||=createStaticVNode(`<div class="console-header" data-v-7a32e4c7><span class="dot red" data-v-7a32e4c7></span><span class="dot yellow" data-v-7a32e4c7></span><span class="dot green" data-v-7a32e4c7></span><span class="title" data-v-7a32e4c7>Terminal Output</span></div>`,1),createBaseVNode(`div`,{class:`console-body`,ref_key:`consoleRef`,ref:k},[(openBlock(!0),createElementBlock(Fragment,null,renderList(O.value,(r,x)=>(openBlock(),createElementBlock(`div`,{key:x,class:`log-line`},[createBaseVNode(`span`,_hoisted_6,`[`+toDisplayString(r.time)+`]`,1),createBaseVNode(`span`,{class:normalizeClass([`msg`,r.type])},toDisplayString(r.text),3)]))),128)),O.value.length===0?(openBlock(),createElementBlock(`div`,_hoisted_7,`等待执行任务...`)):createCommentVNode(``,!0)],512)])])])}}}),[[`__scopeId`,`data-v-7a32e4c7`]]);export{p_limit_default as default};