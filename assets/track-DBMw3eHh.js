import{$n as e,At as t,Bt as n,Dt as r,E as i,Ht as a,Ot as o,Q as s,an as c,pn as l,qn as u,r as d,wt as f,xt as p}from"./index-Ug8tEEVv.js";/* empty css            *//* empty css            *//* empty css            *//* empty css            */import{r as m,t as h}from"./common-CPMhAFjS.js";/* empty css            */import{t as g}from"./leaflet-src-BWMd6RyR.js";var _=e(g(),1),v=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),y=6371008.8,b={centimeters:y*100,centimetres:y*100,degrees:y/111325,feet:y*3.28084,inches:y*39.37,kilometers:y/1e3,kilometres:y/1e3,meters:y,metres:y,miles:y/1609.344,millimeters:y*1e3,millimetres:y*1e3,nauticalmiles:y/1852,radians:1,yards:y*1.0936};function x(e,t,n){n===void 0&&(n={});var r={type:`Feature`};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function S(e,t,n){if(n===void 0&&(n={}),!e)throw Error(`coordinates is required`);if(!Array.isArray(e))throw Error(`coordinates must be an Array`);if(e.length<2)throw Error(`coordinates must be at least 2 numbers long`);if(!O(e[0])||!O(e[1]))throw Error(`coordinates must contain numbers`);return x({type:`Point`,coordinates:e},t,n)}function C(e,t,n){if(n===void 0&&(n={}),e.length<2)throw Error(`coordinates must be an array of two or more positions`);return x({type:`LineString`,coordinates:e},t,n)}function w(e,t){t===void 0&&(t=`kilometers`);var n=b[t];if(!n)throw Error(t+` units is invalid`);return e*n}function T(e,t){t===void 0&&(t=`kilometers`);var n=b[t];if(!n)throw Error(t+` units is invalid`);return e/n}function E(e){return e%(2*Math.PI)*180/Math.PI}function D(e){return e%360*Math.PI/180}function O(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function k(e){return!!e&&e.constructor===Object}function A(e,t,n){if(e!==null)for(var r,i,a,o,s,c,l,u=0,d=0,f,p=e.type,m=p===`FeatureCollection`,h=p===`Feature`,g=m?e.features.length:1,_=0;_<g;_++){l=m?e.features[_].geometry:h?e.geometry:e,f=l?l.type===`GeometryCollection`:!1,s=f?l.geometries.length:1;for(var v=0;v<s;v++){var y=0,b=0;if(o=f?l.geometries[v]:l,o!==null){c=o.coordinates;var x=o.type;switch(u=0,x){case null:break;case`Point`:if(t(c,d,_,y,b)===!1)return!1;d++,y++;break;case`LineString`:case`MultiPoint`:for(r=0;r<c.length;r++){if(t(c[r],d,_,y,b)===!1)return!1;d++,x===`MultiPoint`&&y++}x===`LineString`&&y++;break;case`Polygon`:case`MultiLineString`:for(r=0;r<c.length;r++){for(i=0;i<c[r].length-u;i++){if(t(c[r][i],d,_,y,b)===!1)return!1;d++}x===`MultiLineString`&&y++,x===`Polygon`&&b++}x===`Polygon`&&y++;break;case`MultiPolygon`:for(r=0;r<c.length;r++){for(b=0,i=0;i<c[r].length;i++){for(a=0;a<c[r][i].length-u;a++){if(t(c[r][i][a],d,_,y,b)===!1)return!1;d++}b++}y++}break;case`GeometryCollection`:for(r=0;r<o.geometries.length;r++)if(A(o.geometries[r],t)===!1)return!1;break;default:throw Error(`Unknown Geometry Type`)}}}}}function j(e,t){var n,r,i,a,o,s,c,l,u,d,f=0,p=e.type===`FeatureCollection`,m=e.type===`Feature`,h=p?e.features.length:1;for(n=0;n<h;n++){for(s=p?e.features[n].geometry:m?e.geometry:e,l=p?e.features[n].properties:m?e.properties:{},u=p?e.features[n].bbox:m?e.bbox:void 0,d=p?e.features[n].id:m?e.id:void 0,c=s?s.type===`GeometryCollection`:!1,o=c?s.geometries.length:1,i=0;i<o;i++){if(a=c?s.geometries[i]:s,a===null){if(t(null,f,l,u,d)===!1)return!1;continue}switch(a.type){case`Point`:case`LineString`:case`MultiPoint`:case`Polygon`:case`MultiLineString`:case`MultiPolygon`:if(t(a,f,l,u,d)===!1)return!1;break;case`GeometryCollection`:for(r=0;r<a.geometries.length;r++)if(t(a.geometries[r],f,l,u,d)===!1)return!1;break;default:throw Error(`Unknown Geometry Type`)}}f++}}function M(e,t){j(e,function(e,n,r,i,a){var o=e===null?null:e.type;switch(o){case null:case`Point`:case`LineString`:case`Polygon`:return t(x(e,r,{bbox:i,id:a}),n,0)===!1?!1:void 0}var s;switch(o){case`MultiPoint`:s=`Point`;break;case`MultiLineString`:s=`LineString`;break;case`MultiPolygon`:s=`Polygon`;break}for(var c=0;c<e.coordinates.length;c++){var l=e.coordinates[c];if(t(x({type:s,coordinates:l},r),n,c)===!1)return!1}})}function N(e,t){M(e,function(e,n,r){var i=0;if(e.geometry){var a=e.geometry.type;if(!(a===`Point`||a===`MultiPoint`)){var o,s=0,c=0,l=0;if(A(e,function(a,u,d,f,p){if(o===void 0||n>s||f>c||p>l){o=a,s=n,c=f,l=p,i=0;return}if(t(C([o,a],e.properties),n,r,p,i)===!1)return!1;i++,o=a})===!1)return!1}}})}function P(e,t,n){var r=n,i=!1;return N(e,function(e,a,o,s,c){r=i===!1&&n===void 0?e:t(r,e,a,o,s,c),i=!0}),r}function F(e){if(!e)throw Error(`coord is required`);if(!Array.isArray(e)){if(e.type===`Feature`&&e.geometry!==null&&e.geometry.type===`Point`)return e.geometry.coordinates;if(e.type===`Point`)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw Error(`coord must be GeoJSON Point or an Array of numbers`)}function I(e){return e.type===`Feature`?e.geometry:e}var R=typeof globalThis<`u`?globalThis:typeof window<`u`?window:typeof global<`u`?global:typeof self<`u`?self:{};function z(e,t,n){n===void 0&&(n={});var r=F(e),i=F(t),a=D(i[1]-r[1]),o=D(i[0]-r[0]),s=D(r[1]),c=D(i[1]),l=Math.sin(a/2)**2+Math.sin(o/2)**2*Math.cos(s)*Math.cos(c);return w(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n.units)}function B(e,t,n,r){r===void 0&&(r={});var i=F(e),a=D(i[0]),o=D(i[1]),s=D(n),c=T(t,r.units),l=Math.asin(Math.sin(o)*Math.cos(c)+Math.cos(o)*Math.sin(c)*Math.cos(s));return S([E(a+Math.atan2(Math.sin(s)*Math.sin(c)*Math.cos(o),Math.cos(c)-Math.sin(o)*Math.sin(l))),E(l)],r.properties)}function V(e,t,n){if(n===void 0&&(n={}),n.final===!0)return H(e,t);var r=F(e),i=F(t),a=D(r[0]),o=D(i[0]),s=D(r[1]),c=D(i[1]),l=Math.sin(o-a)*Math.cos(c),u=Math.cos(s)*Math.sin(c)-Math.sin(s)*Math.cos(c)*Math.cos(o-a);return E(Math.atan2(l,u))}function H(e,t){var n=V(t,e);return n=(n+180)%360,n}function U(e,t,n){n===void 0&&(n={});for(var r=I(e).coordinates,i=0,a=0;a<r.length&&!(t>=i&&a===r.length-1);a++)if(i>=t){var o=t-i;if(o){var s=V(r[a],r[a-1])-180;return B(r[a],o,s,n)}else return S(r[a])}else i+=z(r[a],r[a+1],n);return S(r[r.length-1])}function W(e,t){return t===void 0&&(t={}),P(e,function(e,n){var r=n.geometry.coordinates;return e+z(r[0],r[1],t)},0)}function G(e,t,n,r){if(r||={},!k(r))throw Error(`options is invalid`);var i,a=[];if(e.type===`Feature`)i=e.geometry.coordinates;else if(e.type===`LineString`)i=e.coordinates;else throw Error(`input must be a LineString Feature or Geometry`);for(var o=i.length,s=0,c,l,u,d=0;d<i.length&&!(t>=s&&d===i.length-1);d++){if(s>t&&a.length===0){if(c=t-s,!c)return a.push(i[d]),C(a);l=V(i[d],i[d-1])-180,u=B(i[d],c,l,r),a.push(u.geometry.coordinates)}if(s>=n)return c=n-s,c?(l=V(i[d],i[d-1])-180,u=B(i[d],c,l,r),a.push(u.geometry.coordinates),C(a)):(a.push(i[d]),C(a));if(s>=t&&a.push(i[d]),d===i.length-1)return C(a);s+=z(i[d],i[d+1],r)}if(s<t&&i.length===o)throw Error(`Start position is beyond line`);var f=i[i.length-1];return C([f,f])}(function(e,t){(function(e,t){t(_.default)})(R,function(e){e=e&&e.hasOwnProperty(`default`)?e.default:e;function t(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}var n=function(e,t){return(Math.atan2(t.y-e.y,t.x-e.x)*180/Math.PI+90+360)%360},r=function(e,t){var n=e.value;return e.isInPixels?n/t:n};function i(e){if(typeof e==`string`&&e.indexOf(`%`)!==-1)return{value:parseFloat(e)/100,isInPixels:!1};var t=e?parseFloat(e):0;return{value:t,isInPixels:t>0}}var a=function(e,t){return e.x===t.x&&e.y===t.y};function o(e){return e.reduce(function(e,r,i,o){if(i>0&&!a(r,o[i-1])){var s=o[i-1],c=e.length>0?e[e.length-1].distB:0,l=t(s,r);e.push({a:s,b:r,distA:c,distB:c+l,heading:n(s,r)})}return e},[])}function s(e,t){var n=o(e),i=n.length;if(i===0)return[];var a=n[i-1].distB,s=r(t.offset,a),l=r(t.endOffset,a),u=a*r(t.repeat,a),d=s>0?a*s:0,f=l>0?a*l:0,p=[],m=d;do p.push(m),m+=u;while(u>0&&m<a-f);var h=0,g=n[0];return p.map(function(e){for(;e>g.distB&&h<i-1;)h++,g=n[h];var t=(e-g.distA)/(g.distB-g.distA);return{pt:c(g.a,g.b,t),heading:g.heading}})}function c(e,t,n){return t.x===e.x?{x:e.x,y:e.y+(t.y-e.y)*n}:{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}(function(){var e=L.Marker.prototype._initIcon,t=L.Marker.prototype._setPos,n=L.DomUtil.TRANSFORM===`msTransform`;L.Marker.addInitHook(function(){var e=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;e&&=e[0]+`px `+e[1]+`px`,this.options.rotationOrigin=this.options.rotationOrigin||e||`center bottom`,this.options.rotationAngle=this.options.rotationAngle||0,this.on(`drag`,function(e){e.target._applyRotation()})}),L.Marker.include({_initIcon:function(){e.call(this)},_setPos:function(e){t.call(this,e),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+`Origin`]=this.options.rotationOrigin,n?this._icon.style[L.DomUtil.TRANSFORM]=`rotate(`+this.options.rotationAngle+`deg)`:this._icon.style[L.DomUtil.TRANSFORM]+=` rotateZ(`+this.options.rotationAngle+`deg)`)},setRotationAngle:function(e){return this.options.rotationAngle=e,this.update(),this},setRotationOrigin:function(e){return this.options.rotationOrigin=e,this.update(),this}})})(),e.Symbol=e.Symbol||{},e.Symbol.Dash=e.Class.extend({options:{pixelSize:10,pathOptions:{}},initialize:function(t){e.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,n,r,i,a){var o=this.options,s=Math.PI/180;if(o.pixelSize<=1)return e.polyline([t.latLng,t.latLng],o.pathOptions);var c=r.project(t.latLng),l=-(t.heading-90)*s,u=e.point(c.x+o.pixelSize*Math.cos(l+Math.PI)/2,c.y+o.pixelSize*Math.sin(l)/2),d=c.add(c.subtract(u));return e.polyline([r.unproject(u),r.unproject(d)],o.pathOptions)}}),e.Symbol.dash=function(t){return new e.Symbol.Dash(t)},e.Symbol.ArrowHead=e.Class.extend({options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(t){e.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,n,r,i,a){return this.options.polygon?e.polygon(this._buildArrowPath(t,r),this.options.pathOptions):e.polyline(this._buildArrowPath(t,r),this.options.pathOptions)},_buildArrowPath:function(t,n){var r=Math.PI/180,i=n.project(t.latLng),a=-(t.heading-90)*r,o=this.options.headAngle/2*r,s=a+o,c=a-o,l=e.point(i.x-this.options.pixelSize*Math.cos(s),i.y+this.options.pixelSize*Math.sin(s)),u=e.point(i.x-this.options.pixelSize*Math.cos(c),i.y+this.options.pixelSize*Math.sin(c));return[n.unproject(l),t.latLng,n.unproject(u)]}}),e.Symbol.arrowHead=function(t){return new e.Symbol.ArrowHead(t)},e.Symbol.Marker=e.Class.extend({options:{markerOptions:{},rotate:!1},initialize:function(t){e.Util.setOptions(this,t),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1},buildSymbol:function(t,n,r,i,a){return this.options.rotate&&(this.options.markerOptions.rotationAngle=t.heading+(this.options.angleCorrection||0)),e.marker(t.latLng,this.options.markerOptions)}}),e.Symbol.marker=function(t){return new e.Symbol.Marker(t)};var l=function(t){return t instanceof e.LatLng||Array.isArray(t)&&t.length===2&&typeof t[0]==`number`},u=function(e){return Array.isArray(e)&&l(e[0])};e.PolylineDecorator=e.FeatureGroup.extend({options:{patterns:[]},initialize:function(t,n){e.FeatureGroup.prototype.initialize.call(this),e.Util.setOptions(this,n),this._map=null,this._paths=this._initPaths(t),this._bounds=this._initBounds(),this._patterns=this._initPatterns(this.options.patterns)},_initPaths:function(t,n){var r=this;return u(t)?[n?t.concat([t[0]]):t]:t instanceof e.Polyline?this._initPaths(t.getLatLngs(),t instanceof e.Polygon):Array.isArray(t)?t.reduce(function(e,t){return e.concat(r._initPaths(t,n))},[]):[]},_initPatterns:function(e){return e.map(this._parsePatternDef)},setPatterns:function(e){this.options.patterns=e,this._patterns=this._initPatterns(this.options.patterns),this.redraw()},setPaths:function(e){this._paths=this._initPaths(e),this._bounds=this._initBounds(),this.redraw()},_parsePatternDef:function(e,t){return{symbolFactory:e.symbol,offset:i(e.offset),endOffset:i(e.endOffset),repeat:i(e.repeat)}},onAdd:function(e){this._map=e,this._draw(),this._map.on(`moveend`,this.redraw,this)},onRemove:function(t){this._map.off(`moveend`,this.redraw,this),this._map=null,e.FeatureGroup.prototype.onRemove.call(this,t)},_initBounds:function(){var t=this._paths.reduce(function(e,t){return e.concat(t)},[]);return e.latLngBounds(t)},getBounds:function(){return this._bounds},_buildSymbols:function(e,t,n){var r=this;return n.map(function(i,a){return t.buildSymbol(i,e,r._map,a,n.length)})},_getDirectionPoints:function(t,n){var r=this;return t.length<2?[]:s(t.map(function(e){return r._map.project(e)}),n).map(function(t){return{latLng:r._map.unproject(e.point(t.pt)),heading:t.heading}})},redraw:function(){this._map&&(this.clearLayers(),this._draw())},_getPatternLayers:function(t){var n=this,r=this._map.getBounds().pad(.1);return this._paths.map(function(i){var a=n._getDirectionPoints(i,t).filter(function(e){return r.contains(e.latLng)});return e.featureGroup(n._buildSymbols(i,t.symbolFactory,a))})},_draw:function(){var t=this;this._patterns.map(function(e){return t._getPatternLayers(e)}).forEach(function(n){t.addLayer(e.featureGroup(n))})}}),e.polylineDecorator=function(t,n){return new e.PolylineDecorator(t,n)}})})(),(function(){var e=L.Marker.prototype._initIcon,t=L.Marker.prototype._setPos,n=L.DomUtil.TRANSFORM===`msTransform`;L.Marker.addInitHook(function(){var e=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;e&&=e[0]+`px `+e[1]+`px`,this.options.rotationOrigin=this.options.rotationOrigin||e||`center bottom`,this.options.rotationAngle=this.options.rotationAngle||0,this.on(`drag`,function(e){e.target._applyRotation()})}),L.Marker.include({_initIcon:function(){e.call(this)},_setPos:function(e){t.call(this,e),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+`Origin`]=this.options.rotationOrigin,n?this._icon.style[L.DomUtil.TRANSFORM]=`rotate(`+this.options.rotationAngle+`deg)`:this._icon.style[L.DomUtil.TRANSFORM]+=` rotateZ(`+this.options.rotationAngle+`deg)`)},setRotationAngle:function(e){return this.options.rotationAngle=e,this.update(),this},setRotationOrigin:function(e){return this.options.rotationOrigin=e,this.update(),this}})})(),_.default.TrackPlayer=class{constructor(e,t={}){let n=_.default.polyline(e)._latlngs;this.track=C(n.map(({lng:e,lat:t})=>[e,t])),this.distanceSlice=[0],this.track.geometry.coordinates.forEach((e,t,n)=>{if(t!==0){let e=C(n.slice(0,t+1));this.distanceSlice.push(W(e))}}),this.distance=W(this.track),this.addedToMap=!1,this.options={speed:t.speed??600,weight:t.weight??8,markerIcon:t.markerIcon,polylineDecoratorOptions:t.polylineDecoratorOptions??{patterns:[{offset:30,repeat:60,symbol:_.default.Symbol.arrowHead({pixelSize:5,headAngle:75,polygon:!1,pathOptions:{stroke:!0,weight:3,color:`#fff`}})}]},passedLineColor:t.passedLineColor??`#0000ff`,notPassedLineColor:t.notPassedLineColor??`#ff0000`,panTo:t.panTo??!0,markerRotationOrigin:t.markerRotationOrigin??`center`,markerRotationOffset:t.markerRotationOffset??0,markerRotation:t.markerRotation??!0,progress:t.progress??0},this.initProgress=t.progress,this.isPaused=!0,this.walkedDistance=0,this.walkedDistanceTemp=0,this.trackIndex=0,this.listenedEvents={start:[],pause:[],finished:[],progressCallback:[]}}addTo(e){if(this.addedToMap)return;if(this.map=e,this.addedToMap=!0,this.options.markerIcon){let e=this.track.geometry.coordinates[0];if(this.marker=_.default.marker([e[1],e[0]],{icon:this.options.markerIcon}).addTo(this.map),this.options.markerRotation){let e=this.track.geometry.coordinates;this.marker.setRotationAngle(V(e[0],e[1])/2+this.options.markerRotationOffset/2),this.marker.setRotationOrigin(this.options.markerRotationOrigin)}}let t=this.track.geometry.coordinates.map(([e,t])=>[t,e]);return this.notPassedLine=_.default.polyline(t,{weight:this.options.weight,color:this.options.notPassedLineColor}).addTo(this.map),this.passedLine=_.default.polyline([],{weight:this.options.weight,color:this.options.passedLineColor}).addTo(this.map),this.polylineDecorator=_.default.polylineDecorator(t,this.options.polylineDecoratorOptions).addTo(this.map),this.initProgress&&this.setProgress(this.initProgress),this}remove(){this.addedToMap&&(this.addedToMap=!1,this.polylineDecorator.remove(),this.polylineDecorator=null,this.notPassedLine.remove(),this.notPassedLine=null,this.passedLine.remove(),this.passedLine=null,this.marker&&=(this.marker.remove(),null),this.finished=!1,this.startTimestamp=0,this.pauseTimestamp=0,this.walkedDistanceTemp=0,this.walkedDistance=0,this.trackIndex=0,this.isPaused=!0,this.options.progress=this.initProgress)}start(){!this.isPaused&&!this.finished||!this.addedToMap||((this.options.progress===0||this.options.progress===1)&&(this.startTimestamp=0,this.pauseTimestamp=0,this.walkedDistanceTemp=0,this.walkedDistance=0),this.isPaused=!1,this.finished=!1,this.pauseTimestamp&&this.startTimestamp&&(this.startTimestamp+=Date.now()-this.pauseTimestamp),this.startAction(),this.listenedEvents.start.forEach(e=>e()),this.initProgress&&this.setProgress(this.initProgress))}pause(){this.isPaused||this.finished||(this.pauseTimestamp=Date.now(),this.isPaused=!0,this.listenedEvents.pause.forEach(e=>e()))}startAction(){let e=this.distance,t=n=>{if(n&&this.addedToMap){let t=e/this.options.speed*3600*1e3;this.startTimestamp||=n,this.walkedDistance=e*((n-this.startTimestamp)/t)+this.walkedDistanceTemp,this.playAction()}!this.isPaused&&!this.finished&&requestAnimationFrame(t)};t()}playAction(e=!1){if(this.isPaused&&!e)return;let t=this.distance;this.trackIndex=this.distanceSlice.findIndex((e,t,n)=>this.walkedDistance>=e&&this.walkedDistance<(n[t+1]??1/0));let[n,r]=U(this.track,this.walkedDistance).geometry.coordinates;if(this.markerPoint=[r,n],this.options.panTo&&this.map.panTo(this.markerPoint,{animate:!1}),this.marker&&this.marker.setLatLng(this.markerPoint),this.walkedDistance>=t)this.notPassedLine.setLatLngs([]);else{let e=G(this.track,this.walkedDistance);this.notPassedLine.setLatLngs(e.geometry.coordinates.map(([e,t])=>[t,e]))}if(this.walkedDistance>0){let e=G(this.track,0,this.walkedDistance);this.passedLine.setLatLngs(e.geometry.coordinates.map(([e,t])=>[t,e]))}else this.passedLine.setLatLngs([]);if(this.polylineDecorator.setPaths([...this.passedLine.getLatLngs(),...this.notPassedLine.getLatLngs()]),this.walkedDistance<t&&this.options.markerRotation&&this.marker){let e=0;e=V(S([n,r]),S(this.track.geometry.coordinates[this.trackIndex+1])),this.marker.setRotationAngle(e/2+this.options.markerRotationOffset/2)}if(this.options.progress=Math.min(1,this.walkedDistance/t),this.listenedEvents.progressCallback.forEach(e=>e(this.options.progress,_.default.latLng(...this.markerPoint),this.trackIndex)),this.walkedDistance>=t&&(this.walkedDistance=t,this.finished=!0,this.listenedEvents.finished.forEach(e=>e()),this.options.markerRotation&&this.marker)){let e=this.track.geometry.coordinates,t=V(S(e.at(-2)),S(e.at(-1)));this.marker.setRotationAngle(t/2+this.options.markerRotationOffset/2)}}setSpeedAction(e){this.options.speed=e,this.walkedDistanceTemp=this.walkedDistance,this.startTimestamp=0}setSpeed(e,t=20){return v(this,null,function*(){t&&(clearTimeout(this.setSpeedTimeout),yield new Promise(e=>{this.setSpeedTimeout=setTimeout(e,t)})),this.setSpeedAction(e)})}setProgress(e){this.addedToMap&&(this.options.progress==1&&e==1||this.options.progress==0&&e==0||(this.options.progress=e,this.walkedDistanceTemp=this.distance*e,this.startTimestamp=0,(this.isPaused||this.finished)&&(this.walkedDistance=this.walkedDistanceTemp,this.isPaused?this.playAction(!0):(this.finished=!1,this.isPaused=!1,this.startAction()))))}on(e,t){switch(e){case`start`:this.listenedEvents.start.push(t);break;case`pause`:this.listenedEvents.pause.push(t);break;case`finished`:this.listenedEvents.finished.push(t);break;case`progress`:this.listenedEvents.progressCallback.push(t);break}}off(e,t){if(!t){this.listenedEvents[e]=[];return}switch(e){case`start`:this.listenedEvents.start=this.listenedEvents.start.filter(e=>e!==t);break;case`pause`:this.listenedEvents.pause=this.listenedEvents.pause.filter(e=>e!==t);break;case`finished`:this.listenedEvents.finished=this.listenedEvents.finished.filter(e=>e!==t);break;case`progress`:this.listenedEvents.progressCallback=this.listenedEvents.progressCallback.filter(e=>e!==t);break}}};var K={class:`relative h-full w-full`},q={class:`absolute top-2 right-2 z-[888] flex items-center gap-5 rounded bg-white px-3 py-2 text-xs`},J={class:`flex items-center`},Y={class:`flex w-[300px] items-center gap-5`},X={class:`text-nowrap`},Z={class:`flex w-[350px] items-center gap-5`},Q=t({__name:`track`,setup(e){let t={},g={},v=l({speed:g?.options?.speed??600,progress:g?.options?.progress*100||0,start:()=>{t.setZoom(17),g.start()},pause:()=>g.pause()}),y=async e=>{let t=await h({keyword:e});return`${t.data.location.lon},${t.data.location.lat}`},b=e=>{let t=e.match(/<routelatlon>([\s\S]*?)<\/routelatlon>/);return t?t[1].trim():``},x=async(e,t)=>b((await m({orig:e,dest:t})).data),S=e=>e.split(`;`).map(e=>{if(e!==``){let t=e.split(`,`);return{lng:t[0],lat:t[1]}}}),C=e=>{g.setProgress(Number(e)/100)},w=e=>{g.setSpeed(e)},T=async()=>{let e=await y(`成都科学城`),n=S(await x(e,await y(`成都天府香山`))).filter(e=>e),r=_.default.icon({iconUrl:d,iconSize:[22,42],iconAnchor:[11,21]});t.fitBounds(n),g=new _.default.TrackPlayer(n,{markerIcon:r,speed:v.speed,weight:8,passedLineColor:`#43A047`,notPassedLineColor:`#F44336`,panTo:!0,markerRotation:!0}),g.addTo(t);let i=_.default.marker(e.split(`,`),{icon:_.default.divIcon({iconSize:null,className:``,popupAnchor:[5,5],shadowAnchor:[5,5],html:`<div class='carnumbox'><div class='carnumbox-text'>川A888888</div></div>`})}).addTo(t);g.on(`progress`,(e,{lng:t,lat:n})=>{i.setLatLng([n,t]),v.progress=e*100})},E=()=>{let e=_.default.tileLayer(`http://t0.tianditu.gov.cn/vec_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=b40e3cf3d6fa4b1a6c1dc2d2a5288b7e`,{tileSize:256,maxZoom:18,minZoom:5}),n=_.default.tileLayer(`http://t0.tianditu.gov.cn/cva_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cva&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=b40e3cf3d6fa4b1a6c1dc2d2a5288b7e`,{tileSize:256,maxZoom:18,minZoom:5});_.default.layerGroup([e,n]);let r=_.default.tileLayer(`http://www.google.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}`,{maxZoom:20});t=_.default.map(`gisMap`,{center:_.default.latLng(30.5728,104.0665),zoom:12,minZoom:5,maxZoom:18,layers:[r],attributionControl:!1,zoomControl:!0,fullscreenControl:!0,fullscreenControlOptions:{position:`topleft`}})};return n(()=>{E()}),(e,t)=>{let n=s,l=i;return a(),f(`div`,K,[t[9]||=p(`div`,{id:`gisMap`,class:`absolute top-0 right-0 bottom-0 left-0`},null,-1),p(`div`,q,[p(`div`,J,[o(n,{onClick:T},{default:c(()=>t[4]||=[r(`生成路线`)]),_:1}),o(n,{onClick:t[0]||=e=>v.start()},{default:c(()=>t[5]||=[r(`开始`)]),_:1}),o(n,{onClick:t[1]||=e=>v.pause()},{default:c(()=>t[6]||=[r(`暂停`)]),_:1})]),p(`div`,Y,[t[7]||=p(`p`,{class:`text-nowrap`},`速度`,-1),o(l,{onChange:w,modelValue:v.speed,"onUpdate:modelValue":t[2]||=e=>v.speed=e,max:1e3,min:0},null,8,[`modelValue`]),p(`p`,X,u(v.speed)+` （km/h）`,1)]),p(`div`,Z,[t[8]||=p(`p`,{class:`text-nowrap`},`进程`,-1),o(l,{onChange:C,modelValue:v.progress,"onUpdate:modelValue":t[3]||=e=>v.progress=e,max:100,min:0},null,8,[`modelValue`]),p(`p`,null,u(Math.floor(v.progress))+`%`,1)])])])}}});export{Q as default};