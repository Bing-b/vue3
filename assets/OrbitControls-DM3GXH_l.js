import{A as Quaternion,B as Vector3,E as Plane,I as Spherical,L as TOUCH,g as MOUSE,j as Ray,l as Controls,v as MathUtils,z as Vector2}from"./three.module-Dpv6cFeR.js";var _changeEvent={type:`change`},_startEvent={type:`start`},_endEvent={type:`end`},_ray=new Ray,_plane=new Plane,_TILT_LIMIT=Math.cos(70*MathUtils.DEG2RAD),_v=new Vector3,_twoPI=2*Math.PI,_STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},_EPS=1e-6,OrbitControls=class extends Controls{constructor(O,M=null){super(O,M),this.state=_STATE.NONE,this.enabled=!0,this.target=new Vector3,this.cursor=new Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:`ArrowLeft`,UP:`ArrowUp`,RIGHT:`ArrowRight`,BOTTOM:`ArrowDown`},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new Vector3,this._lastQuaternion=new Quaternion,this._lastTargetPosition=new Vector3,this._quat=new Quaternion().setFromUnitVectors(O.up,new Vector3(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Spherical,this._sphericalDelta=new Spherical,this._scale=1,this._panOffset=new Vector3,this._rotateStart=new Vector2,this._rotateEnd=new Vector2,this._rotateDelta=new Vector2,this._panStart=new Vector2,this._panEnd=new Vector2,this._panDelta=new Vector2,this._dollyStart=new Vector2,this._dollyEnd=new Vector2,this._dollyDelta=new Vector2,this._dollyDirection=new Vector3,this._mouse=new Vector2,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=onPointerMove.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerUp=onPointerUp.bind(this),this._onContextMenu=onContextMenu.bind(this),this._onMouseWheel=onMouseWheel.bind(this),this._onKeyDown=onKeyDown.bind(this),this._onTouchStart=onTouchStart.bind(this),this._onTouchMove=onTouchMove.bind(this),this._onMouseDown=onMouseDown.bind(this),this._onMouseMove=onMouseMove.bind(this),this._interceptControlDown=interceptControlDown.bind(this),this._interceptControlUp=interceptControlUp.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener(`pointerdown`,this._onPointerDown),this.domElement.addEventListener(`pointercancel`,this._onPointerUp),this.domElement.addEventListener(`contextmenu`,this._onContextMenu),this.domElement.addEventListener(`wheel`,this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener(`keydown`,this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction=`none`}disconnect(){this.domElement.removeEventListener(`pointerdown`,this._onPointerDown),this.domElement.removeEventListener(`pointermove`,this._onPointerMove),this.domElement.removeEventListener(`pointerup`,this._onPointerUp),this.domElement.removeEventListener(`pointercancel`,this._onPointerUp),this.domElement.removeEventListener(`wheel`,this._onMouseWheel),this.domElement.removeEventListener(`contextmenu`,this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener(`keydown`,this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction=`auto`}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(u){u.addEventListener(`keydown`,this._onKeyDown),this._domElementKeyEvents=u}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener(`keydown`,this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(_changeEvent),this.update(),this.state=_STATE.NONE}update(u=null){let O=this.object.position;_v.copy(O).sub(this.target),_v.applyQuaternion(this._quat),this._spherical.setFromVector3(_v),this.autoRotate&&this.state===_STATE.NONE&&this._rotateLeft(this._getAutoRotationAngle(u)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let k=this.minAzimuthAngle,A=this.maxAzimuthAngle;isFinite(k)&&isFinite(A)&&(k<-Math.PI?k+=_twoPI:k>Math.PI&&(k-=_twoPI),A<-Math.PI?A+=_twoPI:A>Math.PI&&(A-=_twoPI),k<=A?this._spherical.theta=Math.max(k,Math.min(A,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(k+A)/2?Math.max(k,this._spherical.theta):Math.min(A,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let j=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{let u=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),j=u!=this._spherical.radius}if(_v.setFromSpherical(this._spherical),_v.applyQuaternion(this._quatInverse),O.copy(this.target).add(_v),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let u=null;if(this.object.isPerspectiveCamera){let D=_v.length();u=this._clampDistance(D*this._scale);let O=D-u;this.object.position.addScaledVector(this._dollyDirection,O),this.object.updateMatrixWorld(),j=!!O}else if(this.object.isOrthographicCamera){let O=new Vector3(this._mouse.x,this._mouse.y,0);O.unproject(this.object);let k=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),j=k!==this.object.zoom;let A=new Vector3(this._mouse.x,this._mouse.y,0);A.unproject(this.object),this.object.position.sub(A).add(O),this.object.updateMatrixWorld(),u=_v.length()}else this.zoomToCursor=!1;u!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(u).add(this.object.position):(_ray.origin.copy(this.object.position),_ray.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(_ray.direction))<_TILT_LIMIT?this.object.lookAt(this.target):(_plane.setFromNormalAndCoplanarPoint(this.object.up,this.target),_ray.intersectPlane(_plane,this.target))))}else if(this.object.isOrthographicCamera){let u=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),u!==this.object.zoom&&(this.object.updateProjectionMatrix(),j=!0)}return this._scale=1,this._performCursorZoom=!1,j||this._lastPosition.distanceToSquared(this.object.position)>_EPS||8*(1-this._lastQuaternion.dot(this.object.quaternion))>_EPS||this._lastTargetPosition.distanceToSquared(this.target)>_EPS?(this.dispatchEvent(_changeEvent),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(u){return u===null?_twoPI/60/60*this.autoRotateSpeed:_twoPI/60*this.autoRotateSpeed*u}_getZoomScale(u){let D=Math.abs(u*.01);return .95**(this.zoomSpeed*D)}_rotateLeft(u){this._sphericalDelta.theta-=u}_rotateUp(u){this._sphericalDelta.phi-=u}_panLeft(u,D){_v.setFromMatrixColumn(D,0),_v.multiplyScalar(-u),this._panOffset.add(_v)}_panUp(u,D){this.screenSpacePanning===!0?_v.setFromMatrixColumn(D,1):(_v.setFromMatrixColumn(D,0),_v.crossVectors(this.object.up,_v)),_v.multiplyScalar(u),this._panOffset.add(_v)}_pan(u,D){let O=this.domElement;if(this.object.isPerspectiveCamera){let k=this.object.position;_v.copy(k).sub(this.target);let A=_v.length();A*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*u*A/O.clientHeight,this.object.matrix),this._panUp(2*D*A/O.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(u*(this.object.right-this.object.left)/this.object.zoom/O.clientWidth,this.object.matrix),this._panUp(D*(this.object.top-this.object.bottom)/this.object.zoom/O.clientHeight,this.object.matrix)):this.enablePan=!1}_dollyOut(u){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=u:this.enableZoom=!1}_dollyIn(u){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=u:this.enableZoom=!1}_updateZoomParameters(u,D){if(!this.zoomToCursor)return;this._performCursorZoom=!0;let O=this.domElement.getBoundingClientRect(),k=u-O.left,A=D-O.top,j=O.width,M=O.height;this._mouse.x=k/j*2-1,this._mouse.y=-(A/M)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(u){return Math.max(this.minDistance,Math.min(this.maxDistance,u))}_handleMouseDownRotate(u){this._rotateStart.set(u.clientX,u.clientY)}_handleMouseDownDolly(u){this._updateZoomParameters(u.clientX,u.clientX),this._dollyStart.set(u.clientX,u.clientY)}_handleMouseDownPan(u){this._panStart.set(u.clientX,u.clientY)}_handleMouseMoveRotate(u){this._rotateEnd.set(u.clientX,u.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);let D=this.domElement;this._rotateLeft(_twoPI*this._rotateDelta.x/D.clientHeight),this._rotateUp(_twoPI*this._rotateDelta.y/D.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(u){this._dollyEnd.set(u.clientX,u.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(u){this._panEnd.set(u.clientX,u.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(u){this._updateZoomParameters(u.clientX,u.clientY),u.deltaY<0?this._dollyIn(this._getZoomScale(u.deltaY)):u.deltaY>0&&this._dollyOut(this._getZoomScale(u.deltaY)),this.update()}_handleKeyDown(u){let D=!1;switch(u.code){case this.keys.UP:u.ctrlKey||u.metaKey||u.shiftKey?this._rotateUp(_twoPI*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),D=!0;break;case this.keys.BOTTOM:u.ctrlKey||u.metaKey||u.shiftKey?this._rotateUp(-_twoPI*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),D=!0;break;case this.keys.LEFT:u.ctrlKey||u.metaKey||u.shiftKey?this._rotateLeft(_twoPI*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),D=!0;break;case this.keys.RIGHT:u.ctrlKey||u.metaKey||u.shiftKey?this._rotateLeft(-_twoPI*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),D=!0;break}D&&(u.preventDefault(),this.update())}_handleTouchStartRotate(u){if(this._pointers.length===1)this._rotateStart.set(u.pageX,u.pageY);else{let D=this._getSecondPointerPosition(u),O=.5*(u.pageX+D.x),k=.5*(u.pageY+D.y);this._rotateStart.set(O,k)}}_handleTouchStartPan(u){if(this._pointers.length===1)this._panStart.set(u.pageX,u.pageY);else{let D=this._getSecondPointerPosition(u),O=.5*(u.pageX+D.x),k=.5*(u.pageY+D.y);this._panStart.set(O,k)}}_handleTouchStartDolly(u){let D=this._getSecondPointerPosition(u),O=u.pageX-D.x,k=u.pageY-D.y,A=Math.sqrt(O*O+k*k);this._dollyStart.set(0,A)}_handleTouchStartDollyPan(u){this.enableZoom&&this._handleTouchStartDolly(u),this.enablePan&&this._handleTouchStartPan(u)}_handleTouchStartDollyRotate(u){this.enableZoom&&this._handleTouchStartDolly(u),this.enableRotate&&this._handleTouchStartRotate(u)}_handleTouchMoveRotate(u){if(this._pointers.length==1)this._rotateEnd.set(u.pageX,u.pageY);else{let D=this._getSecondPointerPosition(u),O=.5*(u.pageX+D.x),k=.5*(u.pageY+D.y);this._rotateEnd.set(O,k)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);let D=this.domElement;this._rotateLeft(_twoPI*this._rotateDelta.x/D.clientHeight),this._rotateUp(_twoPI*this._rotateDelta.y/D.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(u){if(this._pointers.length===1)this._panEnd.set(u.pageX,u.pageY);else{let D=this._getSecondPointerPosition(u),O=.5*(u.pageX+D.x),k=.5*(u.pageY+D.y);this._panEnd.set(O,k)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(u){let D=this._getSecondPointerPosition(u),O=u.pageX-D.x,k=u.pageY-D.y,A=Math.sqrt(O*O+k*k);this._dollyEnd.set(0,A),this._dollyDelta.set(0,(this._dollyEnd.y/this._dollyStart.y)**+this.zoomSpeed),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);let j=(u.pageX+D.x)*.5,M=(u.pageY+D.y)*.5;this._updateZoomParameters(j,M)}_handleTouchMoveDollyPan(u){this.enableZoom&&this._handleTouchMoveDolly(u),this.enablePan&&this._handleTouchMovePan(u)}_handleTouchMoveDollyRotate(u){this.enableZoom&&this._handleTouchMoveDolly(u),this.enableRotate&&this._handleTouchMoveRotate(u)}_addPointer(u){this._pointers.push(u.pointerId)}_removePointer(u){delete this._pointerPositions[u.pointerId];for(let D=0;D<this._pointers.length;D++)if(this._pointers[D]==u.pointerId){this._pointers.splice(D,1);return}}_isTrackingPointer(u){for(let D=0;D<this._pointers.length;D++)if(this._pointers[D]==u.pointerId)return!0;return!1}_trackPointer(u){let D=this._pointerPositions[u.pointerId];D===void 0&&(D=new Vector2,this._pointerPositions[u.pointerId]=D),D.set(u.pageX,u.pageY)}_getSecondPointerPosition(u){let D=u.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[D]}_customWheelEvent(u){let D=u.deltaMode,O={clientX:u.clientX,clientY:u.clientY,deltaY:u.deltaY};switch(D){case 1:O.deltaY*=16;break;case 2:O.deltaY*=100;break}return u.ctrlKey&&!this._controlActive&&(O.deltaY*=10),O}};function onPointerDown(u){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(u.pointerId),this.domElement.addEventListener(`pointermove`,this._onPointerMove),this.domElement.addEventListener(`pointerup`,this._onPointerUp)),!this._isTrackingPointer(u)&&(this._addPointer(u),u.pointerType===`touch`?this._onTouchStart(u):this._onMouseDown(u)))}function onPointerMove(u){this.enabled!==!1&&(u.pointerType===`touch`?this._onTouchMove(u):this._onMouseMove(u))}function onPointerUp(u){switch(this._removePointer(u),this._pointers.length){case 0:this.domElement.releasePointerCapture(u.pointerId),this.domElement.removeEventListener(`pointermove`,this._onPointerMove),this.domElement.removeEventListener(`pointerup`,this._onPointerUp),this.dispatchEvent(_endEvent),this.state=_STATE.NONE;break;case 1:let D=this._pointers[0],O=this._pointerPositions[D];this._onTouchStart({pointerId:D,pageX:O.x,pageY:O.y});break}}function onMouseDown(u){let D;switch(u.button){case 0:D=this.mouseButtons.LEFT;break;case 1:D=this.mouseButtons.MIDDLE;break;case 2:D=this.mouseButtons.RIGHT;break;default:D=-1}switch(D){case MOUSE.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(u),this.state=_STATE.DOLLY;break;case MOUSE.ROTATE:if(u.ctrlKey||u.metaKey||u.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(u),this.state=_STATE.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(u),this.state=_STATE.ROTATE}break;case MOUSE.PAN:if(u.ctrlKey||u.metaKey||u.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(u),this.state=_STATE.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(u),this.state=_STATE.PAN}break;default:this.state=_STATE.NONE}this.state!==_STATE.NONE&&this.dispatchEvent(_startEvent)}function onMouseMove(u){switch(this.state){case _STATE.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(u);break;case _STATE.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(u);break;case _STATE.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(u);break}}function onMouseWheel(u){this.enabled===!1||this.enableZoom===!1||this.state!==_STATE.NONE||(u.preventDefault(),this.dispatchEvent(_startEvent),this._handleMouseWheel(this._customWheelEvent(u)),this.dispatchEvent(_endEvent))}function onKeyDown(u){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(u)}function onTouchStart(u){switch(this._trackPointer(u),this._pointers.length){case 1:switch(this.touches.ONE){case TOUCH.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(u),this.state=_STATE.TOUCH_ROTATE;break;case TOUCH.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(u),this.state=_STATE.TOUCH_PAN;break;default:this.state=_STATE.NONE}break;case 2:switch(this.touches.TWO){case TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(u),this.state=_STATE.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(u),this.state=_STATE.TOUCH_DOLLY_ROTATE;break;default:this.state=_STATE.NONE}break;default:this.state=_STATE.NONE}this.state!==_STATE.NONE&&this.dispatchEvent(_startEvent)}function onTouchMove(u){switch(this._trackPointer(u),this.state){case _STATE.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(u),this.update();break;case _STATE.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(u),this.update();break;case _STATE.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(u),this.update();break;case _STATE.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(u),this.update();break;default:this.state=_STATE.NONE}}function onContextMenu(u){this.enabled!==!1&&u.preventDefault()}function interceptControlDown(u){u.key===`Control`&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener(`keyup`,this._interceptControlUp,{passive:!0,capture:!0}))}function interceptControlUp(u){u.key===`Control`&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener(`keyup`,this._interceptControlUp,{passive:!0,capture:!0}))}export{OrbitControls as t};