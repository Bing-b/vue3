/* empty css             *//* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  */import{L as b}from"./leaflet-src-OdLU_445.js";import{a as J,b as K}from"./common-Dt9grIY3.js";import{c as tt}from"./main-BT5Jzw3n.js";import{p as et,N as it}from"./ui-CgqiKUtE.js";import{x as st,X as ot,k as nt,y as rt,z as at,A,P as R,H as G,L as N,M as H}from"./core-B_x7lh11.js";var lt=(i,s,e)=>new Promise((o,n)=>{var a=l=>{try{c(e.next(l))}catch(d){n(d)}},p=l=>{try{c(e.throw(l))}catch(d){n(d)}},c=l=>l.done?o(l.value):Promise.resolve(l.value).then(a,p);c((e=e.apply(i,s)).next())}),M=63710088e-1,W={centimeters:M*100,centimetres:M*100,degrees:M/111325,feet:M*3.28084,inches:M*39.37,kilometers:M/1e3,kilometres:M/1e3,meters:M,metres:M,miles:M/1609.344,millimeters:M*1e3,millimetres:M*1e3,nauticalmiles:M/1852,radians:1,yards:M*1.0936};function I(i,s,e){e===void 0&&(e={});var o={type:"Feature"};return(e.id===0||e.id)&&(o.id=e.id),e.bbox&&(o.bbox=e.bbox),o.properties=s||{},o.geometry=i,o}function _(i,s,e){if(e===void 0&&(e={}),!i)throw new Error("coordinates is required");if(!Array.isArray(i))throw new Error("coordinates must be an Array");if(i.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!q(i[0])||!q(i[1]))throw new Error("coordinates must contain numbers");var o={type:"Point",coordinates:i};return I(o,s,e)}function S(i,s,e){if(e===void 0&&(e={}),i.length<2)throw new Error("coordinates must be an array of two or more positions");var o={type:"LineString",coordinates:i};return I(o,s,e)}function ht(i,s){s===void 0&&(s="kilometers");var e=W[s];if(!e)throw new Error(s+" units is invalid");return i*e}function pt(i,s){s===void 0&&(s="kilometers");var e=W[s];if(!e)throw new Error(s+" units is invalid");return i/e}function U(i){var s=i%(2*Math.PI);return s*180/Math.PI}function T(i){var s=i%360;return s*Math.PI/180}function q(i){return!isNaN(i)&&i!==null&&!Array.isArray(i)}function ct(i){return!!i&&i.constructor===Object}function Y(i,s,e){if(i!==null)for(var o,n,a,p,c,l,d,y=0,f=0,g,t=i.type,r=t==="FeatureCollection",h=t==="Feature",u=r?i.features.length:1,m=0;m<u;m++){d=r?i.features[m].geometry:h?i.geometry:i,g=d?d.type==="GeometryCollection":!1,c=g?d.geometries.length:1;for(var k=0;k<c;k++){var v=0,w=0;if(p=g?d.geometries[k]:d,p!==null){l=p.coordinates;var P=p.type;switch(y=0,P){case null:break;case"Point":if(s(l,f,m,v,w)===!1)return!1;f++,v++;break;case"LineString":case"MultiPoint":for(o=0;o<l.length;o++){if(s(l[o],f,m,v,w)===!1)return!1;f++,P==="MultiPoint"&&v++}P==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(o=0;o<l.length;o++){for(n=0;n<l[o].length-y;n++){if(s(l[o][n],f,m,v,w)===!1)return!1;f++}P==="MultiLineString"&&v++,P==="Polygon"&&w++}P==="Polygon"&&v++;break;case"MultiPolygon":for(o=0;o<l.length;o++){for(w=0,n=0;n<l[o].length;n++){for(a=0;a<l[o][n].length-y;a++){if(s(l[o][n][a],f,m,v,w)===!1)return!1;f++}w++}v++}break;case"GeometryCollection":for(o=0;o<p.geometries.length;o++)if(Y(p.geometries[o],s)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ut(i,s){var e,o,n,a,p,c,l,d,y,f,g=0,t=i.type==="FeatureCollection",r=i.type==="Feature",h=t?i.features.length:1;for(e=0;e<h;e++){for(c=t?i.features[e].geometry:r?i.geometry:i,d=t?i.features[e].properties:r?i.properties:{},y=t?i.features[e].bbox:r?i.bbox:void 0,f=t?i.features[e].id:r?i.id:void 0,l=c?c.type==="GeometryCollection":!1,p=l?c.geometries.length:1,n=0;n<p;n++){if(a=l?c.geometries[n]:c,a===null){if(s(null,g,d,y,f)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(s(a,g,d,y,f)===!1)return!1;break}case"GeometryCollection":{for(o=0;o<a.geometries.length;o++)if(s(a.geometries[o],g,d,y,f)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}g++}}function dt(i,s){ut(i,function(e,o,n,a,p){var c=e===null?null:e.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return s(I(e,n,{bbox:a,id:p}),o,0)===!1?!1:void 0}var l;switch(c){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var d=0;d<e.coordinates.length;d++){var y=e.coordinates[d],f={type:l,coordinates:y};if(s(I(f,n),o,d)===!1)return!1}})}function ft(i,s){dt(i,function(e,o,n){var a=0;if(e.geometry){var p=e.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var c,l=0,d=0,y=0;if(Y(e,function(f,g,t,r,h){if(c===void 0||o>l||r>d||h>y){c=f,l=o,d=r,y=h,a=0;return}var u=S([c,f],e.properties);if(s(u,o,n,h,a)===!1)return!1;a++,c=f})===!1)return!1}}})}function mt(i,s,e){var o=e,n=!1;return ft(i,function(a,p,c,l,d){n===!1&&e===void 0?o=a:o=s(o,a,p,c,l,d),n=!0}),o}function D(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function gt(i){return i.type==="Feature"?i.geometry:i}var yt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function V(i,s,e){e===void 0&&(e={});var o=D(i),n=D(s),a=T(n[1]-o[1]),p=T(n[0]-o[0]),c=T(o[1]),l=T(n[1]),d=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(p/2),2)*Math.cos(c)*Math.cos(l);return ht(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),e.units)}function B(i,s,e,o){o===void 0&&(o={});var n=D(i),a=T(n[0]),p=T(n[1]),c=T(e),l=pt(s,o.units),d=Math.asin(Math.sin(p)*Math.cos(l)+Math.cos(p)*Math.sin(l)*Math.cos(c)),y=a+Math.atan2(Math.sin(c)*Math.sin(l)*Math.cos(p),Math.cos(l)-Math.sin(p)*Math.sin(d)),f=U(y),g=U(d);return _([f,g],o.properties)}function O(i,s,e){if(e===void 0&&(e={}),e.final===!0)return kt(i,s);var o=D(i),n=D(s),a=T(o[0]),p=T(n[0]),c=T(o[1]),l=T(n[1]),d=Math.sin(p-a)*Math.cos(l),y=Math.cos(c)*Math.sin(l)-Math.sin(c)*Math.cos(l)*Math.cos(p-a);return U(Math.atan2(d,y))}function kt(i,s){var e=O(s,i);return e=(e+180)%360,e}function vt(i,s,e){e===void 0&&(e={});for(var o=gt(i),n=o.coordinates,a=0,p=0;p<n.length&&!(s>=a&&p===n.length-1);p++)if(a>=s){var c=s-a;if(c){var l=O(n[p],n[p-1])-180,d=B(n[p],c,l,e);return d}else return _(n[p])}else a+=V(n[p],n[p+1],e);return _(n[n.length-1])}function X(i,s){return s===void 0&&(s={}),mt(i,function(e,o){var n=o.geometry.coordinates;return e+V(n[0],n[1],s)},0)}function $(i,s,e,o){if(o=o||{},!ct(o))throw new Error("options is invalid");var n,a=[];if(i.type==="Feature")n=i.geometry.coordinates;else if(i.type==="LineString")n=i.coordinates;else throw new Error("input must be a LineString Feature or Geometry");for(var p=n.length,c=0,l,d,y,f=0;f<n.length&&!(s>=c&&f===n.length-1);f++){if(c>s&&a.length===0){if(l=s-c,!l)return a.push(n[f]),S(a);d=O(n[f],n[f-1])-180,y=B(n[f],l,d,o),a.push(y.geometry.coordinates)}if(c>=e)return l=e-c,l?(d=O(n[f],n[f-1])-180,y=B(n[f],l,d,o),a.push(y.geometry.coordinates),S(a)):(a.push(n[f]),S(a));if(c>=s&&a.push(n[f]),f===n.length-1)return S(a);c+=V(n[f],n[f+1],o)}if(c<s&&n.length===p)throw new Error("Start position is beyond line");var g=n[n.length-1];return S([g,g])}(function(i,s){(function(e,o){o(b)})(yt,function(e){e=e&&e.hasOwnProperty("default")?e.default:e;function o(t,r){var h=r.x-t.x,u=r.y-t.y;return Math.sqrt(h*h+u*u)}var n=function(t,r){return(Math.atan2(r.y-t.y,r.x-t.x)*180/Math.PI+90+360)%360},a=function(t,r){var h=t.value,u=t.isInPixels;return u?h/r:h};function p(t){if(typeof t=="string"&&t.indexOf("%")!==-1)return{value:parseFloat(t)/100,isInPixels:!1};var r=t?parseFloat(t):0;return{value:r,isInPixels:r>0}}var c=function(t,r){return t.x===r.x&&t.y===r.y};function l(t){return t.reduce(function(r,h,u,m){if(u>0&&!c(h,m[u-1])){var k=m[u-1],v=r.length>0?r[r.length-1].distB:0,w=o(k,h);r.push({a:k,b:h,distA:v,distB:v+w,heading:n(k,h)})}return r},[])}function d(t,r){var h=l(t),u=h.length;if(u===0)return[];var m=h[u-1].distB,k=a(r.offset,m),v=a(r.endOffset,m),w=a(r.repeat,m),P=m*w,E=k>0?m*k:0,C=v>0?m*v:0,Z=[],F=E;do Z.push(F),F+=P;while(P>0&&F<m-C);var z=0,x=h[0];return Z.map(function(j){for(;j>x.distB&&z<u-1;)z++,x=h[z];var Q=(j-x.distA)/(x.distB-x.distA);return{pt:y(x.a,x.b,Q),heading:x.heading}})}function y(t,r,h){return r.x!==t.x?{x:t.x+h*(r.x-t.x),y:t.y+h*(r.y-t.y)}:{x:t.x,y:t.y+(r.y-t.y)*h}}(function(){var t=L.Marker.prototype._initIcon,r=L.Marker.prototype._setPos,h=L.DomUtil.TRANSFORM==="msTransform";L.Marker.addInitHook(function(){var u=this.options.icon&&this.options.icon.options,m=u&&this.options.icon.options.iconAnchor;m&&(m=m[0]+"px "+m[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||m||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(k){k.target._applyRotation()})}),L.Marker.include({_initIcon:function(){t.call(this)},_setPos:function(u){r.call(this,u),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,h?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(u){return this.options.rotationAngle=u,this.update(),this},setRotationOrigin:function(u){return this.options.rotationOrigin=u,this.update(),this}})})(),e.Symbol=e.Symbol||{},e.Symbol.Dash=e.Class.extend({options:{pixelSize:10,pathOptions:{}},initialize:function(t){e.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,r,h,u,m){var k=this.options,v=Math.PI/180;if(k.pixelSize<=1)return e.polyline([t.latLng,t.latLng],k.pathOptions);var w=h.project(t.latLng),P=-(t.heading-90)*v,E=e.point(w.x+k.pixelSize*Math.cos(P+Math.PI)/2,w.y+k.pixelSize*Math.sin(P)/2),C=w.add(w.subtract(E));return e.polyline([h.unproject(E),h.unproject(C)],k.pathOptions)}}),e.Symbol.dash=function(t){return new e.Symbol.Dash(t)},e.Symbol.ArrowHead=e.Class.extend({options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(t){e.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,r,h,u,m){return this.options.polygon?e.polygon(this._buildArrowPath(t,h),this.options.pathOptions):e.polyline(this._buildArrowPath(t,h),this.options.pathOptions)},_buildArrowPath:function(t,r){var h=Math.PI/180,u=r.project(t.latLng),m=-(t.heading-90)*h,k=this.options.headAngle/2*h,v=m+k,w=m-k,P=e.point(u.x-this.options.pixelSize*Math.cos(v),u.y+this.options.pixelSize*Math.sin(v)),E=e.point(u.x-this.options.pixelSize*Math.cos(w),u.y+this.options.pixelSize*Math.sin(w));return[r.unproject(P),t.latLng,r.unproject(E)]}}),e.Symbol.arrowHead=function(t){return new e.Symbol.ArrowHead(t)},e.Symbol.Marker=e.Class.extend({options:{markerOptions:{},rotate:!1},initialize:function(t){e.Util.setOptions(this,t),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1},buildSymbol:function(t,r,h,u,m){return this.options.rotate&&(this.options.markerOptions.rotationAngle=t.heading+(this.options.angleCorrection||0)),e.marker(t.latLng,this.options.markerOptions)}}),e.Symbol.marker=function(t){return new e.Symbol.Marker(t)};var f=function(t){return t instanceof e.LatLng||Array.isArray(t)&&t.length===2&&typeof t[0]=="number"},g=function(t){return Array.isArray(t)&&f(t[0])};e.PolylineDecorator=e.FeatureGroup.extend({options:{patterns:[]},initialize:function(t,r){e.FeatureGroup.prototype.initialize.call(this),e.Util.setOptions(this,r),this._map=null,this._paths=this._initPaths(t),this._bounds=this._initBounds(),this._patterns=this._initPatterns(this.options.patterns)},_initPaths:function(t,r){var h=this;if(g(t)){var u=r?t.concat([t[0]]):t;return[u]}return t instanceof e.Polyline?this._initPaths(t.getLatLngs(),t instanceof e.Polygon):Array.isArray(t)?t.reduce(function(m,k){return m.concat(h._initPaths(k,r))},[]):[]},_initPatterns:function(t){return t.map(this._parsePatternDef)},setPatterns:function(t){this.options.patterns=t,this._patterns=this._initPatterns(this.options.patterns),this.redraw()},setPaths:function(t){this._paths=this._initPaths(t),this._bounds=this._initBounds(),this.redraw()},_parsePatternDef:function(t,r){return{symbolFactory:t.symbol,offset:p(t.offset),endOffset:p(t.endOffset),repeat:p(t.repeat)}},onAdd:function(t){this._map=t,this._draw(),this._map.on("moveend",this.redraw,this)},onRemove:function(t){this._map.off("moveend",this.redraw,this),this._map=null,e.FeatureGroup.prototype.onRemove.call(this,t)},_initBounds:function(){var t=this._paths.reduce(function(r,h){return r.concat(h)},[]);return e.latLngBounds(t)},getBounds:function(){return this._bounds},_buildSymbols:function(t,r,h){var u=this;return h.map(function(m,k){return r.buildSymbol(m,t,u._map,k,h.length)})},_getDirectionPoints:function(t,r){var h=this;if(t.length<2)return[];var u=t.map(function(m){return h._map.project(m)});return d(u,r).map(function(m){return{latLng:h._map.unproject(e.point(m.pt)),heading:m.heading}})},redraw:function(){this._map&&(this.clearLayers(),this._draw())},_getPatternLayers:function(t){var r=this,h=this._map.getBounds().pad(.1);return this._paths.map(function(u){var m=r._getDirectionPoints(u,t).filter(function(k){return h.contains(k.latLng)});return e.featureGroup(r._buildSymbols(u,t.symbolFactory,m))})},_draw:function(){var t=this;this._patterns.map(function(r){return t._getPatternLayers(r)}).forEach(function(r){t.addLayer(e.featureGroup(r))})}}),e.polylineDecorator=function(t,r){return new e.PolylineDecorator(t,r)}})})();(function(){var i=L.Marker.prototype._initIcon,s=L.Marker.prototype._setPos,e=L.DomUtil.TRANSFORM==="msTransform";L.Marker.addInitHook(function(){var o=this.options.icon&&this.options.icon.options,n=o&&this.options.icon.options.iconAnchor;n&&(n=n[0]+"px "+n[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||n||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(a){a.target._applyRotation()})}),L.Marker.include({_initIcon:function(){i.call(this)},_setPos:function(o){s.call(this,o),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,e?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(o){return this.options.rotationAngle=o,this.update(),this},setRotationOrigin:function(o){return this.options.rotationOrigin=o,this.update(),this}})})();b.TrackPlayer=class{constructor(i,s={}){var e,o,n,a,p,c,l,d,y,f;let g=b.polyline(i)._latlngs;this.track=S(g.map(({lng:t,lat:r})=>[t,r])),this.distanceSlice=[0],this.track.geometry.coordinates.forEach((t,r,h)=>{if(r!==0){let u=S(h.slice(0,r+1));this.distanceSlice.push(X(u))}}),this.distance=X(this.track),this.addedToMap=!1,this.options={speed:(e=s.speed)!=null?e:600,weight:(o=s.weight)!=null?o:8,markerIcon:s.markerIcon,polylineDecoratorOptions:(n=s.polylineDecoratorOptions)!=null?n:{patterns:[{offset:30,repeat:60,symbol:b.Symbol.arrowHead({pixelSize:5,headAngle:75,polygon:!1,pathOptions:{stroke:!0,weight:3,color:"#fff"}})}]},passedLineColor:(a=s.passedLineColor)!=null?a:"#0000ff",notPassedLineColor:(p=s.notPassedLineColor)!=null?p:"#ff0000",panTo:(c=s.panTo)!=null?c:!0,markerRotationOrigin:(l=s.markerRotationOrigin)!=null?l:"center",markerRotationOffset:(d=s.markerRotationOffset)!=null?d:0,markerRotation:(y=s.markerRotation)!=null?y:!0,progress:(f=s.progress)!=null?f:0},this.initProgress=s.progress,this.isPaused=!0,this.walkedDistance=0,this.walkedDistanceTemp=0,this.trackIndex=0,this.listenedEvents={start:[],pause:[],finished:[],progressCallback:[]}}addTo(i){if(this.addedToMap)return;if(this.map=i,this.addedToMap=!0,this.options.markerIcon){let e=this.track.geometry.coordinates[0];if(this.marker=b.marker([e[1],e[0]],{icon:this.options.markerIcon}).addTo(this.map),this.options.markerRotation){let o=this.track.geometry.coordinates;this.marker.setRotationAngle(O(o[0],o[1])/2+this.options.markerRotationOffset/2),this.marker.setRotationOrigin(this.options.markerRotationOrigin)}}let s=this.track.geometry.coordinates.map(([e,o])=>[o,e]);return this.notPassedLine=b.polyline(s,{weight:this.options.weight,color:this.options.notPassedLineColor}).addTo(this.map),this.passedLine=b.polyline([],{weight:this.options.weight,color:this.options.passedLineColor}).addTo(this.map),this.polylineDecorator=b.polylineDecorator(s,this.options.polylineDecoratorOptions).addTo(this.map),this.initProgress&&this.setProgress(this.initProgress),this}remove(){this.addedToMap&&(this.addedToMap=!1,this.polylineDecorator.remove(),this.polylineDecorator=null,this.notPassedLine.remove(),this.notPassedLine=null,this.passedLine.remove(),this.passedLine=null,this.marker&&(this.marker.remove(),this.marker=null),this.finished=!1,this.startTimestamp=0,this.pauseTimestamp=0,this.walkedDistanceTemp=0,this.walkedDistance=0,this.trackIndex=0,this.isPaused=!0,this.options.progress=this.initProgress)}start(){!this.isPaused&&!this.finished||!this.addedToMap||((this.options.progress===0||this.options.progress===1)&&(this.startTimestamp=0,this.pauseTimestamp=0,this.walkedDistanceTemp=0,this.walkedDistance=0),this.isPaused=!1,this.finished=!1,this.pauseTimestamp&&this.startTimestamp&&(this.startTimestamp=this.startTimestamp+(Date.now()-this.pauseTimestamp)),this.startAction(),this.listenedEvents.start.forEach(i=>i()),this.initProgress&&this.setProgress(this.initProgress))}pause(){this.isPaused||this.finished||(this.pauseTimestamp=Date.now(),this.isPaused=!0,this.listenedEvents.pause.forEach(i=>i()))}startAction(){let i=this.distance,s=e=>{if(e&&this.addedToMap){let o=i/this.options.speed*3600*1e3;this.startTimestamp||(this.startTimestamp=e);let n=e-this.startTimestamp;this.walkedDistance=i*(n/o)+this.walkedDistanceTemp,this.playAction()}!this.isPaused&&!this.finished&&requestAnimationFrame(s)};s()}playAction(i=!1){if(this.isPaused&&!i)return;let s=this.distance;this.trackIndex=this.distanceSlice.findIndex((n,a,p)=>{var c;return this.walkedDistance>=n&&this.walkedDistance<((c=p[a+1])!=null?c:1/0)});let[e,o]=vt(this.track,this.walkedDistance).geometry.coordinates;if(this.markerPoint=[o,e],this.options.panTo&&this.map.panTo(this.markerPoint,{animate:!1}),this.marker&&this.marker.setLatLng(this.markerPoint),this.walkedDistance>=s)this.notPassedLine.setLatLngs([]);else{let n=$(this.track,this.walkedDistance);this.notPassedLine.setLatLngs(n.geometry.coordinates.map(([a,p])=>[p,a]))}if(this.walkedDistance>0){let n=$(this.track,0,this.walkedDistance);this.passedLine.setLatLngs(n.geometry.coordinates.map(([a,p])=>[p,a]))}else this.passedLine.setLatLngs([]);if(this.polylineDecorator.setPaths([...this.passedLine.getLatLngs(),...this.notPassedLine.getLatLngs()]),this.walkedDistance<s&&this.options.markerRotation&&this.marker){let n=0;n=O(_([e,o]),_(this.track.geometry.coordinates[this.trackIndex+1])),this.marker.setRotationAngle(n/2+this.options.markerRotationOffset/2)}if(this.options.progress=Math.min(1,this.walkedDistance/s),this.listenedEvents.progressCallback.forEach(n=>n(this.options.progress,b.latLng(...this.markerPoint),this.trackIndex)),this.walkedDistance>=s&&(this.walkedDistance=s,this.finished=!0,this.listenedEvents.finished.forEach(n=>n()),this.options.markerRotation&&this.marker)){let n=this.track.geometry.coordinates,a=O(_(n.at(-2)),_(n.at(-1)));this.marker.setRotationAngle(a/2+this.options.markerRotationOffset/2)}}setSpeedAction(i){this.options.speed=i,this.walkedDistanceTemp=this.walkedDistance,this.startTimestamp=0}setSpeed(i,s=20){return lt(this,null,function*(){s&&(clearTimeout(this.setSpeedTimeout),yield new Promise(e=>{this.setSpeedTimeout=setTimeout(e,s)})),this.setSpeedAction(i)})}setProgress(i){this.addedToMap&&(this.options.progress==1&&i==1||this.options.progress==0&&i==0||(this.options.progress=i,this.walkedDistanceTemp=this.distance*i,this.startTimestamp=0,(this.isPaused||this.finished)&&(this.walkedDistance=this.walkedDistanceTemp,this.isPaused?this.playAction(!0):(this.finished=!1,this.isPaused=!1,this.startAction()))))}on(i,s){switch(i){case"start":this.listenedEvents.start.push(s);break;case"pause":this.listenedEvents.pause.push(s);break;case"finished":this.listenedEvents.finished.push(s);break;case"progress":this.listenedEvents.progressCallback.push(s);break}}off(i,s){if(!s){this.listenedEvents[i]=[];return}switch(i){case"start":this.listenedEvents.start=this.listenedEvents.start.filter(e=>e!==s);break;case"pause":this.listenedEvents.pause=this.listenedEvents.pause.filter(e=>e!==s);break;case"finished":this.listenedEvents.finished=this.listenedEvents.finished.filter(e=>e!==s);break;case"progress":this.listenedEvents.progressCallback=this.listenedEvents.progressCallback.filter(e=>e!==s);break}}};const wt={class:"relative h-full w-full"},bt={class:"absolute top-2 right-2 z-[888] flex items-center gap-5 rounded bg-white px-3 py-2 text-xs"},Lt={class:"flex items-center"},Pt={class:"flex w-[300px] items-center gap-5"},Mt={class:"text-nowrap"},Tt={class:"flex w-[350px] items-center gap-5"},Ft=st({__name:"track",setup(i){let s={},e={};const o=ot({speed:e?.options?.speed??600,progress:e?.options?.progress*100||0,start:()=>{s.setZoom(17),e.start()},pause:()=>e.pause()}),n=async g=>{const t=await J({keyword:g});return`${t.data.location.lon},${t.data.location.lat}`},a=g=>{const t=g.match(/<routelatlon>([\s\S]*?)<\/routelatlon>/);return t?t[1].trim():""},p=async(g,t)=>{const r=await K({orig:g,dest:t});return a(r.data)},c=g=>g.split(";").map(t=>{if(t!==""){const r=t.split(",");return{lng:r[0],lat:r[1]}}}),l=g=>{e.setProgress(Number(g)/100)},d=g=>{e.setSpeed(g)},y=async()=>{const g=await n("成都科学城"),t=await n("成都天府香山"),r=await p(g,t);let h=c(r).filter(v=>v);const u=b.icon({iconUrl:tt,iconSize:[22,42],iconAnchor:[11,21]});s.fitBounds(h),e=new b.TrackPlayer(h,{markerIcon:u,speed:o.speed,weight:8,passedLineColor:"#43A047",notPassedLineColor:"#F44336",panTo:!0,markerRotation:!0}),e.addTo(s);const k=b.marker(g.split(","),{icon:b.divIcon({iconSize:null,className:"",popupAnchor:[5,5],shadowAnchor:[5,5],html:"<div class='carnumbox'><div class='carnumbox-text'>"+"川A888888"+"</div></div>"})}).addTo(s);e.on("progress",(v,{lng:w,lat:P})=>{k.setLatLng([P,w]),o.progress=v*100})},f=()=>{const g=b.tileLayer("http://t0.tianditu.gov.cn/vec_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=b40e3cf3d6fa4b1a6c1dc2d2a5288b7e",{tileSize:256,maxZoom:18,minZoom:5}),t=b.tileLayer("http://t0.tianditu.gov.cn/cva_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cva&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=b40e3cf3d6fa4b1a6c1dc2d2a5288b7e",{tileSize:256,maxZoom:18,minZoom:5});b.layerGroup([g,t]);const r=b.tileLayer("http://www.google.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}",{maxZoom:20});s=b.map("gisMap",{center:b.latLng(30.5728,104.0665),zoom:12,minZoom:5,maxZoom:18,layers:[r],attributionControl:!1,zoomControl:!0,fullscreenControl:!0,fullscreenControlOptions:{position:"topleft"}})};return nt(()=>{f()}),(g,t)=>{const r=et,h=it;return at(),rt("div",wt,[t[9]||(t[9]=A("div",{id:"gisMap",class:"absolute top-0 right-0 bottom-0 left-0"},null,-1)),A("div",bt,[A("div",Lt,[R(r,{onClick:y},{default:G(()=>t[4]||(t[4]=[N("生成路线")])),_:1}),R(r,{onClick:t[0]||(t[0]=u=>o.start())},{default:G(()=>t[5]||(t[5]=[N("开始")])),_:1}),R(r,{onClick:t[1]||(t[1]=u=>o.pause())},{default:G(()=>t[6]||(t[6]=[N("暂停")])),_:1})]),A("div",Pt,[t[7]||(t[7]=A("p",{class:"text-nowrap"},"速度",-1)),R(h,{onChange:d,modelValue:o.speed,"onUpdate:modelValue":t[2]||(t[2]=u=>o.speed=u),max:1e3,min:0},null,8,["modelValue"]),A("p",Mt,H(o.speed)+" （km/h）",1)]),A("div",Tt,[t[8]||(t[8]=A("p",{class:"text-nowrap"},"进程",-1)),R(h,{onChange:l,modelValue:o.progress,"onUpdate:modelValue":t[3]||(t[3]=u=>o.progress=u),max:100,min:0},null,8,["modelValue"]),A("p",null,H(Math.floor(o.progress))+"%",1)])])])}}});export{Ft as default};
