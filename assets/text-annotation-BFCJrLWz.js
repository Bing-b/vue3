import{$n as reactive,A as ElSelect,Bn as resolveComponent,Fn as openBlock,Jn as withCtx,Mr as toDisplayString,Nn as onMounted,P as ElLink,Pr as __commonJSMin,Rn as renderList,Rr as __toESM,Sn as createVNode,U as ElDialog,Wn as useModel,X as ElTag,Yn as withDirectives,_n as createBlock,at as ElBadge,en as ElIcon,er as ref,fn as Fragment,gn as createBaseVNode,hn as computed,k as ElOption,kn as mergeModels,kr as normalizeStyle,ln as vShow,lt as ElInput,nn as _plugin_vue_export_helper_default,qn as watchEffect,tt as ElButton,wn as defineComponent,xn as createTextVNode,yn as createElementBlock}from"./index-BSx7YI45.js";/* empty css            *//* empty css            */import"./css-De1qXSl6.js";/* empty css            *//* empty css            *//* empty css            *//* empty css            *//* empty css            *//* empty css            *//* empty css            */var import_dist=__commonJSMin(((e,t)=>{(function(n,r){typeof e==`object`&&typeof t==`object`?t.exports=r():typeof define==`function`&&define.amd?define([],r):typeof e==`object`?e.Poplar=r():n.Poplar=r()})(window,function(){return n={},e.m=t=[function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0}),t.SVGNS=`http://www.w3.org/2000/svg`},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__values||function(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(t,`__esModule`,{value:!0});var o,s,c,l=n(4),u=n(3);function d(){var e=s!==null&&s.apply(this,arguments)||this;return e.entities=new Map,e.nextId=0,e}o=t.Base||={},s=u.EventEmitter,i(d,s),Object.defineProperty(d.prototype,`json`,{get:function(){var e,t,n=[];try{for(var r=a(this.values()),i=r.next();!i.done;i=r.next()){var o=i.value;`json`in o?n.push(o.json):n.push(JSON.parse(JSON.stringify(o)))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,`length`,{get:function(){return this.entities.size},enumerable:!0,configurable:!0}),d.prototype.get=function(e){return l.assert(this.has(e),`There's no Entity which id=`+e+` in repo!`),this.entities.get(e)},d.prototype.has=function(e){return this.entities.has(e)},d.prototype.set=function(e,t){var n=this.has(e);return this.entities.set(e,t),n?this.emit(`updated`,t):(this.nextId<e+1&&(this.nextId=e+1),this.emit(`created`,t)),this},d.prototype.add=function(e){if(`id`in e){var t=e.id;return l.assert(!this.has(t),`reAdd `+t+`!`),t===null?(e.id=this.nextId,this.add(e)):(this.set(t,e),t)}var n=this.nextId;return this.set(n,e),n},d.prototype[Symbol.iterator]=function(){return this.entities[Symbol.iterator]()},d.prototype.delete=function(e){if(typeof e==`number`&&this.has(e)){var t=this.get(e);return this.entities.delete(e),this.emit(`removed`,t),!0}return typeof e!=`number`&&`id`in e&&this.delete(e.id)},d.prototype.values=function(){return this.entities.values()},c=d,o.Repository=c},function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0});var r=(Object.defineProperty(i.prototype,`isSome`,{get:function(){return this.value!==null},enumerable:!0,configurable:!0}),i.prototype.map=function(e){return this.value===null?new i(null):new i(e(this.value))},i.prototype.flatMap=function(e){return this.value===null?new i(null):o(e(this.value).toNullable())},i.prototype.orElse=function(e){return this.value===null?e:this.value},i.prototype.toNullable=function(){return this.value},i.prototype.match=function(e,t){return this.isSome?e:t},i);function i(e){this.value=e}function a(e){return new r(e)}function o(e){return e==null?t.none:a(e)}t.Option=r,t.none=new r(null),t.some=a,t.fromNullable=o,t.fromTry=function(e){try{return a(e())}catch{return t.none}}},function(e,t,n){var r,i=typeof Reflect==`object`?Reflect:null,a=i&&typeof i.apply==`function`?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&typeof i.ownKeys==`function`?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}((e.exports=s).EventEmitter=s).prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function l(e){return e._maxListeners===void 0?s.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var i,a,o;if(typeof n!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof n);if((a=e._events)===void 0?(a=e._events=Object.create(null),e._eventsCount=0):(a.newListener!==void 0&&(e.emit(`newListener`,t,n.listener?n.listener:n),a=e._events),o=a[t]),o===void 0)o=a[t]=n,++e._eventsCount;else if(typeof o==`function`?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),0<(i=l(e))&&o.length>i&&!o.warned){o.warned=!0;var s=Error(`Possible EventEmitter memory leak detected. `+o.length+` `+String(t)+` listeners added. Use emitter.setMaxListeners() to increase limit`);s.name=`MaxListenersExceededWarning`,s.emitter=e,s.type=t,s.count=o.length,function(e){console&&console.warn}(s)}return e}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,e))}.bind(r);return i.listener=n,r.wrapFn=i}function f(e,t,n){var r=e._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i==`function`?n?[i.listener||i]:[i]:n?function(e){for(var t=Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function p(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n==`function`)return 1;if(n!==void 0)return n.length}return 0}function m(e,t){for(var n=Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,`defaultMaxListeners`,{enumerable:!0,get:function(){return c},set:function(e){if(typeof e!=`number`||e<0||o(e))throw RangeError(`The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received `+e+`.`);c=e}}),s.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if(typeof e!=`number`||e<0||o(e))throw RangeError(`The value of "n" is out of range. It must be a non-negative number. Received `+e+`.`);return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r=e===`error`,i=this._events;if(i!==void 0)r&&=i.error===void 0;else if(!r)return!1;if(r){var o;if(0<t.length&&(o=t[0]),o instanceof Error)throw o;var s=Error(`Unhandled error.`+(o?` (`+o.message+`)`:``));throw s.context=o,s}var c=i[e];if(c===void 0)return!1;if(typeof c==`function`)a(c,this,t);else{var l=c.length,u=m(c,l);for(n=0;n<l;++n)a(u[n],this,t)}return!0},s.prototype.on=s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){if(typeof t!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof t);return this.on(e,d(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if(typeof t!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof t);return this.prependListener(e,d(this,e,t)),this},s.prototype.off=s.prototype.removeListener=function(e,t){var n,r,i,a,o;if(typeof t!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof t);if((r=this._events)===void 0||(n=r[e])===void 0)return this;if(n===t||n.listener===t)--this._eventsCount==0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit(`removeListener`,e,n.listener||t));else if(typeof n!=`function`){for(i=-1,a=n.length-1;0<=a;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;i===0?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),n.length===1&&(r[e]=n[0]),r.removeListener!==void 0&&this.emit(`removeListener`,e,o||t)}return this},s.prototype.removeAllListeners=function(e){var t,n,r;if((n=this._events)===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var i,a=Object.keys(n);for(r=0;r<a.length;++r)(i=a[r])!==`removeListener`&&this.removeAllListeners(i);return this.removeAllListeners(`removeListener`),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(t=n[e])==`function`)this.removeListener(e,t);else if(t!==void 0)for(r=t.length-1;0<=r;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return typeof e.listenerCount==`function`?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return 0<this._eventsCount?r(this._events):[]}},function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0}),t.assert=function(e,t){}},function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0}),t.shadeColor=function(e,t){var n=parseInt(e.slice(1),16),r=Math.min((n>>16)+(n>>16)*t/100,255),i=Math.min((n>>8&255)+(n>>8&255)*t/100,255);return`#`+(Math.min((255&n)+(255&n)*t/100,255)|i<<8|r<<16).toString(16)},t.addAlpha=function(e,t){var n=parseInt(e.slice(1),16);return`rgba(`+(n>>16)+`,`+(n>>8&255)+`,`+(255&n)+`,`+t+`%)`}},function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0});function r(){this.layer=0}t.TopContextUser=r,t.overLaps=function e(t,n){return t.layer===n.layer&&(t.left>n.left?e(n,t):!(t.left+t.width<n.left))}},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__read||function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(t===void 0||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e};Object.defineProperty(t,`__esModule`,{value:!0});var s=n(6),c=n(0),l=n(1),u=n(5);(function(e){var t,n=(t=s.TopContextUser,i(r,t),Object.defineProperty(r.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`lineIn`,{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`view`,{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`highLightWidth`,{get:function(){return this.view.contentWidth(this.store.startIndex,this.store.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`highLightLeft`,{get:function(){return this.view.contentWidth(this.lineIn.startIndex,this.store.startIndex)+this.lineIn.view.paddingLeft},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`middle`,{get:function(){return this.highLightLeft+this.highLightWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`labelLeft`,{get:function(){return this.middle-this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`labelRight`,{get:function(){return this.middle+this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`labelWidth`,{get:function(){return this.view.labelFont.widthOf(this.store.category.text)+this.config.labelPadding+2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`left`,{get:function(){return this.config.labelWidthCalcMethod===`max`?this.labelWidth>this.highLightWidth?this.labelLeft:this.highLightLeft:this.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`width`,{get:function(){return this.config.labelWidthCalcMethod===`max`?this.labelWidth>this.highLightWidth-1?this.labelWidth:this.highLightWidth-1:this.labelWidth},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`annotationY`,{get:function(){return-this.view.topContextLayerHeight*(this.layer-1)-(this.view.labelFont.lineHeight+2+2*this.config.labelPadding+this.config.bracketWidth)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`globalY`,{get:function(){return this.lineIn.y+this.annotationY},enumerable:!0,configurable:!0}),r.prototype.render=function(){var e;this.svgElement=document.createElementNS(c.SVGNS,`g`),(e=this.svgElement.classList).add.apply(e,o(this.config.labelClasses));var t=this.createHighLightElement(),n=this.createAnnotationElement(),r=this.view.topContextLayerHeight*(this.layer-1),i=this.createBracketElement(this.highLightWidth,-r,0,-r,this.config.bracketWidth);return this.svgElement.appendChild(t),this.svgElement.appendChild(n),this.svgElement.appendChild(i),this.svgElement},r.prototype.update=function(){this.svgElement.style.transform=`translate(`+this.highLightLeft+`px,`+this.lineIn.y+`px)`},r.prototype.remove=function(){this.svgElement.remove()},r.prototype.createHighLightElement=function(){var e=document.createElementNS(c.SVGNS,`rect`),t=this.store.category.color;return e.setAttribute(`height`,this.lineIn.view.contentFont.lineHeight.toString()),e.setAttribute(`width`,this.highLightWidth.toString()),e.setAttribute(`fill`,/^#/g.test(t)?u.addAlpha(t,70):t),e},r.prototype.createBracketElement=function(e,t,n,r,i,a){a===void 0&&(a=.6);var o=e-n,s=t-r,l=Math.sqrt(o*o+s*s),u=e+a*i*(s/=l),d=t-a*i*(o/=l),f=e-.25*l*o+(1-a)*i*s,p=t-.25*l*s-(1-a)*i*o,m=e-.5*l*o+i*s,h=t-.5*l*s-i*o,g=n+a*i*s,_=r-a*i*o,v=e-.75*l*o+(1-a)*i*s,y=t-.75*l*s-(1-a)*i*o,b=document.createElementNS(c.SVGNS,`path`);return b.setAttribute(`d`,`M`+e+`,`+t+`Q`+u+`,`+d+`,`+f+`,`+p+`T`+m+`,`+h+`M`+n+`,`+r+`Q`+g+`,`+_+`,`+v+`,`+y+`T`+m+`,`+h),b.setAttribute(`fill`,`none`),b.setAttribute(`stroke`,this.store.category.borderColor),b},r.prototype.createAnnotationElement=function(){var e=this,t=this.view.labelCategoryElementFactoryRepository.get(this.store.category.id).create();return t.style.transform=`translate(`+(this.highLightWidth-this.labelWidth)/2+`px,`+this.annotationY+`px)`,t.onclick=function(t){e.view.root.emit(`labelClicked`,e.id,t)},t.ondblclick=function(t){e.view.root.emit(`labelDoubleClicked`,e.id,t)},t.oncontextmenu=function(t){e.view.root.emit(`labelRightClicked`,e.id,t),t.preventDefault()},t.onmouseenter=function(){e.svgElement.classList.add(`hover`),Array.from(e.store.connectionsFrom).map(function(t){return e.view.connectionViewRepository.get(t.id)}).map(function(e){return e.addHover(`from`)}),Array.from(e.store.connectionsTo).map(function(t){return e.view.connectionViewRepository.get(t.id)}).map(function(e){return e.addHover(`to`)})},t.onmouseleave=function(){e.svgElement.classList.remove(`hover`),Array.from(e.store.connectionsFrom).map(function(t){return e.view.connectionViewRepository.get(t.id)}).map(function(e){return e.removeHover(`from`)}),Array.from(e.store.connectionsTo).map(function(t){return e.view.connectionViewRepository.get(t.id)}).map(function(e){return e.removeHover(`to`)})},t},r);function r(e,n,r){var i=t.call(this)||this;return i.store=e,i.contextIn=n,i.config=r,i.layer=0,i.svgElement=null,i}e.Entity=n;var a,d=(a=l.Base.Repository,i(f,a),f.prototype.get=function(e){return this.entities.get(e)},f);function f(){return a!==null&&a.apply(this,arguments)||this}e.Repository=d})(t.LabelView||={})},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__values||function(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(t,`__esModule`,{value:!0});var o=n(1);(function(e){var t=(Object.defineProperty(n.prototype,`startIndex`,{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`endIndex`,{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),n.prototype.move=function(e){this._startIndex+=e,this._endIndex+=e},Object.defineProperty(n.prototype,`category`,{get:function(){return this.root.labelCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`json`,{get:function(){return{id:this.id,categoryId:this.categoryId,startIndex:this.startIndex,endIndex:this.endIndex}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`sameLineConnections`,{get:function(){var e,t,n=[];try{for(var r=a(this.root.connectionRepo.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.priorLabel===this&&n.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`connectionsFrom`,{get:function(){var e,t,n=new Set;try{for(var r=a(this.root.connectionRepo.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.from===this&&n.add(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`connectionsTo`,{get:function(){var e,t,n=new Set;try{for(var r=a(this.root.connectionRepo.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.to===this&&n.add(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`allConnections`,{get:function(){return new Set(Array.prototype.concat(Array.from(this.connectionsFrom),Array.from(this.connectionsTo)))},enumerable:!0,configurable:!0}),n);function n(e,t,n,r,i){this.id=e,this.categoryId=t,this._startIndex=n,this._endIndex=r,this.root=i}e.Entity=t;var r,s,c=(r=o.Base.Repository,i(l,r),l.prototype.set=function(e,t){return this.againstMultipleLabelWith(t)||r.prototype.set.call(this,e,t),this},l.prototype.add=function(e){return this.againstMultipleLabelWith(e)?-1:r.prototype.add.call(this,e)},l.prototype.againstMultipleLabelWith=function(e){function t(e,t){return e.startIndex===t.startIndex&&e.endIndex===t.endIndex}var n=this.config.allowMultipleLabel===`notAllowed`?t:function(e,n){return t(e,n)&&e.categoryId==n.categoryId};return Array.from(this.values()).some(function(t){return n(t,e)})},l.prototype.getEntitiesInRange=function(e,t){return Array.from(this.entities.values()).filter(function(n){return e<=n.startIndex&&n.endIndex<=t})},l.prototype.getEntitiesCross=function(e){return Array.from(this.entities.values()).filter(function(t){return t.startIndex<=e&&e<t.endIndex})},l);function l(e){var t=r.call(this)||this;return t.config=e,t}function u(e,n){return new t(e.id,e.categoryId,e.startIndex,e.endIndex,n)}e.Repository=c,(s=e.Factory||={}).create=u,s.createAll=function(e,t){return e.map(function(e){return u(e,t)})}})(t.Label||={})},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,`__esModule`,{value:!0});var a=n(1);(function(e){var t=(Object.defineProperty(n.prototype,`category`,{get:function(){return this.root.connectionCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`from`,{get:function(){return this.root.labelRepo.get(this.fromId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`to`,{get:function(){return this.root.labelRepo.get(this.toId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`priorLabel`,{get:function(){return this.from.startIndex<this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`posteriorLabel`,{get:function(){return this.from.startIndex>=this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`json`,{get:function(){return{id:this.id,categoryId:this.categoryId,fromId:this.fromId,toId:this.toId}},enumerable:!0,configurable:!0}),n);function n(e,t,n,r,i){this.id=e,this.categoryId=t,this.fromId=n,this.toId=r,this.root=i}e.Entity=t;var r,o,s=(r=a.Base.Repository,i(c,r),c.prototype.set=function(e,t){return this.againstMultipleConnectionRuleWith(t)||r.prototype.set.call(this,e,t),this},c.prototype.add=function(e){return this.againstMultipleConnectionRuleWith(e)?-1:r.prototype.add.call(this,e)},c.prototype.againstMultipleConnectionRuleWith=function(e){function t(e,t){return e.from===t.from&&e.to===t.to}var n=this.config.allowMultipleConnection===`notAllowed`?t:function(e,n){return t(e,n)&&e.categoryId==n.categoryId};return Array.from(this.values()).some(function(t){return n(t,e)})},c);function c(e){var t=r.call(this)||this;return t.config=e,t}function l(e,n){return new t(e.id,e.categoryId,e.fromId,e.toId,n)}e.Repository=s,(o=e.Factory||={}).create=l,o.createAll=function(e,t){return e.map(function(e){return l(e,t)})}})(t.Connection||={})},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__read||function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(t===void 0||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e};Object.defineProperty(t,`__esModule`,{value:!0});var s=n(1),c=n(0),l=n(6);(function(e){var t,n=(t=l.TopContextUser,i(r,t),Object.defineProperty(r.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`lineIn`,{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`view`,{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`sameLineLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.priorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`mayNotSameLineLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.posteriorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`fromLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.from.id)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`toLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.to.id)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`leftLabelView`,{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`rightLabelView`,{get:function(){return this.fromLabelView.labelLeft>=this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`middle`,{get:function(){return(this.leftLabelView.labelLeft+this.rightLabelView.labelRight)/2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`textWidth`,{get:function(){return this.view.connectionFont.widthOf(this.store.category.text)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`textLeft`,{get:function(){return this.middle-this.textWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`lineIncludedWidth`,{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.toLabelView.labelRight-this.fromLabelView.labelLeft:this.fromLabelView.labelRight-this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`lineIncludedLeft`,{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView.labelLeft:this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`width`,{get:function(){return this.config.connectionWidthCalcMethod===`text`?this.textWidth:this.lineIncludedWidth},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`left`,{get:function(){return this.config.connectionWidthCalcMethod===`text`?this.textLeft:this.lineIncludedLeft},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,`globalY`,{get:function(){return this.lineIn.y-this.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),r.prototype.render=function(){var e=this;this.svgElement=document.createElementNS(c.SVGNS,`g`);var t=this.view.connectionCategoryElementFactoryRepository.get(this.store.category.id).create();return this.svgElement.appendChild(t),this.svgElement.style.cursor=`pointer`,this.svgElement.onclick=function(t){e.view.root.emit(`connectionClicked`,e.id,t)},this.svgElement.ondblclick=function(t){e.view.root.emit(`connectionDoubleClicked`,e.id,t)},this.svgElement.oncontextmenu=function(t){e.view.root.emit(`connectionRightClicked`,e.id,t),t.preventDefault()},this.svgElement.onmouseenter=function(){e.svgElement.classList.add(`hover`),e.lineElement.classList.add(`hover`)},this.svgElement.onmouseleave=function(){e.svgElement.classList.remove(`hover`),e.lineElement.classList.remove(`hover`)},this.renderLine(),this.svgElement},r.prototype.update=function(){this.svgElement.style.transform=`translate(`+this.textLeft+`px,`+this.globalY+`px)`,this.updateLine()},r.prototype.addHover=function(e){this.svgElement.classList.add(`hover-`+e),this.lineElement.classList.add(`hover-`+e)},r.prototype.removeHover=function(e){this.svgElement.classList.remove(`hover-`+e),this.lineElement.classList.remove(`hover-`+e)},r.prototype.remove=function(){this.svgElement.remove(),this.lineElement.remove()},r.prototype.updateLine=function(){var e=this.globalY+this.view.topContextLayerHeight/2-this.view.labelFont.fontSize+2;this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.lineElement.setAttribute(`d`,`
                    M `+(this.fromLabelView.labelLeft+1)+`   `+(this.fromLabelView.globalY+1)+`
                    C `+(this.fromLabelView.labelLeft-8)+`  `+e+`,
                      `+(this.fromLabelView.labelLeft-8)+`  `+e+`,
                      `+(this.fromLabelView.labelLeft+1)+`   `+e+`
                    L `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+` `+e+`
                    C `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+`  `+e+`,
                      `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+`  `+e+`,
                      `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+`   `+(this.toLabelView.globalY-1)+`
                `):this.lineElement.setAttribute(`d`,`
                    M `+(this.fromLabelView.labelRight-1)+`   `+(this.fromLabelView.globalY+1)+`
                    C `+(this.fromLabelView.labelRight+8)+`  `+e+`,
                      `+(this.fromLabelView.labelRight+8)+`  `+e+`,
                      `+(this.fromLabelView.labelRight-1)+`   `+e+`
                    L `+this.toLabelView.labelLeft+`          `+e+`
                    C `+(this.toLabelView.labelLeft-8)+`  `+e+`,
                      `+(this.toLabelView.labelLeft-8)+`  `+e+`,
                      `+this.toLabelView.labelLeft+`   `+(this.toLabelView.globalY-1)+`
                `)},r.prototype.renderLine=function(){var e;this.lineElement=document.createElementNS(c.SVGNS,`path`),(e=this.lineElement.classList).add.apply(e,o(this.config.connectionClasses.map(function(e){return e+`-line`}))),this.lineElement.setAttribute(`fill`,`none`),this.lineElement.style.markerEnd=`url(#marker-arrow)`,this.updateLine(),this.contextIn.backgroundElement.appendChild(this.lineElement)},r);function r(e,n,r){var i=t.call(this)||this;return i.store=e,i.contextIn=n,i.config=r,i.svgElement=null,i.lineElement=null,i}e.Entity=n;var a,u=(a=s.Base.Repository,i(d,a),d);function d(){return a!==null&&a.apply(this,arguments)||this}e.Repository=u})(t.ConnectionView||={})},function(e,t,n){var r=this&&this.__read||function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(t===void 0||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,`__esModule`,{value:!0});var a,o,s=n(0);function c(e,t,n,r,i,a){this.fontFamily=e,this.fontSize=t,this.fontWeight=n,this.lineHeight=r,this.topToBaseLine=i,this.width=a}a=t.Font||={},c.prototype.widthOf=function(e){var t=this;return typeof e==`string`?this.widthOf(Array.from(e)):e.map(function(e){return t.width.get(e)}).reduce(function(e,t){return e+t},0)},o=c,a.ValueObject=o,function(e){function t(e,t,n){var r=new Map,i=new Set(e);i.delete(`
`);var a=Array.from(i);t.textContent=a.join(``),t.parentNode.parentNode.insertBefore(n,t.parentNode),a.forEach(function(e,n){r.set(e,t.getExtentOfChar(n).width)});var s=n.getBoundingClientRect().top-t.getBoundingClientRect().top,c=parseFloat(window.getComputedStyle(t).fontSize),l=window.getComputedStyle(t).fontFamily,u=window.getComputedStyle(t).fontWeight,d=t.getBoundingClientRect().height;return new o(l,c,u,d,s,r)}e.create=t;var n=(r.prototype.thanCreate=function(e,n){var r,a;(r=this.measuringElement.classList).add.apply(r,i(e));var o=t(n,this.measuringElement,this.baseLineReferenceElement);return(a=this.measuringElement.classList).remove.apply(a,i(e)),this.result.push(o),this},r.prototype.endBatch=function(){return this.baseLineReferenceElement.remove(),this.measuringElement.remove(),this.result},r);function r(e,t){this.svgElement=e,this.textElement=t,this.baseLineReferenceElement=document.createElementNS(s.SVGNS,`rect`),this.baseLineReferenceElement.setAttribute(`width`,`1px`),this.baseLineReferenceElement.setAttribute(`height`,`1px`),this.svgElement.appendChild(this.baseLineReferenceElement),this.measuringElement=document.createElementNS(s.SVGNS,`tspan`),this.textElement.appendChild(this.measuringElement),this.result=[]}e.startBatch=function(e,t){return new n(e,t)}}(a.Factory||={}),(a.Service||={}).measureMore=function(e,t,n,r){var a,o=new Set(t);o.delete(`
`);var c=Array.from(o).filter(function(t){return!e.width.has(t)});if(0<c.length){var l=document.createElementNS(s.SVGNS,`tspan`);(a=l.classList).add.apply(a,i(n)),l.textContent=c.join(``),r.appendChild(l),c.forEach(function(t,n){e.width.set(t,l.getExtentOfChar(n).width)}),l.remove()}return e}},function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0}),t.Annotator=n(13).Annotator;var r=n(27),i=n(28),a=n(29);t.Action={Connection:r.Connection,Label:i.Label,Content:a.Content}},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,`__esModule`,{value:!0});var a,o=n(3),s=n(14),c=n(17),l=n(0),u=n(24),d=n(25),f=n(26),p=(a=o.EventEmitter,i(m,a),m.prototype.applyAction=function(e){e.apply(this.store)},m.prototype.export=function(){this.view.contentEditor.hide();var e=this.view.svgElement.outerHTML.replace(/&nbsp;/,` `);return this.view.contentEditor.show(),e},m.prototype.remove=function(){this.view.svgElement.remove(),this.store.config.contentEditable&&this.view.contentEditor.remove()},m);function m(e,t,n){var r=a.call(this)||this;r.containerElement=t,r.configInput=n;var i=u.parseInput(n||{});r.store=new s.Store(i),r.store.json=typeof e==`string`?JSON.parse(e):e;var o=document.createElementNS(l.SVGNS,`svg`);return o.setAttribute(`xmlns`,l.SVGNS),t.appendChild(o),r.view=new c.View(r,o,i),r.textSelectionHandler=new d.TextSelectionHandler(r,i),r.twoLabelsClickedHandler=new f.TwoLabelsClickedHandler(r,i),r}t.Annotator=p},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,`__esModule`,{value:!0});var a,o=n(15),s=n(8),c=n(16),l=n(9),u=(a=n(3).EventEmitter,i(d,a),Object.defineProperty(d.prototype,`content`,{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,`json`,{get:function(){return{content:this._content,labelCategories:this.labelCategoryRepo.json,labels:this.labelRepo.json,connectionCategories:this.connectionCategoryRepo.json,connections:this.connectionRepo.json}},set:function(e){var t=this;this._content=e.content.endsWith(`
`)?e.content:e.content+`
`,o.LabelCategory.Factory.createAll(e.labelCategories,this.config).map(function(e){return t.labelCategoryRepo.add(e)}),s.Label.Factory.createAll(e.labels,this).map(function(e){return t.labelRepo.add(e)}),e.connectionCategories.map(function(e){return t.connectionCategoryRepo.add(e)}),l.Connection.Factory.createAll(e.connections,this).map(function(e){return t.connectionRepo.add(e)})},enumerable:!0,configurable:!0}),d.prototype.contentSlice=function(e,t){return this.content.slice(e,t)},d.prototype.moveLabels=function(e,t){Array.from(this.labelRepo.values()).filter(function(t){return t.startIndex>=e}).map(function(e){return e.move(t)})},d.prototype.spliceContent=function(e,t){var n=[...arguments].slice(2),r=e+t;if(t===0||Array.from(this.labelRepo.values()).find(function(t){return t.startIndex<=e&&e<t.endIndex||t.startIndex<r&&r<t.endIndex})===void 0){var i=this.content.slice(0,e),a=this.content.slice(e,e+t),o=n.join(``),s=this.content.slice(e+t);this._content=i+o+s,this.moveLabels(e+t,o.length-a.length),this.emit(`contentSpliced`,e,a,o)}},d);function d(e){var t=a.call(this)||this;return t._content=``,t.config=e,t.labelCategoryRepo=new o.LabelCategory.Repository,t.labelRepo=new s.Label.Repository(e),t.connectionCategoryRepo=new c.ConnectionCategory.Repository,t.connectionRepo=new l.Connection.Repository(e),t}t.Store=u},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,`__esModule`,{value:!0});var a,o,s,c,l=n(1),u=n(5);function d(){return o!==null&&o.apply(this,arguments)||this}function f(e,t){var n=e.borderColor,r=e.color;return!e.borderColor&&e[`border-color`]&&(n=e[`border-color`]),e.color||(r=t),e.borderColor||(n=u.shadeColor(r,-30)),{id:e.id,text:e.text,color:r,borderColor:n}}a=t.LabelCategory||={},o=l.Base.Repository,i(d,o),c=d,a.Repository=c,(s=a.Factory||={}).create=f,s.createAll=function(e,t){return e.map(function(e){return f(e,t.defaultLabelColor)})}},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,`__esModule`,{value:!0});var a,o,s,c=n(1);function l(){return o!==null&&o.apply(this,arguments)||this}a=t.ConnectionCategory||={},o=c.Base.Repository,i(l,o),s=l,a.Repository=s},function(e,t,n){var r=this&&this.__read||function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(t===void 0||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},a=this&&this.__values||function(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(t,`__esModule`,{value:!0});var o=n(0),s=n(18),c=n(11),l=n(21),u=n(7),d=n(10),f=n(22),p=n(23),m=n(2),h=(g.layoutTopContextsAfter=function(e){for(;e.next.isSome;)e.topContext.update(),e=e.next.toNullable();e.topContext.update()},g.prototype.constructLabelViewsForLine=function(e){var t=this,n=this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map(function(n){return new u.LabelView.Entity(n,e.topContext,t.config)});return n.map(function(e){return t.labelViewRepository.add(e)}),n.map(function(t){return e.topContext.addChild(t)}),n},g.prototype.constructConnectionsForLine=function(e){var t=this;return this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map(function(n){var r=n.sameLineConnections.filter(function(e){return!t.connectionViewRepository.has(e.id)}).map(function(n){return new d.ConnectionView.Entity(n,e.topContext,t.config)});return r.map(function(e){return t.connectionViewRepository.add(e)}),r.map(function(t){return e.topContext.addChild(t)}),r}).reduce(function(e,t){return e.concat(t)},[])},Object.defineProperty(g.prototype,`height`,{get:function(){var e=this;return this.lines.reduce(function(t,n){return t+n.height+e.contentFont.fontSize*(e.config.lineHeight-1)},20)},enumerable:!0,configurable:!0}),g.createMarkerElement=function(){var e=document.createElementNS(o.SVGNS,`path`);e.setAttribute(`d`,`M0,4 L0,8 L6,6 L0,4 L0,8`),e.setAttribute(`stroke`,`#000000`),e.setAttribute(`fill`,`#000000`);var t=document.createElementNS(o.SVGNS,`marker`);return t.setAttribute(`id`,`marker-arrow`),t.setAttribute(`markerWidth`,`8`),t.setAttribute(`markerHeight`,`10`),t.setAttribute(`orient`,`auto`),t.setAttribute(`refX`,`5`),t.setAttribute(`refY`,`6`),t.appendChild(e),t},g.prototype.contentWidth=function(e,t){return this.contentFont.widthOf(this.store.contentSlice(e,t))},g.prototype.removeLine=function(e){var t=this;e.remove(),e.topContext.children.forEach(function(e){e instanceof u.LabelView.Entity?t.labelViewRepository.delete(e):e instanceof d.ConnectionView.Entity&&t.connectionViewRepository.delete(e)})},g.prototype.registerEventHandlers=function(){var e=this;this.textElement.onmouseup=function(t){window.getSelection().type===`Range`?e.root.textSelectionHandler.textSelected():e.config.contentEditable&&e.contentEditor.caretChanged(t.clientY)},this.store.labelRepo.on(`created`,this.onLabelCreated.bind(this)),this.store.labelRepo.on(`removed`,function(t){var n=e.labelViewRepository.get(t.id);n.lineIn.topContext.removeChild(n),n.remove(),e.labelViewRepository.delete(n),n.lineIn.topContext.update(),n.lineIn.update(),g.layoutTopContextsAfter(n.lineIn),e.config.contentEditable&&e.contentEditor.update()}),this.store.connectionRepo.on(`created`,this.onConnectionCreated.bind(this)),this.store.connectionRepo.on(`removed`,function(t){var n=e.connectionViewRepository.get(t.id);n.lineIn.topContext.removeChild(n),n.remove(),e.connectionViewRepository.delete(n),n.lineIn.topContext.update(),n.lineIn.update(),g.layoutTopContextsAfter(n.lineIn),e.config.contentEditable&&e.contentEditor.update()}),this.config.contentEditable&&this.store.on(`contentSpliced`,this.onContentSpliced.bind(this))},g.prototype.rerenderLines=function(e,t){for(var n,r,o,c,l,u,d,f=this.lines[0].svgElement.parentElement,p=e;p<=t;++p)this.removeLine(this.lines[p]);var h=this.lines[e],g=this.lines[t],_=s.Line.Service.divide(this,h.startIndex,g.endIndex);for(_.length!==0&&(_[0].last=h.last,h.last.map(function(e){return e.next=m.some(_[0])}),_[_.length-1].next=g.next,g.next.map(function(e){return e.last=m.some(_[_.length-1])}),(n=this.lines).splice.apply(n,i([e,t-e+1],_)),e===0?g.next.isSome?_[0].insertBefore(g.next):_[0].insertInto(f):_[0].insertAfter(h.last)),p=1;p<_.length;++p)_[p].insertAfter(m.some(_[p-1]));function v(e){y.constructLabelViewsForLine(e).map(function(t){return e.topContext.renderChild(t)})}var y=this;try{for(var b=a(_),x=b.next();!x.done;x=b.next())v(O=x.value)}catch(e){r={error:e}}finally{try{x&&!x.done&&(o=b.return)&&o.call(b)}finally{if(r)throw r.error}}function S(e){C.constructConnectionsForLine(e).map(function(t){return e.topContext.renderChild(t)})}var C=this;try{for(var w=a(_),T=w.next();!T.done;T=w.next())S(O=T.value)}catch(e){c={error:e}}finally{try{T&&!T.done&&(l=w.return)&&l.call(w)}finally{if(c)throw c.error}}try{for(var E=a(_),D=E.next();!D.done;D=E.next()){var O;(O=D.value).update(),O.topContext.update()}}catch(e){u={error:e}}finally{try{D&&!D.done&&(d=E.return)&&d.call(E)}finally{if(u)throw u.error}}},g.prototype.onLabelCreated=function(e){var t=r(this.findRangeInLines(e.startIndex,e.endIndex),2),n=t[0];if(t[1]===n+1){var i=this.lines[n],a=new u.LabelView.Entity(e,i.topContext,this.config);this.labelViewRepository.add(a),i.topContext.addChild(a),i.topContext.renderChild(a),i.topContext.update(),i.update()}else{var o=this.findHardLineEndsInIndex(n);this.rerenderLines(n,o)}g.layoutTopContextsAfter(this.lines[n]),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},g.prototype.findRangeInLines=function(e,t){var n=0,r=0;return this.lines.forEach(function(i,a){i.startIndex<=e&&e<i.endIndex&&(n=a),i.startIndex<=t-1&&t-1<i.endIndex&&(r=a+1)}),[n,r]},g.prototype.onConnectionCreated=function(e){var t=this.labelViewRepository.get(e.priorLabel.id),n=t.lineIn.topContext,r=new d.ConnectionView.Entity(e,n,this.config);this.connectionViewRepository.add(r),n.addChild(r),n.renderChild(r),n.update(),t.lineIn.update(),g.layoutTopContextsAfter(t.lineIn),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},g.prototype.onContentSpliced=function(e,t,n){t!==``&&this.onRemoved(e,t),n!==``&&this.onInserted(e,n)},g.prototype.onRemoved=function(e,t){var n=r(this.findRangeInLines(e,e+1),2),i=n[0];n[1],this.lines[i].startIndex===e-t.length?this.lines[i].move(-t.length):this.lines[i].inserted(-t.length);for(var a=i+1;a<this.lines.length;)this.lines[a].move(-t.length),++a;var o=this.findHardLineEndsInIndex(i);if(t===`
`&&this.lines[i].isBlank){var s=this.lines[i].last,c=this.lines[i].next;this.lines[i].remove(),this.lines.splice(i,1),s.map(function(e){return e.next=c}),c.map(function(e){return e.last=s})}else this.rerenderLines(i,o);g.layoutTopContextsAfter(this.lines[o-1]);var l=Array.from(t).filter(function(e){return e===`
`}).length;l===0?(this.contentEditor.characterIndex-=t.length,this.contentEditor.avoidInLabel(`forward`)):0<=this.contentEditor.lineIndex-l&&(this.contentEditor.lineIndex-=l,this.contentEditor.characterIndex=this.contentEditor.line.content.length,this.contentEditor.avoidInLabel(`forward`)),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},g.prototype.onInserted=function(e,t){var n=r(this.findRangeInLines(e,e+1),2),i=n[0];n[1],this.lines[i].startIndex===e+t.length?this.lines[i].move(t.length):this.lines[i].inserted(t.length);for(var a=i+1;a<this.lines.length;)this.lines[a].move(t.length),++a;var o=this.findHardLineEndsInIndex(i);this.rerenderLines(i,o),g.layoutTopContextsAfter(this.lines[o]);var s=Array.from(t),c=s.filter(function(e){return e===`
`}).length,l=s.lastIndexOf(`
`),u=t.length-l;c===0?this.contentEditor.characterIndex+=t.length:(this.contentEditor.lineIndex+=c,this.contentEditor.characterIndex=u-1),this.contentEditor.avoidInLabel(`forward`),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},g.prototype.findHardLineEndsInIndex=function(e){var t;for(t=e;t<this.lines.length-1&&!this.lines[t].endWithHardLineBreak;++t);return t},g.prototype.collectStyle=function(){var e=document.createElementNS(o.SVGNS,`style`),t=`
        `+this.config.contentClasses.map(function(e){return`.`+e}).join(`,`)+` {
            font-family: `+this.contentFont.fontFamily+`;
            font-weight: `+this.contentFont.fontWeight+`;
            font-size: `+this.contentFont.fontSize+`px;
            line-height: `+this.contentFont.lineHeight+`px;
        }
        `,n=`
        `+this.config.labelClasses.map(function(e){return`.`+e}).join(`,`)+` {
            font-family: `+this.labelFont.fontFamily+`;
            font-weight: `+this.labelFont.fontWeight+`;
            font-size: `+this.labelFont.fontSize+`px;
        }
        `,r=this.config.connectionClasses.map(function(e){return`.`+e}).join(`,`),i=this.config.connectionClasses.map(function(e){return`.`+e+`-line`}).join(`,`),a=`
        `+r+` {
            font-family: `+this.connectionFont.fontFamily+`;
            font-weight: `+this.connectionFont.fontWeight+`;
            font-size: `+this.connectionFont.fontSize+`px;
        }
        `+i+` {
            stroke: #000;
        }
        `;return e.innerHTML=t+n+a,e},Object.defineProperty(g.prototype,`paddingLeft`,{get:function(){var e=this;return Math.max.apply(Math,i(Array.from(this.store.labelCategoryRepo.values()).map(function(t){return e.labelFont.widthOf(t.text)})))/2+1},enumerable:!0,configurable:!0}),g);function g(e,t,n){var a,m,h;this.root=e,this.svgElement=t,this.config=n,this.contentEditor=null,this.store=e.store,this.labelViewRepository=new u.LabelView.Repository,this.connectionViewRepository=new d.ConnectionView.Repository,this.markerElement=g.createMarkerElement(),this.svgElement.appendChild(this.markerElement),this.textElement=document.createElementNS(o.SVGNS,`text`),this.textElement.style.whiteSpace=`pre`,this.textElement.style.wordWrap=`normal`,this.svgElement.appendChild(this.textElement);var _=Array.from(this.store.labelCategoryRepo.values()).map(function(e){return e.text}).join(``),v=Array.from(this.store.connectionCategoryRepo.values()).map(function(e){return e.text}).join(``);a=r(c.Font.Factory.startBatch(t,this.textElement).thanCreate(n.contentClasses,this.store.content).thanCreate(n.labelClasses,_).thanCreate(n.connectionClasses,v).endBatch(),3),this.contentFont=a[0],this.labelFont=a[1],this.connectionFont=a[2];var y=this.labelFont.lineHeight+2+2*n.labelPadding+n.bracketWidth;this.topContextLayerHeight=2*n.topContextMargin+Math.max(y,this.connectionFont.lineHeight),(m=this.textElement.classList).add.apply(m,i(n.contentClasses)),this.labelCategoryElementFactoryRepository=new l.LabelCategoryElement.FactoryRepository(this,n),this.connectionCategoryElementFactoryRepository=new f.ConnectionCategoryElement.FactoryRepository(this,n),this.lineMaxWidth=t.width.baseVal.value-2*this.paddingLeft,this.lines=s.Line.Service.divide(this,0,this.store.content.length),this.lines.map(this.constructLabelViewsForLine.bind(this)),this.lines.map(this.constructConnectionsForLine.bind(this));var b=this.lines.map(function(e){return e.render()});if((h=this.textElement).append.apply(h,i(b)),this.svgElement.style.height=this.height.toString()+`px`,this.registerEventHandlers(),this.config.contentEditable){this.contentEditor=new p.ContentEditor(this);var x=r(this.contentEditor.render(),2),S=x[0],C=x[1];this.svgElement.appendChild(S),this.svgElement.parentNode.insertBefore(C,this.svgElement)}this.svgElement.appendChild(this.collectStyle())}t.View=h},function(e,t,n){var r=this&&this.__read||function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(t===void 0||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o},i=this&&this.__values||function(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(t,`__esModule`,{value:!0});var a=n(2),o=n(0),s=n(19),c=n(20);(function(e){var t=(Object.defineProperty(n.prototype,`startIndex`,{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`endIndex`,{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),n.prototype.move=function(e){this._startIndex+=e,this._endIndex+=e},n.prototype.inserted=function(e){this._endIndex+=e},Object.defineProperty(n.prototype,`dy`,{get:function(){return this.last.match(this.view.contentFont.fontSize*this.config.lineHeight,this.view.contentFont.topToBaseLine)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`height`,{get:function(){return this.topContext.layer*this.view.topContextLayerHeight+this.view.contentFont.fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`y`,{get:function(){var e=this;return c.takeWhile(this.view.lines,function(t){return t!==e}).reduce(function(t,n){return t+n.height+e.view.contentFont.fontSize*(e.config.lineHeight-1)},0)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`isBlank`,{get:function(){return this.view.store.content.slice(this.startIndex,this.endIndex-1)===``},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`content`,{get:function(){return this.endWithHardLineBreak?this.isBlank?``:this.view.store.content.slice(this.startIndex,this.endIndex-1):this.view.store.content.slice(this.startIndex,this.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,`endWithHardLineBreak`,{get:function(){return this.view.store.content[this.endIndex-1]===`
`},enumerable:!0,configurable:!0}),n.prototype.update=function(){this.svgElement.innerHTML=this.content.replace(/ /g,`&nbsp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`),this.isBlank&&(this.svgElement.style.fontSize=this.view.contentFont.fontSize/4+`px`),this.svgElement.setAttribute(`x`,this.view.paddingLeft.toString()),this.svgElement.setAttribute(`dy`,this.dy.toString()+`px`)},n.prototype.render=function(){this.svgElement=document.createElementNS(o.SVGNS,`tspan`);var e=r(this.topContext.render(),2),t=e[0],n=e[1];return this.view.svgElement.insertBefore(t,this.view.textElement),this.view.markerElement.insertAdjacentElement(`afterend`,n),Object.assign(this.svgElement,{annotatorElement:this}),this.update(),this.svgElement},n.prototype.remove=function(){this.topContext.remove(),this.svgElement.remove()},n.prototype.insertBefore=function(e){var t=this;this.render(),e.map(function(e){e.svgElement.parentNode.insertBefore(t.svgElement,e.svgElement),e.topContext.svgElement.parentNode.insertBefore(t.topContext.svgElement,e.topContext.svgElement),e.topContext.backgroundElement.parentNode.insertBefore(t.topContext.backgroundElement,e.topContext.backgroundElement)})},n.prototype.insertAfter=function(e){var t=this;this.render(),e.map(function(e){e.svgElement.insertAdjacentElement(`afterend`,t.svgElement),e.topContext.svgElement.insertAdjacentElement(`afterend`,t.topContext.svgElement),e.topContext.backgroundElement.insertAdjacentElement(`afterend`,t.topContext.backgroundElement)})},n.prototype.insertInto=function(e){this.render(),e.appendChild(this.svgElement)},n);function n(e,t,n,r,i){this.last=n,this.next=r,this.view=i,this.svgElement=null,this._startIndex=e,this._endIndex=t,this.topContext=new s.TopContext(this),this.config=i.config}e.ValueObject=t;var l=(Object.defineProperty(u.prototype,`store`,{get:function(){return this.view.store},enumerable:!0,configurable:!0}),u.prototype.divide=function(e,t){var n,r;this.init();var o=e,s=e+1;do{var c=this.mergeLabel(s),l=this.mergeWord(c),u=c===s&&c===l;this.store.content[s-1]===`
`?(this.tokenQueue.length===0?this.reduce(s-1,s):this.reduce(this.tokenQueue[0].startIndex,s),o=s):u&&(this.shiftWithAutoReduce({startIndex:o,endIndex:s}),o=s),++s}while(o<t);function d(e){f.map(function(t){return t.next=a.some(e)}),e.last=f,f=a.some(e)}this.tokenQueue.length!==0&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex);var f=a.none;try{for(var p=i(this.result),m=p.next();!m.done;m=p.next())d(m.value)}catch(e){n={error:e}}finally{try{m&&!m.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}return this.result},u.prototype.init=function(){this.result=[],this.tokenQueue=[]},u.prototype.mergeLabel=function(e){return this.store.labelRepo.getEntitiesCross(e-1).some(function(t){return t.endIndex>e})?this.store.labelRepo.getEntitiesCross(e-1).filter(function(t){return t.endIndex>e}).sort(function(e,t){return t.endIndex-e.endIndex})[0].endIndex:e},u.prototype.mergeWord=function(e){u.wordReg.lastIndex=0;var t=u.wordReg.exec(this.store.contentSlice(e-1,e+1));return t===null?e:t[0].length===2?e+1:e},u.prototype.reduce=function(t,n){var r=new e.ValueObject(t,n,a.none,a.none,this.view);this.result.push(r),this.tokenQueue=[]},u.prototype.shiftWithAutoReduce=function(e){var t=this.tokenQueue.length===0?0:this.view.contentWidth(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),n=this.view.contentWidth(e.startIndex,e.endIndex);this.tokenQueue.length!==0&&t+n>this.view.lineMaxWidth&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),n>this.view.lineMaxWidth?this.reduce(e.startIndex,e.endIndex):this.tokenQueue.push(e)},u.wordReg=/([a-zA-z][a-zA-Z0-9']*[-|.]?)|([+\-]?[0-9.][0-9.%]*)/g,u);function u(e){this.view=e,this.result=[],this.tokenQueue=[]}(e.Service||={}).divide=function(e,t,n){return new l(e).divide(t,n)}})(t.Line||={})},function(e,t,n){var r=this&&this.__read||function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(t===void 0||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},a=this&&this.__values||function(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(t,`__esModule`,{value:!0});var o=n(0),s=n(6),c=n(10),l=n(4),u=n(7),d=(Object.defineProperty(f.prototype,`layer`,{get:function(){return this.children.size===0?0:Math.max.apply(Math,i(Array.from(this.children).map(function(e){return e.layer})))},enumerable:!0,configurable:!0}),f.prototype.update=function(){var e=this;this.children.forEach(function(e){return e.update()}),Array.from(this.children).filter(function(e){return e instanceof u.LabelView.Entity}).map(function(t){t.store.allConnections.forEach(function(n){if(e.belongTo.view.connectionViewRepository.has(n.id)){var r=e.belongTo.view.connectionViewRepository.get(n.id);r.mayNotSameLineLabelView===t&&r.update()}})})},f.prototype.render=function(){var e=this;return this.svgElement=document.createElementNS(o.SVGNS,`g`),this.backgroundElement=document.createElementNS(o.SVGNS,`g`),this.children.forEach(function(t){e.renderChild(t)}),this.update(),[this.svgElement,this.backgroundElement]},f.prototype.addChild=function(e){var t,n,r=this.layer,i=!1;e instanceof c.ConnectionView.Entity&&(e.layer=e.sameLineLabelView.layer);do{++e.layer,i=!1;try{for(var o=(t=void 0,a(this.children)),l=o.next();!l.done;l=o.next()){var u=l.value;if(s.overLaps(e,u)){i=!0;break}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}while(i);return this.children.add(e),this.layer-r},f.prototype.renderChild=function(e){l.assert(this.children.has(e));var t=e.render();this.svgElement.appendChild(t)},f.prototype.removeChild=function(e){l.assert(this.children.has(e)),this.children.delete(e)},f.prototype.remove=function(){this.svgElement.remove(),this.backgroundElement.remove()},f);function f(e){this.backgroundElement=null,this.svgElement=null,this.children=new Set,this.belongTo=e}t.TopContext=d},function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0});var r=n(2);t.lookup=function(e,t){return e.length<=t?r.none:r.some(e[t])},t.takeWhile=function(e,t){var n;for(n=0;n<e.length&&t(e[n]);++n);return e.slice(0,n)}},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__values||function(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(t,`__esModule`,{value:!0});var o,s,c,l,u=n(1),d=n(0),f=n(5);function p(e,t,n,r){this.store=e,this.font=t,this.padding=n,this.svgElement=document.createElementNS(d.SVGNS,`g`);var i=document.createElementNS(d.SVGNS,`rect`);i.setAttribute(`fill`,/^#/g.test(e.color)?f.addAlpha(e.color,r):e.color),i.setAttribute(`stroke`,e.borderColor),i.setAttribute(`width`,this.width.toString()),i.setAttribute(`height`,(t.lineHeight+2*n).toString()),i.setAttribute(`rx`,(2*n).toString()),i.style.cursor=`pointer`;var a=document.createElementNS(d.SVGNS,`text`);a.style.userSelect=`none`,a.style.cursor=`pointer`,a.textContent=e.text,a.setAttribute(`dx`,n.toString()),a.setAttribute(`dy`,t.topToBaseLine+n+`px`),this.svgElement.appendChild(i),this.svgElement.appendChild(a)}function m(e,t){var n,r,i=c.call(this)||this;try{for(var o=a(e.store.labelCategoryRepo.values()),l=o.next();!l.done;l=o.next()){var u=l.value;i.add(new s(u,e.labelFont,t.labelPadding,t.labelOpacity))}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i}o=t.LabelCategoryElement||={},Object.defineProperty(p.prototype,`width`,{get:function(){return this.font.widthOf(this.store.text)+2*this.padding},enumerable:!0,configurable:!0}),p.prototype.create=function(){return this.svgElement.cloneNode(!0)},Object.defineProperty(p.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),s=p,c=u.Base.Repository,i(m,c),l=m,o.FactoryRepository=l},function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__read||function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(t===void 0||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e},s=this&&this.__values||function(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(t,`__esModule`,{value:!0});var c,l,u,d,f=n(1),p=n(0);function m(e,t,n){var r;this.store=e,this.svgElement=document.createElementNS(p.SVGNS,`g`);var i=document.createElementNS(p.SVGNS,`rect`);i.setAttribute(`fill`,`#ffffff`),i.setAttribute(`width`,t.widthOf(e.text).toString()),i.setAttribute(`height`,t.lineHeight.toString());var a=document.createElementNS(p.SVGNS,`text`);(r=a.classList).add.apply(r,o(n)),a.textContent=e.text,a.setAttribute(`dy`,t.topToBaseLine+`px`),this.svgElement.appendChild(i),this.svgElement.appendChild(a)}function h(e,t){var n,r,i=u.call(this)||this;i.config=t;try{for(var a=s(e.store.connectionCategoryRepo.values()),o=a.next();!o.done;o=a.next()){var c=o.value;u.prototype.add.call(i,new l(c,e.connectionFont,t.connectionClasses))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}c=t.ConnectionCategoryElement||={},Object.defineProperty(m.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),m.prototype.create=function(){return this.svgElement.cloneNode(!0)},l=m,u=f.Base.Repository,i(h,u),d=h,c.FactoryRepository=d},function(e,t,n){var r=this&&this.__read||function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(t===void 0||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,`__esModule`,{value:!0});var a=n(0),o=n(11),s=n(7),c=(Object.defineProperty(l.prototype,`characterIndex`,{get:function(){return this._characterIndex},set:function(e){this.view.lines[this._lineIndex].isBlank?this._characterIndex=0:this._characterIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,`lineIndex`,{get:function(){return this._lineIndex},set:function(e){this._lineIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,`line`,{get:function(){return this.view.lines[this.lineIndex]},enumerable:!0,configurable:!0}),l.prototype.render=function(){var e=this;return this.constructCaretElement(),this.constructHiddenTextAreaElement(),this.parentSVGYOffset=this.view.svgElement.getBoundingClientRect().top-document.getElementsByTagName(`html`)[0].getBoundingClientRect().top,this.hiddenTextAreaElement.onkeyup=function(t){if(!e.inComposition){switch(t.key){case`ArrowLeft`:e.characterIndex===0?e.line.last.isSome&&(--e.lineIndex,e.characterIndex=e.line.content.length):(--e.characterIndex,e.avoidInLabel(`backward`));break;case`ArrowRight`:e.characterIndex>=e.line.content.length||e.line.isBlank?e.line.next.isSome&&(++e.lineIndex,e.characterIndex=0):(++e.characterIndex,e.avoidInLabel(`forward`));break;case`ArrowUp`:e.line.last.isSome&&--e.lineIndex,e.characterIndex=Math.min(e.characterIndex,e.line.content.length),e.avoidInLabel(`forward`);break;case`ArrowDown`:e.line.next.isSome&&++e.lineIndex,e.characterIndex=Math.min(e.characterIndex,e.line.content.length),e.avoidInLabel(`forward`);break;case`Backspace`:var n=e.line.startIndex+e.characterIndex-1;e.view.root.emit(`contentDelete`,n,1);break;default:if(e.hiddenTextAreaElement.value!==``){o.Font.Service.measureMore(e.view.contentFont,e.hiddenTextAreaElement.value,e.view.config.contentClasses,e.view.textElement);var r=e.view.lines[e._lineIndex].startIndex+e.characterIndex;e.view.root.emit(`contentInput`,r,e.hiddenTextAreaElement.value),e.hiddenTextAreaElement.value=``}}e.update()}},this.hiddenTextAreaElement.addEventListener(`compositionstart`,function(){e.inComposition=!0}),this.hiddenTextAreaElement.addEventListener(`compositionend`,function(){e.inComposition=!1}),this.update(),this.hiddenTextAreaElement.style.opacity=`0`,[this.cursorElement,this.hiddenTextAreaElement]},l.prototype.avoidInLabel=function(e){for(var t=this.line.startIndex+this.characterIndex,n=Array.from(this.line.topContext.children).filter(function(e){return e instanceof s.LabelView.Entity}),r=n.find(function(e){return e.store.startIndex<=t-1&&t<e.store.endIndex});r!==void 0;)e===`forward`?++this.characterIndex:--this.characterIndex,t=this.line.startIndex+this.characterIndex,r=n.find(function(e){return e.store.startIndex<=t-1&&t<e.store.endIndex})},l.prototype.update=function(){var e=this.view.paddingLeft+this.view.contentFont.widthOf(this.line.content.slice(0,this.characterIndex));this.cursorElement.setAttribute(`d`,`
            M`+e+`,`+this.line.y+`
            L`+e+`,`+(this.line.y+this.view.contentFont.lineHeight)+`
        `),this.hiddenTextAreaElement.style.top=this.parentSVGYOffset+this.line.y+`px`,this.hiddenTextAreaElement.style.left=this.cursorElement.getBoundingClientRect().left+`px`},l.prototype.caretChanged=function(e){var t=window.getSelection();if(t.type===`Caret`){var n=document.querySelector(`svg`).getClientRects()[0];if(t.anchorNode.parentNode!==null){var r=t.anchorNode.parentNode.getExtentOfChar(0);if(n.top+r.y+this.view.contentFont.lineHeight<=e){var i=t.anchorNode.parentNode.nextSibling.annotatorElement;this._lineIndex=this.view.lines.indexOf(i),this.characterIndex=0,this.avoidInLabel(`forward`)}else i=t.anchorNode.parentNode.annotatorElement,this._lineIndex=this.view.lines.indexOf(i),this.characterIndex=t.anchorOffset,this.avoidInLabel(`forward`);this.update(),this.hiddenTextAreaElement.focus({preventScroll:!0})}}},l.prototype.constructHiddenTextAreaElement=function(){var e;this.hiddenTextAreaElement=document.createElement(`textarea`),this.hiddenTextAreaElement.setAttribute(`autocorrect`,`off`),this.hiddenTextAreaElement.setAttribute(`autocapitalize`,`off`),this.hiddenTextAreaElement.setAttribute(`spellcheck`,`false`),(e=this.hiddenTextAreaElement.classList).add.apply(e,i(this.view.config.contentClasses)),this.hiddenTextAreaElement.style.position=`absolute`,this.hiddenTextAreaElement.style.padding=`0`,this.hiddenTextAreaElement.style.width=`100vw`,this.hiddenTextAreaElement.style.height=`1em`,this.hiddenTextAreaElement.style.outline=`none`,this.hiddenTextAreaElement.style.zIndex=`-1`,this.hiddenTextAreaElement.style.borderStyle=`none`,this.hiddenTextAreaElement.style.fontFamily=this.view.contentFont.fontFamily,this.hiddenTextAreaElement.style.fontSize=this.view.contentFont.fontSize+`px`,this.hiddenTextAreaElement.style.fontWeight=this.view.contentFont.fontWeight,this.hiddenTextAreaElement.style.opacity=`0`},l.prototype.constructCaretElement=function(){this.cursorElement=document.createElementNS(a.SVGNS,`path`),this.cursorElement.setAttribute(`stroke`,`#000000`),this.cursorElement.setAttribute(`stroke-width`,`1.5`),this.cursorElement.style.animationName=`cursor`,this.cursorElement.style.animationDuration=`0.75s`,this.cursorElement.style.animationTimingFunction=`ease-out`,this.cursorElement.style.animationDirection=`alternate`,this.cursorElement.style.animationIterationCount=`infinite`},l.prototype.hide=function(){this.cursorElement.style.display=`none`},l.prototype.show=function(){this.cursorElement.style.display=`inline`},l.prototype.remove=function(){this.hiddenTextAreaElement.remove()},l);function l(e){this.view=e,this.cursorElement=null,this.hiddenTextAreaElement=null,this.parentSVGYOffset=null;var t=document.getElementsByTagName(`head`)[0],n=document.createElement(`style`);n.innerHTML=`@keyframes cursor { from { opacity: 0; } to { opacity: 1; }  }`,t.appendChild(n),this._lineIndex=0,this._characterIndex=0,this.inComposition=!1}t.ContentEditor=c},function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0});var r={contentClasses:[`poplar-annotation-content`],labelClasses:[`poplar-annotation-label`],connectionClasses:[`poplar-annotation-connection`],labelPadding:2,lineHeight:1.5,topContextMargin:3,bracketWidth:8,allowMultipleLabel:`differentCategory`,allowMultipleConnection:`differentCategory`,labelWidthCalcMethod:`max`,connectionWidthCalcMethod:`line`,labelOpacity:90,defaultLabelColor:`#ff9d61`,selectingAreaStrip:/[\n ]/,unconnectedLineStyle:`curve`,contentEditable:!0};t.parseInput=function(e){var t={};for(var n in r)t[n]=e[n]===void 0?r[n]:e[n];return t}},function(e,t,n){var r=this&&this.__read||function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(t===void 0||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o};Object.defineProperty(t,`__esModule`,{value:!0});var i=n(2),a=n(4),o=(s.prototype.getSelectionInfo=function(){var e,t=this,n=window.getSelection();a.assert(n.type===`Range`);var o,s,c,l,u=null,d=null;try{u=n.anchorNode.parentNode,d=n.focusNode.parentNode}catch{return null}try{if(o=u.annotatorElement,s=d.annotatorElement,o.view!==this.root.view||s.view!==this.root.view)return null;c=o.startIndex+n.anchorOffset,l=s.startIndex+n.focusOffset}catch{return null}return l<c&&(e=r([l,c],2),c=e[0],l=e[1]),i.fromNullable(this.config.selectingAreaStrip).map(function(e){for(;e.test(t.root.store.content[c]);)++c;for(;e.test(t.root.store.content[l-1]);)--l}),l<=c?null:{startIndex:c,endIndex:l}},s.prototype.textSelected=function(){var e,t=this.getSelectionInfo();t&&this.root.emit(`textSelected`,t.startIndex,t.endIndex),(e=window.getSelection())==null||e.removeAllRanges()},s);function s(e,t){this.root=e,this.config=t}t.TextSelectionHandler=o},function(e,t,n){var r=this&&this.__read||function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(t===void 0||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,`__esModule`,{value:!0});function a(e,t){var n,r=this;this.root=e,this.config=t,this.lastSelection=s.none,this.svgElement=document.createElementNS(o.SVGNS,`path`),(n=this.svgElement.classList).add.apply(n,i(e.view.config.connectionClasses.map(function(e){return e+`-line`}))),this.svgElement.setAttribute(`fill`,`none`),this.svgElement.style.markerEnd=`url(#marker-arrow)`,this.root.on(`labelClicked`,function(e){r.lastSelection.isSome?(r.root.emit(`twoLabelsClicked`,r.lastSelection.toNullable().id,e),r.svgElement.remove(),r.svgElement.setAttribute(`d`,``),r.lastSelection=s.none):(r.lastSelection=s.some(r.root.view.labelViewRepository.get(e)),r.root.view.svgElement.insertBefore(r.svgElement,r.root.view.svgElement.firstChild))}),this.root.view.svgElement.onmousemove=function(e){r.lastSelection.map(function(n){var i=n.labelLeft+1,a=n.labelRight-1,o=n.globalY+1,s=e.clientX-r.root.view.svgElement.getBoundingClientRect().left,c=e.clientY-r.root.view.svgElement.getBoundingClientRect().top,l=(i+a)/2<s?i:a;if(t.unconnectedLineStyle===`straight`)r.svgElement.setAttribute(`d`,`
                    M`+l+`,`+o+`
                    L`+s+`,`+c+`
                `);else if(t.unconnectedLineStyle===`curve`){var u=(i-s)/4,d=Math.min(o,c)-20;r.svgElement.setAttribute(`d`,`
                        M`+l+`,`+o+`
                        C`+(l-u)+`,`+d+`,`+(s+u)+`,`+d+`,`+s+`,`+c+`
                    `)}})},this.root.view.svgElement.oncontextmenu=function(e){r.lastSelection.map(function(){r.svgElement.remove(),r.svgElement.setAttribute(`d`,``),r.lastSelection=s.none,e.preventDefault()})}}var o=n(0),s=n(2);t.TwoLabelsClickedHandler=a},function(e,t,n){Object.defineProperty(t,`__esModule`,{value:!0});var r=n(9);(function(e){var t=(n.prototype.apply=function(e){e.connectionRepo.add(new r.Connection.Entity(null,this.categoryId,this.fromId,this.toId,e))},n);function n(e,t,n){this.categoryId=e,this.fromId=t,this.toId=n}e.CreateConnectionAction=t,e.Create=function(e,n,r){return new t(e,n,r)};var i=(a.prototype.apply=function(e){e.connectionRepo.delete(this.id)},a);function a(e){this.id=e}function o(e){return new i(e)}e.DeleteConnectionAction=i,e.Delete=o;var s=(c.prototype.apply=function(e){var t=e.connectionRepo.get(this.connectionId);o(this.connectionId).apply(e),e.connectionRepo.add(new r.Connection.Entity(this.connectionId,this.categoryId,t.fromId,t.toId,e))},c);function c(e,t){this.connectionId=e,this.categoryId=t}e.UpdateConnectionAction=s,e.Update=function(e,t){return new s(e,t)}})(t.Connection||={})},function(e,t,n){var r=this&&this.__values||function(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(t,`__esModule`,{value:!0});var i=n(8);(function(e){var t=(n.prototype.apply=function(e){if(e.content.slice(this.startIndex,this.endIndex).includes(`
`))throw Error(`Insert label across hard line is not supported now! Please remove the \\n in content first!`);e.labelRepo.add(new i.Label.Entity(null,this.categoryId,this.startIndex,this.endIndex,e))},n);function n(e,t,n){this.categoryId=e,this.startIndex=t,this.endIndex=n}e.CreateLabelAction=t,e.Create=function(e,n,r){return new t(e,n,r)};var a=(o.prototype.apply=function(e){var t,n;try{for(var i=r(e.labelRepo.get(this.id).allConnections),a=i.next();!a.done;a=i.next()){var o=a.value;e.connectionRepo.delete(o)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.labelRepo.delete(this.id)},o);function o(e){this.id=e}function s(e){return new a(e)}e.DeleteLabelAction=a,e.Delete=s;var c=(l.prototype.apply=function(e){var t=e.labelRepo.get(this.labelId),n=t.allConnections;s(this.labelId).apply(e),e.labelRepo.add(new i.Label.Entity(this.labelId,this.categoryId,t.startIndex,t.endIndex,e)),n.forEach(function(t){return e.connectionRepo.add(t)})},l);function l(e,t){this.labelId=e,this.categoryId=t}e.UpdateLabelAction=c,e.Update=function(e,t){return new c(e,t)}})(t.Label||={})},function(e,t,n){var r,i;function a(e,t,n){this.startIndex=e,this.removeLength=t,this.insert=n}Object.defineProperty(t,`__esModule`,{value:!0}),r=t.Content||={},a.prototype.apply=function(e){if(!e.config.contentEditable)throw Error(`Content edition is not on!`);e.spliceContent(this.startIndex,this.removeLength,this.insert)},i=a,r.SpliceAction=i,r.Splice=function(e,t,n){return new i(e,t,n)}}],e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(e){typeof Symbol<`u`&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:`Module`}),Object.defineProperty(e,`__esModule`,{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n||4&n&&typeof t==`object`&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,`default`,{enumerable:!0,value:t}),2&n&&typeof t!=`string`)for(var i in t)e.d(r,i,function(e){return t[e]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,`a`,n),n},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p=``,e(e.s=12);function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var t,n})}))(),labelCategoryDialog_default=_plugin_vue_export_helper_default(defineComponent({__name:`index`,props:mergeModels({LabelCategorys:{}},{visible:{default:!1},visibleModifiers:{}}),emits:mergeModels([`updateLable`],[`update:visible`]),setup(e,{emit:n}){let o=n,s=useModel(e,`visible`),c=ref(),u=()=>{c.value!==null&&o(`updateLable`,c.value),c.value=void 0};return watchEffect(()=>{}),(e,n)=>{let o=ElOption,p=ElSelect,m=ElDialog;return openBlock(),createElementBlock(`div`,null,[createVNode(m,{title:``,modelValue:s.value,"onUpdate:modelValue":n[1]||=e=>s.value=e,width:`240`},{default:withCtx(()=>[createVNode(p,{modelValue:c.value,"onUpdate:modelValue":n[0]||=e=>c.value=e,placeholder:``,onChange:u},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.LabelCategorys,e=>(openBlock(),createBlock(o,{key:e.id,label:e.text,value:e.id},{default:withCtx(()=>[createBaseVNode(`span`,{class:`w-3 h-3 mr-1 inline-block`,style:normalizeStyle({backgroundColor:e.color})},null,4),createBaseVNode(`span`,null,toDisplayString(e.text),1)]),_:2},1032,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1},8,[`modelValue`])])}}}),[[`__scopeId`,`data-v-291685b6`]]),connectionCategoryDialog_default=_plugin_vue_export_helper_default(defineComponent({__name:`index`,props:{visible:{type:Boolean,default:()=>!1},connectionCategories:{}},emits:[`update:visible`,`updateConnection`],setup(e,{emit:o}){let s=e,c=o,u=computed({get(){return s.visible},set(e){c(`update:visible`,e)}}),p=ref(),m=()=>{p.value!==null&&c(`updateConnection`,p.value),p.value=void 0};return(e,o)=>{let s=resolveComponent(`Link`),c=ElIcon,h=ElOption,_=ElSelect,y=ElDialog;return openBlock(),createElementBlock(`div`,null,[createVNode(y,{title:``,modelValue:u.value,"onUpdate:modelValue":o[1]||=e=>u.value=e,width:`300`},{default:withCtx(()=>[createVNode(_,{modelValue:p.value,"onUpdate:modelValue":o[0]||=e=>p.value=e,placeholder:``,onChange:m},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.connectionCategories,e=>(openBlock(),createBlock(h,{key:e.id,label:e.text,value:e.id},{default:withCtx(()=>[createVNode(c,{color:`#fb9776`,size:`16`,class:`mr-1 translate-y-[2px]`},{default:withCtx(()=>[createVNode(s)]),_:1}),createBaseVNode(`span`,null,toDisplayString(e.text),1)]),_:2},1032,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1},8,[`modelValue`])])}}}),[[`__scopeId`,`data-v-c44b241c`]]),_hoisted_1={class:`h-full`},_hoisted_2={class:`p-5`},_hoisted_3={class:`flex`},_hoisted_4={class:`editor w-1/2`},_hoisted_5={class:`ml-5 w-1/2`},_hoisted_6={class:`dark:border-dark-border mb-3 rounded border border-[#dedede] px-2 py-3`},_hoisted_7={class:`mt-4 flex items-center`},CategorySelectModes=function(e){return e[e.CREATE=0]=`CREATE`,e[e.UPDATE=1]=`UPDATE`,e}(CategorySelectModes||{}),text_annotation_default=_plugin_vue_export_helper_default(defineComponent({__name:`index`,setup(t){let n=ref(null),c=ref(``),u=ref(CategorySelectModes.CREATE),f=ref(!1),p=ref(!1),v=reactive({startIndex:-1,endIndex:-1,selectedId:-1,sourceId:-1,targetId:-1}),C={topContextMargin:0,connectionWidthCalcMethod:`line`,unconnectedLineStyle:`curve`,labelWidthCalcMethod:`label`},w=()=>{let e={content:c.value,labelCategories:[{id:0,text:``,color:`#fae88e`,borderColor:`#dfc33a`},{id:1,text:``,color:`#cdec90`,borderColor:`#98d918`},{id:2,text:``,color:`#7da1ed`,borderColor:`#265ac9`}],labels:[{id:0,categoryId:0,startIndex:0,endIndex:2},{id:1,categoryId:1,startIndex:8,endIndex:9},{id:2,categoryId:2,startIndex:23,endIndex:24}],connectionCategories:[{id:0,text:`1`},{id:1,text:`2`}],connections:[{id:0,categoryId:0,fromId:0,toId:1},{id:1,categoryId:1,fromId:1,toId:2}]},t=document.getElementById(`example`);n.value&&n.value.remove(),n.value=new import_dist.Annotator(e,t,C),n.value.on(`textSelected`,(e,t)=>{v.startIndex=e,v.endIndex=t,f.value=!0,u.value=CategorySelectModes.CREATE}),n.value.on(`labelRightClicked`,e=>{n.value.applyAction(import_dist.Action.Label.Delete(e))}),n.value.on(`labelDoubleClicked`,e=>{u.value=CategorySelectModes.UPDATE,v.selectedId=e,f.value=!0}),n.value.on(`twoLabelsClicked`,(e,t)=>{e!==t&&(v.sourceId=e,v.targetId=t,u.value=CategorySelectModes.CREATE,p.value=!0)}),n.value.on(`connectionDoubleClicked`,e=>{v.selectedId=e,u.value=CategorySelectModes.UPDATE,p.value=!0}),n.value.on(`connectionRightClicked`,e=>{n.value.applyAction(import_dist.Action.Connection.Delete(e))})},T=e=>{u.value===CategorySelectModes.CREATE?n.value.applyAction(import_dist.Action.Label.Create(e,v.startIndex,v.endIndex)):n.value.applyAction(import_dist.Action.Label.Update(v.selectedId,e)),f.value=!1},O=e=>{u.value===CategorySelectModes.CREATE?n.value.applyAction(import_dist.Action.Connection.Create(e,v.sourceId,v.targetId)):n.value.applyAction(import_dist.Action.Connection.Update(v.selectedId,e)),p.value=!1},k=()=>{let e=document.createElement(`a`);e.download=`data.json`,e.style.display=`none`;let t=new Blob([JSON.stringify(n.value.store.json,null,4)]);e.href=URL.createObjectURL(t),document.body.appendChild(e),e.click(),document.body.removeChild(e)},A=()=>{let e=document.createElement(`a`);e.download=`data.svg`,e.style.display=`none`;let t=new Blob([n.value.export()]);e.href=URL.createObjectURL(t),document.body.appendChild(e),e.click(),document.body.removeChild(e)},j=computed(()=>{if(n.value===null)return[];let e=[];for(let[t,r]of n.value.store.labelCategoryRepo)e.push(r);return e}),M=computed(()=>{if(n.value===null)return[];let e=[];for(let[t,r]of n.value.store.connectionCategoryRepo)e.push(r);return e}),N=computed(()=>{if(n.value===null)return[];let e=[],t=[];for(let[e,r]of n.value.store.labelCategoryRepo)t.push(r);for(let[t,r]of n.value.store.labelRepo)e.push(r.json);let r=e.reduce((e,t)=>(e.set(t.categoryId,(e.get(t.categoryId)||0)+1),e),new Map);return t.forEach(e=>{let t=e.id;r.has(t)&&(e.num=r.get(t))}),t});return onMounted(()=>{c.value=` `}),(e,t)=>{let o=ElLink,u=ElInput,v=ElButton,y=ElTag,S=ElBadge;return openBlock(),createElementBlock(`div`,_hoisted_1,[t[10]||=createBaseVNode(`h2`,{class:`title w-full`},``,-1),createBaseVNode(`div`,_hoisted_2,[createVNode(o,{href:`https://github.com/synyi/poplar/blob/master/doc/zh.md`,target:`_blank`},{default:withCtx(()=>t[3]||=[createTextVNode(`Poplar-annotator`)]),_:1}),createBaseVNode(`div`,_hoisted_3,[createBaseVNode(`div`,_hoisted_4,[t[5]||=createBaseVNode(`h4`,{class:`my-1`},``,-1),createVNode(u,{modelValue:c.value,"onUpdate:modelValue":t[0]||=e=>c.value=e,type:`textarea`,resize:`none`,rows:10,placeholder:``},null,8,[`modelValue`]),createVNode(v,{class:`mt-[10px]`,type:`primary`,onClick:w},{default:withCtx(()=>t[4]||=[createTextVNode(``)]),_:1})]),createBaseVNode(`div`,_hoisted_5,[t[8]||=createBaseVNode(`h4`,{class:`my-1`},``,-1),createBaseVNode(`div`,_hoisted_6,[(openBlock(!0),createElementBlock(Fragment,null,renderList(N.value,e=>(openBlock(),createBlock(S,{key:e.id,value:e.num,class:`item mr-4`,type:`warning`},{default:withCtx(()=>[createVNode(y,{hit:!0,color:e.color},{default:withCtx(()=>[createTextVNode(toDisplayString(e.text),1)]),_:2},1032,[`color`])]),_:2},1032,[`value`]))),128))]),t[9]||=createBaseVNode(`div`,{id:`example`,class:`dark:border-dark-border h-[300px] overflow-hidden rounded border border-[#dedede]`},null,-1),createBaseVNode(`div`,_hoisted_7,[withDirectives(createVNode(v,{type:`primary`,onClick:k},{default:withCtx(()=>t[6]||=[createTextVNode(`JSON`)]),_:1},512),[[vShow,n.value]]),withDirectives(createVNode(v,{type:`primary`,onClick:A},{default:withCtx(()=>t[7]||=[createTextVNode(`SVG`)]),_:1},512),[[vShow,n.value]])])])])]),createVNode(labelCategoryDialog_default,{visible:f.value,"onUpdate:visible":t[1]||=e=>f.value=e,LabelCategorys:j.value,onUpdateLable:T},null,8,[`visible`,`LabelCategorys`]),createVNode(connectionCategoryDialog_default,{visible:p.value,"onUpdate:visible":t[2]||=e=>p.value=e,connectionCategories:M.value,onUpdateConnection:O},null,8,[`visible`,`connectionCategories`])])}}}),[[`__scopeId`,`data-v-a33f485d`]]);export{text_annotation_default as default};