import{$ as ElButton,Ft as position_default,Jt as video_pause_default,Lr as toDisplayString,Mn as onMounted,Pn as openBlock,Sn as defineComponent,T as ElSlider,Ur as __toESM,Yn as withCtx,Yt as video_play_default,bn as createVNode,dr as unref,et as ElButtonGroup,gn as createElementBlock,n as car_default,nr as reactive,pn as createBaseVNode,yn as createTextVNode}from"./index-DzasR-yf.js";/* empty css            *//* empty css            *//* empty css            *//* empty css            *//* empty css            *//* empty css            */import{r as getloadGeo,t as getPlaceGeo}from"./common-Bpo4B_zZ.js";/* empty css            */import{t as require_leaflet_src}from"./leaflet-src-TMLMeRhc.js";var import_leaflet_src=__toESM(require_leaflet_src(),1),N=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),b=6371008.8,Z={centimeters:b*100,centimetres:b*100,degrees:b/111325,feet:b*3.28084,inches:b*39.37,kilometers:b/1e3,kilometres:b/1e3,meters:b,metres:b,miles:b/1609.344,millimeters:b*1e3,millimetres:b*1e3,nauticalmiles:b/1852,radians:1,yards:b*1.0936};function C(e,t,n){n===void 0&&(n={});var r={type:`Feature`};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function O(e,t,n){if(n===void 0&&(n={}),!e)throw Error(`coordinates is required`);if(!Array.isArray(e))throw Error(`coordinates must be an Array`);if(e.length<2)throw Error(`coordinates must be at least 2 numbers long`);if(!H(e[0])||!H(e[1]))throw Error(`coordinates must contain numbers`);return C({type:`Point`,coordinates:e},t,n)}function S(e,t,n){if(n===void 0&&(n={}),e.length<2)throw Error(`coordinates must be an array of two or more positions`);return C({type:`LineString`,coordinates:e},t,n)}function K(e,t){t===void 0&&(t=`kilometers`);var n=Z[t];if(!n)throw Error(t+` units is invalid`);return e*n}function Q(e,t){t===void 0&&(t=`kilometers`);var n=Z[t];if(!n)throw Error(t+` units is invalid`);return e/n}function F(e){return e%(2*Math.PI)*180/Math.PI}function M(e){return e%360*Math.PI/180}function H(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function X(e){return!!e&&e.constructor===Object}function J(e,t,n){if(e!==null)for(var r,i,a,o,s,c,l,u=0,d=0,f,p=e.type,m=p===`FeatureCollection`,h=p===`Feature`,g=m?e.features.length:1,_=0;_<g;_++){l=m?e.features[_].geometry:h?e.geometry:e,f=l?l.type===`GeometryCollection`:!1,s=f?l.geometries.length:1;for(var v=0;v<s;v++){var y=0,x=0;if(o=f?l.geometries[v]:l,o!==null){c=o.coordinates;var w=o.type;switch(u=0,w){case null:break;case`Point`:if(t(c,d,_,y,x)===!1)return!1;d++,y++;break;case`LineString`:case`MultiPoint`:for(r=0;r<c.length;r++){if(t(c[r],d,_,y,x)===!1)return!1;d++,w===`MultiPoint`&&y++}w===`LineString`&&y++;break;case`Polygon`:case`MultiLineString`:for(r=0;r<c.length;r++){for(i=0;i<c[r].length-u;i++){if(t(c[r][i],d,_,y,x)===!1)return!1;d++}w===`MultiLineString`&&y++,w===`Polygon`&&x++}w===`Polygon`&&y++;break;case`MultiPolygon`:for(r=0;r<c.length;r++){for(x=0,i=0;i<c[r].length;i++){for(a=0;a<c[r][i].length-u;a++){if(t(c[r][i][a],d,_,y,x)===!1)return!1;d++}x++}y++}break;case`GeometryCollection`:for(r=0;r<o.geometries.length;r++)if(J(o.geometries[r],t)===!1)return!1;break;default:throw Error(`Unknown Geometry Type`)}}}}}function Y(e,t){var n,r,i,a,o,s,c,l,u,d,f=0,p=e.type===`FeatureCollection`,m=e.type===`Feature`,h=p?e.features.length:1;for(n=0;n<h;n++){for(s=p?e.features[n].geometry:m?e.geometry:e,l=p?e.features[n].properties:m?e.properties:{},u=p?e.features[n].bbox:m?e.bbox:void 0,d=p?e.features[n].id:m?e.id:void 0,c=s?s.type===`GeometryCollection`:!1,o=c?s.geometries.length:1,i=0;i<o;i++){if(a=c?s.geometries[i]:s,a===null){if(t(null,f,l,u,d)===!1)return!1;continue}switch(a.type){case`Point`:case`LineString`:case`MultiPoint`:case`Polygon`:case`MultiLineString`:case`MultiPolygon`:if(t(a,f,l,u,d)===!1)return!1;break;case`GeometryCollection`:for(r=0;r<a.geometries.length;r++)if(t(a.geometries[r],f,l,u,d)===!1)return!1;break;default:throw Error(`Unknown Geometry Type`)}}f++}}function j(e,t){Y(e,function(e,n,r,i,a){var o=e===null?null:e.type;switch(o){case null:case`Point`:case`LineString`:case`Polygon`:return t(C(e,r,{bbox:i,id:a}),n,0)===!1?!1:void 0}var s;switch(o){case`MultiPoint`:s=`Point`;break;case`MultiLineString`:s=`LineString`;break;case`MultiPolygon`:s=`Polygon`;break}for(var c=0;c<e.coordinates.length;c++){var l=e.coordinates[c];if(t(C({type:s,coordinates:l},r),n,c)===!1)return!1}})}function $(e,t){j(e,function(e,n,r){var i=0;if(e.geometry){var a=e.geometry.type;if(!(a===`Point`||a===`MultiPoint`)){var o,s=0,c=0,l=0;if(J(e,function(a,u,d,f,p){if(o===void 0||n>s||f>c||p>l){o=a,s=n,c=f,l=p,i=0;return}if(t(S([o,a],e.properties),n,r,p,i)===!1)return!1;i++,o=a})===!1)return!1}}})}function tt(e,t,n){var r=n,i=!1;return $(e,function(e,a,o,s,c){r=i===!1&&n===void 0?e:t(r,e,a,o,s,c),i=!0}),r}function E(e){if(!e)throw Error(`coord is required`);if(!Array.isArray(e)){if(e.type===`Feature`&&e.geometry!==null&&e.geometry.type===`Point`)return e.geometry.coordinates;if(e.type===`Point`)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw Error(`coord must be GeoJSON Point or an Array of numbers`)}function et(e){return e.type===`Feature`?e.geometry:e}var it=typeof globalThis<`u`?globalThis:typeof window<`u`?window:typeof global<`u`?global:typeof self<`u`?self:{};function U(e,t,n){n===void 0&&(n={});var r=E(e),i=E(t),a=M(i[1]-r[1]),o=M(i[0]-r[0]),s=M(r[1]),c=M(i[1]),l=Math.sin(a/2)**2+Math.sin(o/2)**2*Math.cos(s)*Math.cos(c);return K(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n.units)}function B(e,t,n,r){r===void 0&&(r={});var i=E(e),a=M(i[0]),o=M(i[1]),s=M(n),c=Q(t,r.units),l=Math.asin(Math.sin(o)*Math.cos(c)+Math.cos(o)*Math.sin(c)*Math.cos(s));return O([F(a+Math.atan2(Math.sin(s)*Math.sin(c)*Math.cos(o),Math.cos(c)-Math.sin(o)*Math.sin(l))),F(l)],r.properties)}function T(e,t,n){if(n===void 0&&(n={}),n.final===!0)return st(e,t);var r=E(e),i=E(t),a=M(r[0]),o=M(i[0]),s=M(r[1]),c=M(i[1]),l=Math.sin(o-a)*Math.cos(c),u=Math.cos(s)*Math.sin(c)-Math.sin(s)*Math.cos(c)*Math.cos(o-a);return F(Math.atan2(l,u))}function st(e,t){var n=T(t,e);return n=(n+180)%360,n}function rt(e,t,n){n===void 0&&(n={});for(var r=et(e).coordinates,i=0,a=0;a<r.length&&!(t>=i&&a===r.length-1);a++)if(i>=t){var o=t-i;if(o){var s=T(r[a],r[a-1])-180;return B(r[a],o,s,n)}else return O(r[a])}else i+=U(r[a],r[a+1],n);return O(r[r.length-1])}function q(e,t){return t===void 0&&(t={}),tt(e,function(e,n){var r=n.geometry.coordinates;return e+U(r[0],r[1],t)},0)}function V(e,t,n,r){if(r||={},!X(r))throw Error(`options is invalid`);var i,a=[];if(e.type===`Feature`)i=e.geometry.coordinates;else if(e.type===`LineString`)i=e.coordinates;else throw Error(`input must be a LineString Feature or Geometry`);for(var o=i.length,s=0,c,l,u,d=0;d<i.length&&!(t>=s&&d===i.length-1);d++){if(s>t&&a.length===0){if(c=t-s,!c)return a.push(i[d]),S(a);l=T(i[d],i[d-1])-180,u=B(i[d],c,l,r),a.push(u.geometry.coordinates)}if(s>=n)return c=n-s,c?(l=T(i[d],i[d-1])-180,u=B(i[d],c,l,r),a.push(u.geometry.coordinates),S(a)):(a.push(i[d]),S(a));if(s>=t&&a.push(i[d]),d===i.length-1)return S(a);s+=U(i[d],i[d+1],r)}if(s<t&&i.length===o)throw Error(`Start position is beyond line`);var f=i[i.length-1];return S([f,f])}(function(e,t){(function(e,t){t(import_leaflet_src.default)})(it,function(e){e=e&&e.hasOwnProperty(`default`)?e.default:e;function t(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}var n=function(e,t){return(Math.atan2(t.y-e.y,t.x-e.x)*180/Math.PI+90+360)%360},r=function(e,t){var n=e.value;return e.isInPixels?n/t:n};function i(e){if(typeof e==`string`&&e.indexOf(`%`)!==-1)return{value:parseFloat(e)/100,isInPixels:!1};var t=e?parseFloat(e):0;return{value:t,isInPixels:t>0}}var a=function(e,t){return e.x===t.x&&e.y===t.y};function o(e){return e.reduce(function(e,r,i,o){if(i>0&&!a(r,o[i-1])){var s=o[i-1],c=e.length>0?e[e.length-1].distB:0,l=t(s,r);e.push({a:s,b:r,distA:c,distB:c+l,heading:n(s,r)})}return e},[])}function s(e,t){var n=o(e),i=n.length;if(i===0)return[];var a=n[i-1].distB,s=r(t.offset,a),l=r(t.endOffset,a),u=a*r(t.repeat,a),d=s>0?a*s:0,f=l>0?a*l:0,p=[],m=d;do p.push(m),m+=u;while(u>0&&m<a-f);var h=0,g=n[0];return p.map(function(e){for(;e>g.distB&&h<i-1;)h++,g=n[h];var t=(e-g.distA)/(g.distB-g.distA);return{pt:c(g.a,g.b,t),heading:g.heading}})}function c(e,t,n){return t.x===e.x?{x:e.x,y:e.y+(t.y-e.y)*n}:{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}(function(){var e=L.Marker.prototype._initIcon,t=L.Marker.prototype._setPos,n=L.DomUtil.TRANSFORM===`msTransform`;L.Marker.addInitHook(function(){var e=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;e&&=e[0]+`px `+e[1]+`px`,this.options.rotationOrigin=this.options.rotationOrigin||e||`center bottom`,this.options.rotationAngle=this.options.rotationAngle||0,this.on(`drag`,function(e){e.target._applyRotation()})}),L.Marker.include({_initIcon:function(){e.call(this)},_setPos:function(e){t.call(this,e),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+`Origin`]=this.options.rotationOrigin,n?this._icon.style[L.DomUtil.TRANSFORM]=`rotate(`+this.options.rotationAngle+`deg)`:this._icon.style[L.DomUtil.TRANSFORM]+=` rotateZ(`+this.options.rotationAngle+`deg)`)},setRotationAngle:function(e){return this.options.rotationAngle=e,this.update(),this},setRotationOrigin:function(e){return this.options.rotationOrigin=e,this.update(),this}})})(),e.Symbol=e.Symbol||{},e.Symbol.Dash=e.Class.extend({options:{pixelSize:10,pathOptions:{}},initialize:function(t){e.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,n,r,i,a){var o=this.options,s=Math.PI/180;if(o.pixelSize<=1)return e.polyline([t.latLng,t.latLng],o.pathOptions);var c=r.project(t.latLng),l=-(t.heading-90)*s,u=e.point(c.x+o.pixelSize*Math.cos(l+Math.PI)/2,c.y+o.pixelSize*Math.sin(l)/2),d=c.add(c.subtract(u));return e.polyline([r.unproject(u),r.unproject(d)],o.pathOptions)}}),e.Symbol.dash=function(t){return new e.Symbol.Dash(t)},e.Symbol.ArrowHead=e.Class.extend({options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(t){e.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,n,r,i,a){return this.options.polygon?e.polygon(this._buildArrowPath(t,r),this.options.pathOptions):e.polyline(this._buildArrowPath(t,r),this.options.pathOptions)},_buildArrowPath:function(t,n){var r=Math.PI/180,i=n.project(t.latLng),a=-(t.heading-90)*r,o=this.options.headAngle/2*r,s=a+o,c=a-o,l=e.point(i.x-this.options.pixelSize*Math.cos(s),i.y+this.options.pixelSize*Math.sin(s)),u=e.point(i.x-this.options.pixelSize*Math.cos(c),i.y+this.options.pixelSize*Math.sin(c));return[n.unproject(l),t.latLng,n.unproject(u)]}}),e.Symbol.arrowHead=function(t){return new e.Symbol.ArrowHead(t)},e.Symbol.Marker=e.Class.extend({options:{markerOptions:{},rotate:!1},initialize:function(t){e.Util.setOptions(this,t),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1},buildSymbol:function(t,n,r,i,a){return this.options.rotate&&(this.options.markerOptions.rotationAngle=t.heading+(this.options.angleCorrection||0)),e.marker(t.latLng,this.options.markerOptions)}}),e.Symbol.marker=function(t){return new e.Symbol.Marker(t)};var l=function(t){return t instanceof e.LatLng||Array.isArray(t)&&t.length===2&&typeof t[0]==`number`},u=function(e){return Array.isArray(e)&&l(e[0])};e.PolylineDecorator=e.FeatureGroup.extend({options:{patterns:[]},initialize:function(t,n){e.FeatureGroup.prototype.initialize.call(this),e.Util.setOptions(this,n),this._map=null,this._paths=this._initPaths(t),this._bounds=this._initBounds(),this._patterns=this._initPatterns(this.options.patterns)},_initPaths:function(t,n){var r=this;return u(t)?[n?t.concat([t[0]]):t]:t instanceof e.Polyline?this._initPaths(t.getLatLngs(),t instanceof e.Polygon):Array.isArray(t)?t.reduce(function(e,t){return e.concat(r._initPaths(t,n))},[]):[]},_initPatterns:function(e){return e.map(this._parsePatternDef)},setPatterns:function(e){this.options.patterns=e,this._patterns=this._initPatterns(this.options.patterns),this.redraw()},setPaths:function(e){this._paths=this._initPaths(e),this._bounds=this._initBounds(),this.redraw()},_parsePatternDef:function(e,t){return{symbolFactory:e.symbol,offset:i(e.offset),endOffset:i(e.endOffset),repeat:i(e.repeat)}},onAdd:function(e){this._map=e,this._draw(),this._map.on(`moveend`,this.redraw,this)},onRemove:function(t){this._map.off(`moveend`,this.redraw,this),this._map=null,e.FeatureGroup.prototype.onRemove.call(this,t)},_initBounds:function(){var t=this._paths.reduce(function(e,t){return e.concat(t)},[]);return e.latLngBounds(t)},getBounds:function(){return this._bounds},_buildSymbols:function(e,t,n){var r=this;return n.map(function(i,a){return t.buildSymbol(i,e,r._map,a,n.length)})},_getDirectionPoints:function(t,n){var r=this;return t.length<2?[]:s(t.map(function(e){return r._map.project(e)}),n).map(function(t){return{latLng:r._map.unproject(e.point(t.pt)),heading:t.heading}})},redraw:function(){this._map&&(this.clearLayers(),this._draw())},_getPatternLayers:function(t){var n=this,r=this._map.getBounds().pad(.1);return this._paths.map(function(i){var a=n._getDirectionPoints(i,t).filter(function(e){return r.contains(e.latLng)});return e.featureGroup(n._buildSymbols(i,t.symbolFactory,a))})},_draw:function(){var t=this;this._patterns.map(function(e){return t._getPatternLayers(e)}).forEach(function(n){t.addLayer(e.featureGroup(n))})}}),e.polylineDecorator=function(t,n){return new e.PolylineDecorator(t,n)}})})(),(function(){var e=L.Marker.prototype._initIcon,t=L.Marker.prototype._setPos,n=L.DomUtil.TRANSFORM===`msTransform`;L.Marker.addInitHook(function(){var e=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;e&&=e[0]+`px `+e[1]+`px`,this.options.rotationOrigin=this.options.rotationOrigin||e||`center bottom`,this.options.rotationAngle=this.options.rotationAngle||0,this.on(`drag`,function(e){e.target._applyRotation()})}),L.Marker.include({_initIcon:function(){e.call(this)},_setPos:function(e){t.call(this,e),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+`Origin`]=this.options.rotationOrigin,n?this._icon.style[L.DomUtil.TRANSFORM]=`rotate(`+this.options.rotationAngle+`deg)`:this._icon.style[L.DomUtil.TRANSFORM]+=` rotateZ(`+this.options.rotationAngle+`deg)`)},setRotationAngle:function(e){return this.options.rotationAngle=e,this.update(),this},setRotationOrigin:function(e){return this.options.rotationOrigin=e,this.update(),this}})})(),import_leaflet_src.default.TrackPlayer=class{constructor(e,t={}){let n=import_leaflet_src.default.polyline(e)._latlngs;this.track=S(n.map(({lng:e,lat:t})=>[e,t])),this.distanceSlice=[0],this.track.geometry.coordinates.forEach((e,t,n)=>{if(t!==0){let e=S(n.slice(0,t+1));this.distanceSlice.push(q(e))}}),this.distance=q(this.track),this.addedToMap=!1,this.options={speed:t.speed??600,weight:t.weight??8,markerIcon:t.markerIcon,polylineDecoratorOptions:t.polylineDecoratorOptions??{patterns:[{offset:30,repeat:60,symbol:import_leaflet_src.default.Symbol.arrowHead({pixelSize:5,headAngle:75,polygon:!1,pathOptions:{stroke:!0,weight:3,color:`#fff`}})}]},passedLineColor:t.passedLineColor??`#0000ff`,notPassedLineColor:t.notPassedLineColor??`#ff0000`,panTo:t.panTo??!0,markerRotationOrigin:t.markerRotationOrigin??`center`,markerRotationOffset:t.markerRotationOffset??0,markerRotation:t.markerRotation??!0,progress:t.progress??0},this.initProgress=t.progress,this.isPaused=!0,this.walkedDistance=0,this.walkedDistanceTemp=0,this.trackIndex=0,this.listenedEvents={start:[],pause:[],finished:[],progressCallback:[]}}addTo(e){if(this.addedToMap)return;if(this.map=e,this.addedToMap=!0,this.options.markerIcon){let e=this.track.geometry.coordinates[0];if(this.marker=import_leaflet_src.default.marker([e[1],e[0]],{icon:this.options.markerIcon}).addTo(this.map),this.options.markerRotation){let e=this.track.geometry.coordinates;this.marker.setRotationAngle(T(e[0],e[1])/2+this.options.markerRotationOffset/2),this.marker.setRotationOrigin(this.options.markerRotationOrigin)}}let t=this.track.geometry.coordinates.map(([e,t])=>[t,e]);return this.notPassedLine=import_leaflet_src.default.polyline(t,{weight:this.options.weight,color:this.options.notPassedLineColor}).addTo(this.map),this.passedLine=import_leaflet_src.default.polyline([],{weight:this.options.weight,color:this.options.passedLineColor}).addTo(this.map),this.polylineDecorator=import_leaflet_src.default.polylineDecorator(t,this.options.polylineDecoratorOptions).addTo(this.map),this.initProgress&&this.setProgress(this.initProgress),this}remove(){this.addedToMap&&(this.addedToMap=!1,this.polylineDecorator.remove(),this.polylineDecorator=null,this.notPassedLine.remove(),this.notPassedLine=null,this.passedLine.remove(),this.passedLine=null,this.marker&&=(this.marker.remove(),null),this.finished=!1,this.startTimestamp=0,this.pauseTimestamp=0,this.walkedDistanceTemp=0,this.walkedDistance=0,this.trackIndex=0,this.isPaused=!0,this.options.progress=this.initProgress)}start(){!this.isPaused&&!this.finished||!this.addedToMap||((this.options.progress===0||this.options.progress===1)&&(this.startTimestamp=0,this.pauseTimestamp=0,this.walkedDistanceTemp=0,this.walkedDistance=0),this.isPaused=!1,this.finished=!1,this.pauseTimestamp&&this.startTimestamp&&(this.startTimestamp+=Date.now()-this.pauseTimestamp),this.startAction(),this.listenedEvents.start.forEach(e=>e()),this.initProgress&&this.setProgress(this.initProgress))}pause(){this.isPaused||this.finished||(this.pauseTimestamp=Date.now(),this.isPaused=!0,this.listenedEvents.pause.forEach(e=>e()))}startAction(){let e=this.distance,t=n=>{if(n&&this.addedToMap){let t=e/this.options.speed*3600*1e3;this.startTimestamp||=n,this.walkedDistance=e*((n-this.startTimestamp)/t)+this.walkedDistanceTemp,this.playAction()}!this.isPaused&&!this.finished&&requestAnimationFrame(t)};t()}playAction(e=!1){if(this.isPaused&&!e)return;let t=this.distance;this.trackIndex=this.distanceSlice.findIndex((e,t,n)=>this.walkedDistance>=e&&this.walkedDistance<(n[t+1]??1/0));let[n,r]=rt(this.track,this.walkedDistance).geometry.coordinates;if(this.markerPoint=[r,n],this.options.panTo&&this.map.panTo(this.markerPoint,{animate:!1}),this.marker&&this.marker.setLatLng(this.markerPoint),this.walkedDistance>=t)this.notPassedLine.setLatLngs([]);else{let e=V(this.track,this.walkedDistance);this.notPassedLine.setLatLngs(e.geometry.coordinates.map(([e,t])=>[t,e]))}if(this.walkedDistance>0){let e=V(this.track,0,this.walkedDistance);this.passedLine.setLatLngs(e.geometry.coordinates.map(([e,t])=>[t,e]))}else this.passedLine.setLatLngs([]);if(this.polylineDecorator.setPaths([...this.passedLine.getLatLngs(),...this.notPassedLine.getLatLngs()]),this.walkedDistance<t&&this.options.markerRotation&&this.marker){let e=0;e=T(O([n,r]),O(this.track.geometry.coordinates[this.trackIndex+1])),this.marker.setRotationAngle(e/2+this.options.markerRotationOffset/2)}if(this.options.progress=Math.min(1,this.walkedDistance/t),this.listenedEvents.progressCallback.forEach(e=>e(this.options.progress,import_leaflet_src.default.latLng(...this.markerPoint),this.trackIndex)),this.walkedDistance>=t&&(this.walkedDistance=t,this.finished=!0,this.listenedEvents.finished.forEach(e=>e()),this.options.markerRotation&&this.marker)){let e=this.track.geometry.coordinates,t=T(O(e.at(-2)),O(e.at(-1)));this.marker.setRotationAngle(t/2+this.options.markerRotationOffset/2)}}setSpeedAction(e){this.options.speed=e,this.walkedDistanceTemp=this.walkedDistance,this.startTimestamp=0}setSpeed(e,t=20){return N(this,null,function*(){t&&(clearTimeout(this.setSpeedTimeout),yield new Promise(e=>{this.setSpeedTimeout=setTimeout(e,t)})),this.setSpeedAction(e)})}setProgress(e){this.addedToMap&&(this.options.progress==1&&e==1||this.options.progress==0&&e==0||(this.options.progress=e,this.walkedDistanceTemp=this.distance*e,this.startTimestamp=0,(this.isPaused||this.finished)&&(this.walkedDistance=this.walkedDistanceTemp,this.isPaused?this.playAction(!0):(this.finished=!1,this.isPaused=!1,this.startAction()))))}on(e,t){switch(e){case`start`:this.listenedEvents.start.push(t);break;case`pause`:this.listenedEvents.pause.push(t);break;case`finished`:this.listenedEvents.finished.push(t);break;case`progress`:this.listenedEvents.progressCallback.push(t);break}}off(e,t){if(!t){this.listenedEvents[e]=[];return}switch(e){case`start`:this.listenedEvents.start=this.listenedEvents.start.filter(e=>e!==t);break;case`pause`:this.listenedEvents.pause=this.listenedEvents.pause.filter(e=>e!==t);break;case`finished`:this.listenedEvents.finished=this.listenedEvents.finished.filter(e=>e!==t);break;case`progress`:this.listenedEvents.progressCallback=this.listenedEvents.progressCallback.filter(e=>e!==t);break}}};var _hoisted_1={class:`relative h-full w-full`},_hoisted_2={class:`track-toolbar-container`},_hoisted_3={class:`control-section`},_hoisted_4={class:`slider-section`},_hoisted_5={class:`slider-item`},_hoisted_6={class:`value`},_hoisted_7={class:`slider-item`},_hoisted_8={class:`value`},track_default=defineComponent({__name:`track`,setup(o){let c={},w={},D=reactive({speed:w?.options?.speed??600,progress:w?.options?.progress*100||0,start:()=>{c.setZoom(17),w.start()},pause:()=>w.pause()}),k=async e=>{let t=await getPlaceGeo({keyword:e});return`${t.data.location.lon},${t.data.location.lat}`},A=e=>{let t=e.match(/<routelatlon>([\s\S]*?)<\/routelatlon>/);return t?t[1].trim():``},P=async(e,t)=>A((await getloadGeo({orig:e,dest:t})).data),I=e=>e.split(`;`).map(e=>{if(e!==``){let t=e.split(`,`);return{lng:t[0],lat:t[1]}}}),R=e=>{w.setProgress(Number(e)/100)},z=e=>{w.setSpeed(e)},W=async()=>{let e=await k(`成都科学城`),t=I(await P(e,await k(`成都天府香山`))).filter(e=>e),n=import_leaflet_src.default.icon({iconUrl:car_default,iconSize:[22,42],iconAnchor:[11,21]});c.fitBounds(t),w=new import_leaflet_src.default.TrackPlayer(t,{markerIcon:n,speed:D.speed,weight:8,passedLineColor:`#43A047`,notPassedLineColor:`#F44336`,panTo:!0,markerRotation:!0}),w.addTo(c);let r=import_leaflet_src.default.marker(e.split(`,`),{icon:import_leaflet_src.default.divIcon({iconSize:null,className:``,popupAnchor:[5,5],shadowAnchor:[5,5],html:`<div class='carnumbox'><div class='carnumbox-text'>川A888888</div></div>`})}).addTo(c);w.on(`progress`,(e,{lng:t,lat:n})=>{r.setLatLng([n,t]),D.progress=e*100})},G=()=>{let e=import_leaflet_src.default.tileLayer(`http://t0.tianditu.gov.cn/vec_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=b40e3cf3d6fa4b1a6c1dc2d2a5288b7e`,{tileSize:256,maxZoom:18,minZoom:5}),t=import_leaflet_src.default.tileLayer(`http://t0.tianditu.gov.cn/cva_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cva&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=b40e3cf3d6fa4b1a6c1dc2d2a5288b7e`,{tileSize:256,maxZoom:18,minZoom:5});import_leaflet_src.default.layerGroup([e,t]);let n=import_leaflet_src.default.tileLayer(`http://www.google.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}`,{maxZoom:20});c=import_leaflet_src.default.map(`gisMap`,{center:import_leaflet_src.default.latLng(30.5728,104.0665),zoom:12,minZoom:5,maxZoom:18,layers:[n],attributionControl:!1,zoomControl:!0,fullscreenControl:!0,fullscreenControlOptions:{position:`topleft`}})};return onMounted(()=>{G()}),(i,o)=>{let c=ElButton,h=ElButtonGroup,g=ElSlider;return openBlock(),createElementBlock(`div`,_hoisted_1,[o[11]||=createBaseVNode(`div`,{id:`gisMap`,class:`absolute top-0 right-0 bottom-0 left-0`},null,-1),createBaseVNode(`div`,_hoisted_2,[createBaseVNode(`div`,_hoisted_3,[createVNode(h,null,{default:withCtx(()=>[createVNode(c,{type:`primary`,icon:unref(position_default),onClick:W},{default:withCtx(()=>o[4]||=[createTextVNode(`生成路线`)]),_:1},8,[`icon`]),createVNode(c,{type:`success`,icon:unref(video_play_default),onClick:o[0]||=e=>D.start()},{default:withCtx(()=>o[5]||=[createTextVNode(`开始`)]),_:1},8,[`icon`]),createVNode(c,{type:`warning`,icon:unref(video_pause_default),onClick:o[1]||=e=>D.pause()},{default:withCtx(()=>o[6]||=[createTextVNode(`暂停`)]),_:1},8,[`icon`])]),_:1})]),o[10]||=createBaseVNode(`div`,{class:`divider`},null,-1),createBaseVNode(`div`,_hoisted_4,[createBaseVNode(`div`,_hoisted_5,[o[8]||=createBaseVNode(`span`,{class:`label`},`速度`,-1),createVNode(g,{modelValue:D.speed,"onUpdate:modelValue":o[2]||=e=>D.speed=e,max:1e3,min:0,onChange:z},null,8,[`modelValue`]),createBaseVNode(`span`,_hoisted_6,[createTextVNode(toDisplayString(D.speed)+` `,1),o[7]||=createBaseVNode(`small`,null,`km/h`,-1)])]),createBaseVNode(`div`,_hoisted_7,[o[9]||=createBaseVNode(`span`,{class:`label`},`进程`,-1),createVNode(g,{modelValue:D.progress,"onUpdate:modelValue":o[3]||=e=>D.progress=e,max:100,min:0,onChange:R},null,8,[`modelValue`]),createBaseVNode(`span`,_hoisted_8,toDisplayString(Math.floor(D.progress))+`%`,1)])])])])}}});export{track_default as default};