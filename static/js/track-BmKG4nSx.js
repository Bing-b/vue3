/* empty css             *//* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  */import{L as b,s as J}from"./utils-DVJ2Em1N.js";import{a as K,b as tt}from"./common-BEtaFwDd.js";import{m as et,M as it}from"./ui-DUCvL7au.js";import{x as st,X as ot,k as nt,y as rt,z as at,A,P as E,H as G,L as U,M as H}from"./core-OJ5DsH9Q.js";import"./main-UU21ezkI.js";var lt=(i,r,t)=>new Promise((n,s)=>{var l=h=>{try{u(t.next(h))}catch(f){s(f)}},p=h=>{try{u(t.throw(h))}catch(f){s(f)}},u=h=>h.done?n(h.value):Promise.resolve(h.value).then(l,p);u((t=t.apply(i,r)).next())}),M=63710088e-1,W={centimeters:M*100,centimetres:M*100,degrees:M/111325,feet:M*3.28084,inches:M*39.37,kilometers:M/1e3,kilometres:M/1e3,meters:M,metres:M,miles:M/1609.344,millimeters:M*1e3,millimetres:M*1e3,nauticalmiles:M/1852,radians:1,yards:M*1.0936};function I(i,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=i,n}function _(i,r,t){if(t===void 0&&(t={}),!i)throw new Error("coordinates is required");if(!Array.isArray(i))throw new Error("coordinates must be an Array");if(i.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!q(i[0])||!q(i[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:i};return I(n,r,t)}function S(i,r,t){if(t===void 0&&(t={}),i.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:i};return I(n,r,t)}function ht(i,r){r===void 0&&(r="kilometers");var t=W[r];if(!t)throw new Error(r+" units is invalid");return i*t}function pt(i,r){r===void 0&&(r="kilometers");var t=W[r];if(!t)throw new Error(r+" units is invalid");return i/t}function N(i){var r=i%(2*Math.PI);return r*180/Math.PI}function T(i){var r=i%360;return r*Math.PI/180}function q(i){return!isNaN(i)&&i!==null&&!Array.isArray(i)}function ut(i){return!!i&&i.constructor===Object}function Y(i,r,t){if(i!==null)for(var n,s,l,p,u,h,f,g=0,m=0,w,e=i.type,o=e==="FeatureCollection",a=e==="Feature",c=o?i.features.length:1,d=0;d<c;d++){f=o?i.features[d].geometry:a?i.geometry:i,w=f?f.type==="GeometryCollection":!1,u=w?f.geometries.length:1;for(var y=0;y<u;y++){var k=0,v=0;if(p=w?f.geometries[y]:f,p!==null){h=p.coordinates;var P=p.type;switch(g=0,P){case null:break;case"Point":if(r(h,m,d,k,v)===!1)return!1;m++,k++;break;case"LineString":case"MultiPoint":for(n=0;n<h.length;n++){if(r(h[n],m,d,k,v)===!1)return!1;m++,P==="MultiPoint"&&k++}P==="LineString"&&k++;break;case"Polygon":case"MultiLineString":for(n=0;n<h.length;n++){for(s=0;s<h[n].length-g;s++){if(r(h[n][s],m,d,k,v)===!1)return!1;m++}P==="MultiLineString"&&k++,P==="Polygon"&&v++}P==="Polygon"&&k++;break;case"MultiPolygon":for(n=0;n<h.length;n++){for(v=0,s=0;s<h[n].length;s++){for(l=0;l<h[n][s].length-g;l++){if(r(h[n][s][l],m,d,k,v)===!1)return!1;m++}v++}k++}break;case"GeometryCollection":for(n=0;n<p.geometries.length;n++)if(Y(p.geometries[n],r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ct(i,r){var t,n,s,l,p,u,h,f,g,m,w=0,e=i.type==="FeatureCollection",o=i.type==="Feature",a=e?i.features.length:1;for(t=0;t<a;t++){for(u=e?i.features[t].geometry:o?i.geometry:i,f=e?i.features[t].properties:o?i.properties:{},g=e?i.features[t].bbox:o?i.bbox:void 0,m=e?i.features[t].id:o?i.id:void 0,h=u?u.type==="GeometryCollection":!1,p=h?u.geometries.length:1,s=0;s<p;s++){if(l=h?u.geometries[s]:u,l===null){if(r(null,w,f,g,m)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(l,w,f,g,m)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<l.geometries.length;n++)if(r(l.geometries[n],w,f,g,m)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function dt(i,r){ct(i,function(t,n,s,l,p){var u=t===null?null:t.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return r(I(t,s,{bbox:l,id:p}),n,0)===!1?!1:void 0}var h;switch(u){case"MultiPoint":h="Point";break;case"MultiLineString":h="LineString";break;case"MultiPolygon":h="Polygon";break}for(var f=0;f<t.coordinates.length;f++){var g=t.coordinates[f],m={type:h,coordinates:g};if(r(I(m,s),n,f)===!1)return!1}})}function ft(i,r){dt(i,function(t,n,s){var l=0;if(t.geometry){var p=t.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var u,h=0,f=0,g=0;if(Y(t,function(m,w,e,o,a){if(u===void 0||n>h||o>f||a>g){u=m,h=n,f=o,g=a,l=0;return}var c=S([u,m],t.properties);if(r(c,n,s,a,l)===!1)return!1;l++,u=m})===!1)return!1}}})}function mt(i,r,t){var n=t,s=!1;return ft(i,function(l,p,u,h,f){s===!1&&t===void 0?n=l:n=r(n,l,p,u,h,f),s=!0}),n}function D(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function gt(i){return i.type==="Feature"?i.geometry:i}var yt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function V(i,r,t){t===void 0&&(t={});var n=D(i),s=D(r),l=T(s[1]-n[1]),p=T(s[0]-n[0]),u=T(n[1]),h=T(s[1]),f=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(p/2),2)*Math.cos(u)*Math.cos(h);return ht(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),t.units)}function B(i,r,t,n){n===void 0&&(n={});var s=D(i),l=T(s[0]),p=T(s[1]),u=T(t),h=pt(r,n.units),f=Math.asin(Math.sin(p)*Math.cos(h)+Math.cos(p)*Math.sin(h)*Math.cos(u)),g=l+Math.atan2(Math.sin(u)*Math.sin(h)*Math.cos(p),Math.cos(h)-Math.sin(p)*Math.sin(f)),m=N(g),w=N(f);return _([m,w],n.properties)}function O(i,r,t){if(t===void 0&&(t={}),t.final===!0)return kt(i,r);var n=D(i),s=D(r),l=T(n[0]),p=T(s[0]),u=T(n[1]),h=T(s[1]),f=Math.sin(p-l)*Math.cos(h),g=Math.cos(u)*Math.sin(h)-Math.sin(u)*Math.cos(h)*Math.cos(p-l);return N(Math.atan2(f,g))}function kt(i,r){var t=O(r,i);return t=(t+180)%360,t}function vt(i,r,t){t===void 0&&(t={});for(var n=gt(i),s=n.coordinates,l=0,p=0;p<s.length&&!(r>=l&&p===s.length-1);p++)if(l>=r){var u=r-l;if(u){var h=O(s[p],s[p-1])-180,f=B(s[p],u,h,t);return f}else return _(s[p])}else l+=V(s[p],s[p+1],t);return _(s[s.length-1])}function X(i,r){return r===void 0&&(r={}),mt(i,function(t,n){var s=n.geometry.coordinates;return t+V(s[0],s[1],r)},0)}function $(i,r,t,n){if(n=n||{},!ut(n))throw new Error("options is invalid");var s,l=[];if(i.type==="Feature")s=i.geometry.coordinates;else if(i.type==="LineString")s=i.coordinates;else throw new Error("input must be a LineString Feature or Geometry");for(var p=s.length,u=0,h,f,g,m=0;m<s.length&&!(r>=u&&m===s.length-1);m++){if(u>r&&l.length===0){if(h=r-u,!h)return l.push(s[m]),S(l);f=O(s[m],s[m-1])-180,g=B(s[m],h,f,n),l.push(g.geometry.coordinates)}if(u>=t)return h=t-u,h?(f=O(s[m],s[m-1])-180,g=B(s[m],h,f,n),l.push(g.geometry.coordinates),S(l)):(l.push(s[m]),S(l));if(u>=r&&l.push(s[m]),m===s.length-1)return S(l);u+=V(s[m],s[m+1],n)}if(u<r&&s.length===p)throw new Error("Start position is beyond line");var w=s[s.length-1];return S([w,w])}(function(i,r){(function(t,n){n(b)})(yt,function(t){t=t&&t.hasOwnProperty("default")?t.default:t;function n(e,o){var a=o.x-e.x,c=o.y-e.y;return Math.sqrt(a*a+c*c)}var s=function(e,o){return(Math.atan2(o.y-e.y,o.x-e.x)*180/Math.PI+90+360)%360},l=function(e,o){var a=e.value,c=e.isInPixels;return c?a/o:a};function p(e){if(typeof e=="string"&&e.indexOf("%")!==-1)return{value:parseFloat(e)/100,isInPixels:!1};var o=e?parseFloat(e):0;return{value:o,isInPixels:o>0}}var u=function(e,o){return e.x===o.x&&e.y===o.y};function h(e){return e.reduce(function(o,a,c,d){if(c>0&&!u(a,d[c-1])){var y=d[c-1],k=o.length>0?o[o.length-1].distB:0,v=n(y,a);o.push({a:y,b:a,distA:k,distB:k+v,heading:s(y,a)})}return o},[])}function f(e,o){var a=h(e),c=a.length;if(c===0)return[];var d=a[c-1].distB,y=l(o.offset,d),k=l(o.endOffset,d),v=l(o.repeat,d),P=d*v,R=y>0?d*y:0,C=k>0?d*k:0,Z=[],F=R;do Z.push(F),F+=P;while(P>0&&F<d-C);var z=0,x=a[0];return Z.map(function(j){for(;j>x.distB&&z<c-1;)z++,x=a[z];var Q=(j-x.distA)/(x.distB-x.distA);return{pt:g(x.a,x.b,Q),heading:x.heading}})}function g(e,o,a){return o.x!==e.x?{x:e.x+a*(o.x-e.x),y:e.y+a*(o.y-e.y)}:{x:e.x,y:e.y+(o.y-e.y)*a}}(function(){var e=L.Marker.prototype._initIcon,o=L.Marker.prototype._setPos,a=L.DomUtil.TRANSFORM==="msTransform";L.Marker.addInitHook(function(){var c=this.options.icon&&this.options.icon.options,d=c&&this.options.icon.options.iconAnchor;d&&(d=d[0]+"px "+d[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||d||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(y){y.target._applyRotation()})}),L.Marker.include({_initIcon:function(){e.call(this)},_setPos:function(c){o.call(this,c),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,a?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(c){return this.options.rotationAngle=c,this.update(),this},setRotationOrigin:function(c){return this.options.rotationOrigin=c,this.update(),this}})})(),t.Symbol=t.Symbol||{},t.Symbol.Dash=t.Class.extend({options:{pixelSize:10,pathOptions:{}},initialize:function(e){t.Util.setOptions(this,e),this.options.pathOptions.clickable=!1},buildSymbol:function(e,o,a,c,d){var y=this.options,k=Math.PI/180;if(y.pixelSize<=1)return t.polyline([e.latLng,e.latLng],y.pathOptions);var v=a.project(e.latLng),P=-(e.heading-90)*k,R=t.point(v.x+y.pixelSize*Math.cos(P+Math.PI)/2,v.y+y.pixelSize*Math.sin(P)/2),C=v.add(v.subtract(R));return t.polyline([a.unproject(R),a.unproject(C)],y.pathOptions)}}),t.Symbol.dash=function(e){return new t.Symbol.Dash(e)},t.Symbol.ArrowHead=t.Class.extend({options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(e){t.Util.setOptions(this,e),this.options.pathOptions.clickable=!1},buildSymbol:function(e,o,a,c,d){return this.options.polygon?t.polygon(this._buildArrowPath(e,a),this.options.pathOptions):t.polyline(this._buildArrowPath(e,a),this.options.pathOptions)},_buildArrowPath:function(e,o){var a=Math.PI/180,c=o.project(e.latLng),d=-(e.heading-90)*a,y=this.options.headAngle/2*a,k=d+y,v=d-y,P=t.point(c.x-this.options.pixelSize*Math.cos(k),c.y+this.options.pixelSize*Math.sin(k)),R=t.point(c.x-this.options.pixelSize*Math.cos(v),c.y+this.options.pixelSize*Math.sin(v));return[o.unproject(P),e.latLng,o.unproject(R)]}}),t.Symbol.arrowHead=function(e){return new t.Symbol.ArrowHead(e)},t.Symbol.Marker=t.Class.extend({options:{markerOptions:{},rotate:!1},initialize:function(e){t.Util.setOptions(this,e),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1},buildSymbol:function(e,o,a,c,d){return this.options.rotate&&(this.options.markerOptions.rotationAngle=e.heading+(this.options.angleCorrection||0)),t.marker(e.latLng,this.options.markerOptions)}}),t.Symbol.marker=function(e){return new t.Symbol.Marker(e)};var m=function(e){return e instanceof t.LatLng||Array.isArray(e)&&e.length===2&&typeof e[0]=="number"},w=function(e){return Array.isArray(e)&&m(e[0])};t.PolylineDecorator=t.FeatureGroup.extend({options:{patterns:[]},initialize:function(e,o){t.FeatureGroup.prototype.initialize.call(this),t.Util.setOptions(this,o),this._map=null,this._paths=this._initPaths(e),this._bounds=this._initBounds(),this._patterns=this._initPatterns(this.options.patterns)},_initPaths:function(e,o){var a=this;if(w(e)){var c=o?e.concat([e[0]]):e;return[c]}return e instanceof t.Polyline?this._initPaths(e.getLatLngs(),e instanceof t.Polygon):Array.isArray(e)?e.reduce(function(d,y){return d.concat(a._initPaths(y,o))},[]):[]},_initPatterns:function(e){return e.map(this._parsePatternDef)},setPatterns:function(e){this.options.patterns=e,this._patterns=this._initPatterns(this.options.patterns),this.redraw()},setPaths:function(e){this._paths=this._initPaths(e),this._bounds=this._initBounds(),this.redraw()},_parsePatternDef:function(e,o){return{symbolFactory:e.symbol,offset:p(e.offset),endOffset:p(e.endOffset),repeat:p(e.repeat)}},onAdd:function(e){this._map=e,this._draw(),this._map.on("moveend",this.redraw,this)},onRemove:function(e){this._map.off("moveend",this.redraw,this),this._map=null,t.FeatureGroup.prototype.onRemove.call(this,e)},_initBounds:function(){var e=this._paths.reduce(function(o,a){return o.concat(a)},[]);return t.latLngBounds(e)},getBounds:function(){return this._bounds},_buildSymbols:function(e,o,a){var c=this;return a.map(function(d,y){return o.buildSymbol(d,e,c._map,y,a.length)})},_getDirectionPoints:function(e,o){var a=this;if(e.length<2)return[];var c=e.map(function(d){return a._map.project(d)});return f(c,o).map(function(d){return{latLng:a._map.unproject(t.point(d.pt)),heading:d.heading}})},redraw:function(){this._map&&(this.clearLayers(),this._draw())},_getPatternLayers:function(e){var o=this,a=this._map.getBounds().pad(.1);return this._paths.map(function(c){var d=o._getDirectionPoints(c,e).filter(function(y){return a.contains(y.latLng)});return t.featureGroup(o._buildSymbols(c,e.symbolFactory,d))})},_draw:function(){var e=this;this._patterns.map(function(o){return e._getPatternLayers(o)}).forEach(function(o){e.addLayer(t.featureGroup(o))})}}),t.polylineDecorator=function(e,o){return new t.PolylineDecorator(e,o)}})})();(function(){var i=L.Marker.prototype._initIcon,r=L.Marker.prototype._setPos,t=L.DomUtil.TRANSFORM==="msTransform";L.Marker.addInitHook(function(){var n=this.options.icon&&this.options.icon.options,s=n&&this.options.icon.options.iconAnchor;s&&(s=s[0]+"px "+s[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||s||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(l){l.target._applyRotation()})}),L.Marker.include({_initIcon:function(){i.call(this)},_setPos:function(n){r.call(this,n),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,t?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(n){return this.options.rotationAngle=n,this.update(),this},setRotationOrigin:function(n){return this.options.rotationOrigin=n,this.update(),this}})})();b.TrackPlayer=class{constructor(i,r={}){var t,n,s,l,p,u,h,f,g,m;let w=b.polyline(i)._latlngs;this.track=S(w.map(({lng:e,lat:o})=>[e,o])),this.distanceSlice=[0],this.track.geometry.coordinates.forEach((e,o,a)=>{if(o!==0){let c=S(a.slice(0,o+1));this.distanceSlice.push(X(c))}}),this.distance=X(this.track),this.addedToMap=!1,this.options={speed:(t=r.speed)!=null?t:600,weight:(n=r.weight)!=null?n:8,markerIcon:r.markerIcon,polylineDecoratorOptions:(s=r.polylineDecoratorOptions)!=null?s:{patterns:[{offset:30,repeat:60,symbol:b.Symbol.arrowHead({pixelSize:5,headAngle:75,polygon:!1,pathOptions:{stroke:!0,weight:3,color:"#fff"}})}]},passedLineColor:(l=r.passedLineColor)!=null?l:"#0000ff",notPassedLineColor:(p=r.notPassedLineColor)!=null?p:"#ff0000",panTo:(u=r.panTo)!=null?u:!0,markerRotationOrigin:(h=r.markerRotationOrigin)!=null?h:"center",markerRotationOffset:(f=r.markerRotationOffset)!=null?f:0,markerRotation:(g=r.markerRotation)!=null?g:!0,progress:(m=r.progress)!=null?m:0},this.initProgress=r.progress,this.isPaused=!0,this.walkedDistance=0,this.walkedDistanceTemp=0,this.trackIndex=0,this.listenedEvents={start:[],pause:[],finished:[],progressCallback:[]}}addTo(i){if(this.addedToMap)return;if(this.map=i,this.addedToMap=!0,this.options.markerIcon){let t=this.track.geometry.coordinates[0];if(this.marker=b.marker([t[1],t[0]],{icon:this.options.markerIcon}).addTo(this.map),this.options.markerRotation){let n=this.track.geometry.coordinates;this.marker.setRotationAngle(O(n[0],n[1])/2+this.options.markerRotationOffset/2),this.marker.setRotationOrigin(this.options.markerRotationOrigin)}}let r=this.track.geometry.coordinates.map(([t,n])=>[n,t]);return this.notPassedLine=b.polyline(r,{weight:this.options.weight,color:this.options.notPassedLineColor}).addTo(this.map),this.passedLine=b.polyline([],{weight:this.options.weight,color:this.options.passedLineColor}).addTo(this.map),this.polylineDecorator=b.polylineDecorator(r,this.options.polylineDecoratorOptions).addTo(this.map),this.initProgress&&this.setProgress(this.initProgress),this}remove(){this.addedToMap&&(this.addedToMap=!1,this.polylineDecorator.remove(),this.polylineDecorator=null,this.notPassedLine.remove(),this.notPassedLine=null,this.passedLine.remove(),this.passedLine=null,this.marker&&(this.marker.remove(),this.marker=null),this.finished=!1,this.startTimestamp=0,this.pauseTimestamp=0,this.walkedDistanceTemp=0,this.walkedDistance=0,this.trackIndex=0,this.isPaused=!0,this.options.progress=this.initProgress)}start(){!this.isPaused&&!this.finished||!this.addedToMap||((this.options.progress===0||this.options.progress===1)&&(this.startTimestamp=0,this.pauseTimestamp=0,this.walkedDistanceTemp=0,this.walkedDistance=0),this.isPaused=!1,this.finished=!1,this.pauseTimestamp&&this.startTimestamp&&(this.startTimestamp=this.startTimestamp+(Date.now()-this.pauseTimestamp)),this.startAction(),this.listenedEvents.start.forEach(i=>i()),this.initProgress&&this.setProgress(this.initProgress))}pause(){this.isPaused||this.finished||(this.pauseTimestamp=Date.now(),this.isPaused=!0,this.listenedEvents.pause.forEach(i=>i()))}startAction(){let i=this.distance,r=t=>{if(t&&this.addedToMap){let n=i/this.options.speed*3600*1e3;this.startTimestamp||(this.startTimestamp=t);let s=t-this.startTimestamp;this.walkedDistance=i*(s/n)+this.walkedDistanceTemp,this.playAction()}!this.isPaused&&!this.finished&&requestAnimationFrame(r)};r()}playAction(i=!1){if(this.isPaused&&!i)return;let r=this.distance;this.trackIndex=this.distanceSlice.findIndex((s,l,p)=>{var u;return this.walkedDistance>=s&&this.walkedDistance<((u=p[l+1])!=null?u:1/0)});let[t,n]=vt(this.track,this.walkedDistance).geometry.coordinates;if(this.markerPoint=[n,t],this.options.panTo&&this.map.panTo(this.markerPoint,{animate:!1}),this.marker&&this.marker.setLatLng(this.markerPoint),this.walkedDistance>=r)this.notPassedLine.setLatLngs([]);else{let s=$(this.track,this.walkedDistance);this.notPassedLine.setLatLngs(s.geometry.coordinates.map(([l,p])=>[p,l]))}if(this.walkedDistance>0){let s=$(this.track,0,this.walkedDistance);this.passedLine.setLatLngs(s.geometry.coordinates.map(([l,p])=>[p,l]))}else this.passedLine.setLatLngs([]);if(this.polylineDecorator.setPaths([...this.passedLine.getLatLngs(),...this.notPassedLine.getLatLngs()]),this.walkedDistance<r&&this.options.markerRotation&&this.marker){let s=0;s=O(_([t,n]),_(this.track.geometry.coordinates[this.trackIndex+1])),this.marker.setRotationAngle(s/2+this.options.markerRotationOffset/2)}if(this.options.progress=Math.min(1,this.walkedDistance/r),this.listenedEvents.progressCallback.forEach(s=>s(this.options.progress,b.latLng(...this.markerPoint),this.trackIndex)),this.walkedDistance>=r&&(this.walkedDistance=r,this.finished=!0,this.listenedEvents.finished.forEach(s=>s()),this.options.markerRotation&&this.marker)){let s=this.track.geometry.coordinates,l=O(_(s.at(-2)),_(s.at(-1)));this.marker.setRotationAngle(l/2+this.options.markerRotationOffset/2)}}setSpeedAction(i){this.options.speed=i,this.walkedDistanceTemp=this.walkedDistance,this.startTimestamp=0}setSpeed(i,r=20){return lt(this,null,function*(){r&&(clearTimeout(this.setSpeedTimeout),yield new Promise(t=>{this.setSpeedTimeout=setTimeout(t,r)})),this.setSpeedAction(i)})}setProgress(i){this.addedToMap&&(this.options.progress==1&&i==1||this.options.progress==0&&i==0||(this.options.progress=i,this.walkedDistanceTemp=this.distance*i,this.startTimestamp=0,(this.isPaused||this.finished)&&(this.walkedDistance=this.walkedDistanceTemp,this.isPaused?this.playAction(!0):(this.finished=!1,this.isPaused=!1,this.startAction()))))}on(i,r){switch(i){case"start":this.listenedEvents.start.push(r);break;case"pause":this.listenedEvents.pause.push(r);break;case"finished":this.listenedEvents.finished.push(r);break;case"progress":this.listenedEvents.progressCallback.push(r);break}}off(i,r){if(!r){this.listenedEvents[i]=[];return}switch(i){case"start":this.listenedEvents.start=this.listenedEvents.start.filter(t=>t!==r);break;case"pause":this.listenedEvents.pause=this.listenedEvents.pause.filter(t=>t!==r);break;case"finished":this.listenedEvents.finished=this.listenedEvents.finished.filter(t=>t!==r);break;case"progress":this.listenedEvents.progressCallback=this.listenedEvents.progressCallback.filter(t=>t!==r);break}}};const wt={class:"relative h-full w-full"},bt={class:"absolute top-2 right-2 z-[888] flex items-center gap-5 rounded bg-white px-3 py-2 text-xs"},Lt={class:"flex items-center"},Pt={class:"flex w-[300px] items-center gap-5"},Mt={class:"text-nowrap"},Tt={class:"flex w-[350px] items-center gap-5"},Ft=st({__name:"track",setup(i){const r=J("../../../assets/images/car.png",[24,46],[12,23]);let t={},n={};const s=ot({speed:n?.options?.speed??600,progress:n?.options?.progress*100||0,start:()=>{t.setZoom(17),n.start()},pause:()=>n.pause()}),l=async e=>{const o=await K({keyword:e});return`${o.data.location.lon},${o.data.location.lat}`},p=e=>{const o=e.match(/<routelatlon>([\s\S]*?)<\/routelatlon>/);return o?o[1].trim():""},u=async(e,o)=>{const a=await tt({orig:e,dest:o});return console.log(p(a.data)),p(a.data)},h=e=>e.split(";").map(o=>{if(o!==""){const a=o.split(",");return{lng:a[0],lat:a[1]}}}),f=e=>{n.setProgress(e/100)},g=e=>{n.setSpeed(e)},m=async()=>{const e=await l("成都科学城"),o=await l("成都天府香山"),a=await u(e,o);let c=h(a).filter(k=>k);t.fitBounds(c),n=new b.TrackPlayer(c,{markerIcon:r,speed:s.speed,weight:8,passedLineColor:"#43A047",notPassedLineColor:"#F44336",panTo:!0,markerRotation:!0,markerRotationOffset:0}),n.addTo(t);const y=b.marker(e.split(","),{icon:b.divIcon({iconSize:null,className:"",popupAnchor:[5,5],shadowAnchor:[5,5],html:"<div class='carnumbox'><div class='carnumbox-text'>"+"川A888888"+"</div></div>"})}).addTo(t);n.on("progress",(k,{lng:v,lat:P})=>{y.setLatLng([P,v]),s.progress=k*100})},w=()=>{const e=b.tileLayer("http://t0.tianditu.gov.cn/vec_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=b40e3cf3d6fa4b1a6c1dc2d2a5288b7e",{tileSize:256,maxZoom:18,minZoom:5}),o=b.tileLayer("http://t0.tianditu.gov.cn/cva_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cva&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=b40e3cf3d6fa4b1a6c1dc2d2a5288b7e",{tileSize:256,maxZoom:18,minZoom:5});b.layerGroup([e,o]);const a=b.tileLayer("http://www.google.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}",{maxZoom:20});t=b.map("gisMap",{center:b.latLng(30.5728,104.0665),zoom:12,minZoom:5,maxZoom:18,layers:[a],attributionControl:!1,zoomControl:!0,fullscreenControl:!0,fullscreenControlOptions:{position:"topleft"}})};return nt(()=>{w()}),(e,o)=>{const a=et,c=it;return at(),rt("div",wt,[o[9]||(o[9]=A("div",{id:"gisMap",class:"absolute top-0 right-0 bottom-0 left-0"},null,-1)),A("div",bt,[A("div",Lt,[E(a,{onClick:m},{default:G(()=>o[4]||(o[4]=[U("生成路线")])),_:1}),E(a,{onClick:o[0]||(o[0]=d=>s.start())},{default:G(()=>o[5]||(o[5]=[U("开始")])),_:1}),E(a,{onClick:o[1]||(o[1]=d=>s.pause())},{default:G(()=>o[6]||(o[6]=[U("暂停")])),_:1})]),A("div",Pt,[o[7]||(o[7]=A("p",{class:"text-nowrap"},"速度",-1)),E(c,{onChange:g,modelValue:s.speed,"onUpdate:modelValue":o[2]||(o[2]=d=>s.speed=d),max:1e3,min:0},null,8,["modelValue"]),A("p",Mt,H(s.speed)+" （km/h）",1)]),A("div",Tt,[o[8]||(o[8]=A("p",{class:"text-nowrap"},"进程",-1)),E(c,{onChange:f,modelValue:s.progress,"onUpdate:modelValue":o[3]||(o[3]=d=>s.progress=d),max:100,min:0},null,8,["modelValue"]),A("p",null,H(Math.floor(s.progress))+"%",1)])])])}}});export{Ft as default};
