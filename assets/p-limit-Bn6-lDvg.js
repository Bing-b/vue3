import{$ as ElButton,$t as _plugin_vue_export_helper_default,An as nextTick,Ft as position_default,J as ElTag,Lr as toDisplayString,Mr as normalizeClass,Pn as openBlock,Q as require_dayjs_min,Rn as renderList,Sn as defineComponent,Ur as __toESM,Yn as withCtx,bn as createVNode,dr as unref,gn as createElementBlock,hn as createCommentVNode,ir as ref,ln as Fragment,pn as createBaseVNode,vn as createStaticVNode,yn as createTextVNode}from"./index-DzasR-yf.js";/* empty css            *//* empty css            *//* empty css            */var Node=class{value;next;constructor(i){this.value=i}},Queue=class{#e;#t;#n;constructor(){this.clear()}enqueue(i){let S=new Node(i);this.#e?(this.#t.next=S,this.#t=S):(this.#e=S,this.#t=S),this.#n++}dequeue(){let i=this.#e;if(i)return this.#e=this.#e.next,this.#n--,i.value}peek(){if(this.#e)return this.#e.value}clear(){this.#e=void 0,this.#t=void 0,this.#n=0}get size(){return this.#n}*[Symbol.iterator](){let i=this.#e;for(;i;)yield i.value,i=i.next}};function pLimit(i){validateConcurrency(i);let S=new Queue,C=0,w=()=>{C<i&&S.size>0&&(S.dequeue()(),C++)},T=()=>{C--,w()},E=async(i,S,C)=>{let w=(async()=>i(...C))();S(w);try{await w}catch{}T()},D=(T,D,O)=>{new Promise(i=>{S.enqueue(i)}).then(E.bind(void 0,T,D,O)),(async()=>{await Promise.resolve(),C<i&&w()})()},O=(i,...S)=>new Promise(C=>{D(i,C,S)});return Object.defineProperties(O,{activeCount:{get:()=>C},pendingCount:{get:()=>S.size},clearQueue:{value(){S.clear()}},concurrency:{get:()=>i,set(T){validateConcurrency(T),i=T,queueMicrotask(()=>{for(;C<i&&S.size>0;)w()})}}}),O}function validateConcurrency(i){if(!((Number.isInteger(i)||i===1/0)&&i>0))throw TypeError("Expected `concurrency` to be a number from 1 and up")}var import_dayjs_min=__toESM(require_dayjs_min()),_hoisted_1={class:`demo-card`},_hoisted_2={class:`demo-content`},_hoisted_3={class:`control-panel`},_hoisted_4={class:`config-item`},_hoisted_5={class:`console-wrapper`},_hoisted_6={class:`time`},_hoisted_7={key:0,class:`empty-msg`},p_limit_default=_plugin_vue_export_helper_default(defineComponent({__name:`p-limit`,setup(S){let k=ref([]),A=ref(null),j=(i,S=`info`)=>{k.value.push({time:(0,import_dayjs_min.default)().format(`HH:mm:ss.SSS`),text:i,type:S}),nextTick(()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)})},N=i=>new Promise(S=>{j(`Task [${i}] - 开始执行 (等待 2s)`),setTimeout(()=>{j(`Task [${i}] - 执行完毕`,`success`),S(i)},2e3)}),P=async()=>{k.value=[],j(`初始化最大并发限额: 1`);let i=pLimit(1),S=[i(()=>N(`Task-X`)),i(()=>N(`Task-Y`)),i(()=>N(`Task-Z`))];await Promise.all(S),j(`所有请求已完成`,`success`)};return(S,C)=>{let j=ElTag,M=ElButton;return openBlock(),createElementBlock(`div`,_hoisted_1,[C[4]||=createBaseVNode(`div`,{class:`demo-info`},[createBaseVNode(`h4`,{class:`title`},`并发控制 (P-Limit)`),createBaseVNode(`p`,{class:`desc`},`模拟受限并发环境下的异步请求执行，确保系统稳定性`)],-1),createBaseVNode(`div`,_hoisted_2,[createBaseVNode(`div`,_hoisted_3,[createBaseVNode(`div`,_hoisted_4,[C[1]||=createBaseVNode(`span`,{class:`label`},`最大并发数`,-1),createVNode(j,{type:`warning`,effect:`dark`},{default:withCtx(()=>C[0]||=[createTextVNode(`1`)]),_:1})]),createVNode(M,{type:`primary`,onClick:P,icon:unref(position_default),large:``},{default:withCtx(()=>C[2]||=[createTextVNode(` 开始模拟并发请求 `)]),_:1},8,[`icon`])]),createBaseVNode(`div`,_hoisted_5,[C[3]||=createStaticVNode(`<div class="console-header" data-v-7a32e4c7><span class="dot red" data-v-7a32e4c7></span><span class="dot yellow" data-v-7a32e4c7></span><span class="dot green" data-v-7a32e4c7></span><span class="title" data-v-7a32e4c7>Terminal Output</span></div>`,1),createBaseVNode(`div`,{class:`console-body`,ref_key:`consoleRef`,ref:A},[(openBlock(!0),createElementBlock(Fragment,null,renderList(k.value,(i,S)=>(openBlock(),createElementBlock(`div`,{key:S,class:`log-line`},[createBaseVNode(`span`,_hoisted_6,`[`+toDisplayString(i.time)+`]`,1),createBaseVNode(`span`,{class:normalizeClass([`msg`,i.type])},toDisplayString(i.text),3)]))),128)),k.value.length===0?(openBlock(),createElementBlock(`div`,_hoisted_7,`等待执行任务...`)):createCommentVNode(``,!0)],512)])])])}}}),[[`__scopeId`,`data-v-7a32e4c7`]]);export{p_limit_default as default};