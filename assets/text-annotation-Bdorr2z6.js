import{$ as ElButton,A as ElSelect,Dn as mergeModels,Hr as __toESM,Ir as toDisplayString,J as ElTag,Jn as withCtx,Ln as renderList,Nn as openBlock,Nr as normalizeStyle,P as ElLink,Qt as _plugin_vue_export_helper_default,Rr as __commonJSMin,Un as useModel,V as ElDialog,Xt as ElIcon,Yn as withDirectives,an as vShow,cn as Fragment,dn as computed,fn as createBaseVNode,hn as createElementBlock,jn as onMounted,k as ElOption,pn as createBlock,qn as watchEffect,rr as ref,rt as ElBadge,st as ElInput,tr as reactive,vn as createTextVNode,xn as defineComponent,yn as createVNode,zn as resolveComponent}from"./index-_fc2eCpQ.js";/* empty css            *//* empty css            */import"./css-pkVQ7h14.js";/* empty css            *//* empty css            *//* empty css            *//* empty css            *//* empty css            *//* empty css            *//* empty css            */var import_dist=__commonJSMin(((e,h)=>{(function(g,_){typeof e==`object`&&typeof h==`object`?h.exports=_():typeof define==`function`&&define.amd?define([],_):typeof e==`object`?e.Poplar=_():g.Poplar=_()})(window,function(){return g={},e.m=h=[function(e,h,g){Object.defineProperty(h,`__esModule`,{value:!0}),h.SVGNS=`http://www.w3.org/2000/svg`},function(e,h,g){var _,v=this&&this.__extends||(_=function(e,h){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,h){e.__proto__=h}||function(e,h){for(var g in h)h.hasOwnProperty(g)&&(e[g]=h[g])})(e,h)},function(e,h){function g(){this.constructor=e}_(e,h),e.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)}),y=this&&this.__values||function(e){var h=typeof Symbol==`function`&&Symbol.iterator,g=h&&e[h],_=0;if(g)return g.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&_>=e.length&&(e=void 0),{value:e&&e[_++],done:!e}}};throw TypeError(h?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(h,`__esModule`,{value:!0});var b,x,S,C=g(4),w=g(3);function T(){var e=x!==null&&x.apply(this,arguments)||this;return e.entities=new Map,e.nextId=0,e}b=h.Base||={},x=w.EventEmitter,v(T,x),Object.defineProperty(T.prototype,`json`,{get:function(){var e,h,g=[];try{for(var _=y(this.values()),v=_.next();!v.done;v=_.next()){var b=v.value;`json`in b?g.push(b.json):g.push(JSON.parse(JSON.stringify(b)))}}catch(h){e={error:h}}finally{try{v&&!v.done&&(h=_.return)&&h.call(_)}finally{if(e)throw e.error}}return g},enumerable:!0,configurable:!0}),Object.defineProperty(T.prototype,`length`,{get:function(){return this.entities.size},enumerable:!0,configurable:!0}),T.prototype.get=function(e){return C.assert(this.has(e),`There's no Entity which id=`+e+` in repo!`),this.entities.get(e)},T.prototype.has=function(e){return this.entities.has(e)},T.prototype.set=function(e,h){var g=this.has(e);return this.entities.set(e,h),g?this.emit(`updated`,h):(this.nextId<e+1&&(this.nextId=e+1),this.emit(`created`,h)),this},T.prototype.add=function(e){if(`id`in e){var h=e.id;return C.assert(!this.has(h),`reAdd `+h+`!`),h===null?(e.id=this.nextId,this.add(e)):(this.set(h,e),h)}var g=this.nextId;return this.set(g,e),g},T.prototype[Symbol.iterator]=function(){return this.entities[Symbol.iterator]()},T.prototype.delete=function(e){if(typeof e==`number`&&this.has(e)){var h=this.get(e);return this.entities.delete(e),this.emit(`removed`,h),!0}return typeof e!=`number`&&`id`in e&&this.delete(e.id)},T.prototype.values=function(){return this.entities.values()},S=T,b.Repository=S},function(e,h,g){Object.defineProperty(h,`__esModule`,{value:!0});var _=(Object.defineProperty(v.prototype,`isSome`,{get:function(){return this.value!==null},enumerable:!0,configurable:!0}),v.prototype.map=function(e){return this.value===null?new v(null):new v(e(this.value))},v.prototype.flatMap=function(e){return this.value===null?new v(null):b(e(this.value).toNullable())},v.prototype.orElse=function(e){return this.value===null?e:this.value},v.prototype.toNullable=function(){return this.value},v.prototype.match=function(e,h){return this.isSome?e:h},v);function v(e){this.value=e}function y(e){return new _(e)}function b(e){return e==null?h.none:y(e)}h.Option=_,h.none=new _(null),h.some=y,h.fromNullable=b,h.fromTry=function(e){try{return y(e())}catch{return h.none}}},function(e,h,g){var _,v=typeof Reflect==`object`?Reflect:null,y=v&&typeof v.apply==`function`?v.apply:function(e,h,g){return Function.prototype.apply.call(e,h,g)};_=v&&typeof v.ownKeys==`function`?v.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var b=Number.isNaN||function(e){return e!=e};function x(){x.init.call(this)}((e.exports=x).EventEmitter=x).prototype._events=void 0,x.prototype._eventsCount=0,x.prototype._maxListeners=void 0;var S=10;function C(e){return e._maxListeners===void 0?x.defaultMaxListeners:e._maxListeners}function w(e,h,g,_){var v,y,b;if(typeof g!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof g);if((y=e._events)===void 0?(y=e._events=Object.create(null),e._eventsCount=0):(y.newListener!==void 0&&(e.emit(`newListener`,h,g.listener?g.listener:g),y=e._events),b=y[h]),b===void 0)b=y[h]=g,++e._eventsCount;else if(typeof b==`function`?b=y[h]=_?[g,b]:[b,g]:_?b.unshift(g):b.push(g),0<(v=C(e))&&b.length>v&&!b.warned){b.warned=!0;var x=Error(`Possible EventEmitter memory leak detected. `+b.length+` `+String(h)+` listeners added. Use emitter.setMaxListeners() to increase limit`);x.name=`MaxListenersExceededWarning`,x.emitter=e,x.type=h,x.count=b.length,function(e){console&&console.warn}(x)}return e}function T(e,h,g){var _={fired:!1,wrapFn:void 0,target:e,type:h,listener:g},v=function(){for(var e=[],h=0;h<arguments.length;h++)e.push(arguments[h]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,y(this.listener,this.target,e))}.bind(_);return v.listener=g,_.wrapFn=v}function E(e,h,g){var _=e._events;if(_===void 0)return[];var v=_[h];return v===void 0?[]:typeof v==`function`?g?[v.listener||v]:[v]:g?function(e){for(var h=Array(e.length),g=0;g<h.length;++g)h[g]=e[g].listener||e[g];return h}(v):O(v,v.length)}function D(e){var h=this._events;if(h!==void 0){var g=h[e];if(typeof g==`function`)return 1;if(g!==void 0)return g.length}return 0}function O(e,h){for(var g=Array(h),_=0;_<h;++_)g[_]=e[_];return g}Object.defineProperty(x,`defaultMaxListeners`,{enumerable:!0,get:function(){return S},set:function(e){if(typeof e!=`number`||e<0||b(e))throw RangeError(`The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received `+e+`.`);S=e}}),x.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},x.prototype.setMaxListeners=function(e){if(typeof e!=`number`||e<0||b(e))throw RangeError(`The value of "n" is out of range. It must be a non-negative number. Received `+e+`.`);return this._maxListeners=e,this},x.prototype.getMaxListeners=function(){return C(this)},x.prototype.emit=function(e){for(var h=[],g=1;g<arguments.length;g++)h.push(arguments[g]);var _=e===`error`,v=this._events;if(v!==void 0)_&&=v.error===void 0;else if(!_)return!1;if(_){var b;if(0<h.length&&(b=h[0]),b instanceof Error)throw b;var x=Error(`Unhandled error.`+(b?` (`+b.message+`)`:``));throw x.context=b,x}var S=v[e];if(S===void 0)return!1;if(typeof S==`function`)y(S,this,h);else{var C=S.length,w=O(S,C);for(g=0;g<C;++g)y(w[g],this,h)}return!0},x.prototype.on=x.prototype.addListener=function(e,h){return w(this,e,h,!1)},x.prototype.prependListener=function(e,h){return w(this,e,h,!0)},x.prototype.once=function(e,h){if(typeof h!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof h);return this.on(e,T(this,e,h)),this},x.prototype.prependOnceListener=function(e,h){if(typeof h!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof h);return this.prependListener(e,T(this,e,h)),this},x.prototype.off=x.prototype.removeListener=function(e,h){var g,_,v,y,b;if(typeof h!=`function`)throw TypeError(`The "listener" argument must be of type Function. Received type `+typeof h);if((_=this._events)===void 0||(g=_[e])===void 0)return this;if(g===h||g.listener===h)--this._eventsCount==0?this._events=Object.create(null):(delete _[e],_.removeListener&&this.emit(`removeListener`,e,g.listener||h));else if(typeof g!=`function`){for(v=-1,y=g.length-1;0<=y;y--)if(g[y]===h||g[y].listener===h){b=g[y].listener,v=y;break}if(v<0)return this;v===0?g.shift():function(e,h){for(;h+1<e.length;h++)e[h]=e[h+1];e.pop()}(g,v),g.length===1&&(_[e]=g[0]),_.removeListener!==void 0&&this.emit(`removeListener`,e,b||h)}return this},x.prototype.removeAllListeners=function(e){var h,g,_;if((g=this._events)===void 0)return this;if(g.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):g[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete g[e]),this;if(arguments.length===0){var v,y=Object.keys(g);for(_=0;_<y.length;++_)(v=y[_])!==`removeListener`&&this.removeAllListeners(v);return this.removeAllListeners(`removeListener`),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(h=g[e])==`function`)this.removeListener(e,h);else if(h!==void 0)for(_=h.length-1;0<=_;_--)this.removeListener(e,h[_]);return this},x.prototype.listeners=function(e){return E(this,e,!0)},x.prototype.rawListeners=function(e){return E(this,e,!1)},x.listenerCount=function(e,h){return typeof e.listenerCount==`function`?e.listenerCount(h):D.call(e,h)},x.prototype.listenerCount=D,x.prototype.eventNames=function(){return 0<this._eventsCount?_(this._events):[]}},function(e,h,g){Object.defineProperty(h,`__esModule`,{value:!0}),h.assert=function(e,h){}},function(e,h,g){Object.defineProperty(h,`__esModule`,{value:!0}),h.shadeColor=function(e,h){var g=parseInt(e.slice(1),16),_=Math.min((g>>16)+(g>>16)*h/100,255),v=Math.min((g>>8&255)+(g>>8&255)*h/100,255);return`#`+(Math.min((255&g)+(255&g)*h/100,255)|v<<8|_<<16).toString(16)},h.addAlpha=function(e,h){var g=parseInt(e.slice(1),16);return`rgba(`+(g>>16)+`,`+(g>>8&255)+`,`+(255&g)+`,`+h+`%)`}},function(e,h,g){Object.defineProperty(h,`__esModule`,{value:!0});function _(){this.layer=0}h.TopContextUser=_,h.overLaps=function e(h,g){return h.layer===g.layer&&(h.left>g.left?e(g,h):!(h.left+h.width<g.left))}},function(e,h,g){var _,v=this&&this.__extends||(_=function(e,h){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,h){e.__proto__=h}||function(e,h){for(var g in h)h.hasOwnProperty(g)&&(e[g]=h[g])})(e,h)},function(e,h){function g(){this.constructor=e}_(e,h),e.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)}),y=this&&this.__read||function(e,h){var g=typeof Symbol==`function`&&e[Symbol.iterator];if(!g)return e;var _,v,y=g.call(e),b=[];try{for(;(h===void 0||0<h--)&&!(_=y.next()).done;)b.push(_.value)}catch(e){v={error:e}}finally{try{_&&!_.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}return b},b=this&&this.__spread||function(){for(var e=[],h=0;h<arguments.length;h++)e=e.concat(y(arguments[h]));return e};Object.defineProperty(h,`__esModule`,{value:!0});var x=g(6),S=g(0),C=g(1),w=g(5);(function(e){var h,g=(h=x.TopContextUser,v(_,h),Object.defineProperty(_.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`lineIn`,{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`view`,{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`highLightWidth`,{get:function(){return this.view.contentWidth(this.store.startIndex,this.store.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`highLightLeft`,{get:function(){return this.view.contentWidth(this.lineIn.startIndex,this.store.startIndex)+this.lineIn.view.paddingLeft},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`middle`,{get:function(){return this.highLightLeft+this.highLightWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`labelLeft`,{get:function(){return this.middle-this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`labelRight`,{get:function(){return this.middle+this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`labelWidth`,{get:function(){return this.view.labelFont.widthOf(this.store.category.text)+this.config.labelPadding+2},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`left`,{get:function(){return this.config.labelWidthCalcMethod===`max`?this.labelWidth>this.highLightWidth?this.labelLeft:this.highLightLeft:this.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`width`,{get:function(){return this.config.labelWidthCalcMethod===`max`?this.labelWidth>this.highLightWidth-1?this.labelWidth:this.highLightWidth-1:this.labelWidth},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`annotationY`,{get:function(){return-this.view.topContextLayerHeight*(this.layer-1)-(this.view.labelFont.lineHeight+2+2*this.config.labelPadding+this.config.bracketWidth)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`globalY`,{get:function(){return this.lineIn.y+this.annotationY},enumerable:!0,configurable:!0}),_.prototype.render=function(){var e;this.svgElement=document.createElementNS(S.SVGNS,`g`),(e=this.svgElement.classList).add.apply(e,b(this.config.labelClasses));var h=this.createHighLightElement(),g=this.createAnnotationElement(),_=this.view.topContextLayerHeight*(this.layer-1),v=this.createBracketElement(this.highLightWidth,-_,0,-_,this.config.bracketWidth);return this.svgElement.appendChild(h),this.svgElement.appendChild(g),this.svgElement.appendChild(v),this.svgElement},_.prototype.update=function(){this.svgElement.style.transform=`translate(`+this.highLightLeft+`px,`+this.lineIn.y+`px)`},_.prototype.remove=function(){this.svgElement.remove()},_.prototype.createHighLightElement=function(){var e=document.createElementNS(S.SVGNS,`rect`),h=this.store.category.color;return e.setAttribute(`height`,this.lineIn.view.contentFont.lineHeight.toString()),e.setAttribute(`width`,this.highLightWidth.toString()),e.setAttribute(`fill`,/^#/g.test(h)?w.addAlpha(h,70):h),e},_.prototype.createBracketElement=function(e,h,g,_,v,y){y===void 0&&(y=.6);var b=e-g,x=h-_,C=Math.sqrt(b*b+x*x),w=e+y*v*(x/=C),T=h-y*v*(b/=C),E=e-.25*C*b+(1-y)*v*x,D=h-.25*C*x-(1-y)*v*b,O=e-.5*C*b+v*x,k=h-.5*C*x-v*b,A=g+y*v*x,j=_-y*v*b,M=e-.75*C*b+(1-y)*v*x,N=h-.75*C*x-(1-y)*v*b,P=document.createElementNS(S.SVGNS,`path`);return P.setAttribute(`d`,`M`+e+`,`+h+`Q`+w+`,`+T+`,`+E+`,`+D+`T`+O+`,`+k+`M`+g+`,`+_+`Q`+A+`,`+j+`,`+M+`,`+N+`T`+O+`,`+k),P.setAttribute(`fill`,`none`),P.setAttribute(`stroke`,this.store.category.borderColor),P},_.prototype.createAnnotationElement=function(){var e=this,h=this.view.labelCategoryElementFactoryRepository.get(this.store.category.id).create();return h.style.transform=`translate(`+(this.highLightWidth-this.labelWidth)/2+`px,`+this.annotationY+`px)`,h.onclick=function(h){e.view.root.emit(`labelClicked`,e.id,h)},h.ondblclick=function(h){e.view.root.emit(`labelDoubleClicked`,e.id,h)},h.oncontextmenu=function(h){e.view.root.emit(`labelRightClicked`,e.id,h),h.preventDefault()},h.onmouseenter=function(){e.svgElement.classList.add(`hover`),Array.from(e.store.connectionsFrom).map(function(h){return e.view.connectionViewRepository.get(h.id)}).map(function(e){return e.addHover(`from`)}),Array.from(e.store.connectionsTo).map(function(h){return e.view.connectionViewRepository.get(h.id)}).map(function(e){return e.addHover(`to`)})},h.onmouseleave=function(){e.svgElement.classList.remove(`hover`),Array.from(e.store.connectionsFrom).map(function(h){return e.view.connectionViewRepository.get(h.id)}).map(function(e){return e.removeHover(`from`)}),Array.from(e.store.connectionsTo).map(function(h){return e.view.connectionViewRepository.get(h.id)}).map(function(e){return e.removeHover(`to`)})},h},_);function _(e,g,_){var v=h.call(this)||this;return v.store=e,v.contextIn=g,v.config=_,v.layer=0,v.svgElement=null,v}e.Entity=g;var y,T=(y=C.Base.Repository,v(E,y),E.prototype.get=function(e){return this.entities.get(e)},E);function E(){return y!==null&&y.apply(this,arguments)||this}e.Repository=T})(h.LabelView||={})},function(e,h,g){var _,v=this&&this.__extends||(_=function(e,h){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,h){e.__proto__=h}||function(e,h){for(var g in h)h.hasOwnProperty(g)&&(e[g]=h[g])})(e,h)},function(e,h){function g(){this.constructor=e}_(e,h),e.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)}),y=this&&this.__values||function(e){var h=typeof Symbol==`function`&&Symbol.iterator,g=h&&e[h],_=0;if(g)return g.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&_>=e.length&&(e=void 0),{value:e&&e[_++],done:!e}}};throw TypeError(h?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(h,`__esModule`,{value:!0});var b=g(1);(function(e){var h=(Object.defineProperty(g.prototype,`startIndex`,{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`endIndex`,{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),g.prototype.move=function(e){this._startIndex+=e,this._endIndex+=e},Object.defineProperty(g.prototype,`category`,{get:function(){return this.root.labelCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`json`,{get:function(){return{id:this.id,categoryId:this.categoryId,startIndex:this.startIndex,endIndex:this.endIndex}},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`sameLineConnections`,{get:function(){var e,h,g=[];try{for(var _=y(this.root.connectionRepo.values()),v=_.next();!v.done;v=_.next()){var b=v.value;b.priorLabel===this&&g.push(b)}}catch(h){e={error:h}}finally{try{v&&!v.done&&(h=_.return)&&h.call(_)}finally{if(e)throw e.error}}return g},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`connectionsFrom`,{get:function(){var e,h,g=new Set;try{for(var _=y(this.root.connectionRepo.values()),v=_.next();!v.done;v=_.next()){var b=v.value;b.from===this&&g.add(b)}}catch(h){e={error:h}}finally{try{v&&!v.done&&(h=_.return)&&h.call(_)}finally{if(e)throw e.error}}return g},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`connectionsTo`,{get:function(){var e,h,g=new Set;try{for(var _=y(this.root.connectionRepo.values()),v=_.next();!v.done;v=_.next()){var b=v.value;b.to===this&&g.add(b)}}catch(h){e={error:h}}finally{try{v&&!v.done&&(h=_.return)&&h.call(_)}finally{if(e)throw e.error}}return g},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`allConnections`,{get:function(){return new Set(Array.prototype.concat(Array.from(this.connectionsFrom),Array.from(this.connectionsTo)))},enumerable:!0,configurable:!0}),g);function g(e,h,g,_,v){this.id=e,this.categoryId=h,this._startIndex=g,this._endIndex=_,this.root=v}e.Entity=h;var _,x,S=(_=b.Base.Repository,v(C,_),C.prototype.set=function(e,h){return this.againstMultipleLabelWith(h)||_.prototype.set.call(this,e,h),this},C.prototype.add=function(e){return this.againstMultipleLabelWith(e)?-1:_.prototype.add.call(this,e)},C.prototype.againstMultipleLabelWith=function(e){function h(e,h){return e.startIndex===h.startIndex&&e.endIndex===h.endIndex}var g=this.config.allowMultipleLabel===`notAllowed`?h:function(e,g){return h(e,g)&&e.categoryId==g.categoryId};return Array.from(this.values()).some(function(h){return g(h,e)})},C.prototype.getEntitiesInRange=function(e,h){return Array.from(this.entities.values()).filter(function(g){return e<=g.startIndex&&g.endIndex<=h})},C.prototype.getEntitiesCross=function(e){return Array.from(this.entities.values()).filter(function(h){return h.startIndex<=e&&e<h.endIndex})},C);function C(e){var h=_.call(this)||this;return h.config=e,h}function w(e,g){return new h(e.id,e.categoryId,e.startIndex,e.endIndex,g)}e.Repository=S,(x=e.Factory||={}).create=w,x.createAll=function(e,h){return e.map(function(e){return w(e,h)})}})(h.Label||={})},function(e,h,g){var _,v=this&&this.__extends||(_=function(e,h){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,h){e.__proto__=h}||function(e,h){for(var g in h)h.hasOwnProperty(g)&&(e[g]=h[g])})(e,h)},function(e,h){function g(){this.constructor=e}_(e,h),e.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)});Object.defineProperty(h,`__esModule`,{value:!0});var y=g(1);(function(e){var h=(Object.defineProperty(g.prototype,`category`,{get:function(){return this.root.connectionCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`from`,{get:function(){return this.root.labelRepo.get(this.fromId)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`to`,{get:function(){return this.root.labelRepo.get(this.toId)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`priorLabel`,{get:function(){return this.from.startIndex<this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`posteriorLabel`,{get:function(){return this.from.startIndex>=this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`json`,{get:function(){return{id:this.id,categoryId:this.categoryId,fromId:this.fromId,toId:this.toId}},enumerable:!0,configurable:!0}),g);function g(e,h,g,_,v){this.id=e,this.categoryId=h,this.fromId=g,this.toId=_,this.root=v}e.Entity=h;var _,b,x=(_=y.Base.Repository,v(S,_),S.prototype.set=function(e,h){return this.againstMultipleConnectionRuleWith(h)||_.prototype.set.call(this,e,h),this},S.prototype.add=function(e){return this.againstMultipleConnectionRuleWith(e)?-1:_.prototype.add.call(this,e)},S.prototype.againstMultipleConnectionRuleWith=function(e){function h(e,h){return e.from===h.from&&e.to===h.to}var g=this.config.allowMultipleConnection===`notAllowed`?h:function(e,g){return h(e,g)&&e.categoryId==g.categoryId};return Array.from(this.values()).some(function(h){return g(h,e)})},S);function S(e){var h=_.call(this)||this;return h.config=e,h}function C(e,g){return new h(e.id,e.categoryId,e.fromId,e.toId,g)}e.Repository=x,(b=e.Factory||={}).create=C,b.createAll=function(e,h){return e.map(function(e){return C(e,h)})}})(h.Connection||={})},function(e,h,g){var _,v=this&&this.__extends||(_=function(e,h){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,h){e.__proto__=h}||function(e,h){for(var g in h)h.hasOwnProperty(g)&&(e[g]=h[g])})(e,h)},function(e,h){function g(){this.constructor=e}_(e,h),e.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)}),y=this&&this.__read||function(e,h){var g=typeof Symbol==`function`&&e[Symbol.iterator];if(!g)return e;var _,v,y=g.call(e),b=[];try{for(;(h===void 0||0<h--)&&!(_=y.next()).done;)b.push(_.value)}catch(e){v={error:e}}finally{try{_&&!_.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}return b},b=this&&this.__spread||function(){for(var e=[],h=0;h<arguments.length;h++)e=e.concat(y(arguments[h]));return e};Object.defineProperty(h,`__esModule`,{value:!0});var x=g(1),S=g(0),C=g(6);(function(e){var h,g=(h=C.TopContextUser,v(_,h),Object.defineProperty(_.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`lineIn`,{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`view`,{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`sameLineLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.priorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`mayNotSameLineLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.posteriorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`fromLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.from.id)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`toLabelView`,{get:function(){return this.view.labelViewRepository.get(this.store.to.id)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`leftLabelView`,{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`rightLabelView`,{get:function(){return this.fromLabelView.labelLeft>=this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`middle`,{get:function(){return(this.leftLabelView.labelLeft+this.rightLabelView.labelRight)/2},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`textWidth`,{get:function(){return this.view.connectionFont.widthOf(this.store.category.text)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`textLeft`,{get:function(){return this.middle-this.textWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`lineIncludedWidth`,{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.toLabelView.labelRight-this.fromLabelView.labelLeft:this.fromLabelView.labelRight-this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`lineIncludedLeft`,{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView.labelLeft:this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`width`,{get:function(){return this.config.connectionWidthCalcMethod===`text`?this.textWidth:this.lineIncludedWidth},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`left`,{get:function(){return this.config.connectionWidthCalcMethod===`text`?this.textLeft:this.lineIncludedLeft},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,`globalY`,{get:function(){return this.lineIn.y-this.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),_.prototype.render=function(){var e=this;this.svgElement=document.createElementNS(S.SVGNS,`g`);var h=this.view.connectionCategoryElementFactoryRepository.get(this.store.category.id).create();return this.svgElement.appendChild(h),this.svgElement.style.cursor=`pointer`,this.svgElement.onclick=function(h){e.view.root.emit(`connectionClicked`,e.id,h)},this.svgElement.ondblclick=function(h){e.view.root.emit(`connectionDoubleClicked`,e.id,h)},this.svgElement.oncontextmenu=function(h){e.view.root.emit(`connectionRightClicked`,e.id,h),h.preventDefault()},this.svgElement.onmouseenter=function(){e.svgElement.classList.add(`hover`),e.lineElement.classList.add(`hover`)},this.svgElement.onmouseleave=function(){e.svgElement.classList.remove(`hover`),e.lineElement.classList.remove(`hover`)},this.renderLine(),this.svgElement},_.prototype.update=function(){this.svgElement.style.transform=`translate(`+this.textLeft+`px,`+this.globalY+`px)`,this.updateLine()},_.prototype.addHover=function(e){this.svgElement.classList.add(`hover-`+e),this.lineElement.classList.add(`hover-`+e)},_.prototype.removeHover=function(e){this.svgElement.classList.remove(`hover-`+e),this.lineElement.classList.remove(`hover-`+e)},_.prototype.remove=function(){this.svgElement.remove(),this.lineElement.remove()},_.prototype.updateLine=function(){var e=this.globalY+this.view.topContextLayerHeight/2-this.view.labelFont.fontSize+2;this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.lineElement.setAttribute(`d`,`
                    M `+(this.fromLabelView.labelLeft+1)+`   `+(this.fromLabelView.globalY+1)+`
                    C `+(this.fromLabelView.labelLeft-8)+`  `+e+`,
                      `+(this.fromLabelView.labelLeft-8)+`  `+e+`,
                      `+(this.fromLabelView.labelLeft+1)+`   `+e+`
                    L `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+` `+e+`
                    C `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+`  `+e+`,
                      `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+`  `+e+`,
                      `+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+`   `+(this.toLabelView.globalY-1)+`
                `):this.lineElement.setAttribute(`d`,`
                    M `+(this.fromLabelView.labelRight-1)+`   `+(this.fromLabelView.globalY+1)+`
                    C `+(this.fromLabelView.labelRight+8)+`  `+e+`,
                      `+(this.fromLabelView.labelRight+8)+`  `+e+`,
                      `+(this.fromLabelView.labelRight-1)+`   `+e+`
                    L `+this.toLabelView.labelLeft+`          `+e+`
                    C `+(this.toLabelView.labelLeft-8)+`  `+e+`,
                      `+(this.toLabelView.labelLeft-8)+`  `+e+`,
                      `+this.toLabelView.labelLeft+`   `+(this.toLabelView.globalY-1)+`
                `)},_.prototype.renderLine=function(){var e;this.lineElement=document.createElementNS(S.SVGNS,`path`),(e=this.lineElement.classList).add.apply(e,b(this.config.connectionClasses.map(function(e){return e+`-line`}))),this.lineElement.setAttribute(`fill`,`none`),this.lineElement.style.markerEnd=`url(#marker-arrow)`,this.updateLine(),this.contextIn.backgroundElement.appendChild(this.lineElement)},_);function _(e,g,_){var v=h.call(this)||this;return v.store=e,v.contextIn=g,v.config=_,v.svgElement=null,v.lineElement=null,v}e.Entity=g;var y,w=(y=x.Base.Repository,v(T,y),T);function T(){return y!==null&&y.apply(this,arguments)||this}e.Repository=w})(h.ConnectionView||={})},function(e,h,g){var _=this&&this.__read||function(e,h){var g=typeof Symbol==`function`&&e[Symbol.iterator];if(!g)return e;var _,v,y=g.call(e),b=[];try{for(;(h===void 0||0<h--)&&!(_=y.next()).done;)b.push(_.value)}catch(e){v={error:e}}finally{try{_&&!_.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}return b},v=this&&this.__spread||function(){for(var e=[],h=0;h<arguments.length;h++)e=e.concat(_(arguments[h]));return e};Object.defineProperty(h,`__esModule`,{value:!0});var y,b,x=g(0);function S(e,h,g,_,v,y){this.fontFamily=e,this.fontSize=h,this.fontWeight=g,this.lineHeight=_,this.topToBaseLine=v,this.width=y}y=h.Font||={},S.prototype.widthOf=function(e){var h=this;return typeof e==`string`?this.widthOf(Array.from(e)):e.map(function(e){return h.width.get(e)}).reduce(function(e,h){return e+h},0)},b=S,y.ValueObject=b,function(e){function h(e,h,g){var _=new Map,v=new Set(e);v.delete(`
`);var y=Array.from(v);h.textContent=y.join(``),h.parentNode.parentNode.insertBefore(g,h.parentNode),y.forEach(function(e,g){_.set(e,h.getExtentOfChar(g).width)});var x=g.getBoundingClientRect().top-h.getBoundingClientRect().top,S=parseFloat(window.getComputedStyle(h).fontSize),C=window.getComputedStyle(h).fontFamily,w=window.getComputedStyle(h).fontWeight,T=h.getBoundingClientRect().height;return new b(C,S,w,T,x,_)}e.create=h;var g=(_.prototype.thanCreate=function(e,g){var _,y;(_=this.measuringElement.classList).add.apply(_,v(e));var b=h(g,this.measuringElement,this.baseLineReferenceElement);return(y=this.measuringElement.classList).remove.apply(y,v(e)),this.result.push(b),this},_.prototype.endBatch=function(){return this.baseLineReferenceElement.remove(),this.measuringElement.remove(),this.result},_);function _(e,h){this.svgElement=e,this.textElement=h,this.baseLineReferenceElement=document.createElementNS(x.SVGNS,`rect`),this.baseLineReferenceElement.setAttribute(`width`,`1px`),this.baseLineReferenceElement.setAttribute(`height`,`1px`),this.svgElement.appendChild(this.baseLineReferenceElement),this.measuringElement=document.createElementNS(x.SVGNS,`tspan`),this.textElement.appendChild(this.measuringElement),this.result=[]}e.startBatch=function(e,h){return new g(e,h)}}(y.Factory||={}),(y.Service||={}).measureMore=function(e,h,g,_){var y,b=new Set(h);b.delete(`
`);var S=Array.from(b).filter(function(h){return!e.width.has(h)});if(0<S.length){var C=document.createElementNS(x.SVGNS,`tspan`);(y=C.classList).add.apply(y,v(g)),C.textContent=S.join(``),_.appendChild(C),S.forEach(function(h,g){e.width.set(h,C.getExtentOfChar(g).width)}),C.remove()}return e}},function(e,h,g){Object.defineProperty(h,`__esModule`,{value:!0}),h.Annotator=g(13).Annotator;var _=g(27),v=g(28),y=g(29);h.Action={Connection:_.Connection,Label:v.Label,Content:y.Content}},function(e,h,g){var _,v=this&&this.__extends||(_=function(e,h){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,h){e.__proto__=h}||function(e,h){for(var g in h)h.hasOwnProperty(g)&&(e[g]=h[g])})(e,h)},function(e,h){function g(){this.constructor=e}_(e,h),e.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)});Object.defineProperty(h,`__esModule`,{value:!0});var y,b=g(3),x=g(14),S=g(17),C=g(0),w=g(24),T=g(25),E=g(26),D=(y=b.EventEmitter,v(O,y),O.prototype.applyAction=function(e){e.apply(this.store)},O.prototype.export=function(){this.view.contentEditor.hide();var e=this.view.svgElement.outerHTML.replace(/&nbsp;/,` `);return this.view.contentEditor.show(),e},O.prototype.remove=function(){this.view.svgElement.remove(),this.store.config.contentEditable&&this.view.contentEditor.remove()},O);function O(e,h,g){var _=y.call(this)||this;_.containerElement=h,_.configInput=g;var v=w.parseInput(g||{});_.store=new x.Store(v),_.store.json=typeof e==`string`?JSON.parse(e):e;var b=document.createElementNS(C.SVGNS,`svg`);return b.setAttribute(`xmlns`,C.SVGNS),h.appendChild(b),_.view=new S.View(_,b,v),_.textSelectionHandler=new T.TextSelectionHandler(_,v),_.twoLabelsClickedHandler=new E.TwoLabelsClickedHandler(_,v),_}h.Annotator=D},function(e,h,g){var _,v=this&&this.__extends||(_=function(e,h){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,h){e.__proto__=h}||function(e,h){for(var g in h)h.hasOwnProperty(g)&&(e[g]=h[g])})(e,h)},function(e,h){function g(){this.constructor=e}_(e,h),e.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)});Object.defineProperty(h,`__esModule`,{value:!0});var y,b=g(15),x=g(8),S=g(16),C=g(9),w=(y=g(3).EventEmitter,v(T,y),Object.defineProperty(T.prototype,`content`,{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(T.prototype,`json`,{get:function(){return{content:this._content,labelCategories:this.labelCategoryRepo.json,labels:this.labelRepo.json,connectionCategories:this.connectionCategoryRepo.json,connections:this.connectionRepo.json}},set:function(e){var h=this;this._content=e.content.endsWith(`
`)?e.content:e.content+`
`,b.LabelCategory.Factory.createAll(e.labelCategories,this.config).map(function(e){return h.labelCategoryRepo.add(e)}),x.Label.Factory.createAll(e.labels,this).map(function(e){return h.labelRepo.add(e)}),e.connectionCategories.map(function(e){return h.connectionCategoryRepo.add(e)}),C.Connection.Factory.createAll(e.connections,this).map(function(e){return h.connectionRepo.add(e)})},enumerable:!0,configurable:!0}),T.prototype.contentSlice=function(e,h){return this.content.slice(e,h)},T.prototype.moveLabels=function(e,h){Array.from(this.labelRepo.values()).filter(function(h){return h.startIndex>=e}).map(function(e){return e.move(h)})},T.prototype.spliceContent=function(e,h){var g=[...arguments].slice(2),_=e+h;if(h===0||Array.from(this.labelRepo.values()).find(function(h){return h.startIndex<=e&&e<h.endIndex||h.startIndex<_&&_<h.endIndex})===void 0){var v=this.content.slice(0,e),y=this.content.slice(e,e+h),b=g.join(``),x=this.content.slice(e+h);this._content=v+b+x,this.moveLabels(e+h,b.length-y.length),this.emit(`contentSpliced`,e,y,b)}},T);function T(e){var h=y.call(this)||this;return h._content=``,h.config=e,h.labelCategoryRepo=new b.LabelCategory.Repository,h.labelRepo=new x.Label.Repository(e),h.connectionCategoryRepo=new S.ConnectionCategory.Repository,h.connectionRepo=new C.Connection.Repository(e),h}h.Store=w},function(e,h,g){var _,v=this&&this.__extends||(_=function(e,h){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,h){e.__proto__=h}||function(e,h){for(var g in h)h.hasOwnProperty(g)&&(e[g]=h[g])})(e,h)},function(e,h){function g(){this.constructor=e}_(e,h),e.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)});Object.defineProperty(h,`__esModule`,{value:!0});var y,b,x,S,C=g(1),w=g(5);function T(){return b!==null&&b.apply(this,arguments)||this}function E(e,h){var g=e.borderColor,_=e.color;return!e.borderColor&&e[`border-color`]&&(g=e[`border-color`]),e.color||(_=h),e.borderColor||(g=w.shadeColor(_,-30)),{id:e.id,text:e.text,color:_,borderColor:g}}y=h.LabelCategory||={},b=C.Base.Repository,v(T,b),S=T,y.Repository=S,(x=y.Factory||={}).create=E,x.createAll=function(e,h){return e.map(function(e){return E(e,h.defaultLabelColor)})}},function(e,h,g){var _,v=this&&this.__extends||(_=function(e,h){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,h){e.__proto__=h}||function(e,h){for(var g in h)h.hasOwnProperty(g)&&(e[g]=h[g])})(e,h)},function(e,h){function g(){this.constructor=e}_(e,h),e.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)});Object.defineProperty(h,`__esModule`,{value:!0});var y,b,x,S=g(1);function C(){return b!==null&&b.apply(this,arguments)||this}y=h.ConnectionCategory||={},b=S.Base.Repository,v(C,b),x=C,y.Repository=x},function(e,h,g){var _=this&&this.__read||function(e,h){var g=typeof Symbol==`function`&&e[Symbol.iterator];if(!g)return e;var _,v,y=g.call(e),b=[];try{for(;(h===void 0||0<h--)&&!(_=y.next()).done;)b.push(_.value)}catch(e){v={error:e}}finally{try{_&&!_.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}return b},v=this&&this.__spread||function(){for(var e=[],h=0;h<arguments.length;h++)e=e.concat(_(arguments[h]));return e},y=this&&this.__values||function(e){var h=typeof Symbol==`function`&&Symbol.iterator,g=h&&e[h],_=0;if(g)return g.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&_>=e.length&&(e=void 0),{value:e&&e[_++],done:!e}}};throw TypeError(h?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(h,`__esModule`,{value:!0});var b=g(0),x=g(18),S=g(11),C=g(21),w=g(7),T=g(10),E=g(22),D=g(23),O=g(2),k=(A.layoutTopContextsAfter=function(e){for(;e.next.isSome;)e.topContext.update(),e=e.next.toNullable();e.topContext.update()},A.prototype.constructLabelViewsForLine=function(e){var h=this,g=this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map(function(g){return new w.LabelView.Entity(g,e.topContext,h.config)});return g.map(function(e){return h.labelViewRepository.add(e)}),g.map(function(h){return e.topContext.addChild(h)}),g},A.prototype.constructConnectionsForLine=function(e){var h=this;return this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map(function(g){var _=g.sameLineConnections.filter(function(e){return!h.connectionViewRepository.has(e.id)}).map(function(g){return new T.ConnectionView.Entity(g,e.topContext,h.config)});return _.map(function(e){return h.connectionViewRepository.add(e)}),_.map(function(h){return e.topContext.addChild(h)}),_}).reduce(function(e,h){return e.concat(h)},[])},Object.defineProperty(A.prototype,`height`,{get:function(){var e=this;return this.lines.reduce(function(h,g){return h+g.height+e.contentFont.fontSize*(e.config.lineHeight-1)},20)},enumerable:!0,configurable:!0}),A.createMarkerElement=function(){var e=document.createElementNS(b.SVGNS,`path`);e.setAttribute(`d`,`M0,4 L0,8 L6,6 L0,4 L0,8`),e.setAttribute(`stroke`,`#000000`),e.setAttribute(`fill`,`#000000`);var h=document.createElementNS(b.SVGNS,`marker`);return h.setAttribute(`id`,`marker-arrow`),h.setAttribute(`markerWidth`,`8`),h.setAttribute(`markerHeight`,`10`),h.setAttribute(`orient`,`auto`),h.setAttribute(`refX`,`5`),h.setAttribute(`refY`,`6`),h.appendChild(e),h},A.prototype.contentWidth=function(e,h){return this.contentFont.widthOf(this.store.contentSlice(e,h))},A.prototype.removeLine=function(e){var h=this;e.remove(),e.topContext.children.forEach(function(e){e instanceof w.LabelView.Entity?h.labelViewRepository.delete(e):e instanceof T.ConnectionView.Entity&&h.connectionViewRepository.delete(e)})},A.prototype.registerEventHandlers=function(){var e=this;this.textElement.onmouseup=function(h){window.getSelection().type===`Range`?e.root.textSelectionHandler.textSelected():e.config.contentEditable&&e.contentEditor.caretChanged(h.clientY)},this.store.labelRepo.on(`created`,this.onLabelCreated.bind(this)),this.store.labelRepo.on(`removed`,function(h){var g=e.labelViewRepository.get(h.id);g.lineIn.topContext.removeChild(g),g.remove(),e.labelViewRepository.delete(g),g.lineIn.topContext.update(),g.lineIn.update(),A.layoutTopContextsAfter(g.lineIn),e.config.contentEditable&&e.contentEditor.update()}),this.store.connectionRepo.on(`created`,this.onConnectionCreated.bind(this)),this.store.connectionRepo.on(`removed`,function(h){var g=e.connectionViewRepository.get(h.id);g.lineIn.topContext.removeChild(g),g.remove(),e.connectionViewRepository.delete(g),g.lineIn.topContext.update(),g.lineIn.update(),A.layoutTopContextsAfter(g.lineIn),e.config.contentEditable&&e.contentEditor.update()}),this.config.contentEditable&&this.store.on(`contentSpliced`,this.onContentSpliced.bind(this))},A.prototype.rerenderLines=function(e,h){for(var g,_,b,S,C,w,T,E=this.lines[0].svgElement.parentElement,D=e;D<=h;++D)this.removeLine(this.lines[D]);var k=this.lines[e],A=this.lines[h],j=x.Line.Service.divide(this,k.startIndex,A.endIndex);for(j.length!==0&&(j[0].last=k.last,k.last.map(function(e){return e.next=O.some(j[0])}),j[j.length-1].next=A.next,A.next.map(function(e){return e.last=O.some(j[j.length-1])}),(g=this.lines).splice.apply(g,v([e,h-e+1],j)),e===0?A.next.isSome?j[0].insertBefore(A.next):j[0].insertInto(E):j[0].insertAfter(k.last)),D=1;D<j.length;++D)j[D].insertAfter(O.some(j[D-1]));function M(e){N.constructLabelViewsForLine(e).map(function(h){return e.topContext.renderChild(h)})}var N=this;try{for(var P=y(j),F=P.next();!F.done;F=P.next())M(H=F.value)}catch(e){_={error:e}}finally{try{F&&!F.done&&(b=P.return)&&b.call(P)}finally{if(_)throw _.error}}function I(e){L.constructConnectionsForLine(e).map(function(h){return e.topContext.renderChild(h)})}var L=this;try{for(var R=y(j),z=R.next();!z.done;z=R.next())I(H=z.value)}catch(e){S={error:e}}finally{try{z&&!z.done&&(C=R.return)&&C.call(R)}finally{if(S)throw S.error}}try{for(var B=y(j),V=B.next();!V.done;V=B.next()){var H;(H=V.value).update(),H.topContext.update()}}catch(e){w={error:e}}finally{try{V&&!V.done&&(T=B.return)&&T.call(B)}finally{if(w)throw w.error}}},A.prototype.onLabelCreated=function(e){var h=_(this.findRangeInLines(e.startIndex,e.endIndex),2),g=h[0];if(h[1]===g+1){var v=this.lines[g],y=new w.LabelView.Entity(e,v.topContext,this.config);this.labelViewRepository.add(y),v.topContext.addChild(y),v.topContext.renderChild(y),v.topContext.update(),v.update()}else{var b=this.findHardLineEndsInIndex(g);this.rerenderLines(g,b)}A.layoutTopContextsAfter(this.lines[g]),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},A.prototype.findRangeInLines=function(e,h){var g=0,_=0;return this.lines.forEach(function(v,y){v.startIndex<=e&&e<v.endIndex&&(g=y),v.startIndex<=h-1&&h-1<v.endIndex&&(_=y+1)}),[g,_]},A.prototype.onConnectionCreated=function(e){var h=this.labelViewRepository.get(e.priorLabel.id),g=h.lineIn.topContext,_=new T.ConnectionView.Entity(e,g,this.config);this.connectionViewRepository.add(_),g.addChild(_),g.renderChild(_),g.update(),h.lineIn.update(),A.layoutTopContextsAfter(h.lineIn),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},A.prototype.onContentSpliced=function(e,h,g){h!==``&&this.onRemoved(e,h),g!==``&&this.onInserted(e,g)},A.prototype.onRemoved=function(e,h){var g=_(this.findRangeInLines(e,e+1),2),v=g[0];g[1],this.lines[v].startIndex===e-h.length?this.lines[v].move(-h.length):this.lines[v].inserted(-h.length);for(var y=v+1;y<this.lines.length;)this.lines[y].move(-h.length),++y;var b=this.findHardLineEndsInIndex(v);if(h===`
`&&this.lines[v].isBlank){var x=this.lines[v].last,S=this.lines[v].next;this.lines[v].remove(),this.lines.splice(v,1),x.map(function(e){return e.next=S}),S.map(function(e){return e.last=x})}else this.rerenderLines(v,b);A.layoutTopContextsAfter(this.lines[b-1]);var C=Array.from(h).filter(function(e){return e===`
`}).length;C===0?(this.contentEditor.characterIndex-=h.length,this.contentEditor.avoidInLabel(`forward`)):0<=this.contentEditor.lineIndex-C&&(this.contentEditor.lineIndex-=C,this.contentEditor.characterIndex=this.contentEditor.line.content.length,this.contentEditor.avoidInLabel(`forward`)),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},A.prototype.onInserted=function(e,h){var g=_(this.findRangeInLines(e,e+1),2),v=g[0];g[1],this.lines[v].startIndex===e+h.length?this.lines[v].move(h.length):this.lines[v].inserted(h.length);for(var y=v+1;y<this.lines.length;)this.lines[y].move(h.length),++y;var b=this.findHardLineEndsInIndex(v);this.rerenderLines(v,b),A.layoutTopContextsAfter(this.lines[b]);var x=Array.from(h),S=x.filter(function(e){return e===`
`}).length,C=x.lastIndexOf(`
`),w=h.length-C;S===0?this.contentEditor.characterIndex+=h.length:(this.contentEditor.lineIndex+=S,this.contentEditor.characterIndex=w-1),this.contentEditor.avoidInLabel(`forward`),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+`px`},A.prototype.findHardLineEndsInIndex=function(e){var h;for(h=e;h<this.lines.length-1&&!this.lines[h].endWithHardLineBreak;++h);return h},A.prototype.collectStyle=function(){var e=document.createElementNS(b.SVGNS,`style`),h=`
        `+this.config.contentClasses.map(function(e){return`.`+e}).join(`,`)+` {
            font-family: `+this.contentFont.fontFamily+`;
            font-weight: `+this.contentFont.fontWeight+`;
            font-size: `+this.contentFont.fontSize+`px;
            line-height: `+this.contentFont.lineHeight+`px;
        }
        `,g=`
        `+this.config.labelClasses.map(function(e){return`.`+e}).join(`,`)+` {
            font-family: `+this.labelFont.fontFamily+`;
            font-weight: `+this.labelFont.fontWeight+`;
            font-size: `+this.labelFont.fontSize+`px;
        }
        `,_=this.config.connectionClasses.map(function(e){return`.`+e}).join(`,`),v=this.config.connectionClasses.map(function(e){return`.`+e+`-line`}).join(`,`),y=`
        `+_+` {
            font-family: `+this.connectionFont.fontFamily+`;
            font-weight: `+this.connectionFont.fontWeight+`;
            font-size: `+this.connectionFont.fontSize+`px;
        }
        `+v+` {
            stroke: #000;
        }
        `;return e.innerHTML=h+g+y,e},Object.defineProperty(A.prototype,`paddingLeft`,{get:function(){var e=this;return Math.max.apply(Math,v(Array.from(this.store.labelCategoryRepo.values()).map(function(h){return e.labelFont.widthOf(h.text)})))/2+1},enumerable:!0,configurable:!0}),A);function A(e,h,g){var y,O,k;this.root=e,this.svgElement=h,this.config=g,this.contentEditor=null,this.store=e.store,this.labelViewRepository=new w.LabelView.Repository,this.connectionViewRepository=new T.ConnectionView.Repository,this.markerElement=A.createMarkerElement(),this.svgElement.appendChild(this.markerElement),this.textElement=document.createElementNS(b.SVGNS,`text`),this.textElement.style.whiteSpace=`pre`,this.textElement.style.wordWrap=`normal`,this.svgElement.appendChild(this.textElement);var j=Array.from(this.store.labelCategoryRepo.values()).map(function(e){return e.text}).join(``),M=Array.from(this.store.connectionCategoryRepo.values()).map(function(e){return e.text}).join(``);y=_(S.Font.Factory.startBatch(h,this.textElement).thanCreate(g.contentClasses,this.store.content).thanCreate(g.labelClasses,j).thanCreate(g.connectionClasses,M).endBatch(),3),this.contentFont=y[0],this.labelFont=y[1],this.connectionFont=y[2];var N=this.labelFont.lineHeight+2+2*g.labelPadding+g.bracketWidth;this.topContextLayerHeight=2*g.topContextMargin+Math.max(N,this.connectionFont.lineHeight),(O=this.textElement.classList).add.apply(O,v(g.contentClasses)),this.labelCategoryElementFactoryRepository=new C.LabelCategoryElement.FactoryRepository(this,g),this.connectionCategoryElementFactoryRepository=new E.ConnectionCategoryElement.FactoryRepository(this,g),this.lineMaxWidth=h.width.baseVal.value-2*this.paddingLeft,this.lines=x.Line.Service.divide(this,0,this.store.content.length),this.lines.map(this.constructLabelViewsForLine.bind(this)),this.lines.map(this.constructConnectionsForLine.bind(this));var P=this.lines.map(function(e){return e.render()});if((k=this.textElement).append.apply(k,v(P)),this.svgElement.style.height=this.height.toString()+`px`,this.registerEventHandlers(),this.config.contentEditable){this.contentEditor=new D.ContentEditor(this);var F=_(this.contentEditor.render(),2),I=F[0],L=F[1];this.svgElement.appendChild(I),this.svgElement.parentNode.insertBefore(L,this.svgElement)}this.svgElement.appendChild(this.collectStyle())}h.View=k},function(e,h,g){var _=this&&this.__read||function(e,h){var g=typeof Symbol==`function`&&e[Symbol.iterator];if(!g)return e;var _,v,y=g.call(e),b=[];try{for(;(h===void 0||0<h--)&&!(_=y.next()).done;)b.push(_.value)}catch(e){v={error:e}}finally{try{_&&!_.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}return b},v=this&&this.__values||function(e){var h=typeof Symbol==`function`&&Symbol.iterator,g=h&&e[h],_=0;if(g)return g.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&_>=e.length&&(e=void 0),{value:e&&e[_++],done:!e}}};throw TypeError(h?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(h,`__esModule`,{value:!0});var y=g(2),b=g(0),x=g(19),S=g(20);(function(e){var h=(Object.defineProperty(g.prototype,`startIndex`,{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`endIndex`,{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),g.prototype.move=function(e){this._startIndex+=e,this._endIndex+=e},g.prototype.inserted=function(e){this._endIndex+=e},Object.defineProperty(g.prototype,`dy`,{get:function(){return this.last.match(this.view.contentFont.fontSize*this.config.lineHeight,this.view.contentFont.topToBaseLine)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`height`,{get:function(){return this.topContext.layer*this.view.topContextLayerHeight+this.view.contentFont.fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`y`,{get:function(){var e=this;return S.takeWhile(this.view.lines,function(h){return h!==e}).reduce(function(h,g){return h+g.height+e.view.contentFont.fontSize*(e.config.lineHeight-1)},0)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`isBlank`,{get:function(){return this.view.store.content.slice(this.startIndex,this.endIndex-1)===``},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`content`,{get:function(){return this.endWithHardLineBreak?this.isBlank?``:this.view.store.content.slice(this.startIndex,this.endIndex-1):this.view.store.content.slice(this.startIndex,this.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,`endWithHardLineBreak`,{get:function(){return this.view.store.content[this.endIndex-1]===`
`},enumerable:!0,configurable:!0}),g.prototype.update=function(){this.svgElement.innerHTML=this.content.replace(/ /g,`&nbsp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`),this.isBlank&&(this.svgElement.style.fontSize=this.view.contentFont.fontSize/4+`px`),this.svgElement.setAttribute(`x`,this.view.paddingLeft.toString()),this.svgElement.setAttribute(`dy`,this.dy.toString()+`px`)},g.prototype.render=function(){this.svgElement=document.createElementNS(b.SVGNS,`tspan`);var e=_(this.topContext.render(),2),h=e[0],g=e[1];return this.view.svgElement.insertBefore(h,this.view.textElement),this.view.markerElement.insertAdjacentElement(`afterend`,g),Object.assign(this.svgElement,{annotatorElement:this}),this.update(),this.svgElement},g.prototype.remove=function(){this.topContext.remove(),this.svgElement.remove()},g.prototype.insertBefore=function(e){var h=this;this.render(),e.map(function(e){e.svgElement.parentNode.insertBefore(h.svgElement,e.svgElement),e.topContext.svgElement.parentNode.insertBefore(h.topContext.svgElement,e.topContext.svgElement),e.topContext.backgroundElement.parentNode.insertBefore(h.topContext.backgroundElement,e.topContext.backgroundElement)})},g.prototype.insertAfter=function(e){var h=this;this.render(),e.map(function(e){e.svgElement.insertAdjacentElement(`afterend`,h.svgElement),e.topContext.svgElement.insertAdjacentElement(`afterend`,h.topContext.svgElement),e.topContext.backgroundElement.insertAdjacentElement(`afterend`,h.topContext.backgroundElement)})},g.prototype.insertInto=function(e){this.render(),e.appendChild(this.svgElement)},g);function g(e,h,g,_,v){this.last=g,this.next=_,this.view=v,this.svgElement=null,this._startIndex=e,this._endIndex=h,this.topContext=new x.TopContext(this),this.config=v.config}e.ValueObject=h;var C=(Object.defineProperty(w.prototype,`store`,{get:function(){return this.view.store},enumerable:!0,configurable:!0}),w.prototype.divide=function(e,h){var g,_;this.init();var b=e,x=e+1;do{var S=this.mergeLabel(x),C=this.mergeWord(S),w=S===x&&S===C;this.store.content[x-1]===`
`?(this.tokenQueue.length===0?this.reduce(x-1,x):this.reduce(this.tokenQueue[0].startIndex,x),b=x):w&&(this.shiftWithAutoReduce({startIndex:b,endIndex:x}),b=x),++x}while(b<h);function T(e){E.map(function(h){return h.next=y.some(e)}),e.last=E,E=y.some(e)}this.tokenQueue.length!==0&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex);var E=y.none;try{for(var D=v(this.result),O=D.next();!O.done;O=D.next())T(O.value)}catch(e){g={error:e}}finally{try{O&&!O.done&&(_=D.return)&&_.call(D)}finally{if(g)throw g.error}}return this.result},w.prototype.init=function(){this.result=[],this.tokenQueue=[]},w.prototype.mergeLabel=function(e){return this.store.labelRepo.getEntitiesCross(e-1).some(function(h){return h.endIndex>e})?this.store.labelRepo.getEntitiesCross(e-1).filter(function(h){return h.endIndex>e}).sort(function(e,h){return h.endIndex-e.endIndex})[0].endIndex:e},w.prototype.mergeWord=function(e){w.wordReg.lastIndex=0;var h=w.wordReg.exec(this.store.contentSlice(e-1,e+1));return h===null?e:h[0].length===2?e+1:e},w.prototype.reduce=function(h,g){var _=new e.ValueObject(h,g,y.none,y.none,this.view);this.result.push(_),this.tokenQueue=[]},w.prototype.shiftWithAutoReduce=function(e){var h=this.tokenQueue.length===0?0:this.view.contentWidth(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),g=this.view.contentWidth(e.startIndex,e.endIndex);this.tokenQueue.length!==0&&h+g>this.view.lineMaxWidth&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),g>this.view.lineMaxWidth?this.reduce(e.startIndex,e.endIndex):this.tokenQueue.push(e)},w.wordReg=/([a-zA-z][a-zA-Z0-9']*[-|.]?)|([+\-]?[0-9.][0-9.%]*)/g,w);function w(e){this.view=e,this.result=[],this.tokenQueue=[]}(e.Service||={}).divide=function(e,h,g){return new C(e).divide(h,g)}})(h.Line||={})},function(e,h,g){var _=this&&this.__read||function(e,h){var g=typeof Symbol==`function`&&e[Symbol.iterator];if(!g)return e;var _,v,y=g.call(e),b=[];try{for(;(h===void 0||0<h--)&&!(_=y.next()).done;)b.push(_.value)}catch(e){v={error:e}}finally{try{_&&!_.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}return b},v=this&&this.__spread||function(){for(var e=[],h=0;h<arguments.length;h++)e=e.concat(_(arguments[h]));return e},y=this&&this.__values||function(e){var h=typeof Symbol==`function`&&Symbol.iterator,g=h&&e[h],_=0;if(g)return g.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&_>=e.length&&(e=void 0),{value:e&&e[_++],done:!e}}};throw TypeError(h?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(h,`__esModule`,{value:!0});var b=g(0),x=g(6),S=g(10),C=g(4),w=g(7),T=(Object.defineProperty(E.prototype,`layer`,{get:function(){return this.children.size===0?0:Math.max.apply(Math,v(Array.from(this.children).map(function(e){return e.layer})))},enumerable:!0,configurable:!0}),E.prototype.update=function(){var e=this;this.children.forEach(function(e){return e.update()}),Array.from(this.children).filter(function(e){return e instanceof w.LabelView.Entity}).map(function(h){h.store.allConnections.forEach(function(g){if(e.belongTo.view.connectionViewRepository.has(g.id)){var _=e.belongTo.view.connectionViewRepository.get(g.id);_.mayNotSameLineLabelView===h&&_.update()}})})},E.prototype.render=function(){var e=this;return this.svgElement=document.createElementNS(b.SVGNS,`g`),this.backgroundElement=document.createElementNS(b.SVGNS,`g`),this.children.forEach(function(h){e.renderChild(h)}),this.update(),[this.svgElement,this.backgroundElement]},E.prototype.addChild=function(e){var h,g,_=this.layer,v=!1;e instanceof S.ConnectionView.Entity&&(e.layer=e.sameLineLabelView.layer);do{++e.layer,v=!1;try{for(var b=(h=void 0,y(this.children)),C=b.next();!C.done;C=b.next()){var w=C.value;if(x.overLaps(e,w)){v=!0;break}}}catch(e){h={error:e}}finally{try{C&&!C.done&&(g=b.return)&&g.call(b)}finally{if(h)throw h.error}}}while(v);return this.children.add(e),this.layer-_},E.prototype.renderChild=function(e){C.assert(this.children.has(e));var h=e.render();this.svgElement.appendChild(h)},E.prototype.removeChild=function(e){C.assert(this.children.has(e)),this.children.delete(e)},E.prototype.remove=function(){this.svgElement.remove(),this.backgroundElement.remove()},E);function E(e){this.backgroundElement=null,this.svgElement=null,this.children=new Set,this.belongTo=e}h.TopContext=T},function(e,h,g){Object.defineProperty(h,`__esModule`,{value:!0});var _=g(2);h.lookup=function(e,h){return e.length<=h?_.none:_.some(e[h])},h.takeWhile=function(e,h){var g;for(g=0;g<e.length&&h(e[g]);++g);return e.slice(0,g)}},function(e,h,g){var _,v=this&&this.__extends||(_=function(e,h){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,h){e.__proto__=h}||function(e,h){for(var g in h)h.hasOwnProperty(g)&&(e[g]=h[g])})(e,h)},function(e,h){function g(){this.constructor=e}_(e,h),e.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)}),y=this&&this.__values||function(e){var h=typeof Symbol==`function`&&Symbol.iterator,g=h&&e[h],_=0;if(g)return g.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&_>=e.length&&(e=void 0),{value:e&&e[_++],done:!e}}};throw TypeError(h?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(h,`__esModule`,{value:!0});var b,x,S,C,w=g(1),T=g(0),E=g(5);function D(e,h,g,_){this.store=e,this.font=h,this.padding=g,this.svgElement=document.createElementNS(T.SVGNS,`g`);var v=document.createElementNS(T.SVGNS,`rect`);v.setAttribute(`fill`,/^#/g.test(e.color)?E.addAlpha(e.color,_):e.color),v.setAttribute(`stroke`,e.borderColor),v.setAttribute(`width`,this.width.toString()),v.setAttribute(`height`,(h.lineHeight+2*g).toString()),v.setAttribute(`rx`,(2*g).toString()),v.style.cursor=`pointer`;var y=document.createElementNS(T.SVGNS,`text`);y.style.userSelect=`none`,y.style.cursor=`pointer`,y.textContent=e.text,y.setAttribute(`dx`,g.toString()),y.setAttribute(`dy`,h.topToBaseLine+g+`px`),this.svgElement.appendChild(v),this.svgElement.appendChild(y)}function O(e,h){var g,_,v=S.call(this)||this;try{for(var b=y(e.store.labelCategoryRepo.values()),C=b.next();!C.done;C=b.next()){var w=C.value;v.add(new x(w,e.labelFont,h.labelPadding,h.labelOpacity))}}catch(e){g={error:e}}finally{try{C&&!C.done&&(_=b.return)&&_.call(b)}finally{if(g)throw g.error}}return v}b=h.LabelCategoryElement||={},Object.defineProperty(D.prototype,`width`,{get:function(){return this.font.widthOf(this.store.text)+2*this.padding},enumerable:!0,configurable:!0}),D.prototype.create=function(){return this.svgElement.cloneNode(!0)},Object.defineProperty(D.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),x=D,S=w.Base.Repository,v(O,S),C=O,b.FactoryRepository=C},function(e,h,g){var _,v=this&&this.__extends||(_=function(e,h){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,h){e.__proto__=h}||function(e,h){for(var g in h)h.hasOwnProperty(g)&&(e[g]=h[g])})(e,h)},function(e,h){function g(){this.constructor=e}_(e,h),e.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)}),y=this&&this.__read||function(e,h){var g=typeof Symbol==`function`&&e[Symbol.iterator];if(!g)return e;var _,v,y=g.call(e),b=[];try{for(;(h===void 0||0<h--)&&!(_=y.next()).done;)b.push(_.value)}catch(e){v={error:e}}finally{try{_&&!_.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}return b},b=this&&this.__spread||function(){for(var e=[],h=0;h<arguments.length;h++)e=e.concat(y(arguments[h]));return e},x=this&&this.__values||function(e){var h=typeof Symbol==`function`&&Symbol.iterator,g=h&&e[h],_=0;if(g)return g.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&_>=e.length&&(e=void 0),{value:e&&e[_++],done:!e}}};throw TypeError(h?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(h,`__esModule`,{value:!0});var S,C,w,T,E=g(1),D=g(0);function O(e,h,g){var _;this.store=e,this.svgElement=document.createElementNS(D.SVGNS,`g`);var v=document.createElementNS(D.SVGNS,`rect`);v.setAttribute(`fill`,`#ffffff`),v.setAttribute(`width`,h.widthOf(e.text).toString()),v.setAttribute(`height`,h.lineHeight.toString());var y=document.createElementNS(D.SVGNS,`text`);(_=y.classList).add.apply(_,b(g)),y.textContent=e.text,y.setAttribute(`dy`,h.topToBaseLine+`px`),this.svgElement.appendChild(v),this.svgElement.appendChild(y)}function k(e,h){var g,_,v=w.call(this)||this;v.config=h;try{for(var y=x(e.store.connectionCategoryRepo.values()),b=y.next();!b.done;b=y.next()){var S=b.value;w.prototype.add.call(v,new C(S,e.connectionFont,h.connectionClasses))}}catch(e){g={error:e}}finally{try{b&&!b.done&&(_=y.return)&&_.call(y)}finally{if(g)throw g.error}}return v}S=h.ConnectionCategoryElement||={},Object.defineProperty(O.prototype,`id`,{get:function(){return this.store.id},enumerable:!0,configurable:!0}),O.prototype.create=function(){return this.svgElement.cloneNode(!0)},C=O,w=E.Base.Repository,v(k,w),T=k,S.FactoryRepository=T},function(e,h,g){var _=this&&this.__read||function(e,h){var g=typeof Symbol==`function`&&e[Symbol.iterator];if(!g)return e;var _,v,y=g.call(e),b=[];try{for(;(h===void 0||0<h--)&&!(_=y.next()).done;)b.push(_.value)}catch(e){v={error:e}}finally{try{_&&!_.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}return b},v=this&&this.__spread||function(){for(var e=[],h=0;h<arguments.length;h++)e=e.concat(_(arguments[h]));return e};Object.defineProperty(h,`__esModule`,{value:!0});var y=g(0),b=g(11),x=g(7),S=(Object.defineProperty(C.prototype,`characterIndex`,{get:function(){return this._characterIndex},set:function(e){this.view.lines[this._lineIndex].isBlank?this._characterIndex=0:this._characterIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,`lineIndex`,{get:function(){return this._lineIndex},set:function(e){this._lineIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,`line`,{get:function(){return this.view.lines[this.lineIndex]},enumerable:!0,configurable:!0}),C.prototype.render=function(){var e=this;return this.constructCaretElement(),this.constructHiddenTextAreaElement(),this.parentSVGYOffset=this.view.svgElement.getBoundingClientRect().top-document.getElementsByTagName(`html`)[0].getBoundingClientRect().top,this.hiddenTextAreaElement.onkeyup=function(h){if(!e.inComposition){switch(h.key){case`ArrowLeft`:e.characterIndex===0?e.line.last.isSome&&(--e.lineIndex,e.characterIndex=e.line.content.length):(--e.characterIndex,e.avoidInLabel(`backward`));break;case`ArrowRight`:e.characterIndex>=e.line.content.length||e.line.isBlank?e.line.next.isSome&&(++e.lineIndex,e.characterIndex=0):(++e.characterIndex,e.avoidInLabel(`forward`));break;case`ArrowUp`:e.line.last.isSome&&--e.lineIndex,e.characterIndex=Math.min(e.characterIndex,e.line.content.length),e.avoidInLabel(`forward`);break;case`ArrowDown`:e.line.next.isSome&&++e.lineIndex,e.characterIndex=Math.min(e.characterIndex,e.line.content.length),e.avoidInLabel(`forward`);break;case`Backspace`:var g=e.line.startIndex+e.characterIndex-1;e.view.root.emit(`contentDelete`,g,1);break;default:if(e.hiddenTextAreaElement.value!==``){b.Font.Service.measureMore(e.view.contentFont,e.hiddenTextAreaElement.value,e.view.config.contentClasses,e.view.textElement);var _=e.view.lines[e._lineIndex].startIndex+e.characterIndex;e.view.root.emit(`contentInput`,_,e.hiddenTextAreaElement.value),e.hiddenTextAreaElement.value=``}}e.update()}},this.hiddenTextAreaElement.addEventListener(`compositionstart`,function(){e.inComposition=!0}),this.hiddenTextAreaElement.addEventListener(`compositionend`,function(){e.inComposition=!1}),this.update(),this.hiddenTextAreaElement.style.opacity=`0`,[this.cursorElement,this.hiddenTextAreaElement]},C.prototype.avoidInLabel=function(e){for(var h=this.line.startIndex+this.characterIndex,g=Array.from(this.line.topContext.children).filter(function(e){return e instanceof x.LabelView.Entity}),_=g.find(function(e){return e.store.startIndex<=h-1&&h<e.store.endIndex});_!==void 0;)e===`forward`?++this.characterIndex:--this.characterIndex,h=this.line.startIndex+this.characterIndex,_=g.find(function(e){return e.store.startIndex<=h-1&&h<e.store.endIndex})},C.prototype.update=function(){var e=this.view.paddingLeft+this.view.contentFont.widthOf(this.line.content.slice(0,this.characterIndex));this.cursorElement.setAttribute(`d`,`
            M`+e+`,`+this.line.y+`
            L`+e+`,`+(this.line.y+this.view.contentFont.lineHeight)+`
        `),this.hiddenTextAreaElement.style.top=this.parentSVGYOffset+this.line.y+`px`,this.hiddenTextAreaElement.style.left=this.cursorElement.getBoundingClientRect().left+`px`},C.prototype.caretChanged=function(e){var h=window.getSelection();if(h.type===`Caret`){var g=document.querySelector(`svg`).getClientRects()[0];if(h.anchorNode.parentNode!==null){var _=h.anchorNode.parentNode.getExtentOfChar(0);if(g.top+_.y+this.view.contentFont.lineHeight<=e){var v=h.anchorNode.parentNode.nextSibling.annotatorElement;this._lineIndex=this.view.lines.indexOf(v),this.characterIndex=0,this.avoidInLabel(`forward`)}else v=h.anchorNode.parentNode.annotatorElement,this._lineIndex=this.view.lines.indexOf(v),this.characterIndex=h.anchorOffset,this.avoidInLabel(`forward`);this.update(),this.hiddenTextAreaElement.focus({preventScroll:!0})}}},C.prototype.constructHiddenTextAreaElement=function(){var e;this.hiddenTextAreaElement=document.createElement(`textarea`),this.hiddenTextAreaElement.setAttribute(`autocorrect`,`off`),this.hiddenTextAreaElement.setAttribute(`autocapitalize`,`off`),this.hiddenTextAreaElement.setAttribute(`spellcheck`,`false`),(e=this.hiddenTextAreaElement.classList).add.apply(e,v(this.view.config.contentClasses)),this.hiddenTextAreaElement.style.position=`absolute`,this.hiddenTextAreaElement.style.padding=`0`,this.hiddenTextAreaElement.style.width=`100vw`,this.hiddenTextAreaElement.style.height=`1em`,this.hiddenTextAreaElement.style.outline=`none`,this.hiddenTextAreaElement.style.zIndex=`-1`,this.hiddenTextAreaElement.style.borderStyle=`none`,this.hiddenTextAreaElement.style.fontFamily=this.view.contentFont.fontFamily,this.hiddenTextAreaElement.style.fontSize=this.view.contentFont.fontSize+`px`,this.hiddenTextAreaElement.style.fontWeight=this.view.contentFont.fontWeight,this.hiddenTextAreaElement.style.opacity=`0`},C.prototype.constructCaretElement=function(){this.cursorElement=document.createElementNS(y.SVGNS,`path`),this.cursorElement.setAttribute(`stroke`,`#000000`),this.cursorElement.setAttribute(`stroke-width`,`1.5`),this.cursorElement.style.animationName=`cursor`,this.cursorElement.style.animationDuration=`0.75s`,this.cursorElement.style.animationTimingFunction=`ease-out`,this.cursorElement.style.animationDirection=`alternate`,this.cursorElement.style.animationIterationCount=`infinite`},C.prototype.hide=function(){this.cursorElement.style.display=`none`},C.prototype.show=function(){this.cursorElement.style.display=`inline`},C.prototype.remove=function(){this.hiddenTextAreaElement.remove()},C);function C(e){this.view=e,this.cursorElement=null,this.hiddenTextAreaElement=null,this.parentSVGYOffset=null;var h=document.getElementsByTagName(`head`)[0],g=document.createElement(`style`);g.innerHTML=`@keyframes cursor { from { opacity: 0; } to { opacity: 1; }  }`,h.appendChild(g),this._lineIndex=0,this._characterIndex=0,this.inComposition=!1}h.ContentEditor=S},function(e,h,g){Object.defineProperty(h,`__esModule`,{value:!0});var _={contentClasses:[`poplar-annotation-content`],labelClasses:[`poplar-annotation-label`],connectionClasses:[`poplar-annotation-connection`],labelPadding:2,lineHeight:1.5,topContextMargin:3,bracketWidth:8,allowMultipleLabel:`differentCategory`,allowMultipleConnection:`differentCategory`,labelWidthCalcMethod:`max`,connectionWidthCalcMethod:`line`,labelOpacity:90,defaultLabelColor:`#ff9d61`,selectingAreaStrip:/[\n ]/,unconnectedLineStyle:`curve`,contentEditable:!0};h.parseInput=function(e){var h={};for(var g in _)h[g]=e[g]===void 0?_[g]:e[g];return h}},function(e,h,g){var _=this&&this.__read||function(e,h){var g=typeof Symbol==`function`&&e[Symbol.iterator];if(!g)return e;var _,v,y=g.call(e),b=[];try{for(;(h===void 0||0<h--)&&!(_=y.next()).done;)b.push(_.value)}catch(e){v={error:e}}finally{try{_&&!_.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}return b};Object.defineProperty(h,`__esModule`,{value:!0});var v=g(2),y=g(4),b=(x.prototype.getSelectionInfo=function(){var e,h=this,g=window.getSelection();y.assert(g.type===`Range`);var b,x,S,C,w=null,T=null;try{w=g.anchorNode.parentNode,T=g.focusNode.parentNode}catch{return null}try{if(b=w.annotatorElement,x=T.annotatorElement,b.view!==this.root.view||x.view!==this.root.view)return null;S=b.startIndex+g.anchorOffset,C=x.startIndex+g.focusOffset}catch{return null}return C<S&&(e=_([C,S],2),S=e[0],C=e[1]),v.fromNullable(this.config.selectingAreaStrip).map(function(e){for(;e.test(h.root.store.content[S]);)++S;for(;e.test(h.root.store.content[C-1]);)--C}),C<=S?null:{startIndex:S,endIndex:C}},x.prototype.textSelected=function(){var e,h=this.getSelectionInfo();h&&this.root.emit(`textSelected`,h.startIndex,h.endIndex),(e=window.getSelection())==null||e.removeAllRanges()},x);function x(e,h){this.root=e,this.config=h}h.TextSelectionHandler=b},function(e,h,g){var _=this&&this.__read||function(e,h){var g=typeof Symbol==`function`&&e[Symbol.iterator];if(!g)return e;var _,v,y=g.call(e),b=[];try{for(;(h===void 0||0<h--)&&!(_=y.next()).done;)b.push(_.value)}catch(e){v={error:e}}finally{try{_&&!_.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}return b},v=this&&this.__spread||function(){for(var e=[],h=0;h<arguments.length;h++)e=e.concat(_(arguments[h]));return e};Object.defineProperty(h,`__esModule`,{value:!0});function y(e,h){var g,_=this;this.root=e,this.config=h,this.lastSelection=x.none,this.svgElement=document.createElementNS(b.SVGNS,`path`),(g=this.svgElement.classList).add.apply(g,v(e.view.config.connectionClasses.map(function(e){return e+`-line`}))),this.svgElement.setAttribute(`fill`,`none`),this.svgElement.style.markerEnd=`url(#marker-arrow)`,this.root.on(`labelClicked`,function(e){_.lastSelection.isSome?(_.root.emit(`twoLabelsClicked`,_.lastSelection.toNullable().id,e),_.svgElement.remove(),_.svgElement.setAttribute(`d`,``),_.lastSelection=x.none):(_.lastSelection=x.some(_.root.view.labelViewRepository.get(e)),_.root.view.svgElement.insertBefore(_.svgElement,_.root.view.svgElement.firstChild))}),this.root.view.svgElement.onmousemove=function(e){_.lastSelection.map(function(g){var v=g.labelLeft+1,y=g.labelRight-1,b=g.globalY+1,x=e.clientX-_.root.view.svgElement.getBoundingClientRect().left,S=e.clientY-_.root.view.svgElement.getBoundingClientRect().top,C=(v+y)/2<x?v:y;if(h.unconnectedLineStyle===`straight`)_.svgElement.setAttribute(`d`,`
                    M`+C+`,`+b+`
                    L`+x+`,`+S+`
                `);else if(h.unconnectedLineStyle===`curve`){var w=(v-x)/4,T=Math.min(b,S)-20;_.svgElement.setAttribute(`d`,`
                        M`+C+`,`+b+`
                        C`+(C-w)+`,`+T+`,`+(x+w)+`,`+T+`,`+x+`,`+S+`
                    `)}})},this.root.view.svgElement.oncontextmenu=function(e){_.lastSelection.map(function(){_.svgElement.remove(),_.svgElement.setAttribute(`d`,``),_.lastSelection=x.none,e.preventDefault()})}}var b=g(0),x=g(2);h.TwoLabelsClickedHandler=y},function(e,h,g){Object.defineProperty(h,`__esModule`,{value:!0});var _=g(9);(function(e){var h=(g.prototype.apply=function(e){e.connectionRepo.add(new _.Connection.Entity(null,this.categoryId,this.fromId,this.toId,e))},g);function g(e,h,g){this.categoryId=e,this.fromId=h,this.toId=g}e.CreateConnectionAction=h,e.Create=function(e,g,_){return new h(e,g,_)};var v=(y.prototype.apply=function(e){e.connectionRepo.delete(this.id)},y);function y(e){this.id=e}function b(e){return new v(e)}e.DeleteConnectionAction=v,e.Delete=b;var x=(S.prototype.apply=function(e){var h=e.connectionRepo.get(this.connectionId);b(this.connectionId).apply(e),e.connectionRepo.add(new _.Connection.Entity(this.connectionId,this.categoryId,h.fromId,h.toId,e))},S);function S(e,h){this.connectionId=e,this.categoryId=h}e.UpdateConnectionAction=x,e.Update=function(e,h){return new x(e,h)}})(h.Connection||={})},function(e,h,g){var _=this&&this.__values||function(e){var h=typeof Symbol==`function`&&Symbol.iterator,g=h&&e[h],_=0;if(g)return g.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&_>=e.length&&(e=void 0),{value:e&&e[_++],done:!e}}};throw TypeError(h?`Object is not iterable.`:`Symbol.iterator is not defined.`)};Object.defineProperty(h,`__esModule`,{value:!0});var v=g(8);(function(e){var h=(g.prototype.apply=function(e){if(e.content.slice(this.startIndex,this.endIndex).includes(`
`))throw Error(`Insert label across hard line is not supported now! Please remove the \\n in content first!`);e.labelRepo.add(new v.Label.Entity(null,this.categoryId,this.startIndex,this.endIndex,e))},g);function g(e,h,g){this.categoryId=e,this.startIndex=h,this.endIndex=g}e.CreateLabelAction=h,e.Create=function(e,g,_){return new h(e,g,_)};var y=(b.prototype.apply=function(e){var h,g;try{for(var v=_(e.labelRepo.get(this.id).allConnections),y=v.next();!y.done;y=v.next()){var b=y.value;e.connectionRepo.delete(b)}}catch(e){h={error:e}}finally{try{y&&!y.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}e.labelRepo.delete(this.id)},b);function b(e){this.id=e}function x(e){return new y(e)}e.DeleteLabelAction=y,e.Delete=x;var S=(C.prototype.apply=function(e){var h=e.labelRepo.get(this.labelId),g=h.allConnections;x(this.labelId).apply(e),e.labelRepo.add(new v.Label.Entity(this.labelId,this.categoryId,h.startIndex,h.endIndex,e)),g.forEach(function(h){return e.connectionRepo.add(h)})},C);function C(e,h){this.labelId=e,this.categoryId=h}e.UpdateLabelAction=S,e.Update=function(e,h){return new S(e,h)}})(h.Label||={})},function(e,h,g){var _,v;function y(e,h,g){this.startIndex=e,this.removeLength=h,this.insert=g}Object.defineProperty(h,`__esModule`,{value:!0}),_=h.Content||={},y.prototype.apply=function(e){if(!e.config.contentEditable)throw Error(`Content edition is not on!`);e.spliceContent(this.startIndex,this.removeLength,this.insert)},v=y,_.SpliceAction=v,_.Splice=function(e,h,g){return new v(e,h,g)}}],e.c=g,e.d=function(h,g,_){e.o(h,g)||Object.defineProperty(h,g,{enumerable:!0,get:_})},e.r=function(e){typeof Symbol<`u`&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:`Module`}),Object.defineProperty(e,`__esModule`,{value:!0})},e.t=function(h,g){if(1&g&&(h=e(h)),8&g||4&g&&typeof h==`object`&&h&&h.__esModule)return h;var _=Object.create(null);if(e.r(_),Object.defineProperty(_,`default`,{enumerable:!0,value:h}),2&g&&typeof h!=`string`)for(var v in h)e.d(_,v,function(e){return h[e]}.bind(null,v));return _},e.n=function(h){var g=h&&h.__esModule?function(){return h.default}:function(){return h};return e.d(g,`a`,g),g},e.o=function(e,h){return Object.prototype.hasOwnProperty.call(e,h)},e.p=``,e(e.s=12);function e(_){if(g[_])return g[_].exports;var v=g[_]={i:_,l:!1,exports:{}};return h[_].call(v.exports,v,v.exports,e),v.l=!0,v.exports}var h,g})}))(),labelCategoryDialog_default=_plugin_vue_export_helper_default(defineComponent({__name:`index`,props:mergeModels({LabelCategorys:{}},{visible:{default:!1},visibleModifiers:{}}),emits:mergeModels([`updateLable`],[`update:visible`]),setup(e,{emit:g}){let _=g,y=useModel(e,`visible`),w=ref(),T=()=>{w.value!==null&&_(`updateLable`,w.value),w.value=void 0};return watchEffect(()=>{}),(e,g)=>{let _=ElOption,E=ElSelect,D=ElDialog;return openBlock(),createElementBlock(`div`,null,[createVNode(D,{title:``,modelValue:y.value,"onUpdate:modelValue":g[1]||=e=>y.value=e,width:`240`},{default:withCtx(()=>[createVNode(E,{modelValue:w.value,"onUpdate:modelValue":g[0]||=e=>w.value=e,placeholder:``,onChange:T},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.LabelCategorys,e=>(openBlock(),createBlock(_,{key:e.id,label:e.text,value:e.id},{default:withCtx(()=>[createBaseVNode(`span`,{class:`w-3 h-3 mr-1 inline-block`,style:normalizeStyle({backgroundColor:e.color})},null,4),createBaseVNode(`span`,null,toDisplayString(e.text),1)]),_:2},1032,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1},8,[`modelValue`])])}}}),[[`__scopeId`,`data-v-291685b6`]]),connectionCategoryDialog_default=_plugin_vue_export_helper_default(defineComponent({__name:`index`,props:{visible:{type:Boolean,default:()=>!1},connectionCategories:{}},emits:[`update:visible`,`updateConnection`],setup(e,{emit:g}){let _=e,y=g,C=computed({get(){return _.visible},set(e){y(`update:visible`,e)}}),w=ref(),T=()=>{w.value!==null&&y(`updateConnection`,w.value),w.value=void 0};return(e,g)=>{let _=resolveComponent(`Link`),y=ElIcon,E=ElOption,D=ElSelect,A=ElDialog;return openBlock(),createElementBlock(`div`,null,[createVNode(A,{title:``,modelValue:C.value,"onUpdate:modelValue":g[1]||=e=>C.value=e,width:`300`},{default:withCtx(()=>[createVNode(D,{modelValue:w.value,"onUpdate:modelValue":g[0]||=e=>w.value=e,placeholder:``,onChange:T},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.connectionCategories,e=>(openBlock(),createBlock(E,{key:e.id,label:e.text,value:e.id},{default:withCtx(()=>[createVNode(y,{color:`#fb9776`,size:`16`,class:`mr-1 translate-y-[2px]`},{default:withCtx(()=>[createVNode(_)]),_:1}),createBaseVNode(`span`,null,toDisplayString(e.text),1)]),_:2},1032,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1},8,[`modelValue`])])}}}),[[`__scopeId`,`data-v-c44b241c`]]),_hoisted_1={class:`h-full`},_hoisted_2={class:`p-5`},_hoisted_3={class:`flex`},_hoisted_4={class:`editor w-1/2`},_hoisted_5={class:`ml-5 w-1/2`},_hoisted_6={class:`dark:border-dark-border mb-3 rounded border border-[#dedede] px-2 py-3`},_hoisted_7={class:`mt-4 flex items-center`},CategorySelectModes=function(e){return e[e.CREATE=0]=`CREATE`,e[e.UPDATE=1]=`UPDATE`,e}(CategorySelectModes||{}),text_annotation_default=_plugin_vue_export_helper_default(defineComponent({__name:`index`,setup(h){let g=ref(null),_=ref(``),C=ref(CategorySelectModes.CREATE),T=ref(!1),E=ref(!1),D=reactive({startIndex:-1,endIndex:-1,selectedId:-1,sourceId:-1,targetId:-1}),O={topContextMargin:0,connectionWidthCalcMethod:`line`,unconnectedLineStyle:`curve`,labelWidthCalcMethod:`label`},k=()=>{let e={content:_.value,labelCategories:[{id:0,text:``,color:`#fae88e`,borderColor:`#dfc33a`},{id:1,text:``,color:`#cdec90`,borderColor:`#98d918`},{id:2,text:``,color:`#7da1ed`,borderColor:`#265ac9`}],labels:[{id:0,categoryId:0,startIndex:0,endIndex:2},{id:1,categoryId:1,startIndex:8,endIndex:9},{id:2,categoryId:2,startIndex:23,endIndex:24}],connectionCategories:[{id:0,text:`1`},{id:1,text:`2`}],connections:[{id:0,categoryId:0,fromId:0,toId:1},{id:1,categoryId:1,fromId:1,toId:2}]},h=document.getElementById(`example`);g.value&&g.value.remove(),g.value=new import_dist.Annotator(e,h,O),g.value.on(`textSelected`,(e,h)=>{D.startIndex=e,D.endIndex=h,T.value=!0,C.value=CategorySelectModes.CREATE}),g.value.on(`labelRightClicked`,e=>{g.value.applyAction(import_dist.Action.Label.Delete(e))}),g.value.on(`labelDoubleClicked`,e=>{C.value=CategorySelectModes.UPDATE,D.selectedId=e,T.value=!0}),g.value.on(`twoLabelsClicked`,(e,h)=>{e!==h&&(D.sourceId=e,D.targetId=h,C.value=CategorySelectModes.CREATE,E.value=!0)}),g.value.on(`connectionDoubleClicked`,e=>{D.selectedId=e,C.value=CategorySelectModes.UPDATE,E.value=!0}),g.value.on(`connectionRightClicked`,e=>{g.value.applyAction(import_dist.Action.Connection.Delete(e))})},L=e=>{C.value===CategorySelectModes.CREATE?g.value.applyAction(import_dist.Action.Label.Create(e,D.startIndex,D.endIndex)):g.value.applyAction(import_dist.Action.Label.Update(D.selectedId,e)),T.value=!1},z=e=>{C.value===CategorySelectModes.CREATE?g.value.applyAction(import_dist.Action.Connection.Create(e,D.sourceId,D.targetId)):g.value.applyAction(import_dist.Action.Connection.Update(D.selectedId,e)),E.value=!1},U=()=>{let e=document.createElement(`a`);e.download=`data.json`,e.style.display=`none`;let h=new Blob([JSON.stringify(g.value.store.json,null,4)]);e.href=URL.createObjectURL(h),document.body.appendChild(e),e.click(),document.body.removeChild(e)},W=()=>{let e=document.createElement(`a`);e.download=`data.svg`,e.style.display=`none`;let h=new Blob([g.value.export()]);e.href=URL.createObjectURL(h),document.body.appendChild(e),e.click(),document.body.removeChild(e)},G=computed(()=>{if(g.value===null)return[];let e=[];for(let[h,_]of g.value.store.labelCategoryRepo)e.push(_);return e}),K=computed(()=>{if(g.value===null)return[];let e=[];for(let[h,_]of g.value.store.connectionCategoryRepo)e.push(_);return e}),q=computed(()=>{if(g.value===null)return[];let e=[],h=[];for(let[e,_]of g.value.store.labelCategoryRepo)h.push(_);for(let[h,_]of g.value.store.labelRepo)e.push(_.json);let _=e.reduce((e,h)=>(e.set(h.categoryId,(e.get(h.categoryId)||0)+1),e),new Map);return h.forEach(e=>{let h=e.id;_.has(h)&&(e.num=_.get(h))}),h});return onMounted(()=>{_.value=` `}),(h,C)=>{let D=ElLink,O=ElInput,N=ElButton,I=ElTag,B=ElBadge;return openBlock(),createElementBlock(`div`,_hoisted_1,[C[10]||=createBaseVNode(`h2`,{class:`title w-full`},``,-1),createBaseVNode(`div`,_hoisted_2,[createVNode(D,{href:`https://github.com/synyi/poplar/blob/master/doc/zh.md`,target:`_blank`},{default:withCtx(()=>C[3]||=[createTextVNode(`Poplar-annotator`)]),_:1}),createBaseVNode(`div`,_hoisted_3,[createBaseVNode(`div`,_hoisted_4,[C[5]||=createBaseVNode(`h4`,{class:`my-1`},``,-1),createVNode(O,{modelValue:_.value,"onUpdate:modelValue":C[0]||=e=>_.value=e,type:`textarea`,resize:`none`,rows:10,placeholder:``},null,8,[`modelValue`]),createVNode(N,{class:`mt-[10px]`,type:`primary`,onClick:k},{default:withCtx(()=>C[4]||=[createTextVNode(``)]),_:1})]),createBaseVNode(`div`,_hoisted_5,[C[8]||=createBaseVNode(`h4`,{class:`my-1`},``,-1),createBaseVNode(`div`,_hoisted_6,[(openBlock(!0),createElementBlock(Fragment,null,renderList(q.value,e=>(openBlock(),createBlock(B,{key:e.id,value:e.num,class:`item mr-4`,type:`warning`},{default:withCtx(()=>[createVNode(I,{hit:!0,color:e.color},{default:withCtx(()=>[createTextVNode(toDisplayString(e.text),1)]),_:2},1032,[`color`])]),_:2},1032,[`value`]))),128))]),C[9]||=createBaseVNode(`div`,{id:`example`,class:`dark:border-dark-border h-[300px] overflow-hidden rounded border border-[#dedede]`},null,-1),createBaseVNode(`div`,_hoisted_7,[withDirectives(createVNode(N,{type:`primary`,onClick:U},{default:withCtx(()=>C[6]||=[createTextVNode(`JSON`)]),_:1},512),[[vShow,g.value]]),withDirectives(createVNode(N,{type:`primary`,onClick:W},{default:withCtx(()=>C[7]||=[createTextVNode(`SVG`)]),_:1},512),[[vShow,g.value]])])])])]),createVNode(labelCategoryDialog_default,{visible:T.value,"onUpdate:visible":C[1]||=e=>T.value=e,LabelCategorys:G.value,onUpdateLable:L},null,8,[`visible`,`LabelCategorys`]),createVNode(connectionCategoryDialog_default,{visible:E.value,"onUpdate:visible":C[2]||=e=>E.value=e,connectionCategories:K.value,onUpdateConnection:z},null,8,[`visible`,`connectionCategories`])])}}}),[[`__scopeId`,`data-v-a33f485d`]]);export{text_annotation_default as default};