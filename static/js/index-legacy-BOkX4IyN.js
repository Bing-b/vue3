System.register(["./base-legacy-B15TsDT-.js","./el-badge-legacy-C_Cj1V8i.js","./el-tag-legacy-C4ACRu79.js","./el-button-legacy-DM6LSoeO.js","./el-input-legacy-DHX0GcqF.js","./el-link-legacy-DoyNY7lL.js","./core-legacy-DGIjYafI.js","./el-overlay-legacy-DwQ5YFhU.js","./el-select-legacy-Dh6gvrsl.js","./el-scrollbar-legacy-DP7Vsl5u.js","./el-popper-legacy-DZqE8YS_.js","./ui-legacy-Dm5jL3jW.js","./main-legacy-DA2-yfmK.js"],(function(e,t){"use strict";var n,o,r,i,l,a,s,c,u,d,h,f,p,y,v,m,b,g,x,w,E,C,L,_,I,S,O,j,A,R,V,P;return{setters:[null,null,null,null,null,null,e=>{n=e.x,o=e.aX,r=e.az,i=e.r,l=e.h,a=e.y,s=e.z,c=e.P,u=e.H,d=e.O,h=e.a6,f=e.G,p=e.A,y=e.C,v=e.M,m=e.c,b=e.ag,g=e.X,x=e.k,w=e.L,E=e.I,C=e.Q},null,null,null,null,e=>{L=e.G,_=e.H,I=e.I,S=e.B,O=e.D,j=e.n,A=e.m,R=e.J,V=e.K},e=>{P=e._}],execute:function(){var t=document.createElement("style");t.textContent="[data-v-291685b6] .el-dialog__title{font-size:16px}[data-v-291685b6] .el-dialog__body{padding:10px 20px 15px}[data-v-c44b241c] .el-dialog__title{font-size:16px}[data-v-c44b241c] .el-dialog__body{padding:10px 20px 15px}[data-v-a33f485d] .el-tag{color:#333;border:none}#example[data-v-a33f485d]{padding:20px 10px;overflow:auto}#example[data-v-a33f485d] svg{width:100%;font-size:15px}#example[data-v-a33f485d] svg .poplar-annotation-label{font-size:14px}#example[data-v-a33f485d] svg .poplar-annotation-connection-line{stroke:#fb9776;transform:translateY(3px)}#example[data-v-a33f485d] svg .poplar-annotation-connection-line:hover{stroke:red}#example[data-v-a33f485d] svg .poplar-annotation-connection{font-size:14px;transform:translateY(-3px)}#example[data-v-a33f485d] svg #marker-arrow path{fill:#fb9776;stroke:#fb9776}#example[data-v-a33f485d] svg tspan{fill:#464646}\n/*$vite$:1*/",document.head.appendChild(t);var k,M={exports:{}},N=(k||(k=1,function(e){window,e.exports=function(){return n={},e.m=t=[function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.SVGNS="http://www.w3.org/2000/svg"},function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var l,a,s,c=n(4),u=n(3);function d(){var e=null!==a&&a.apply(this,arguments)||this;return e.entities=new Map,e.nextId=0,e}l=t.Base||(t.Base={}),r(d,a=u.EventEmitter),Object.defineProperty(d.prototype,"json",{get:function(){var e,t,n=[];try{for(var o=i(this.values()),r=o.next();!r.done;r=o.next()){var l=r.value;"json"in l?n.push(l.json):n.push(JSON.parse(JSON.stringify(l)))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"length",{get:function(){return this.entities.size},enumerable:!0,configurable:!0}),d.prototype.get=function(e){return c.assert(this.has(e),"There's no Entity which id="+e+" in repo!"),this.entities.get(e)},d.prototype.has=function(e){return this.entities.has(e)},d.prototype.set=function(e,t){var n=this.has(e);return this.entities.set(e,t),n?this.emit("updated",t):(this.nextId<e+1&&(this.nextId=e+1),this.emit("created",t)),this},d.prototype.add=function(e){if("id"in e){var t=e.id;return c.assert(!this.has(t),"reAdd "+t+"!"),null===t?(e.id=this.nextId,this.add(e)):(this.set(t,e),t)}var n=this.nextId;return this.set(n,e),n},d.prototype[Symbol.iterator]=function(){return this.entities[Symbol.iterator]()},d.prototype.delete=function(e){if("number"==typeof e&&this.has(e)){var t=this.get(e);return this.entities.delete(e),this.emit("removed",t),!0}return"number"!=typeof e&&"id"in e&&this.delete(e.id)},d.prototype.values=function(){return this.entities.values()},s=d,l.Repository=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=(Object.defineProperty(r.prototype,"isSome",{get:function(){return null!==this.value},enumerable:!0,configurable:!0}),r.prototype.map=function(e){return null===this.value?new r(null):new r(e(this.value))},r.prototype.flatMap=function(e){return null===this.value?new r(null):l(e(this.value).toNullable())},r.prototype.orElse=function(e){return null===this.value?e:this.value},r.prototype.toNullable=function(){return this.value},r.prototype.match=function(e,t){return this.isSome?e:t},r);function r(e){this.value=e}function i(e){return new o(e)}function l(e){return null==e?t.none:i(e)}t.Option=o,t.none=new o(null),t.some=i,t.fromNullable=l,t.fromTry=function(e){try{return i(e())}catch(e){return t.none}}},function(e,t,n){var o,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};o=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var l=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}((e.exports=a).EventEmitter=a).prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function u(e,t,n,o){var r,i,l;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),l=i[t]),void 0===l)l=i[t]=n,++e._eventsCount;else if("function"==typeof l?l=i[t]=o?[n,l]:[l,n]:o?l.unshift(n):l.push(n),0<(r=c(e))&&l.length>r&&!l.warned){l.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=l.length,function(e){console&&console.warn&&console.warn(e)}(a)}return e}function d(e,t,n){var o={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,i(this.listener,this.target,e))}.bind(o);return r.listener=n,o.wrapFn=r}function h(e,t,n){var o=e._events;if(void 0===o)return[];var r=o[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),o=0;o<t;++o)n[o]=e[o];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||l(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||l(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o="error"===e,r=this._events;if(void 0!==r)o=o&&void 0===r.error;else if(!o)return!1;if(o){var l;if(0<t.length&&(l=t[0]),l instanceof Error)throw l;var a=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw a.context=l,a}var s=r[e];if(void 0===s)return!1;if("function"==typeof s)i(s,this,t);else{var c=s.length,u=p(s,c);for(n=0;n<c;++n)i(u[n],this,t)}return!0},a.prototype.on=a.prototype.addListener=function(e,t){return u(this,e,t,!1)},a.prototype.prependListener=function(e,t){return u(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,d(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,d(this,e,t)),this},a.prototype.off=a.prototype.removeListener=function(e,t){var n,o,r,i,l;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(o=this._events))return this;if(void 0===(n=o[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,i=n.length-1;0<=i;i--)if(n[i]===t||n[i].listener===t){l=n[i].listener,r=i;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(o[e]=n[0]),void 0!==o.removeListener&&this.emit("removeListener",e,l||t)}return this},a.prototype.removeAllListeners=function(e){var t,n,o;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,i=Object.keys(n);for(o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(o=t.length-1;0<=o;o--)this.removeListener(e,t[o]);return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},a.prototype.listenerCount=f,a.prototype.eventNames=function(){return 0<this._eventsCount?o(this._events):[]}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.shadeColor=function(e,t){var n=parseInt(e.slice(1),16),o=Math.min((n>>16)+(n>>16)*t/100,255),r=Math.min((n>>8&255)+(n>>8&255)*t/100,255);return"#"+(Math.min((255&n)+(255&n)*t/100,255)|r<<8|o<<16).toString(16)},t.addAlpha=function(e,t){var n=parseInt(e.slice(1),16);return"rgba("+(n>>16)+","+(n>>8&255)+","+(255&n)+","+t+"%)"}},function(e,t,n){function o(){this.layer=0}Object.defineProperty(t,"__esModule",{value:!0}),t.TopContextUser=o,t.overLaps=function e(t,n){return t.layer===n.layer&&(t.left>n.left?e(n,t):!(t.left+t.width<n.left))}},function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)l.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return l},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(0),c=n(1),u=n(5);!function(e){var t,n=(t=a.TopContextUser,r(o,t),Object.defineProperty(o.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lineIn",{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"view",{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"highLightWidth",{get:function(){return this.view.contentWidth(this.store.startIndex,this.store.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"highLightLeft",{get:function(){return this.view.contentWidth(this.lineIn.startIndex,this.store.startIndex)+this.lineIn.view.paddingLeft},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"middle",{get:function(){return this.highLightLeft+this.highLightWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"labelLeft",{get:function(){return this.middle-this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"labelRight",{get:function(){return this.middle+this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"labelWidth",{get:function(){return this.view.labelFont.widthOf(this.store.category.text)+this.config.labelPadding+2},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"left",{get:function(){return"max"===this.config.labelWidthCalcMethod?this.labelWidth>this.highLightWidth?this.labelLeft:this.highLightLeft:this.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"width",{get:function(){return"max"===this.config.labelWidthCalcMethod?this.labelWidth>this.highLightWidth-1?this.labelWidth:this.highLightWidth-1:this.labelWidth},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"annotationY",{get:function(){return-this.view.topContextLayerHeight*(this.layer-1)-(this.view.labelFont.lineHeight+2+2*this.config.labelPadding+this.config.bracketWidth)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"globalY",{get:function(){return this.lineIn.y+this.annotationY},enumerable:!0,configurable:!0}),o.prototype.render=function(){var e;this.svgElement=document.createElementNS(s.SVGNS,"g"),(e=this.svgElement.classList).add.apply(e,l(this.config.labelClasses));var t=this.createHighLightElement(),n=this.createAnnotationElement(),o=this.view.topContextLayerHeight*(this.layer-1),r=this.createBracketElement(this.highLightWidth,-o,0,-o,this.config.bracketWidth);return this.svgElement.appendChild(t),this.svgElement.appendChild(n),this.svgElement.appendChild(r),this.svgElement},o.prototype.update=function(){this.svgElement.style.transform="translate("+this.highLightLeft+"px,"+this.lineIn.y+"px)"},o.prototype.remove=function(){this.svgElement.remove()},o.prototype.createHighLightElement=function(){var e=document.createElementNS(s.SVGNS,"rect"),t=this.store.category.color;return e.setAttribute("height",this.lineIn.view.contentFont.lineHeight.toString()),e.setAttribute("width",this.highLightWidth.toString()),e.setAttribute("fill",/^#/g.test(t)?u.addAlpha(t,70):t),e},o.prototype.createBracketElement=function(e,t,n,o,r,i){void 0===i&&(i=.6);var l=e-n,a=t-o,c=Math.sqrt(l*l+a*a),u=e+i*r*(a/=c),d=t-i*r*(l/=c),h=e-.25*c*l+(1-i)*r*a,f=t-.25*c*a-(1-i)*r*l,p=e-.5*c*l+r*a,y=t-.5*c*a-r*l,v=n+i*r*a,m=o-i*r*l,b=e-.75*c*l+(1-i)*r*a,g=t-.75*c*a-(1-i)*r*l,x=document.createElementNS(s.SVGNS,"path");return x.setAttribute("d","M"+e+","+t+"Q"+u+","+d+","+h+","+f+"T"+p+","+y+"M"+n+","+o+"Q"+v+","+m+","+b+","+g+"T"+p+","+y),x.setAttribute("fill","none"),x.setAttribute("stroke",this.store.category.borderColor),x},o.prototype.createAnnotationElement=function(){var e=this,t=this.view.labelCategoryElementFactoryRepository.get(this.store.category.id).create();return t.style.transform="translate("+(this.highLightWidth-this.labelWidth)/2+"px,"+this.annotationY+"px)",t.onclick=function(t){e.view.root.emit("labelClicked",e.id,t)},t.ondblclick=function(t){e.view.root.emit("labelDoubleClicked",e.id,t)},t.oncontextmenu=function(t){e.view.root.emit("labelRightClicked",e.id,t),t.preventDefault()},t.onmouseenter=function(){e.svgElement.classList.add("hover"),Array.from(e.store.connectionsFrom).map((function(t){return e.view.connectionViewRepository.get(t.id)})).map((function(e){return e.addHover("from")})),Array.from(e.store.connectionsTo).map((function(t){return e.view.connectionViewRepository.get(t.id)})).map((function(e){return e.addHover("to")}))},t.onmouseleave=function(){e.svgElement.classList.remove("hover"),Array.from(e.store.connectionsFrom).map((function(t){return e.view.connectionViewRepository.get(t.id)})).map((function(e){return e.removeHover("from")})),Array.from(e.store.connectionsTo).map((function(t){return e.view.connectionViewRepository.get(t.id)})).map((function(e){return e.removeHover("to")}))},t},o);function o(e,n,o){var r=t.call(this)||this;return r.store=e,r.contextIn=n,r.config=o,r.layer=0,r.svgElement=null,r}e.Entity=n;var i,d=(i=c.Base.Repository,r(h,i),h.prototype.get=function(e){return this.entities.get(e)},h);function h(){return null!==i&&i.apply(this,arguments)||this}e.Repository=d}(t.LabelView||(t.LabelView={}))},function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var l=n(1);!function(e){var t=(Object.defineProperty(n.prototype,"startIndex",{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endIndex",{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),n.prototype.move=function(e){this._startIndex+=e,this._endIndex+=e},Object.defineProperty(n.prototype,"category",{get:function(){return this.root.labelCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"json",{get:function(){return{id:this.id,categoryId:this.categoryId,startIndex:this.startIndex,endIndex:this.endIndex}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sameLineConnections",{get:function(){var e,t,n=[];try{for(var o=i(this.root.connectionRepo.values()),r=o.next();!r.done;r=o.next()){var l=r.value;l.priorLabel===this&&n.push(l)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"connectionsFrom",{get:function(){var e,t,n=new Set;try{for(var o=i(this.root.connectionRepo.values()),r=o.next();!r.done;r=o.next()){var l=r.value;l.from===this&&n.add(l)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"connectionsTo",{get:function(){var e,t,n=new Set;try{for(var o=i(this.root.connectionRepo.values()),r=o.next();!r.done;r=o.next()){var l=r.value;l.to===this&&n.add(l)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allConnections",{get:function(){return new Set(Array.prototype.concat(Array.from(this.connectionsFrom),Array.from(this.connectionsTo)))},enumerable:!0,configurable:!0}),n);function n(e,t,n,o,r){this.id=e,this.categoryId=t,this._startIndex=n,this._endIndex=o,this.root=r}e.Entity=t;var o,a,s=(o=l.Base.Repository,r(c,o),c.prototype.set=function(e,t){return this.againstMultipleLabelWith(t)?console.warn("try set a label against the againstMultipleLabelWith rule!"):o.prototype.set.call(this,e,t),this},c.prototype.add=function(e){return this.againstMultipleLabelWith(e)?(console.warn("try add a label against the againstMultipleLabelWith rule!"),-1):o.prototype.add.call(this,e)},c.prototype.againstMultipleLabelWith=function(e){function t(e,t){return e.startIndex===t.startIndex&&e.endIndex===t.endIndex}var n="notAllowed"===this.config.allowMultipleLabel?t:function(e,n){return t(e,n)&&e.categoryId==n.categoryId};return Array.from(this.values()).some((function(t){return n(t,e)}))},c.prototype.getEntitiesInRange=function(e,t){return Array.from(this.entities.values()).filter((function(n){return e<=n.startIndex&&n.endIndex<=t}))},c.prototype.getEntitiesCross=function(e){return Array.from(this.entities.values()).filter((function(t){return t.startIndex<=e&&e<t.endIndex}))},c);function c(e){var t=o.call(this)||this;return t.config=e,t}function u(e,n){return new t(e.id,e.categoryId,e.startIndex,e.endIndex,n)}e.Repository=s,(a=e.Factory||(e.Factory={})).create=u,a.createAll=function(e,t){return e.map((function(e){return u(e,t)}))}}(t.Label||(t.Label={}))},function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);!function(e){var t=(Object.defineProperty(n.prototype,"category",{get:function(){return this.root.connectionCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"from",{get:function(){return this.root.labelRepo.get(this.fromId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"to",{get:function(){return this.root.labelRepo.get(this.toId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"priorLabel",{get:function(){return this.from.startIndex<this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"posteriorLabel",{get:function(){return this.from.startIndex>=this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"json",{get:function(){return{id:this.id,categoryId:this.categoryId,fromId:this.fromId,toId:this.toId}},enumerable:!0,configurable:!0}),n);function n(e,t,n,o,r){this.id=e,this.categoryId=t,this.fromId=n,this.toId=o,this.root=r}e.Entity=t;var o,l,a=(o=i.Base.Repository,r(s,o),s.prototype.set=function(e,t){return this.againstMultipleConnectionRuleWith(t)?console.warn("try set a label against the checkMultipleLabel rule!"):o.prototype.set.call(this,e,t),this},s.prototype.add=function(e){return this.againstMultipleConnectionRuleWith(e)?(console.warn("try add a label against the checkMultipleLabel rule!"),-1):o.prototype.add.call(this,e)},s.prototype.againstMultipleConnectionRuleWith=function(e){function t(e,t){return e.from===t.from&&e.to===t.to}var n="notAllowed"===this.config.allowMultipleConnection?t:function(e,n){return t(e,n)&&e.categoryId==n.categoryId};return Array.from(this.values()).some((function(t){return n(t,e)}))},s);function s(e){var t=o.call(this)||this;return t.config=e,t}function c(e,n){return new t(e.id,e.categoryId,e.fromId,e.toId,n)}e.Repository=a,(l=e.Factory||(e.Factory={})).create=c,l.createAll=function(e,t){return e.map((function(e){return c(e,t)}))}}(t.Connection||(t.Connection={}))},function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)l.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return l},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(0),c=n(6);!function(e){var t,n=(t=c.TopContextUser,r(o,t),Object.defineProperty(o.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lineIn",{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"view",{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sameLineLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.priorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"mayNotSameLineLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.posteriorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"fromLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.from.id)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"toLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.to.id)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"leftLabelView",{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rightLabelView",{get:function(){return this.fromLabelView.labelLeft>=this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"middle",{get:function(){return(this.leftLabelView.labelLeft+this.rightLabelView.labelRight)/2},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textWidth",{get:function(){return this.view.connectionFont.widthOf(this.store.category.text)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textLeft",{get:function(){return this.middle-this.textWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lineIncludedWidth",{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.toLabelView.labelRight-this.fromLabelView.labelLeft:this.fromLabelView.labelRight-this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lineIncludedLeft",{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView.labelLeft:this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"width",{get:function(){return"text"===this.config.connectionWidthCalcMethod?this.textWidth:this.lineIncludedWidth},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"left",{get:function(){return"text"===this.config.connectionWidthCalcMethod?this.textLeft:this.lineIncludedLeft},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"globalY",{get:function(){return this.lineIn.y-this.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),o.prototype.render=function(){var e=this;this.svgElement=document.createElementNS(s.SVGNS,"g");var t=this.view.connectionCategoryElementFactoryRepository.get(this.store.category.id).create();return this.svgElement.appendChild(t),this.svgElement.style.cursor="pointer",this.svgElement.onclick=function(t){e.view.root.emit("connectionClicked",e.id,t)},this.svgElement.ondblclick=function(t){e.view.root.emit("connectionDoubleClicked",e.id,t)},this.svgElement.oncontextmenu=function(t){e.view.root.emit("connectionRightClicked",e.id,t),t.preventDefault()},this.svgElement.onmouseenter=function(){e.svgElement.classList.add("hover"),e.lineElement.classList.add("hover")},this.svgElement.onmouseleave=function(){e.svgElement.classList.remove("hover"),e.lineElement.classList.remove("hover")},this.renderLine(),this.svgElement},o.prototype.update=function(){this.svgElement.style.transform="translate("+this.textLeft+"px,"+this.globalY+"px)",this.updateLine()},o.prototype.addHover=function(e){this.svgElement.classList.add("hover-"+e),this.lineElement.classList.add("hover-"+e)},o.prototype.removeHover=function(e){this.svgElement.classList.remove("hover-"+e),this.lineElement.classList.remove("hover-"+e)},o.prototype.remove=function(){this.svgElement.remove(),this.lineElement.remove()},o.prototype.updateLine=function(){var e=this.globalY+this.view.topContextLayerHeight/2-this.view.labelFont.fontSize+2;this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.lineElement.setAttribute("d","\n                    M "+(this.fromLabelView.labelLeft+1)+"   "+(this.fromLabelView.globalY+1)+"\n                    C "+(this.fromLabelView.labelLeft-8)+"  "+e+",\n                      "+(this.fromLabelView.labelLeft-8)+"  "+e+",\n                      "+(this.fromLabelView.labelLeft+1)+"   "+e+"\n                    L "+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+" "+e+"\n                    C "+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+"  "+e+",\n                      "+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+"  "+e+",\n                      "+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+"   "+(this.toLabelView.globalY-1)+"\n                "):this.lineElement.setAttribute("d","\n                    M "+(this.fromLabelView.labelRight-1)+"   "+(this.fromLabelView.globalY+1)+"\n                    C "+(this.fromLabelView.labelRight+8)+"  "+e+",\n                      "+(this.fromLabelView.labelRight+8)+"  "+e+",\n                      "+(this.fromLabelView.labelRight-1)+"   "+e+"\n                    L "+this.toLabelView.labelLeft+"          "+e+"\n                    C "+(this.toLabelView.labelLeft-8)+"  "+e+",\n                      "+(this.toLabelView.labelLeft-8)+"  "+e+",\n                      "+this.toLabelView.labelLeft+"   "+(this.toLabelView.globalY-1)+"\n                ")},o.prototype.renderLine=function(){var e;this.lineElement=document.createElementNS(s.SVGNS,"path"),(e=this.lineElement.classList).add.apply(e,l(this.config.connectionClasses.map((function(e){return e+"-line"})))),this.lineElement.setAttribute("fill","none"),this.lineElement.style.markerEnd="url(#marker-arrow)",this.updateLine(),this.contextIn.backgroundElement.appendChild(this.lineElement)},o);function o(e,n,o){var r=t.call(this)||this;return r.store=e,r.contextIn=n,r.config=o,r.svgElement=null,r.lineElement=null,r}e.Entity=n;var i,u=(i=a.Base.Repository,r(d,i),d);function d(){return null!==i&&i.apply(this,arguments)||this}e.Repository=u}(t.ConnectionView||(t.ConnectionView={}))},function(e,t,n){var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)l.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return l},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var i,l,a=n(0);function s(e,t,n,o,r,i){this.fontFamily=e,this.fontSize=t,this.fontWeight=n,this.lineHeight=o,this.topToBaseLine=r,this.width=i}i=t.Font||(t.Font={}),s.prototype.widthOf=function(e){var t=this;return"string"==typeof e?this.widthOf(Array.from(e)):e.map((function(e){return t.width.get(e)})).reduce((function(e,t){return e+t}),0)},l=s,i.ValueObject=l,function(e){function t(e,t,n){var o=new Map,r=new Set(e);r.delete("\n");var i=Array.from(r);t.textContent=i.join(""),t.parentNode.parentNode.insertBefore(n,t.parentNode),i.forEach((function(e,n){o.set(e,t.getExtentOfChar(n).width)}));var a=n.getBoundingClientRect().top-t.getBoundingClientRect().top,s=parseFloat(window.getComputedStyle(t).fontSize),c=window.getComputedStyle(t).fontFamily,u=window.getComputedStyle(t).fontWeight,d=t.getBoundingClientRect().height;return new l(c,s,u,d,a,o)}e.create=t;var n=(o.prototype.thanCreate=function(e,n){var o,i;(o=this.measuringElement.classList).add.apply(o,r(e));var l=t(n,this.measuringElement,this.baseLineReferenceElement);return(i=this.measuringElement.classList).remove.apply(i,r(e)),this.result.push(l),this},o.prototype.endBatch=function(){return this.baseLineReferenceElement.remove(),this.measuringElement.remove(),this.result},o);function o(e,t){this.svgElement=e,this.textElement=t,this.baseLineReferenceElement=document.createElementNS(a.SVGNS,"rect"),this.baseLineReferenceElement.setAttribute("width","1px"),this.baseLineReferenceElement.setAttribute("height","1px"),this.svgElement.appendChild(this.baseLineReferenceElement),this.measuringElement=document.createElementNS(a.SVGNS,"tspan"),this.textElement.appendChild(this.measuringElement),this.result=[]}e.startBatch=function(e,t){return new n(e,t)}}(i.Factory||(i.Factory={})),(i.Service||(i.Service={})).measureMore=function(e,t,n,o){var i,l=new Set(t);l.delete("\n");var s=Array.from(l).filter((function(t){return!e.width.has(t)}));if(0<s.length){var c=document.createElementNS(a.SVGNS,"tspan");(i=c.classList).add.apply(i,r(n)),c.textContent=s.join(""),o.appendChild(c),s.forEach((function(t,n){e.width.set(t,c.getExtentOfChar(n).width)})),c.remove()}return e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=n(13);t.Annotator=o.Annotator;var r=n(27),i=n(28),l=n(29),a={Connection:r.Connection,Label:i.Label,Content:l.Content};t.Action=a},function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,l=n(3),a=n(14),s=n(17),c=n(0),u=n(24),d=n(25),h=n(26),f=(r(p,i=l.EventEmitter),p.prototype.applyAction=function(e){e.apply(this.store)},p.prototype.export=function(){this.view.contentEditor.hide();var e=this.view.svgElement.outerHTML.replace(/&nbsp;/," ");return this.view.contentEditor.show(),e},p.prototype.remove=function(){this.view.svgElement.remove(),this.store.config.contentEditable&&this.view.contentEditor.remove()},p);function p(e,t,n){var o=i.call(this)||this;o.containerElement=t,o.configInput=n;var r=u.parseInput(n||{});o.store=new a.Store(r),o.store.json="string"==typeof e?JSON.parse(e):e;var l=document.createElementNS(c.SVGNS,"svg");return l.setAttribute("xmlns",c.SVGNS),t.appendChild(l),o.view=new s.View(o,l,r),o.textSelectionHandler=new d.TextSelectionHandler(o,r),o.twoLabelsClickedHandler=new h.TwoLabelsClickedHandler(o,r),o}t.Annotator=f},function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,l=n(15),a=n(8),s=n(16),c=n(9),u=n(3),d=(r(h,i=u.EventEmitter),Object.defineProperty(h.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"json",{get:function(){return{content:this._content,labelCategories:this.labelCategoryRepo.json,labels:this.labelRepo.json,connectionCategories:this.connectionCategoryRepo.json,connections:this.connectionRepo.json}},set:function(e){var t=this;this._content=e.content.endsWith("\n")?e.content:e.content+"\n",l.LabelCategory.Factory.createAll(e.labelCategories,this.config).map((function(e){return t.labelCategoryRepo.add(e)})),a.Label.Factory.createAll(e.labels,this).map((function(e){return t.labelRepo.add(e)})),e.connectionCategories.map((function(e){return t.connectionCategoryRepo.add(e)})),c.Connection.Factory.createAll(e.connections,this).map((function(e){return t.connectionRepo.add(e)}))},enumerable:!0,configurable:!0}),h.prototype.contentSlice=function(e,t){return this.content.slice(e,t)},h.prototype.moveLabels=function(e,t){Array.from(this.labelRepo.values()).filter((function(t){return t.startIndex>=e})).map((function(e){return e.move(t)}))},h.prototype.spliceContent=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var r=e+t;if(0===t||void 0===Array.from(this.labelRepo.values()).find((function(t){return t.startIndex<=e&&e<t.endIndex||t.startIndex<r&&r<t.endIndex}))){var i=this.content.slice(0,e),l=this.content.slice(e,e+t),a=n.join(""),s=this.content.slice(e+t);this._content=i+a+s,this.moveLabels(e+t,a.length-l.length),this.emit("contentSpliced",e,l,a)}},h);function h(e){var t=i.call(this)||this;return t._content="",t.config=e,t.labelCategoryRepo=new l.LabelCategory.Repository,t.labelRepo=new a.Label.Repository(e),t.connectionCategoryRepo=new s.ConnectionCategory.Repository,t.connectionRepo=new c.Connection.Repository(e),t}t.Store=d},function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,l,a,s,c=n(1),u=n(5);function d(){return null!==l&&l.apply(this,arguments)||this}function h(e,t){var n=e.borderColor,o=e.color;return!e.borderColor&&e["border-color"]&&(n=e["border-color"]),e.color||(o=t),e.borderColor||(n=u.shadeColor(o,-30)),{id:e.id,text:e.text,color:o,borderColor:n}}i=t.LabelCategory||(t.LabelCategory={}),r(d,l=c.Base.Repository),s=d,i.Repository=s,(a=i.Factory||(i.Factory={})).create=h,a.createAll=function(e,t){return e.map((function(e){return h(e,t.defaultLabelColor)}))}},function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,l,a,s=n(1);function c(){return null!==l&&l.apply(this,arguments)||this}i=t.ConnectionCategory||(t.ConnectionCategory={}),r(c,l=s.Base.Repository),a=c,i.Repository=a},function(e,t,n){var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)l.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return l},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),a=n(18),s=n(11),c=n(21),u=n(7),d=n(10),h=n(22),f=n(23),p=n(2),y=(v.layoutTopContextsAfter=function(e){for(;e.next.isSome;)e.topContext.update(),e=e.next.toNullable();e.topContext.update()},v.prototype.constructLabelViewsForLine=function(e){var t=this,n=this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map((function(n){return new u.LabelView.Entity(n,e.topContext,t.config)}));return n.map((function(e){return t.labelViewRepository.add(e)})),n.map((function(t){return e.topContext.addChild(t)})),n},v.prototype.constructConnectionsForLine=function(e){var t=this;return this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map((function(n){var o=n.sameLineConnections.filter((function(e){return!t.connectionViewRepository.has(e.id)})).map((function(n){return new d.ConnectionView.Entity(n,e.topContext,t.config)}));return o.map((function(e){return t.connectionViewRepository.add(e)})),o.map((function(t){return e.topContext.addChild(t)})),o})).reduce((function(e,t){return e.concat(t)}),[])},Object.defineProperty(v.prototype,"height",{get:function(){var e=this;return this.lines.reduce((function(t,n){return t+n.height+e.contentFont.fontSize*(e.config.lineHeight-1)}),20)},enumerable:!0,configurable:!0}),v.createMarkerElement=function(){var e=document.createElementNS(l.SVGNS,"path");e.setAttribute("d","M0,4 L0,8 L6,6 L0,4 L0,8"),e.setAttribute("stroke","#000000"),e.setAttribute("fill","#000000");var t=document.createElementNS(l.SVGNS,"marker");return t.setAttribute("id","marker-arrow"),t.setAttribute("markerWidth","8"),t.setAttribute("markerHeight","10"),t.setAttribute("orient","auto"),t.setAttribute("refX","5"),t.setAttribute("refY","6"),t.appendChild(e),t},v.prototype.contentWidth=function(e,t){return this.contentFont.widthOf(this.store.contentSlice(e,t))},v.prototype.removeLine=function(e){var t=this;e.remove(),e.topContext.children.forEach((function(e){e instanceof u.LabelView.Entity?t.labelViewRepository.delete(e):e instanceof d.ConnectionView.Entity&&t.connectionViewRepository.delete(e)}))},v.prototype.registerEventHandlers=function(){var e=this;this.textElement.onmouseup=function(t){"Range"===window.getSelection().type?e.root.textSelectionHandler.textSelected():e.config.contentEditable&&e.contentEditor.caretChanged(t.clientY)},this.store.labelRepo.on("created",this.onLabelCreated.bind(this)),this.store.labelRepo.on("removed",(function(t){var n=e.labelViewRepository.get(t.id);n.lineIn.topContext.removeChild(n),n.remove(),e.labelViewRepository.delete(n),n.lineIn.topContext.update(),n.lineIn.update(),v.layoutTopContextsAfter(n.lineIn),e.config.contentEditable&&e.contentEditor.update()})),this.store.connectionRepo.on("created",this.onConnectionCreated.bind(this)),this.store.connectionRepo.on("removed",(function(t){var n=e.connectionViewRepository.get(t.id);n.lineIn.topContext.removeChild(n),n.remove(),e.connectionViewRepository.delete(n),n.lineIn.topContext.update(),n.lineIn.update(),v.layoutTopContextsAfter(n.lineIn),e.config.contentEditable&&e.contentEditor.update()})),this.config.contentEditable&&this.store.on("contentSpliced",this.onContentSpliced.bind(this))},v.prototype.rerenderLines=function(e,t){for(var n,o,l,s,c,u,d,h=this.lines[0].svgElement.parentElement,f=e;f<=t;++f)this.removeLine(this.lines[f]);var y=this.lines[e],v=this.lines[t],m=a.Line.Service.divide(this,y.startIndex,v.endIndex);for(0!==m.length&&(m[0].last=y.last,y.last.map((function(e){return e.next=p.some(m[0])})),m[m.length-1].next=v.next,v.next.map((function(e){return e.last=p.some(m[m.length-1])})),(n=this.lines).splice.apply(n,r([e,t-e+1],m)),0===e?v.next.isSome?m[0].insertBefore(v.next):m[0].insertInto(h):m[0].insertAfter(y.last)),f=1;f<m.length;++f)m[f].insertAfter(p.some(m[f-1]));function b(e){g.constructLabelViewsForLine(e).map((function(t){return e.topContext.renderChild(t)}))}var g=this;try{for(var x=i(m),w=x.next();!w.done;w=x.next())b(O=w.value)}catch(e){o={error:e}}finally{try{w&&!w.done&&(l=x.return)&&l.call(x)}finally{if(o)throw o.error}}function E(e){C.constructConnectionsForLine(e).map((function(t){return e.topContext.renderChild(t)}))}var C=this;try{for(var L=i(m),_=L.next();!_.done;_=L.next())E(O=_.value)}catch(e){s={error:e}}finally{try{_&&!_.done&&(c=L.return)&&c.call(L)}finally{if(s)throw s.error}}try{for(var I=i(m),S=I.next();!S.done;S=I.next()){var O;(O=S.value).update(),O.topContext.update()}}catch(e){u={error:e}}finally{try{S&&!S.done&&(d=I.return)&&d.call(I)}finally{if(u)throw u.error}}},v.prototype.onLabelCreated=function(e){var t=o(this.findRangeInLines(e.startIndex,e.endIndex),2),n=t[0];if(t[1]===n+1){var r=this.lines[n],i=new u.LabelView.Entity(e,r.topContext,this.config);this.labelViewRepository.add(i),r.topContext.addChild(i),r.topContext.renderChild(i),r.topContext.update(),r.update()}else{var l=this.findHardLineEndsInIndex(n);this.rerenderLines(n,l)}v.layoutTopContextsAfter(this.lines[n]),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},v.prototype.findRangeInLines=function(e,t){var n=0,o=0;return this.lines.forEach((function(r,i){r.startIndex<=e&&e<r.endIndex&&(n=i),r.startIndex<=t-1&&t-1<r.endIndex&&(o=i+1)})),[n,o]},v.prototype.onConnectionCreated=function(e){var t=this.labelViewRepository.get(e.priorLabel.id),n=t.lineIn.topContext,o=new d.ConnectionView.Entity(e,n,this.config);this.connectionViewRepository.add(o),n.addChild(o),n.renderChild(o),n.update(),t.lineIn.update(),v.layoutTopContextsAfter(t.lineIn),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},v.prototype.onContentSpliced=function(e,t,n){""!==t&&this.onRemoved(e,t),""!==n&&this.onInserted(e,n)},v.prototype.onRemoved=function(e,t){var n=o(this.findRangeInLines(e,e+1),2),r=n[0];n[1],this.lines[r].startIndex===e-t.length?this.lines[r].move(-t.length):this.lines[r].inserted(-t.length);for(var i=r+1;i<this.lines.length;)this.lines[i].move(-t.length),++i;var l=this.findHardLineEndsInIndex(r);if("\n"===t&&this.lines[r].isBlank){var a=this.lines[r].last,s=this.lines[r].next;this.lines[r].remove(),this.lines.splice(r,1),a.map((function(e){return e.next=s})),s.map((function(e){return e.last=a}))}else this.rerenderLines(r,l);v.layoutTopContextsAfter(this.lines[l-1]);var c=Array.from(t).filter((function(e){return"\n"===e})).length;0===c?(this.contentEditor.characterIndex-=t.length,this.contentEditor.avoidInLabel("forward")):0<=this.contentEditor.lineIndex-c&&(this.contentEditor.lineIndex-=c,this.contentEditor.characterIndex=this.contentEditor.line.content.length,this.contentEditor.avoidInLabel("forward")),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},v.prototype.onInserted=function(e,t){var n=o(this.findRangeInLines(e,e+1),2),r=n[0];n[1],this.lines[r].startIndex===e+t.length?this.lines[r].move(t.length):this.lines[r].inserted(t.length);for(var i=r+1;i<this.lines.length;)this.lines[i].move(t.length),++i;var l=this.findHardLineEndsInIndex(r);this.rerenderLines(r,l),v.layoutTopContextsAfter(this.lines[l]);var a=Array.from(t),s=a.filter((function(e){return"\n"===e})).length,c=a.lastIndexOf("\n"),u=t.length-c;0===s?this.contentEditor.characterIndex+=t.length:(this.contentEditor.lineIndex+=s,this.contentEditor.characterIndex=u-1),this.contentEditor.avoidInLabel("forward"),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},v.prototype.findHardLineEndsInIndex=function(e){var t;for(t=e;t<this.lines.length-1&&!this.lines[t].endWithHardLineBreak;++t);return t},v.prototype.collectStyle=function(){var e=document.createElementNS(l.SVGNS,"style"),t="\n        "+this.config.contentClasses.map((function(e){return"."+e})).join(",")+" {\n            font-family: "+this.contentFont.fontFamily+";\n            font-weight: "+this.contentFont.fontWeight+";\n            font-size: "+this.contentFont.fontSize+"px;\n            line-height: "+this.contentFont.lineHeight+"px;\n        }\n        ",n="\n        "+this.config.labelClasses.map((function(e){return"."+e})).join(",")+" {\n            font-family: "+this.labelFont.fontFamily+";\n            font-weight: "+this.labelFont.fontWeight+";\n            font-size: "+this.labelFont.fontSize+"px;\n        }\n        ",o=this.config.connectionClasses.map((function(e){return"."+e})).join(","),r=this.config.connectionClasses.map((function(e){return"."+e+"-line"})).join(","),i="\n        "+o+" {\n            font-family: "+this.connectionFont.fontFamily+";\n            font-weight: "+this.connectionFont.fontWeight+";\n            font-size: "+this.connectionFont.fontSize+"px;\n        }\n        "+r+" {\n            stroke: #000;\n        }\n        ";return e.innerHTML=t+n+i,e},Object.defineProperty(v.prototype,"paddingLeft",{get:function(){var e=this;return Math.max.apply(Math,r(Array.from(this.store.labelCategoryRepo.values()).map((function(t){return e.labelFont.widthOf(t.text)}))))/2+1},enumerable:!0,configurable:!0}),v);function v(e,t,n){var i,p,y;this.root=e,this.svgElement=t,this.config=n,this.contentEditor=null,this.store=e.store,this.labelViewRepository=new u.LabelView.Repository,this.connectionViewRepository=new d.ConnectionView.Repository,this.markerElement=v.createMarkerElement(),this.svgElement.appendChild(this.markerElement),this.textElement=document.createElementNS(l.SVGNS,"text"),this.textElement.style.whiteSpace="pre",this.textElement.style.wordWrap="normal",this.svgElement.appendChild(this.textElement);var m=Array.from(this.store.labelCategoryRepo.values()).map((function(e){return e.text})).join(""),b=Array.from(this.store.connectionCategoryRepo.values()).map((function(e){return e.text})).join("");i=o(s.Font.Factory.startBatch(t,this.textElement).thanCreate(n.contentClasses,this.store.content).thanCreate(n.labelClasses,m).thanCreate(n.connectionClasses,b).endBatch(),3),this.contentFont=i[0],this.labelFont=i[1],this.connectionFont=i[2];var g=this.labelFont.lineHeight+2+2*n.labelPadding+n.bracketWidth;this.topContextLayerHeight=2*n.topContextMargin+Math.max(g,this.connectionFont.lineHeight),(p=this.textElement.classList).add.apply(p,r(n.contentClasses)),this.labelCategoryElementFactoryRepository=new c.LabelCategoryElement.FactoryRepository(this,n),this.connectionCategoryElementFactoryRepository=new h.ConnectionCategoryElement.FactoryRepository(this,n),this.lineMaxWidth=t.width.baseVal.value-2*this.paddingLeft,this.lines=a.Line.Service.divide(this,0,this.store.content.length),this.lines.map(this.constructLabelViewsForLine.bind(this)),this.lines.map(this.constructConnectionsForLine.bind(this));var x=this.lines.map((function(e){return e.render()}));if((y=this.textElement).append.apply(y,r(x)),this.svgElement.style.height=this.height.toString()+"px",this.registerEventHandlers(),this.config.contentEditable){this.contentEditor=new f.ContentEditor(this);var w=o(this.contentEditor.render(),2),E=w[0],C=w[1];this.svgElement.appendChild(E),this.svgElement.parentNode.insertBefore(C,this.svgElement)}this.svgElement.appendChild(this.collectStyle())}t.View=y},function(e,t,n){var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)l.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return l},r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),l=n(0),a=n(19),s=n(20);!function(e){var t=(Object.defineProperty(n.prototype,"startIndex",{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endIndex",{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),n.prototype.move=function(e){this._startIndex+=e,this._endIndex+=e},n.prototype.inserted=function(e){this._endIndex+=e},Object.defineProperty(n.prototype,"dy",{get:function(){return this.last.match(this.view.contentFont.fontSize*this.config.lineHeight,this.view.contentFont.topToBaseLine)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.topContext.layer*this.view.topContextLayerHeight+this.view.contentFont.fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){var e=this;return s.takeWhile(this.view.lines,(function(t){return t!==e})).reduce((function(t,n){return t+n.height+e.view.contentFont.fontSize*(e.config.lineHeight-1)}),0)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBlank",{get:function(){return""===this.view.store.content.slice(this.startIndex,this.endIndex-1)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"content",{get:function(){return this.endWithHardLineBreak?this.isBlank?"":this.view.store.content.slice(this.startIndex,this.endIndex-1):this.view.store.content.slice(this.startIndex,this.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endWithHardLineBreak",{get:function(){return"\n"===this.view.store.content[this.endIndex-1]},enumerable:!0,configurable:!0}),n.prototype.update=function(){this.svgElement.innerHTML=this.content.replace(/ /g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.isBlank&&(this.svgElement.style.fontSize=this.view.contentFont.fontSize/4+"px"),this.svgElement.setAttribute("x",this.view.paddingLeft.toString()),this.svgElement.setAttribute("dy",this.dy.toString()+"px")},n.prototype.render=function(){this.svgElement=document.createElementNS(l.SVGNS,"tspan");var e=o(this.topContext.render(),2),t=e[0],n=e[1];return this.view.svgElement.insertBefore(t,this.view.textElement),this.view.markerElement.insertAdjacentElement("afterend",n),Object.assign(this.svgElement,{annotatorElement:this}),this.update(),this.svgElement},n.prototype.remove=function(){this.topContext.remove(),this.svgElement.remove()},n.prototype.insertBefore=function(e){var t=this;this.render(),e.map((function(e){e.svgElement.parentNode.insertBefore(t.svgElement,e.svgElement),e.topContext.svgElement.parentNode.insertBefore(t.topContext.svgElement,e.topContext.svgElement),e.topContext.backgroundElement.parentNode.insertBefore(t.topContext.backgroundElement,e.topContext.backgroundElement)}))},n.prototype.insertAfter=function(e){var t=this;this.render(),e.map((function(e){e.svgElement.insertAdjacentElement("afterend",t.svgElement),e.topContext.svgElement.insertAdjacentElement("afterend",t.topContext.svgElement),e.topContext.backgroundElement.insertAdjacentElement("afterend",t.topContext.backgroundElement)}))},n.prototype.insertInto=function(e){this.render(),e.appendChild(this.svgElement)},n);function n(e,t,n,o,r){this.last=n,this.next=o,this.view=r,this.svgElement=null,this._startIndex=e,this._endIndex=t,this.topContext=new a.TopContext(this),this.config=r.config}e.ValueObject=t;var c=(Object.defineProperty(u.prototype,"store",{get:function(){return this.view.store},enumerable:!0,configurable:!0}),u.prototype.divide=function(e,t){var n,o;this.init();var l=e,a=e+1;do{var s=this.mergeLabel(a),c=this.mergeWord(s),u=s===a&&s===c;"\n"===this.store.content[a-1]?(0===this.tokenQueue.length?this.reduce(a-1,a):this.reduce(this.tokenQueue[0].startIndex,a),l=a):u&&(this.shiftWithAutoReduce({startIndex:l,endIndex:a}),l=a),++a}while(l<t);function d(e){h.map((function(t){return t.next=i.some(e)})),e.last=h,h=i.some(e)}0!==this.tokenQueue.length&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex);var h=i.none;try{for(var f=r(this.result),p=f.next();!p.done;p=f.next())d(p.value)}catch(e){n={error:e}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(n)throw n.error}}return this.result},u.prototype.init=function(){this.result=[],this.tokenQueue=[]},u.prototype.mergeLabel=function(e){return this.store.labelRepo.getEntitiesCross(e-1).some((function(t){return t.endIndex>e}))?this.store.labelRepo.getEntitiesCross(e-1).filter((function(t){return t.endIndex>e})).sort((function(e,t){return t.endIndex-e.endIndex}))[0].endIndex:e},u.prototype.mergeWord=function(e){u.wordReg.lastIndex=0;var t=u.wordReg.exec(this.store.contentSlice(e-1,e+1));return null===t?e:2===t[0].length?e+1:e},u.prototype.reduce=function(t,n){var o=new e.ValueObject(t,n,i.none,i.none,this.view);this.result.push(o),this.tokenQueue=[]},u.prototype.shiftWithAutoReduce=function(e){var t=0===this.tokenQueue.length?0:this.view.contentWidth(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),n=this.view.contentWidth(e.startIndex,e.endIndex);0!==this.tokenQueue.length&&t+n>this.view.lineMaxWidth&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),n>this.view.lineMaxWidth?(this.reduce(e.startIndex,e.endIndex),console.warn('the token "'+this.store.contentSlice(e.startIndex,e.endIndex)+'" is too long for a line!')):this.tokenQueue.push(e)},u.wordReg=/([a-zA-z][a-zA-Z0-9']*[-|.]?)|([+\-]?[0-9.][0-9.%]*)/g,u);function u(e){this.view=e,this.result=[],this.tokenQueue=[]}(e.Service||(e.Service={})).divide=function(e,t,n){return new c(e).divide(t,n)}}(t.Line||(t.Line={}))},function(e,t,n){var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)l.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return l},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),a=n(6),s=n(10),c=n(4),u=n(7),d=(Object.defineProperty(h.prototype,"layer",{get:function(){return 0===this.children.size?0:Math.max.apply(Math,r(Array.from(this.children).map((function(e){return e.layer}))))},enumerable:!0,configurable:!0}),h.prototype.update=function(){var e=this;this.children.forEach((function(e){return e.update()})),Array.from(this.children).filter((function(e){return e instanceof u.LabelView.Entity})).map((function(t){t.store.allConnections.forEach((function(n){if(e.belongTo.view.connectionViewRepository.has(n.id)){var o=e.belongTo.view.connectionViewRepository.get(n.id);o.mayNotSameLineLabelView===t&&o.update()}}))}))},h.prototype.render=function(){var e=this;return this.svgElement=document.createElementNS(l.SVGNS,"g"),this.backgroundElement=document.createElementNS(l.SVGNS,"g"),this.children.forEach((function(t){e.renderChild(t)})),this.update(),[this.svgElement,this.backgroundElement]},h.prototype.addChild=function(e){var t,n,o=this.layer,r=!1;e instanceof s.ConnectionView.Entity&&(e.layer=e.sameLineLabelView.layer);do{++e.layer,r=!1;try{for(var l=(t=void 0,i(this.children)),c=l.next();!c.done;c=l.next()){var u=c.value;if(a.overLaps(e,u)){r=!0;break}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}}while(r);return this.children.add(e),this.layer-o},h.prototype.renderChild=function(e){c.assert(this.children.has(e));var t=e.render();this.svgElement.appendChild(t)},h.prototype.removeChild=function(e){c.assert(this.children.has(e)),this.children.delete(e)},h.prototype.remove=function(){this.svgElement.remove(),this.backgroundElement.remove()},h);function h(e){this.backgroundElement=null,this.svgElement=null,this.children=new Set,this.belongTo=e}t.TopContext=d},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=n(2);t.lookup=function(e,t){return e.length<=t?o.none:o.some(e[t])},t.takeWhile=function(e,t){var n;for(n=0;n<e.length&&t(e[n]);++n);return e.slice(0,n)}},function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var l,a,s,c,u=n(1),d=n(0),h=n(5);function f(e,t,n,o){this.store=e,this.font=t,this.padding=n,this.svgElement=document.createElementNS(d.SVGNS,"g");var r=document.createElementNS(d.SVGNS,"rect");r.setAttribute("fill",/^#/g.test(e.color)?h.addAlpha(e.color,o):e.color),r.setAttribute("stroke",e.borderColor),r.setAttribute("width",this.width.toString()),r.setAttribute("height",(t.lineHeight+2*n).toString()),r.setAttribute("rx",(2*n).toString()),r.style.cursor="pointer";var i=document.createElementNS(d.SVGNS,"text");i.style.userSelect="none",i.style.cursor="pointer",i.textContent=e.text,i.setAttribute("dx",n.toString()),i.setAttribute("dy",t.topToBaseLine+n+"px"),this.svgElement.appendChild(r),this.svgElement.appendChild(i)}function p(e,t){var n,o,r=s.call(this)||this;try{for(var l=i(e.store.labelCategoryRepo.values()),c=l.next();!c.done;c=l.next()){var u=c.value;r.add(new a(u,e.labelFont,t.labelPadding,t.labelOpacity))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}return r}l=t.LabelCategoryElement||(t.LabelCategoryElement={}),Object.defineProperty(f.prototype,"width",{get:function(){return this.font.widthOf(this.store.text)+2*this.padding},enumerable:!0,configurable:!0}),f.prototype.create=function(){return this.svgElement.cloneNode(!0)},Object.defineProperty(f.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),a=f,r(p,s=u.Base.Repository),c=p,l.FactoryRepository=c},function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)l.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return l},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var s,c,u,d,h=n(1),f=n(0);function p(e,t,n){var o;this.store=e,this.svgElement=document.createElementNS(f.SVGNS,"g");var r=document.createElementNS(f.SVGNS,"rect");r.setAttribute("fill","#ffffff"),r.setAttribute("width",t.widthOf(e.text).toString()),r.setAttribute("height",t.lineHeight.toString());var i=document.createElementNS(f.SVGNS,"text");(o=i.classList).add.apply(o,l(n)),i.textContent=e.text,i.setAttribute("dy",t.topToBaseLine+"px"),this.svgElement.appendChild(r),this.svgElement.appendChild(i)}function y(e,t){var n,o,r=u.call(this)||this;r.config=t;try{for(var i=a(e.store.connectionCategoryRepo.values()),l=i.next();!l.done;l=i.next()){var s=l.value;u.prototype.add.call(r,new c(s,e.connectionFont,t.connectionClasses))}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return r}s=t.ConnectionCategoryElement||(t.ConnectionCategoryElement={}),Object.defineProperty(p.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),p.prototype.create=function(){return this.svgElement.cloneNode(!0)},c=p,r(y,u=h.Base.Repository),d=y,s.FactoryRepository=d},function(e,t,n){var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)l.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return l},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),l=n(11),a=n(7),s=(Object.defineProperty(c.prototype,"characterIndex",{get:function(){return this._characterIndex},set:function(e){this.view.lines[this._lineIndex].isBlank?this._characterIndex=0:this._characterIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"lineIndex",{get:function(){return this._lineIndex},set:function(e){this._lineIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"line",{get:function(){return this.view.lines[this.lineIndex]},enumerable:!0,configurable:!0}),c.prototype.render=function(){var e=this;return this.constructCaretElement(),this.constructHiddenTextAreaElement(),this.parentSVGYOffset=this.view.svgElement.getBoundingClientRect().top-document.getElementsByTagName("html")[0].getBoundingClientRect().top,this.hiddenTextAreaElement.onkeyup=function(t){if(!e.inComposition){switch(t.key){case"ArrowLeft":0===e.characterIndex?e.line.last.isSome&&(--e.lineIndex,e.characterIndex=e.line.content.length):(--e.characterIndex,e.avoidInLabel("backward"));break;case"ArrowRight":e.characterIndex>=e.line.content.length||e.line.isBlank?e.line.next.isSome&&(++e.lineIndex,e.characterIndex=0):(++e.characterIndex,e.avoidInLabel("forward"));break;case"ArrowUp":e.line.last.isSome&&--e.lineIndex,e.characterIndex=Math.min(e.characterIndex,e.line.content.length),e.avoidInLabel("forward");break;case"ArrowDown":e.line.next.isSome&&++e.lineIndex,e.characterIndex=Math.min(e.characterIndex,e.line.content.length),e.avoidInLabel("forward");break;case"Backspace":var n=e.line.startIndex+e.characterIndex-1;e.view.root.emit("contentDelete",n,1);break;default:if(""!==e.hiddenTextAreaElement.value){l.Font.Service.measureMore(e.view.contentFont,e.hiddenTextAreaElement.value,e.view.config.contentClasses,e.view.textElement);var o=e.view.lines[e._lineIndex].startIndex+e.characterIndex;e.view.root.emit("contentInput",o,e.hiddenTextAreaElement.value),e.hiddenTextAreaElement.value=""}}e.update()}},this.hiddenTextAreaElement.addEventListener("compositionstart",(function(){e.inComposition=!0})),this.hiddenTextAreaElement.addEventListener("compositionend",(function(){e.inComposition=!1})),this.update(),this.hiddenTextAreaElement.style.opacity="0",[this.cursorElement,this.hiddenTextAreaElement]},c.prototype.avoidInLabel=function(e){for(var t=this.line.startIndex+this.characterIndex,n=Array.from(this.line.topContext.children).filter((function(e){return e instanceof a.LabelView.Entity})),o=n.find((function(e){return e.store.startIndex<=t-1&&t<e.store.endIndex}));void 0!==o;)"forward"===e?++this.characterIndex:--this.characterIndex,t=this.line.startIndex+this.characterIndex,o=n.find((function(e){return e.store.startIndex<=t-1&&t<e.store.endIndex}))},c.prototype.update=function(){var e=this.view.paddingLeft+this.view.contentFont.widthOf(this.line.content.slice(0,this.characterIndex));this.cursorElement.setAttribute("d","\n            M"+e+","+this.line.y+"\n            L"+e+","+(this.line.y+this.view.contentFont.lineHeight)+"\n        "),this.hiddenTextAreaElement.style.top=this.parentSVGYOffset+this.line.y+"px",this.hiddenTextAreaElement.style.left=this.cursorElement.getBoundingClientRect().left+"px"},c.prototype.caretChanged=function(e){var t=window.getSelection();if("Caret"===t.type){var n=document.querySelector("svg").getClientRects()[0];if(null!==t.anchorNode.parentNode){var o=t.anchorNode.parentNode.getExtentOfChar(0);if(n.top+o.y+this.view.contentFont.lineHeight<=e){var r=t.anchorNode.parentNode.nextSibling.annotatorElement;this._lineIndex=this.view.lines.indexOf(r),this.characterIndex=0,this.avoidInLabel("forward")}else r=t.anchorNode.parentNode.annotatorElement,this._lineIndex=this.view.lines.indexOf(r),this.characterIndex=t.anchorOffset,this.avoidInLabel("forward");this.update(),this.hiddenTextAreaElement.focus({preventScroll:!0})}}},c.prototype.constructHiddenTextAreaElement=function(){var e;this.hiddenTextAreaElement=document.createElement("textarea"),this.hiddenTextAreaElement.setAttribute("autocorrect","off"),this.hiddenTextAreaElement.setAttribute("autocapitalize","off"),this.hiddenTextAreaElement.setAttribute("spellcheck","false"),(e=this.hiddenTextAreaElement.classList).add.apply(e,r(this.view.config.contentClasses)),this.hiddenTextAreaElement.style.position="absolute",this.hiddenTextAreaElement.style.padding="0",this.hiddenTextAreaElement.style.width="100vw",this.hiddenTextAreaElement.style.height="1em",this.hiddenTextAreaElement.style.outline="none",this.hiddenTextAreaElement.style.zIndex="-1",this.hiddenTextAreaElement.style.borderStyle="none",this.hiddenTextAreaElement.style.fontFamily=this.view.contentFont.fontFamily,this.hiddenTextAreaElement.style.fontSize=this.view.contentFont.fontSize+"px",this.hiddenTextAreaElement.style.fontWeight=this.view.contentFont.fontWeight,this.hiddenTextAreaElement.style.opacity="0"},c.prototype.constructCaretElement=function(){this.cursorElement=document.createElementNS(i.SVGNS,"path"),this.cursorElement.setAttribute("stroke","#000000"),this.cursorElement.setAttribute("stroke-width","1.5"),this.cursorElement.style.animationName="cursor",this.cursorElement.style.animationDuration="0.75s",this.cursorElement.style.animationTimingFunction="ease-out",this.cursorElement.style.animationDirection="alternate",this.cursorElement.style.animationIterationCount="infinite"},c.prototype.hide=function(){this.cursorElement.style.display="none"},c.prototype.show=function(){this.cursorElement.style.display="inline"},c.prototype.remove=function(){this.hiddenTextAreaElement.remove()},c);function c(e){this.view=e,this.cursorElement=null,this.hiddenTextAreaElement=null,this.parentSVGYOffset=null;var t=document.getElementsByTagName("head")[0],n=document.createElement("style");n.innerHTML="@keyframes cursor { from { opacity: 0; } to { opacity: 1; }  }",t.appendChild(n),this._lineIndex=0,this._characterIndex=0,this.inComposition=!1}t.ContentEditor=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o={contentClasses:["poplar-annotation-content"],labelClasses:["poplar-annotation-label"],connectionClasses:["poplar-annotation-connection"],labelPadding:2,lineHeight:1.5,topContextMargin:3,bracketWidth:8,allowMultipleLabel:"differentCategory",allowMultipleConnection:"differentCategory",labelWidthCalcMethod:"max",connectionWidthCalcMethod:"line",labelOpacity:90,defaultLabelColor:"#ff9d61",selectingAreaStrip:/[\n ]/,unconnectedLineStyle:"curve",contentEditable:!0};t.parseInput=function(e){var t={};for(var n in o)t[n]=void 0!==e[n]?e[n]:o[n];return t}},function(e,t,n){var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)l.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return l};Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(4),l=(a.prototype.getSelectionInfo=function(){var e,t=this,n=window.getSelection();i.assert("Range"===n.type);var l,a,s,c,u=null,d=null;try{u=n.anchorNode.parentNode,d=n.focusNode.parentNode}catch(e){return null}try{if(l=u.annotatorElement,a=d.annotatorElement,l.view!==this.root.view||a.view!==this.root.view)return null;s=l.startIndex+n.anchorOffset,c=a.startIndex+n.focusOffset}catch(e){return null}return c<s&&(e=o([c,s],2),s=e[0],c=e[1]),r.fromNullable(this.config.selectingAreaStrip).map((function(e){for(;e.test(t.root.store.content[s]);)++s;for(;e.test(t.root.store.content[c-1]);)--c})),c<=s?null:{startIndex:s,endIndex:c}},a.prototype.textSelected=function(){var e,t=this.getSelectionInfo();t&&this.root.emit("textSelected",t.startIndex,t.endIndex),null===(e=window.getSelection())||void 0===e||e.removeAllRanges()},a);function a(e,t){this.root=e,this.config=t}t.TextSelectionHandler=l},function(e,t,n){var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)l.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return l},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};function i(e,t){var n,o=this;this.root=e,this.config=t,this.lastSelection=a.none,this.svgElement=document.createElementNS(l.SVGNS,"path"),(n=this.svgElement.classList).add.apply(n,r(e.view.config.connectionClasses.map((function(e){return e+"-line"})))),this.svgElement.setAttribute("fill","none"),this.svgElement.style.markerEnd="url(#marker-arrow)",this.root.on("labelClicked",(function(e){o.lastSelection.isSome?(o.root.emit("twoLabelsClicked",o.lastSelection.toNullable().id,e),o.svgElement.remove(),o.svgElement.setAttribute("d",""),o.lastSelection=a.none):(o.lastSelection=a.some(o.root.view.labelViewRepository.get(e)),o.root.view.svgElement.insertBefore(o.svgElement,o.root.view.svgElement.firstChild))})),this.root.view.svgElement.onmousemove=function(e){o.lastSelection.map((function(n){var r=n.labelLeft+1,i=n.labelRight-1,l=n.globalY+1,a=e.clientX-o.root.view.svgElement.getBoundingClientRect().left,s=e.clientY-o.root.view.svgElement.getBoundingClientRect().top,c=(r+i)/2<a?r:i;if("straight"===t.unconnectedLineStyle)o.svgElement.setAttribute("d","\n                    M"+c+","+l+"\n                    L"+a+","+s+"\n                ");else if("curve"===t.unconnectedLineStyle){var u=(r-a)/4,d=Math.min(l,s)-20;o.svgElement.setAttribute("d","\n                        M"+c+","+l+"\n                        C"+(c-u)+","+d+","+(a+u)+","+d+","+a+","+s+"\n                    ")}}))},this.root.view.svgElement.oncontextmenu=function(e){o.lastSelection.map((function(){o.svgElement.remove(),o.svgElement.setAttribute("d",""),o.lastSelection=a.none,e.preventDefault()}))}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),a=n(2);t.TwoLabelsClickedHandler=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=n(9);!function(e){var t=(n.prototype.apply=function(e){e.connectionRepo.add(new o.Connection.Entity(null,this.categoryId,this.fromId,this.toId,e))},n);function n(e,t,n){this.categoryId=e,this.fromId=t,this.toId=n}e.CreateConnectionAction=t,e.Create=function(e,n,o){return new t(e,n,o)};var r=(i.prototype.apply=function(e){e.connectionRepo.delete(this.id)},i);function i(e){this.id=e}function l(e){return new r(e)}e.DeleteConnectionAction=r,e.Delete=l;var a=(s.prototype.apply=function(e){var t=e.connectionRepo.get(this.connectionId);l(this.connectionId).apply(e),e.connectionRepo.add(new o.Connection.Entity(this.connectionId,this.categoryId,t.fromId,t.toId,e))},s);function s(e,t){this.connectionId=e,this.categoryId=t}e.UpdateConnectionAction=a,e.Update=function(e,t){return new a(e,t)}}(t.Connection||(t.Connection={}))},function(e,t,n){var o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var r=n(8);!function(e){var t=(n.prototype.apply=function(e){if(e.content.slice(this.startIndex,this.endIndex).includes("\n"))throw Error("Insert label across hard line is not supported now! Please remove the \\n in content first!");e.labelRepo.add(new r.Label.Entity(null,this.categoryId,this.startIndex,this.endIndex,e))},n);function n(e,t,n){this.categoryId=e,this.startIndex=t,this.endIndex=n}e.CreateLabelAction=t,e.Create=function(e,n,o){return new t(e,n,o)};var i=(l.prototype.apply=function(e){var t,n;try{for(var r=o(e.labelRepo.get(this.id).allConnections),i=r.next();!i.done;i=r.next()){var l=i.value;e.connectionRepo.delete(l)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}e.labelRepo.delete(this.id)},l);function l(e){this.id=e}function a(e){return new i(e)}e.DeleteLabelAction=i,e.Delete=a;var s=(c.prototype.apply=function(e){var t=e.labelRepo.get(this.labelId),n=t.allConnections;a(this.labelId).apply(e),e.labelRepo.add(new r.Label.Entity(this.labelId,this.categoryId,t.startIndex,t.endIndex,e)),n.forEach((function(t){return e.connectionRepo.add(t)}))},c);function c(e,t){this.labelId=e,this.categoryId=t}e.UpdateLabelAction=s,e.Update=function(e,t){return new s(e,t)}}(t.Label||(t.Label={}))},function(e,t,n){var o,r;function i(e,t,n){this.startIndex=e,this.removeLength=t,this.insert=n}Object.defineProperty(t,"__esModule",{value:!0}),o=t.Content||(t.Content={}),i.prototype.apply=function(e){if(!e.config.contentEditable)throw Error("Content edition is not on!");e.spliceContent(this.startIndex,this.removeLength,this.insert)},r=i,o.SpliceAction=r,o.Splice=function(e,t,n){return new r(e,t,n)}}],e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:o})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(o,r,function(e){return t[e]}.bind(null,r));return o},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=12);function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var t,n}()}(M)),M.exports);const T=n({__name:"index",props:o({LabelCategorys:{}},{visible:{default:!1},visibleModifiers:{}}),emits:o(["updateLable"],["update:visible"]),setup(e,{emit:t}){const n=t,o=r(e,"visible"),m=i(),b=()=>{null!==m.value&&n("updateLable",m.value),m.value=void 0};return l((()=>{console.log(e.LabelCategorys)})),(e,t)=>{const n=I,r=_,i=L;return s(),a("div",null,[c(i,{title:"",modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),width:"240"},{default:u((()=>[c(r,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e),placeholder:"",onChange:b},{default:u((()=>[(s(!0),a(d,null,h(e.LabelCategorys,(e=>(s(),f(n,{key:e.id,label:e.text,value:e.id},{default:u((()=>[p("span",{class:"w-3 h-3 mr-1 inline-block",style:y({backgroundColor:e.color})},null,4),p("span",null,v(e.text),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])}}}),F=P(T,[["__scopeId","data-v-291685b6"]]),W=n({__name:"index",props:{visible:{type:Boolean,default:()=>!1},connectionCategories:{}},emits:["update:visible","updateConnection"],setup(e,{emit:t}){const n=e,o=t,r=m({get:()=>n.visible,set(e){o("update:visible",e)}}),l=i(),y=()=>{null!==l.value&&o("updateConnection",l.value),l.value=void 0};return(e,t)=>{const n=b("Link"),o=S,i=I,m=_,g=L;return s(),a("div",null,[c(g,{title:"",modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),width:"300"},{default:u((()=>[c(m,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),placeholder:"",onChange:y},{default:u((()=>[(s(!0),a(d,null,h(e.connectionCategories,(e=>(s(),f(i,{key:e.id,label:e.text,value:e.id},{default:u((()=>[c(o,{color:"#fb9776",size:"16",class:"mr-1 translate-y-[2px]"},{default:u((()=>[c(n)])),_:1}),p("span",null,v(e.text),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])}}}),H=P(W,[["__scopeId","data-v-c44b241c"]]),B={class:"h-full"},z={class:"p-5"},G={class:"flex"},U={class:"editor w-1/2"},Q={class:"ml-5 w-1/2"},Y={class:"dark:border-dark-border mb-3 rounded border border-[#dedede] px-2 py-3"},D={class:"mt-4 flex items-center"},J=n({__name:"index",setup(e){const t=i(null),n=i(""),o=i(0),r=i(!1),l=i(!1),y=g({startIndex:-1,endIndex:-1,selectedId:-1,sourceId:-1,targetId:-1}),b={topContextMargin:0,connectionWidthCalcMethod:"line",unconnectedLineStyle:"curve",labelWidthCalcMethod:"label"},L=()=>{const e={content:n.value,labelCategories:[{id:0,text:"",color:"#fae88e",borderColor:"#dfc33a"},{id:1,text:"",color:"#cdec90",borderColor:"#98d918"},{id:2,text:"",color:"#7da1ed",borderColor:"#265ac9"}],labels:[{id:0,categoryId:0,startIndex:0,endIndex:2},{id:1,categoryId:1,startIndex:8,endIndex:9},{id:2,categoryId:2,startIndex:23,endIndex:24}],connectionCategories:[{id:0,text:"1"},{id:1,text:"2"}],connections:[{id:0,categoryId:0,fromId:0,toId:1},{id:1,categoryId:1,fromId:1,toId:2}]},i=document.getElementById("example");t.value&&t.value.remove(),t.value=new N.Annotator(e,i,b),t.value.on("textSelected",((e,t)=>{y.startIndex=e,y.endIndex=t,r.value=!0,o.value=0})),t.value.on("labelRightClicked",(e=>{t.value.applyAction(N.Action.Label.Delete(e))})),t.value.on("labelDoubleClicked",(e=>{o.value=1,y.selectedId=e,r.value=!0})),t.value.on("twoLabelsClicked",((e,t)=>{e!==t&&(y.sourceId=e,y.targetId=t,o.value=0,l.value=!0)})),t.value.on("connectionDoubleClicked",(e=>{y.selectedId=e,o.value=1,l.value=!0})),t.value.on("connectionRightClicked",(e=>{t.value.applyAction(N.Action.Connection.Delete(e))}))},_=e=>{0===o.value?t.value.applyAction(N.Action.Label.Create(e,y.startIndex,y.endIndex)):t.value.applyAction(N.Action.Label.Update(y.selectedId,e)),r.value=!1},I=e=>{0===o.value?t.value.applyAction(N.Action.Connection.Create(e,y.sourceId,y.targetId)):t.value.applyAction(N.Action.Connection.Update(y.selectedId,e)),l.value=!1},S=()=>{const e=document.createElement("a");e.download="data.json",e.style.display="none";const n=new Blob([JSON.stringify(t.value.store.json,null,4)]);e.href=URL.createObjectURL(n),document.body.appendChild(e),e.click(),document.body.removeChild(e)},P=()=>{const e=document.createElement("a");e.download="data.svg",e.style.display="none";const n=new Blob([t.value.export()]);e.href=URL.createObjectURL(n),document.body.appendChild(e),e.click(),document.body.removeChild(e)},k=m((()=>{if(null===t.value)return[];const e=[];for(const[n,o]of t.value.store.labelCategoryRepo)e.push(o);return e})),M=m((()=>{if(null===t.value)return[];const e=[];for(const[n,o]of t.value.store.connectionCategoryRepo)e.push(o);return e})),T=m((()=>{if(null===t.value)return[];const e=[],n=[];for(const[r,i]of t.value.store.labelCategoryRepo)n.push(i);for(const[r,i]of t.value.store.labelRepo)e.push(i.json);const o=e.reduce(((e,t)=>(e.set(t.categoryId,(e.get(t.categoryId)||0)+1),e)),new Map);return n.forEach((e=>{const t=e.id;o.has(t)&&(e.num=o.get(t))})),n}));return x((()=>{n.value=" "})),(e,o)=>{const i=O,y=j,m=A,b=R,g=V;return s(),a("div",B,[o[10]||(o[10]=p("h2",{class:"title w-full"},"",-1)),p("div",z,[c(i,{href:"https://github.com/synyi/poplar/blob/master/doc/zh.md",target:"_blank"},{default:u((()=>o[3]||(o[3]=[w("Poplar-annotator")]))),_:1}),p("div",G,[p("div",U,[o[5]||(o[5]=p("h4",{class:"my-1"},"",-1)),c(y,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=e=>n.value=e),type:"textarea",resize:"none",rows:10,placeholder:""},null,8,["modelValue"]),c(m,{class:"mt-[10px]",type:"primary",onClick:L},{default:u((()=>o[4]||(o[4]=[w("")]))),_:1})]),p("div",Q,[o[8]||(o[8]=p("h4",{class:"my-1"},"",-1)),p("div",Y,[(s(!0),a(d,null,h(T.value,(e=>(s(),f(g,{key:e.id,value:e.num,class:"item mr-4",type:"warning"},{default:u((()=>[c(b,{hit:!0,color:e.color},{default:u((()=>[w(v(e.text),1)])),_:2},1032,["color"])])),_:2},1032,["value"])))),128))]),o[9]||(o[9]=p("div",{id:"example",class:"dark:border-dark-border h-[300px] overflow-hidden rounded border border-[#dedede]"},null,-1)),p("div",D,[E(c(m,{type:"primary",onClick:S},{default:u((()=>o[6]||(o[6]=[w("JSON")]))),_:1},512),[[C,t.value]]),E(c(m,{type:"primary",onClick:P},{default:u((()=>o[7]||(o[7]=[w("SVG")]))),_:1},512),[[C,t.value]])])])])]),c(F,{visible:r.value,"onUpdate:visible":o[1]||(o[1]=e=>r.value=e),LabelCategorys:k.value,onUpdateLable:_},null,8,["visible","LabelCategorys"]),c(H,{visible:l.value,"onUpdate:visible":o[2]||(o[2]=e=>l.value=e),connectionCategories:M.value,onUpdateConnection:I},null,8,["visible","connectionCategories"])])}}});e("default",P(J,[["__scopeId","data-v-a33f485d"]]))}}}));
